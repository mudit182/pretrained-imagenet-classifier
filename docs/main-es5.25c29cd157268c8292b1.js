function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_nonIterableRest()}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,a=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(e,t,n){e.exports=n("zUnb")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},zUnb:function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.r(t);var i=!1,a={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=e},get useDeprecatedSynchronousErrorHandling(){return i}};function o(e){setTimeout((function(){throw e}))}var s={closed:!0,next:function(e){},error:function(e){if(a.useDeprecatedSynchronousErrorHandling)throw e;o(e)},complete:function(){}},u=Array.isArray||function(e){return e&&"number"==typeof e.length};function l(e){return null!==e&&"object"==typeof e}function c(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map((function(e,t){return"".concat(t+1,") ").concat(e.toString())})).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}c.prototype=Object.create(Error.prototype);var h,p=c,f=((h=function(){function e(t){_classCallCheck(this,e),this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return _createClass(e,[{key:"unsubscribe",value:function(){var e,t=!1;if(!this.closed){var n=this._parent,i=this._parents,a=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,c=i?i.length:0;n;)n.remove(this),n=++s<c&&i[s]||null;if(r(a))try{a.call(this)}catch(yE){t=!0,e=yE instanceof p?d(yE.errors):[yE]}if(u(o))for(s=-1,c=o.length;++s<c;){var h=o[s];if(l(h))try{h.unsubscribe()}catch(yE){t=!0,e=e||[],yE instanceof p?e=e.concat(d(yE.errors)):e.push(yE)}}if(t)throw new p(e)}}},{key:"add",value:function(t){var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:if(!t)return e.EMPTY;throw new Error("unrecognized teardown "+t+" added to Subscription.")}if(n._addParent(this)){var i=this._subscriptions;i?i.push(n):this._subscriptions=[n]}return n}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}},{key:"_addParent",value:function(e){var t=this._parent,n=this._parents;return t!==e&&(t?n?-1===n.indexOf(e)&&(n.push(e),!0):(this._parents=[e],!0):(this._parent=e,!0))}}]),e}()).EMPTY=function(e){return e.closed=!0,e}(new h),h);function d(e){return e.reduce((function(e,t){return e.concat(t instanceof p?t.errors:t)}),[])}var m="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),v=function(e){function t(e,n,r){var i;switch(_classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof t?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(_assertThisInitialized(i))):(i.syncErrorThrowable=!0,i.destination=new g(_assertThisInitialized(i),e));break}default:i.syncErrorThrowable=!0,i.destination=new g(_assertThisInitialized(i),e,n,r)}return i}return _inherits(t,e),_createClass(t,[{key:m,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(t.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this}}],[{key:"create",value:function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i}}]),t}(f),g=function(e){function t(e,n,i,a){var o,u;_classCallCheck(this,t),(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._parentSubscriber=e;var l=_assertThisInitialized(o);return r(n)?u=n:n&&(u=n.next,i=n.error,a=n.complete,n!==s&&(r((l=Object.create(n)).unsubscribe)&&o.add(l.unsubscribe.bind(l)),l.unsubscribe=o.unsubscribe.bind(_assertThisInitialized(o)))),o._context=l,o._next=u,o._error=i,o._complete=a,o}return _inherits(t,e),_createClass(t,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,n=a.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):o(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;o(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),a.useDeprecatedSynchronousErrorHandling)throw n;o(n)}}},{key:"__tryOrSetError",value:function(e,t,n){if(!a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return a.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(o(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),t}(v),y="function"==typeof Symbol&&Symbol.observable||"@@observable";function b(){}var w,x=((w=function(){function e(t){_classCallCheck(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return _createClass(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof v)return e;if(e[m])return e[m]()}return e||t||n?new v(e,t,n):new v(s)}(e,t,n);if(i.add(r?r.call(i,this.source):this.source||a.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),a.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){a.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof v?r:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=C(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}}),r,t)}))}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:y,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this:((r=t)?1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)}:b)(this);var r}},{key:"toPromise",value:function(e){var t=this;return new(e=C(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))}}]),e}()).create=function(e){return new w(e)},w);function C(e){if(e||(e=a.Promise||Promise),!e)throw new Error("no Promise impl found");return e}function k(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}k.prototype=Object.create(Error.prototype);var E,_=k,A=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).subject=e,r.subscriber=n,r.closed=!1,r}return _inherits(t,e),_createClass(t,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}}}]),t}(f),S=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).destination=e,n}return _inherits(t,e),t}(v),N=((E=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _inherits(t,e),_createClass(t,[{key:m,value:function(){return new S(this)}},{key:"lift",value:function(e){var t=new D(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new _;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)}},{key:"error",value:function(e){if(this.closed)throw new _;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new _;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new _;return _get(_getPrototypeOf(t.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new _;return this.hasError?(e.error(this.thrownError),f.EMPTY):this.isStopped?(e.complete(),f.EMPTY):(this.observers.push(e),new A(this,e))}},{key:"asObservable",value:function(){var e=new x;return e.source=this,e}}]),t}(x)).create=function(e,t){return new D(e,t)},E),D=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).destination=e,r.source=n,r}return _inherits(t,e),_createClass(t,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):f.EMPTY}}]),t}(N),I=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}},{key:"_error",value:function(e){this.parent.notifyError(e,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),t}(v),T=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}};var R="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";var O=function(e){if(e instanceof x)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[y])return t=e,function(e){var n=t[y]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)};var t,n,r,i;if((n=e)&&"number"==typeof n.length&&"function"!=typeof n)return T(e);if(function(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}(e))return r=e,function(e){return r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,o),e};if(e&&"function"==typeof e[R])return i=e,function(e){for(var t=i[R]();;){var n=t.next();if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof t.return&&e.add((function(){t.return&&t.return()})),e};var a=l(e)?"an invalid object":"'".concat(e,"'");throw new TypeError("You provided ".concat(a," where a stream was expected.")+" You can provide an Observable, Promise, Array, or Iterable.")};function F(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new I(e,n,r);if(!i.closed)return O(t)(i)}var M=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"notifyNext",value:function(e,t,n,r,i){this.destination.next(t)}},{key:"notifyError",value:function(e,t){this.destination.error(e)}},{key:"notifyComplete",value:function(e){this.destination.complete()}}]),t}(v),L=function(){function e(t,n){_classCallCheck(this,e),this.project=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new B(e,this.project,this.thisArg))}}]),e}(),B=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).project=n,i.count=0,i.thisArg=r||_assertThisInitialized(i),i}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),t}(v);var P=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck(this,e),this.project=t,this.concurrent=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new z(e,this.project,this.concurrent))}}]),e}(),z=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=new I(this,void 0,void 0);this.destination.add(r),F(this,e,t,n,r)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e,t,n,r,i){this.destination.next(t)}},{key:"notifyComplete",value:function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),t}(M);function V(e){return e}function W(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=Number.POSITIVE_INFINITY,a=null,o=t[t.length-1];return(r=o)&&"function"==typeof r.schedule?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(i=t.pop())):"number"==typeof o&&(i=t.pop()),null===a&&1===t.length&&t[0]instanceof x?t[0]:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof n?function(i){return i.pipe(e((function(e,r){return(i=t(e,r),i instanceof x?i:new x(O(i))).pipe(function(e,t){return function(t){return t.lift(new L(e,void 0))}}((function(t,i){return n(e,t,r,i)})));var i}),r))}:("number"==typeof n&&(r=n),function(e){return e.lift(new P(t,r))})}(V,e)}(i)(function(e,t){return new x(t?function(n){var r=new f,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}:T(e))}(t,a))}function U(){return function(e){return e.lift(new j(e))}}var j=function(){function e(t){_classCallCheck(this,e),this.connectable=t}return _createClass(e,[{key:"call",value:function(e,t){var n=this.connectable;n._refCount++;var r=new H(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i}}]),e}(),H=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).connectable=n,r}return _inherits(t,e),_createClass(t,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}]),t}(v),G=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return _inherits(t,e),_createClass(t,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new f).add(this.source.subscribe(new K(this.getSubject(),this))),e.closed?(this._connection=null,e=f.EMPTY):this._connection=e),e}},{key:"refCount",value:function(){return U()(this)}}]),t}(x).prototype,q={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:G._subscribe},_isComplete:{value:G._isComplete,writable:!0},getSubject:{value:G.getSubject},connect:{value:G.connect},refCount:{value:G.refCount}},K=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).connectable=n,r}return _inherits(t,e),_createClass(t,[{key:"_error",value:function(e){this._unsubscribe(),_get(_getPrototypeOf(t.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(t.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),t}(S);function X(){return new N}var Q="__parameters__";function Z(e,t,n){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof i)return r.apply(this,t),this;var a=_construct(i,t);return o.annotation=a,o;function o(e,t,n){for(var r=e.hasOwnProperty(Q)?e[Q]:Object.defineProperty(e,Q,{value:[]})[Q];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(a),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i}var $=Z("Inject",(function(e){return{token:e}})),Y=Z("Optional"),J=Z("Self"),ee=Z("SkipSelf"),te=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function ne(e){for(var t in e)if(e[t]===ne)return t;throw Error("Could not find renamed property on target object.")}function re(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ie(e){var t=e[ae];return t&&t.token===e?t:null}var ae=ne({ngInjectableDef:ne});function oe(e){if("string"==typeof e)return e;if(e instanceof Array)return"["+e.map(oe).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return"".concat(e.overriddenName);if(e.name)return"".concat(e.name);var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}var se=ne({__forward_ref__:ne});function ue(e){return e.__forward_ref__=ue,e.toString=function(){return oe(this())},e}function le(e){var t=e;return"function"==typeof t&&t.hasOwnProperty(se)&&t.__forward_ref__===ue?t():e}var ce,he="undefined"!=typeof globalThis&&globalThis,pe="undefined"!=typeof window&&window,fe="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,de="undefined"!=typeof global&&global,me=he||de||pe||fe,ve=function(){function e(t,n){_classCallCheck(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.ngInjectableDef=re({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return _createClass(e,[{key:"toString",value:function(){return"InjectionToken ".concat(this._desc)}}]),e}(),ge=new ve("INJECTOR",-1),ye=new Object,be=/\n/gm,we="\u0275",xe="__source",Ce=ne({provide:String,useValue:ne}),ke=void 0;function Ee(e){var t=ke;return ke=e,t}function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te.Default;if(void 0===ke)throw new Error("inject() must be called from an injection context");return null===ke?function(e,t,n){var r=ie(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&te.Optional)return null;throw new Error("Injector: NOT_FOUND [".concat(oe(e),"]"))}(e,0,t):ke.get(e,t&te.Optional?null:void 0,t)}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te.Default;return(ce||_e)(e,t)}var Se=Ae,Ne=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ye;if(t===ye){var n=new Error("NullInjectorError: No provider for ".concat(oe(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}();function De(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&e.charAt(1)==we?e.substr(2):e;var i=oe(t);if(t instanceof Array)i=t.map(oe).join(" -> ");else if("object"==typeof t){var a=[];for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];a.push(o+":"+("string"==typeof s?JSON.stringify(s):oe(s)))}i="{".concat(a.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(i,"]: ").concat(e.replace(be,"\n  "))}var Ie=function e(){_classCallCheck(this,e)},Te=function e(){_classCallCheck(this,e)};function Re(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Oe(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}var Fe=function(){var e={Emulated:0,Native:1,None:2,ShadowDom:3};return e[e.Emulated]="Emulated",e[e.Native]="Native",e[e.None]="None",e[e.ShadowDom]="ShadowDom",e}(),Me=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(me),Le="ngDebugContext",Be="ngOriginalError",Pe="ngErrorLogger";function ze(e){return e[Le]}function Ve(e){return e[Be]}function We(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var Ue=function(){function e(){_classCallCheck(this,e),this._console=console}return _createClass(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e[Pe]||We}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(e){return e?ze(e)?ze(e):this._findContext(Ve(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=Ve(e);t&&Ve(t);)t=Ve(t);return t}}]),e}(),je=!0,He=!1;function Ge(){return He=!0,je}var qe=function(){function e(t){if(_classCallCheck(this,e),this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n),this.inertBodyElement=this.inertDocument.createElement("body"),n.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch($d){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return _createClass(e,[{key:"getInertBodyElement_XHR",value:function(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch($d){return null}var t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(void 0);var n=t.response.body;return n.removeChild(n.firstChild),n}},{key:"getInertBodyElement_DOMParser",value:function(e){e="<body><remove></remove>"+e+"</body>";try{var t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch($d){return null}}},{key:"getInertBodyElement_InertDocument",value:function(e){var t=this.inertDocument.createElement("template");return"content"in t?(t.innerHTML=e,t):(this.inertBodyElement.innerHTML=e,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}},{key:"stripCustomNsAttrs",value:function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var r=t.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||e.removeAttribute(r)}for(var i=e.firstChild;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}]),e}(),Ke=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,Xe=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Qe(e){return(e=String(e)).match(Ke)||e.match(Xe)?e:(Ge()&&console.warn("WARNING: sanitizing unsafe URL value ".concat(e," (see http://g.co/ng/security#xss)")),"unsafe:"+e)}function Ze(e){var t={},n=!0,r=!1,i=void 0;try{for(var a,o=e.split(",")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){t[a.value]=!0}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}function $e(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];for(var s in o)o.hasOwnProperty(s)&&(e[s]=!0)}return e}var Ye,Je=Ze("area,br,col,hr,img,wbr"),et=Ze("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),tt=Ze("rp,rt"),nt=$e(tt,et),rt=$e(Je,$e(et,Ze("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),$e(tt,Ze("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),nt),it=Ze("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),at=Ze("srcset"),ot=$e(it,at,Ze("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ze("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),st=Ze("script,style,template"),ut=function(){function e(){_classCallCheck(this,e),this.sanitizedSomething=!1,this.buf=[]}return _createClass(e,[{key:"sanitizeChildren",value:function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(e){var t=e.nodeName.toLowerCase();if(!rt.hasOwnProperty(t))return this.sanitizedSomething=!0,!st.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);for(var n,r=e.attributes,i=0;i<r.length;i++){var a=r.item(i),o=a.name,s=o.toLowerCase();if(ot.hasOwnProperty(s)){var u=a.value;it[s]&&(u=Qe(u)),at[s]&&(n=u,u=(n=String(n)).split(",").map((function(e){return Qe(e.trim())})).join(", ")),this.buf.push(" ",o,'="',ht(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(e){var t=e.nodeName.toLowerCase();rt.hasOwnProperty(t)&&!Je.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}},{key:"chars",value:function(e){this.buf.push(ht(e))}},{key:"checkClobberedElement",value:function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: ".concat(e.outerHTML));return t}}]),e}(),lt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,ct=/([^\#-~ |!])/g;function ht(e){return e.replace(/&/g,"&amp;").replace(lt,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(ct,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function pt(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var ft=function(){var e={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return e[e.NONE]="NONE",e[e.HTML]="HTML",e[e.STYLE]="STYLE",e[e.SCRIPT]="SCRIPT",e[e.URL]="URL",e[e.RESOURCE_URL]="RESOURCE_URL",e}(),dt=function e(){_classCallCheck(this,e)},mt=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|Z|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),vt=/^url\(([^)]+)\)$/,gt=/([A-Z])/g;function yt(e){try{return null!=e?e.toString().slice(0,30):e}catch(yE){return"[ERROR] Exception while trying to serialize the value"}}var bt=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return wt()},e}(),wt=function(){},xt=new ve("The presence of this token marks an injector as being the root injector."),Ct=function(e,t,n){return new Nt(e,t,n)},kt=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?Ct(e,t,""):Ct(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=ye,e.NULL=new Ne,e.ngInjectableDef=re({token:e,providedIn:"any",factory:function(){return Ae(ge)}}),e.__NG_ELEMENT_ID__=-1,e}(),Et=function(e){return e},_t=[],At=Et,St=function(){return Array.prototype.slice.call(arguments)},Nt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt.NULL,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,e),this.parent=n,this.source=r;var i=this._records=new Map;i.set(kt,{token:kt,fn:Et,deps:_t,value:this,useNew:!1}),i.set(ge,{token:ge,fn:Et,deps:_t,value:this,useNew:!1}),function e(t,n){if(n)if((n=le(n))instanceof Array)for(var r=0;r<n.length;r++)e(t,n[r]);else{if("function"==typeof n)throw It("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw It("Unexpected provider",n);var i=le(n.provide),a=function(e){var t=function(e){var t=_t,n=e.deps;if(n&&n.length){t=[];for(var r=0;r<n.length;r++){var i=6,a=le(n[r]);if(a instanceof Array)for(var o=0,s=a;o<s.length;o++){var u=s[o];u instanceof Y||u==Y?i|=1:u instanceof ee||u==ee?i&=-3:u instanceof J||u==J?i&=-5:a=u instanceof $?u.token:le(u)}t.push({token:a,options:i})}}else if(e.useExisting)t=[{token:le(e.useExisting),options:6}];else if(!(n||Ce in e))throw It("'deps' required",e);return t}(e),n=Et,r=_t,i=!1,a=le(e.provide);if(Ce in e)r=e.useValue;else if(e.useFactory)n=e.useFactory;else if(e.useExisting);else if(e.useClass)i=!0,n=le(e.useClass);else{if("function"!=typeof a)throw It("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",e);i=!0,n=a}return{deps:t,fn:n,useNew:i,value:r}}(n);if(!0===n.multi){var o=t.get(i);if(o){if(o.fn!==St)throw Dt(i)}else t.set(i,o={token:n.provide,deps:[],useNew:!1,fn:St,value:_t});o.deps.push({token:i=n,options:6})}var s=t.get(i);if(s&&s.fn==St)throw Dt(i);t.set(i,a)}}(i,t)}return _createClass(e,[{key:"get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te.Default,r=this._records.get(e);try{return function e(t,n,r,i,a,o){try{return function(t,n,r,i,a,o){var s;if(!n||o&te.SkipSelf)o&te.Self||(s=i.get(t,a,te.Default));else{if((s=n.value)==At)throw Error("\u0275Circular dependency");if(s===_t){n.value=At;var u=n.useNew,l=n.fn,c=n.deps,h=_t;if(c.length){h=[];for(var p=0;p<c.length;p++){var f=c[p],d=f.options,m=2&d?r.get(f.token):void 0;h.push(e(f.token,m,r,m||4&d?i:kt.NULL,1&d?null:kt.THROW_IF_NOT_FOUND,te.Default))}}n.value=s=u?_construct(l,_toConsumableArray(h)):l.apply(void 0,h)}}return s}(t,n,r,i,a,o)}catch(yE){throw yE instanceof Error||(yE=new Error(yE)),(yE.ngTempTokenPath=yE.ngTempTokenPath||[]).unshift(t),n&&n.value==At&&(n.value=_t),yE}}(e,r,this._records,this.parent,t,n)}catch(yE){return function(e,t,n,r){var i=e.ngTempTokenPath;throw t[xe]&&i.unshift(t[xe]),e.message=De("\n"+e.message,i,"StaticInjectorError",r),e.ngTokenPath=i,e.ngTempTokenPath=null,e}(yE,e,0,this.source)}}},{key:"toString",value:function(){var e=[];return this._records.forEach((function(t,n){return e.push(oe(n))})),"StaticInjector[".concat(e.join(", "),"]")}}]),e}();function Dt(e){return It("Cannot mix multi providers and regular providers",e)}function It(e,t){return new Error(De(e,t,"StaticInjectorError"))}var Tt=null;function Rt(){if(!Tt){var e=me.Symbol;if(e&&e.iterator)Tt=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Tt=r)}}return Tt}function Ot(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function Ft(e,t){var n=Lt(e),r=Lt(t);return n&&r?function(e,t,n){for(var r=e[Rt()](),i=t[Rt()]();;){var a=r.next(),o=i.next();if(a.done&&o.done)return!0;if(a.done||o.done)return!1;if(!n(a.value,o.value))return!1}}(e,t,Ft):!(n||!(e&&("object"==typeof e||"function"==typeof e))||r||!(t&&("object"==typeof t||"function"==typeof t)))||Ot(e,t)}var Mt=function(){function e(t){_classCallCheck(this,e),this.wrapped=t}return _createClass(e,null,[{key:"wrap",value:function(t){return new e(t)}},{key:"unwrap",value:function(t){return e.isWrapped(t)?t.wrapped:t}},{key:"isWrapped",value:function(t){return t instanceof e}}]),e}();function Lt(e){return!!Bt(e)&&(Array.isArray(e)||!(e instanceof Map)&&Rt()in e)}function Bt(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Pt(e){return!!e&&"function"==typeof e.then}var zt=function(){function e(t,n,r){_classCallCheck(this,e),this.previousValue=t,this.currentValue=n,this.firstChange=r}return _createClass(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}(),Vt=function e(){_classCallCheck(this,e)},Wt=function e(){_classCallCheck(this,e)};function Ut(e){var t=Error("No component factory found for ".concat(oe(e),". Did you add it to @NgModule.entryComponents?"));return t[jt]=e,t}var jt="ngComponent",Ht=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){throw Ut(e)}}]),e}(),Gt=function(){var e=function e(){_classCallCheck(this,e)};return e.NULL=new Ht,e}(),qt=function(){function e(t,n,r){_classCallCheck(this,e),this._parent=n,this._ngModule=r,this._factories=new Map;for(var i=0;i<t.length;i++){var a=t[i];this._factories.set(a.componentType,a)}}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){var t=this._factories.get(e);if(!t&&this._parent&&(t=this._parent.resolveComponentFactory(e)),!t)throw Ut(e);return new Kt(t,this._ngModule)}}]),e}(),Kt=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).factory=e,r.ngModule=n,r.selector=e.selector,r.componentType=e.componentType,r.ngContentSelectors=e.ngContentSelectors,r.inputs=e.inputs,r.outputs=e.outputs,r}return _inherits(t,e),_createClass(t,[{key:"create",value:function(e,t,n,r){return this.factory.create(e,t,n,r||this.ngModule)}}]),t}(Wt);function Xt(){}var Qt=function(){var e=function e(t){_classCallCheck(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=function(){return Zt(e)},e}(),Zt=Xt,$t=function e(){_classCallCheck(this,e)},Yt=function(){var e={Important:1,DashCase:2};return e[e.Important]="Important",e[e.DashCase]="DashCase",e}(),Jt=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return en()},e}(),en=Xt,tn=new function e(t){_classCallCheck(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}("8.2.14"),nn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return Lt(e)}},{key:"create",value:function(e){return new an(e)}}]),e}(),rn=function(e,t){return t},an=function(){function e(t){_classCallCheck(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||rn}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,i=null;t||n;){var a=!n||t&&t.currentIndex<ln(n,r,i)?t:n,o=ln(a,r,i),s=a.currentIndex;if(a===n)r--,n=n._nextRemoved;else if(t=t._next,null==a.previousIndex)r++;else{i||(i=[]);var u=o-r,l=s-r;if(u!=l){for(var c=0;c<u;c++){var h=c<i.length?i[c]:i[c]=0,p=h+c;l<=p&&p<u&&(i[c]=h+1)}i[a.previousIndex]=l-u}}o!==s&&e(a,o,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!Lt(e))throw new Error("Error trying to diff '".concat(oe(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,i,a=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)i=this._trackByFn(s,r=e[s]),null!==a&&Ot(a.trackById,i)?(o&&(a=this._verifyReinsertion(a,r,i,s)),Ot(a.item,r)||this._addIdentityChange(a,r)):(a=this._mismatch(a,r,i,s),o=!0),a=a._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,i=e[Rt()]();!(r=i.next()).done;)t(r.value)}(e,(function(e){i=t._trackByFn(n,e),null!==a&&Ot(a.trackById,i)?(o&&(a=t._verifyReinsertion(a,e,i,n)),Ot(a.item,e)||t._addIdentityChange(a,e)):(a=t._mismatch(a,e,i,n),o=!0),a=a._next,n++})),this.length=n;return this._truncate(a),this.collection=e,this.isDirty}},{key:"_reset",value:function(){if(this.isDirty){var e,t;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Ot(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Ot(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):e=this._addAfter(new on(t,n),i,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new un),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t?e:(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e,e)}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new un),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}}]),e}(),on=function e(t,n){_classCallCheck(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},sn=function(){function e(){_classCallCheck(this,e),this._head=null,this._tail=null}return _createClass(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Ot(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),un=function(){function e(){_classCallCheck(this,e),this.map=new Map}return _createClass(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new sn,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"clear",value:function(){this.map.clear()}},{key:"isEmpty",get:function(){return 0===this.map.size}}]),e}();function ln(e,t,n){var r=e.previousIndex;if(null===r)return r;var i=0;return n&&r<n.length&&(i=n[r]),r+t+i}var cn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return e instanceof Map||Bt(e)}},{key:"create",value:function(){return new hn}}]),e}(),hn=function(){function e(){_classCallCheck(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||Bt(e)))throw new Error("Error trying to diff '".concat(oe(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var i=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,i)}})),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}var a=new pn(e);return this._records.set(e,a),a.currentValue=t,this._addToAdditions(a),a}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){Ot(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach((function(n){return t(e[n],n)}))}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}}]),e}(),pn=function e(t){_classCallCheck(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},fn=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t,n=this.factories.find((function(t){return t.supports(e)}));if(null!=n)return n;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new ee,new Y]]}}}]),e}();return e.ngInjectableDef=re({token:e,providedIn:"root",factory:function(){return new e([new nn])}}),e}(),dn=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t=this.factories.find((function(t){return t.supports(e)}));if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new ee,new Y]]}}}]),e}();return e.ngInjectableDef=re({token:e,providedIn:"root",factory:function(){return new e([new cn])}}),e}(),mn=[new cn],vn=new fn([new nn]),gn=new dn(mn),yn=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return bn(e,Qt)},e}(),bn=Xt,wn=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return xn(e,Qt)},e}(),xn=Xt;function Cn(e,t,n,r){var i="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '".concat(t,"'. Current value: '").concat(n,"'.");return r&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(e,t){var n=new Error(e);return kn(n,t),n}(i,e)}function kn(e,t){e[Le]=t,e[Pe]=t.logError.bind(t)}function En(e){return new Error("ViewDestroyedError: Attempt to use a destroyed view: ".concat(e))}function _n(e,t,n){var r=e.state,i=1792&r;return i===t?(e.state=-1793&r|n,e.initIndex=-1,!0):i===n}function An(e,t,n){return(1792&e.state)===t&&e.initIndex<=n&&(e.initIndex=n+1,!0)}function Sn(e,t){return e.nodes[t]}function Nn(e,t){return e.nodes[t]}function Dn(e,t){return e.nodes[t]}function In(e,t){return e.nodes[t]}function Tn(e,t){return e.nodes[t]}var Rn={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},On=function(){},Fn=new Map;function Mn(e){var t=Fn.get(e);return t||(t=oe(e)+"_"+Fn.size,Fn.set(e,t)),t}function Ln(e,t,n,r){if(Mt.isWrapped(r)){r=Mt.unwrap(r);var i=e.def.nodes[t].bindingIndex+n,a=Mt.unwrap(e.oldValues[i]);e.oldValues[i]=new Mt(a)}return r}var Bn="$$undefined",Pn="$$empty";function zn(e){return{id:Bn,styles:e.styles,encapsulation:e.encapsulation,data:e.data}}var Vn=0;function Wn(e,t,n,r){return!(!(2&e.state)&&Ot(e.oldValues[t.bindingIndex+n],r))}function Un(e,t,n,r){return!!Wn(e,t,n,r)&&(e.oldValues[t.bindingIndex+n]=r,!0)}function jn(e,t,n,r){var i=e.oldValues[t.bindingIndex+n];if(1&e.state||!Ft(i,r)){var a=t.bindings[n].name;throw Cn(Rn.createDebugContext(e,t.nodeIndex),"".concat(a,": ").concat(i),"".concat(a,": ").concat(r),0!=(1&e.state))}}function Hn(e){for(var t=e;t;)2&t.def.flags&&(t.state|=8),t=t.viewContainerParent||t.parent}function Gn(e,t){for(var n=e;n&&n!==t;)n.state|=64,n=n.viewContainerParent||n.parent}function qn(e,t,n,r){try{return Hn(33554432&e.def.nodes[t].flags?Nn(e,t).componentView:e),Rn.handleEvent(e,t,n,r)}catch(yE){e.root.errorHandler.handleError(yE)}}function Kn(e){return e.parent?Nn(e.parent,e.parentNodeDef.nodeIndex):null}function Xn(e){return e.parent?e.parentNodeDef.parent:null}function Qn(e,t){switch(201347067&t.flags){case 1:return Nn(e,t.nodeIndex).renderElement;case 2:return Sn(e,t.nodeIndex).renderText}}function Zn(e){return!!e.parent&&!!(32768&e.parentNodeDef.flags)}function $n(e){return!(!e.parent||32768&e.parentNodeDef.flags)}function Yn(e){return 1<<e%32}function Jn(e){var t={},n=0,r={};return e&&e.forEach((function(e){var i=_slicedToArray(e,2),a=i[0],o=i[1];"number"==typeof a?(t[a]=o,n|=Yn(a)):r[a]=o})),{matchedQueries:t,references:r,matchedQueryIds:n}}function er(e,t){return e.map((function(e){var n,r,i;return Array.isArray(e)?(i=(n=_slicedToArray(e,2))[0],r=n[1]):(i=0,r=e),r&&("function"==typeof r||"object"==typeof r)&&t&&Object.defineProperty(r,xe,{value:t,configurable:!0}),{flags:i,token:r,tokenKey:Mn(r)}}))}function tr(e,t,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===Fe.Native?Nn(e,n.renderParent.nodeIndex).renderElement:void 0:t}var nr=new WeakMap;function rr(e){var t=nr.get(e);return t||((t=e((function(){return On}))).factory=e,nr.set(e,t)),t}function ir(e,t,n,r,i){3===t&&(n=e.renderer.parentNode(Qn(e,e.def.lastRenderRootNode))),ar(e,t,0,e.def.nodes.length-1,n,r,i)}function ar(e,t,n,r,i,a,o){for(var s=n;s<=r;s++){var u=e.def.nodes[s];11&u.flags&&sr(e,u,t,i,a,o),s+=u.childCount}}function or(e,t,n,r,i,a){for(var o=e;o&&!Zn(o);)o=o.parent;for(var s=o.parent,u=Xn(o),l=u.nodeIndex+u.childCount,c=u.nodeIndex+1;c<=l;c++){var h=s.def.nodes[c];h.ngContentIndex===t&&sr(s,h,n,r,i,a),c+=h.childCount}if(!s.parent){var p=e.root.projectableNodes[t];if(p)for(var f=0;f<p.length;f++)ur(e,p[f],n,r,i,a)}}function sr(e,t,n,r,i,a){if(8&t.flags)or(e,t.ngContent.index,n,r,i,a);else{var o=Qn(e,t);if(3===n&&33554432&t.flags&&48&t.bindingFlags?(16&t.bindingFlags&&ur(e,o,n,r,i,a),32&t.bindingFlags&&ur(Nn(e,t.nodeIndex).componentView,o,n,r,i,a)):ur(e,o,n,r,i,a),16777216&t.flags)for(var s=Nn(e,t.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)ir(s[u],n,r,i,a);1&t.flags&&!t.element.name&&ar(e,n,t.nodeIndex+1,t.nodeIndex+t.childCount,r,i,a)}}function ur(e,t,n,r,i,a){var o=e.renderer;switch(n){case 1:o.appendChild(r,t);break;case 2:o.insertBefore(r,t,i);break;case 3:o.removeChild(r,t);break;case 0:a.push(t)}}var lr=/^:([^:]+):(.+)$/;function cr(e){if(":"===e[0]){var t=e.match(lr);return[t[1],t[2]]}return["",e]}function hr(e){for(var t=0,n=0;n<e.length;n++)t|=e[n].flags;return t}var pr=new Object,fr=Mn(kt),dr=Mn(ge),mr=Mn(Ie);function vr(e,t,n,r){return n=le(n),{index:-1,deps:er(r,oe(t)),flags:e,token:t,value:n}}function gr(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kt.THROW_IF_NOT_FOUND,a=Ee(e);try{if(8&t.flags)return t.token;if(2&t.flags&&(i=null),1&t.flags)return e._parent.get(t.token,i);var o=t.tokenKey;switch(o){case fr:case dr:case mr:return e}var s,u=e._def.providersByKey[o];if(u){var l=e._providers[u.index];return void 0===l&&(l=e._providers[u.index]=yr(e,u)),l===pr?void 0:l}if((s=ie(t.token))&&(n=e,null!=(r=s).providedIn&&(function(e,t){return e._def.modules.indexOf(t)>-1}(n,r.providedIn)||"root"===r.providedIn&&n._def.isRoot))){var c=e._providers.length;return e._def.providers[c]=e._def.providersByKey[t.tokenKey]={flags:5120,value:s.factory,deps:[],index:c,token:t.token},e._providers[c]=pr,e._providers[c]=yr(e,e._def.providersByKey[t.tokenKey])}return 4&t.flags?i:e._parent.get(t.token,i)}finally{Ee(a)}}function yr(e,t){var n;switch(201347067&t.flags){case 512:n=function(e,t,n){var r=n.length;switch(r){case 0:return new t;case 1:return new t(gr(e,n[0]));case 2:return new t(gr(e,n[0]),gr(e,n[1]));case 3:return new t(gr(e,n[0]),gr(e,n[1]),gr(e,n[2]));default:for(var i=new Array(r),a=0;a<r;a++)i[a]=gr(e,n[a]);return _construct(t,i)}}(e,t.value,t.deps);break;case 1024:n=function(e,t,n){var r=n.length;switch(r){case 0:return t();case 1:return t(gr(e,n[0]));case 2:return t(gr(e,n[0]),gr(e,n[1]));case 3:return t(gr(e,n[0]),gr(e,n[1]),gr(e,n[2]));default:for(var i=Array(r),a=0;a<r;a++)i[a]=gr(e,n[a]);return t.apply(void 0,i)}}(e,t.value,t.deps);break;case 2048:n=gr(e,t.deps[0]);break;case 256:n=t.value}return n===pr||null===n||"object"!=typeof n||131072&t.flags||"function"!=typeof n.ngOnDestroy||(t.flags|=131072),void 0===n?pr:n}function br(e,t){var n=e.viewContainer._embeddedViews;if((null==t||t>=n.length)&&(t=n.length-1),t<0)return null;var r=n[t];return r.viewContainerParent=null,Oe(n,t),Rn.dirtyParentQueries(r),xr(r),r}function wr(e,t,n){var r=t?Qn(t,t.def.lastRenderRootNode):e.renderElement,i=n.renderer.parentNode(r),a=n.renderer.nextSibling(r);ir(n,2,i,a,void 0)}function xr(e){ir(e,3,null,null,void 0)}var Cr=new Object;var kr=function(e){function t(e,n,r,i,a,o){var s;return _classCallCheck(this,t),(s=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).selector=e,s.componentType=n,s._inputs=i,s._outputs=a,s.ngContentSelectors=o,s.viewDefFactory=r,s}return _inherits(t,e),_createClass(t,[{key:"create",value:function(e,t,n,r){if(!r)throw new Error("ngModule should be provided");var i=rr(this.viewDefFactory),a=i.nodes[0].element.componentProvider.nodeIndex,o=Rn.createRootView(e,t||[],n,i,r,Cr),s=Dn(o,a).instance;return n&&o.renderer.setAttribute(Nn(o,0).renderElement,"ng-version",tn.full),new Er(o,new Nr(o),s)}},{key:"inputs",get:function(){var e=[],t=this._inputs;for(var n in t)e.push({propName:n,templateName:t[n]});return e}},{key:"outputs",get:function(){var e=[];for(var t in this._outputs)e.push({propName:t,templateName:this._outputs[t]});return e}}]),t}(Wt),Er=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._view=e,i._viewRef=n,i._component=r,i._elDef=i._view.def.nodes[0],i.hostView=n,i.changeDetectorRef=n,i.instance=r,i}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this._viewRef.destroy()}},{key:"onDestroy",value:function(e){this._viewRef.onDestroy(e)}},{key:"location",get:function(){return new Qt(Nn(this._view,this._elDef.nodeIndex).renderElement)}},{key:"injector",get:function(){return new Rr(this._view,this._elDef)}},{key:"componentType",get:function(){return this._component.constructor}}]),t}(Vt);function _r(e,t,n){return new Ar(e,t,n)}var Ar=function(){function e(t,n,r){_classCallCheck(this,e),this._view=t,this._elDef=n,this._data=r,this._embeddedViews=[]}return _createClass(e,[{key:"clear",value:function(){for(var e=this._embeddedViews.length-1;e>=0;e--){var t=br(this._data,e);Rn.destroyView(t)}}},{key:"get",value:function(e){var t=this._embeddedViews[e];if(t){var n=new Nr(t);return n.attachToViewContainerRef(this),n}return null}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,i){var a=n||this.parentInjector;i||e instanceof Kt||(i=a.get(Ie));var o=e.create(a,r,void 0,i);return this.insert(o.hostView,t),o}},{key:"insert",value:function(e,t){if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,i,a,o,s=e;return n=this._view,r=this._data,i=t,a=s._view,o=r.viewContainer._embeddedViews,null==i&&(i=o.length),a.viewContainerParent=n,Re(o,i,a),function(e,t){var n=Kn(t);if(n&&n!==e&&!(16&t.state)){t.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(t),function(e,t){if(!(4&t.flags)){e.nodeFlags|=4,t.flags|=4;for(var n=t.parent;n;)n.childFlags|=4,n=n.parent}}(t.parent.def,t.parentNodeDef)}}(r,a),Rn.dirtyParentQueries(a),wr(r,i>0?o[i-1]:null,a),s.attachToViewContainerRef(this),e}},{key:"move",value:function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,i,a,o,s=this._embeddedViews.indexOf(e._view);return n=this._data,r=s,i=t,a=n.viewContainer._embeddedViews,o=a[r],Oe(a,r),null==i&&(i=a.length),Re(a,i,o),Rn.dirtyParentQueries(o),xr(o),wr(n,i>0?a[i-1]:null,o),e}},{key:"indexOf",value:function(e){return this._embeddedViews.indexOf(e._view)}},{key:"remove",value:function(e){var t=br(this._data,e);t&&Rn.destroyView(t)}},{key:"detach",value:function(e){var t=br(this._data,e);return t?new Nr(t):null}},{key:"element",get:function(){return new Qt(this._data.renderElement)}},{key:"injector",get:function(){return new Rr(this._view,this._elDef)}},{key:"parentInjector",get:function(){for(var e=this._view,t=this._elDef.parent;!t&&e;)t=Xn(e),e=e.parent;return e?new Rr(e,t):new Rr(this._view,null)}},{key:"length",get:function(){return this._embeddedViews.length}}]),e}();function Sr(e){return new Nr(e)}var Nr=function(){function e(t){_classCallCheck(this,e),this._view=t,this._viewContainerRef=null,this._appRef=null}return _createClass(e,[{key:"markForCheck",value:function(){Hn(this._view)}},{key:"detach",value:function(){this._view.state&=-5}},{key:"detectChanges",value:function(){var e=this._view.root.rendererFactory;e.begin&&e.begin();try{Rn.checkAndUpdateView(this._view)}finally{e.end&&e.end()}}},{key:"checkNoChanges",value:function(){Rn.checkNoChangesView(this._view)}},{key:"reattach",value:function(){this._view.state|=4}},{key:"onDestroy",value:function(e){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(e)}},{key:"destroy",value:function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Rn.destroyView(this._view)}},{key:"detachFromAppRef",value:function(){this._appRef=null,xr(this._view),Rn.dirtyParentQueries(this._view)}},{key:"attachToAppRef",value:function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}},{key:"attachToViewContainerRef",value:function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}},{key:"rootNodes",get:function(){return ir(this._view,0,void 0,void 0,e=[]),e;var e}},{key:"context",get:function(){return this._view.context}},{key:"destroyed",get:function(){return 0!=(128&this._view.state)}}]),e}();function Dr(e,t){return new Ir(e,t)}var Ir=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._parentView=e,r._def=n,r}return _inherits(t,e),_createClass(t,[{key:"createEmbeddedView",value:function(e){return new Nr(Rn.createEmbeddedView(this._parentView,this._def,this._def.element.template,e))}},{key:"elementRef",get:function(){return new Qt(Nn(this._parentView,this._def.nodeIndex).renderElement)}}]),t}(yn);function Tr(e,t){return new Rr(e,t)}var Rr=function(){function e(t,n){_classCallCheck(this,e),this.view=t,this.elDef=n}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt.THROW_IF_NOT_FOUND;return Rn.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:e,tokenKey:Mn(e)},t)}}]),e}();function Or(e,t){var n=e.def.nodes[t];if(1&n.flags){var r=Nn(e,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return Sn(e,n.nodeIndex).renderText;if(20240&n.flags)return Dn(e,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index ".concat(t))}function Fr(e){return new Mr(e.renderer)}var Mr=function(){function e(t){_classCallCheck(this,e),this.delegate=t}return _createClass(e,[{key:"selectRootElement",value:function(e){return this.delegate.selectRootElement(e)}},{key:"createElement",value:function(e,t){var n=_slicedToArray(cr(t),2),r=n[0],i=n[1],a=this.delegate.createElement(i,r);return e&&this.delegate.appendChild(e,a),a}},{key:"createViewRoot",value:function(e){return e}},{key:"createTemplateAnchor",value:function(e){var t=this.delegate.createComment("");return e&&this.delegate.appendChild(e,t),t}},{key:"createText",value:function(e,t){var n=this.delegate.createText(t);return e&&this.delegate.appendChild(e,n),n}},{key:"projectNodes",value:function(e,t){for(var n=0;n<t.length;n++)this.delegate.appendChild(e,t[n])}},{key:"attachViewAfter",value:function(e,t){for(var n=this.delegate.parentNode(e),r=this.delegate.nextSibling(e),i=0;i<t.length;i++)this.delegate.insertBefore(n,t[i],r)}},{key:"detachView",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}}},{key:"destroyView",value:function(e,t){for(var n=0;n<t.length;n++)this.delegate.destroyNode(t[n])}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"listenGlobal",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"setElementProperty",value:function(e,t,n){this.delegate.setProperty(e,t,n)}},{key:"setElementAttribute",value:function(e,t,n){var r=_slicedToArray(cr(t),2),i=r[0],a=r[1];null!=n?this.delegate.setAttribute(e,a,n,i):this.delegate.removeAttribute(e,a,i)}},{key:"setBindingDebugInfo",value:function(e,t,n){}},{key:"setElementClass",value:function(e,t,n){n?this.delegate.addClass(e,t):this.delegate.removeClass(e,t)}},{key:"setElementStyle",value:function(e,t,n){null!=n?this.delegate.setStyle(e,t,n):this.delegate.removeStyle(e,t)}},{key:"invokeElementMethod",value:function(e,t,n){e[t].apply(e,n)}},{key:"setText",value:function(e,t){this.delegate.setValue(e,t)}},{key:"animate",value:function(){throw new Error("Renderer.animate is no longer supported!")}}]),e}();function Lr(e,t,n,r){return new Br(e,t,n,r)}var Br=function(){function e(t,n,r,i){_classCallCheck(this,e),this._moduleType=t,this._parent=n,this._bootstrapComponents=r,this._def=i,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(e){for(var t=e._def,n=e._providers=new Array(t.providers.length),r=0;r<t.providers.length;r++){var i=t.providers[r];4096&i.flags||void 0===n[r]&&(n[r]=yr(e,i))}}(this)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te.Default,r=0;return n&te.SkipSelf?r|=1:n&te.Self&&(r|=4),gr(this,{token:e,tokenKey:Mn(e),flags:r},t)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The ng module ".concat(oe(this.instance.constructor)," has already been destroyed."));this._destroyed=!0,function(e,t){for(var n=e._def,r=new Set,i=0;i<n.providers.length;i++)if(131072&n.providers[i].flags){var a=e._providers[i];if(a&&a!==pr){var o=a.ngOnDestroy;"function"!=typeof o||r.has(a)||(o.apply(a),r.add(a))}}}(this),this._destroyListeners.forEach((function(e){return e()}))}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"instance",get:function(){return this.get(this._moduleType)}},{key:"componentFactoryResolver",get:function(){return this.get(Gt)}}]),e}(),Pr=Mn((function e(){_classCallCheck(this,e)})),zr=Mn(Jt),Vr=Mn(Qt),Wr=Mn(wn),Ur=Mn(yn),jr=Mn(bt),Hr=Mn(kt),Gr=Mn(ge);function qr(e,t,n,r,i,a,o,s){var u=[];if(o)for(var l in o){var c=_slicedToArray(o[l],2),h=c[0],p=c[1];u[h]={flags:8,name:l,nonMinifiedName:p,ns:null,securityContext:null,suffix:null}}var f=[];if(s)for(var d in s)f.push({type:1,propName:d,target:null,eventName:s[d]});return Xr(e,t|=16384,n,r,i,i,a,u,f)}function Kr(e,t,n){return Xr(-1,e|=16,null,0,t,t,n)}function Xr(e,t,n,r,i,a,o,s,u){var l=Jn(n),c=l.matchedQueries,h=l.references,p=l.matchedQueryIds;u||(u=[]),s||(s=[]),a=le(a);var f=er(o,oe(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:p,references:h,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:hr(s),outputs:u,element:null,provider:{token:i,value:a,deps:f},text:null,query:null,ngContent:null}}function Qr(e,t){return Jr(e,t)}function Zr(e,t){for(var n=e;n.parent&&!Zn(n);)n=n.parent;return ei(n.parent,Xn(n),!0,t.provider.value,t.provider.deps)}function $r(e,t){var n,r=ei(e,t.parent,(32768&t.flags)>0,t.provider.value,t.provider.deps);if(t.outputs.length)for(var i=0;i<t.outputs.length;i++){var a=t.outputs[i],o=r[a.propName];if(!(n=o)||"function"!=typeof n.subscribe)throw new Error("@Output ".concat(a.propName," not initialized in '").concat(r.constructor.name,"'."));var s=o.subscribe(Yr(e,t.parent.nodeIndex,a.eventName));e.disposables[t.outputIndex+i]=s.unsubscribe.bind(s)}return r}function Yr(e,t,n){return function(r){return qn(e,t,n,r)}}function Jr(e,t){var n=(8192&t.flags)>0,r=t.provider;switch(201347067&t.flags){case 512:return ei(e,t.parent,n,r.value,r.deps);case 1024:return function(e,t,n,r,i){var a=i.length;switch(a){case 0:return r();case 1:return r(ni(e,t,n,i[0]));case 2:return r(ni(e,t,n,i[0]),ni(e,t,n,i[1]));case 3:return r(ni(e,t,n,i[0]),ni(e,t,n,i[1]),ni(e,t,n,i[2]));default:for(var o=Array(a),s=0;s<a;s++)o[s]=ni(e,t,n,i[s]);return r.apply(void 0,o)}}(e,t.parent,n,r.value,r.deps);case 2048:return ni(e,t.parent,n,r.deps[0]);case 256:return r.value}}function ei(e,t,n,r,i){var a=i.length;switch(a){case 0:return new r;case 1:return new r(ni(e,t,n,i[0]));case 2:return new r(ni(e,t,n,i[0]),ni(e,t,n,i[1]));case 3:return new r(ni(e,t,n,i[0]),ni(e,t,n,i[1]),ni(e,t,n,i[2]));default:for(var o=new Array(a),s=0;s<a;s++)o[s]=ni(e,t,n,i[s]);return _construct(r,o)}}var ti={};function ni(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:kt.THROW_IF_NOT_FOUND;if(8&r.flags)return r.token;var a=e;2&r.flags&&(i=null);var o=r.tokenKey;o===jr&&(n=!(!t||!t.element.componentView)),t&&1&r.flags&&(n=!1,t=t.parent);for(var s=e;s;){if(t)switch(o){case Pr:return Fr(ri(s,t,n));case zr:return ri(s,t,n).renderer;case Vr:return new Qt(Nn(s,t.nodeIndex).renderElement);case Wr:return Nn(s,t.nodeIndex).viewContainer;case Ur:if(t.element.template)return Nn(s,t.nodeIndex).template;break;case jr:return Sr(ri(s,t,n));case Hr:case Gr:return Tr(s,t);default:var u=(n?t.element.allProviders:t.element.publicProviders)[o];if(u){var l=Dn(s,u.nodeIndex);return l||(l={instance:Jr(s,u)},s.nodes[u.nodeIndex]=l),l.instance}}n=Zn(s),t=Xn(s),s=s.parent,4&r.flags&&(s=null)}var c=a.root.injector.get(r.token,ti);return c!==ti||i===ti?c:a.root.ngModule.injector.get(r.token,i)}function ri(e,t,n){var r;if(n)r=Nn(e,t.nodeIndex).componentView;else for(r=e;r.parent&&!Zn(r);)r=r.parent;return r}function ii(e,t,n,r,i,a){if(32768&n.flags){var o=Nn(e,n.parent.nodeIndex).componentView;2&o.def.flags&&(o.state|=8)}if(t.instance[n.bindings[r].name]=i,524288&n.flags){a=a||{};var s=Mt.unwrap(e.oldValues[n.bindingIndex+r]);a[n.bindings[r].nonMinifiedName]=new zt(s,i,0!=(2&e.state))}return e.oldValues[n.bindingIndex+r]=i,a}function ai(e,t){if(e.def.nodeFlags&t)for(var n=e.def.nodes,r=0,i=0;i<n.length;i++){var a=n[i],o=a.parent;for(!o&&a.flags&t&&si(e,i,a.flags&t,r++),0==(a.childFlags&t)&&(i+=a.childCount);o&&1&o.flags&&i===o.nodeIndex+o.childCount;)o.directChildFlags&t&&(r=oi(e,o,t,r)),o=o.parent}}function oi(e,t,n,r){for(var i=t.nodeIndex+1;i<=t.nodeIndex+t.childCount;i++){var a=e.def.nodes[i];a.flags&n&&si(e,i,a.flags&n,r++),i+=a.childCount}return r}function si(e,t,n,r){var i=Dn(e,t);if(i){var a=i.instance;a&&(Rn.setCurrentNode(e,t),1048576&n&&An(e,512,r)&&a.ngAfterContentInit(),2097152&n&&a.ngAfterContentChecked(),4194304&n&&An(e,768,r)&&a.ngAfterViewInit(),8388608&n&&a.ngAfterViewChecked(),131072&n&&a.ngOnDestroy())}}var ui=new ve("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return Me}}),li={},ci=function(){var e={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencySymbol:15,CurrencyName:16,Currencies:17,PluralCase:18,ExtraData:19};return e[e.LocaleId]="LocaleId",e[e.DayPeriodsFormat]="DayPeriodsFormat",e[e.DayPeriodsStandalone]="DayPeriodsStandalone",e[e.DaysFormat]="DaysFormat",e[e.DaysStandalone]="DaysStandalone",e[e.MonthsFormat]="MonthsFormat",e[e.MonthsStandalone]="MonthsStandalone",e[e.Eras]="Eras",e[e.FirstDayOfWeek]="FirstDayOfWeek",e[e.WeekendRange]="WeekendRange",e[e.DateFormat]="DateFormat",e[e.TimeFormat]="TimeFormat",e[e.DateTimeFormat]="DateTimeFormat",e[e.NumberSymbols]="NumberSymbols",e[e.NumberFormats]="NumberFormats",e[e.CurrencySymbol]="CurrencySymbol",e[e.CurrencyName]="CurrencyName",e[e.Currencies]="Currencies",e[e.PluralCase]="PluralCase",e[e.ExtraData]="ExtraData",e}(),hi=["en",[["a","p"],["AM","PM"],void 0],[["AM","PM"],void 0,void 0],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],void 0,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",void 0,"{1} 'at' {0}",void 0],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];function pi(e){var t=e.toLowerCase().replace(/_/g,"-"),n=li[t];if(n)return n;var r=t.split("-")[0];if(n=li[r])return n;if("en"===r)return hi;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}var fi="en-US";function di(e){null==e&&function(e){throw new Error("ASSERTION ERROR: ".concat("Expected localeId to be defined"))}(),"string"==typeof e&&e.toLowerCase().replace(/_/g,"-")}var mi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).__isAsync=n,e}return _inherits(t,e),_createClass(t,[{key:"emit",value:function(e){_get(_getPrototypeOf(t.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,n,r){var i,a=function(e){return null},o=function(){return null};e&&"object"==typeof e?(i=this.__isAsync?function(t){setTimeout((function(){return e.next(t)}))}:function(t){e.next(t)},e.error&&(a=this.__isAsync?function(t){setTimeout((function(){return e.error(t)}))}:function(t){e.error(t)}),e.complete&&(o=this.__isAsync?function(){setTimeout((function(){return e.complete()}))}:function(){e.complete()})):(i=this.__isAsync?function(t){setTimeout((function(){return e(t)}))}:function(t){e(t)},n&&(a=this.__isAsync?function(e){setTimeout((function(){return n(e)}))}:function(e){n(e)}),r&&(o=this.__isAsync?function(){setTimeout((function(){return r()}))}:function(){r()}));var s=_get(_getPrototypeOf(t.prototype),"subscribe",this).call(this,i,a,o);return e instanceof f&&e.add(s),s}}]),t}(N);function vi(){return this._results[Rt()]()}var gi=function(){function e(){_classCallCheck(this,e),this.dirty=!0,this._results=[],this.changes=new mi,this.length=0;var t=Rt(),n=e.prototype;n[t]||(n[t]=vi)}return _createClass(e,[{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e){this._results=function e(t,n){void 0===n&&(n=t);for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?(n===t&&(n=t.slice(0,r)),e(i,n)):n!==t&&n.push(i)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}},{key:"notifyOnChanges",value:function(){this.changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}(),yi=new ve("Application Initializer"),bi=function(){function e(t){var n=this;_classCallCheck(this,e),this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return _createClass(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var i=this.appInits[r]();Pt(i)&&t.push(i)}Promise.all(t).then((function(){n()})).catch((function(t){e.reject(t)})),0===t.length&&n(),this.initialized=!0}}}]),e}(),wi=new ve("AppId");function xi(){return"".concat(Ci()).concat(Ci()).concat(Ci())}function Ci(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var ki=new ve("Platform Initializer"),Ei=new ve("Platform ID"),_i=new ve("appBootstrapListener"),Ai=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}(),Si=new ve("LocaleId"),Ni=!1;function Di(){throw new Error("Runtime compiler is not loaded")}var Ii,Ti,Ri=Di,Oi=Di,Fi=Di,Mi=Di,Li=function(){function e(){_classCallCheck(this,e),this.compileModuleSync=Ri,this.compileModuleAsync=Oi,this.compileModuleAndAllComponentsSync=Fi,this.compileModuleAndAllComponentsAsync=Mi}return _createClass(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}(),Bi=function e(){_classCallCheck(this,e)};var Pi,zi=!(!(Pi=me.wtf)||!(Ii=Pi.trace)||(Ti=Ii.events,0));function Vi(e,t){return null}var Wi=zi?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Ti.createScope(e,t)}:function(e,t){return Vi},Ui=zi?function(e,t){return Ii.leaveScope(e,t),t}:function(e,t){return t},ji=Promise.resolve(0);function Hi(e){"undefined"==typeof Zone?ji.then((function(){e&&e.apply(null,null)})):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var Gi=function(){function e(t){var n,r=t.enableLongStackTrace,i=void 0!==r&&r;if(_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new mi(!1),this.onMicrotaskEmpty=new mi(!1),this.onStable=new mi(!1),this.onError=new mi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(n=this)._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,t,r,i,a,o){try{return Qi(n),e.invokeTask(r,i,a,o)}finally{Zi(n)}},onInvoke:function(e,t,r,i,a,o,s){try{return Qi(n),e.invoke(r,i,a,o,s)}finally{Zi(n)}},onHasTask:function(e,t,r,i){e.hasTask(r,i),t===r&&("microTask"==i.change?(n.hasPendingMicrotasks=i.microTask,Xi(n)):"macroTask"==i.change&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:function(e,t,r,i){return e.handleError(r,i),n.runOutsideAngular((function(){return n.onError.emit(i)})),!1}})}return _createClass(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+r,e,Ki,qi,qi);try{return i.runTask(a,t,n)}finally{i.cancelTask(a)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}();function qi(){}var Ki={};function Xi(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular((function(){return e.onStable.emit(null)}))}finally{e.isStable=!0}}}function Qi(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Zi(e){e._nesting--,Xi(e)}var $i,Yi=function(){function e(){_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new mi,this.onMicrotaskEmpty=new mi,this.onStable=new mi,this.onError=new mi}return _createClass(e,[{key:"run",value:function(e){return e()}},{key:"runGuarded",value:function(e){return e()}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e){return e()}}]),e}(),Ji=function(){function e(t){var n=this;_classCallCheck(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run((function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")}))}return _createClass(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular((function(){e._ngZone.onStable.subscribe({next:function(){Gi.assertNotInAngularZone(),Hi((function(){e._isZoneStable=!0,e._runCallbacksIfReady()}))}})}))}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())Hi((function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1}));else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter((function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)})),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map((function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}})):[]}},{key:"addCallback",value:function(e,t,n){var r=this,i=-1;t&&t>0&&(i=setTimeout((function(){r._callbacks=r._callbacks.filter((function(e){return e.timeoutId!==i})),e(r._didWork,r.getPendingTasks())}),t)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}(),ea=function(){function e(){_classCallCheck(this,e),this._applications=new Map,ta.addToWindow(this)}return _createClass(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ta.findTestabilityInTree(this,e,t)}}]),e}(),ta=new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),na=function(e,t,n){return e.get(Bi).createCompiler([t]).compileModuleAsync(n)},ra=new ve("AllowMultipleToken"),ia=function e(t,n){_classCallCheck(this,e),this.name=t,this.token=n};function aa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: ".concat(t),i=new ve(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=oa();if(!a||a.injector.get(ra,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{var o=n.concat(t).concat({provide:i,useValue:!0});!function(e){if($i&&!$i.destroyed&&!$i.injector.get(ra,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");$i=e.get(sa);var t=e.get(ki,null);t&&t.forEach((function(e){return e()}))}(kt.create({providers:o,name:r}))}return function(e){var t=oa();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function oa(){return $i&&!$i.destroyed?$i:null}var sa=function(){function e(t){_classCallCheck(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n,r=this,i="noop"===(n=t?t.ngZone:void 0)?new Yi:("zone.js"===n?void 0:n)||new Gi({enableLongStackTrace:Ge()}),a=[{provide:Gi,useValue:i}];return i.run((function(){var t=kt.create({providers:a,parent:r.injector,name:e.moduleType.name}),n=e.create(t),o=n.injector.get(Ue,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return Ni&&di(n.injector.get(Si,fi)||fi),n.onDestroy((function(){return ha(r._modules,n)})),i.runOutsideAngular((function(){return i.onError.subscribe({next:function(e){o.handleError(e)}})})),function(e,t,i){try{var a=((o=n.injector.get(bi)).runInitializers(),o.donePromise.then((function(){return r._moduleDoBootstrap(n),n})));return Pt(a)?a.catch((function(n){throw t.runOutsideAngular((function(){return e.handleError(n)})),n})):a}catch(yE){throw t.runOutsideAngular((function(){return e.handleError(yE)})),yE}var o}(o,i)}))}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=ua({},n);return na(this.injector,r,e).then((function(e){return t.bootstrapModuleFactory(e,r)}))}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(ca);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach((function(e){return t.bootstrap(e)}));else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(oe(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. ')+"Please define one of these.");e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach((function(e){return e.destroy()})),this._destroyListeners.forEach((function(e){return e()})),this._destroyed=!0}},{key:"injector",get:function(){return this._injector}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();function ua(e,t){return Array.isArray(t)?t.reduce(ua,e):Object.assign({},e,t)}var la,ca=((la=function(){function e(t,n,r,i,a,o){var s=this;_classCallCheck(this,e),this._zone=t,this._console=n,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=a,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Ge(),this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run((function(){s.tick()}))}});var u=new x((function(e){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular((function(){e.next(s._stable),e.complete()}))})),l=new x((function(e){var t;s._zone.runOutsideAngular((function(){t=s._zone.onStable.subscribe((function(){Gi.assertNotInAngularZone(),Hi((function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,e.next(!0))}))}))}));var n=s._zone.onUnstable.subscribe((function(){Gi.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular((function(){e.next(!1)})))}));return function(){t.unsubscribe(),n.unsubscribe()}}));this.isStable=W(u,l.pipe((function(e){return U()((t=X,function(e){var n;n="function"==typeof t?t:function(){return t};var r=Object.create(e,q);return r.source=e,r.subjectFactory=n,r})(e));var t})))}return _createClass(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof Wt?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var i=function(e){return e instanceof Kt}(n)?null:this._injector.get(Ie),a=n.create(kt.NULL,[],t||n.selector,i);a.onDestroy((function(){r._unloadComponent(a)}));var o=a.injector.get(Ji,null);return o&&a.injector.get(ea).registerApplication(a.location.nativeElement,o),this._loadComponent(a),Ge()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),a}},{key:"tick",value:function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=e._tickScope();try{this._runningTick=!0;var r=!0,i=!1,a=void 0;try{for(var o,s=this._views[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value.detectChanges()}catch(f){i=!0,a=f}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}if(this._enforceNoNewChanges){var u=!0,l=!1,c=void 0;try{for(var h,p=this._views[Symbol.iterator]();!(u=(h=p.next()).done);u=!0)h.value.checkNoChanges()}catch(f){l=!0,c=f}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}}}catch(yE){this._zone.runOutsideAngular((function(){return t._exceptionHandler.handleError(yE)}))}finally{this._runningTick=!1,Ui(n)}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;ha(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(_i,[]).concat(this._bootstrapListeners).forEach((function(t){return t(e)}))}},{key:"_unloadComponent",value:function(e){this.detachView(e.hostView),ha(this.components,e)}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach((function(e){return e.destroy()}))}},{key:"viewCount",get:function(){return this._views.length}}]),e}())._tickScope=Wi("ApplicationRef#tick()"),la);function ha(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var pa=function e(t,n){_classCallCheck(this,e),this.name=t,this.callback=n},fa=function(){function e(t,n,r){_classCallCheck(this,e),this.listeners=[],this.parent=null,this._debugContext=r,this.nativeNode=t,n&&n instanceof da&&n.addChild(this)}return _createClass(e,[{key:"injector",get:function(){return this._debugContext.injector}},{key:"componentInstance",get:function(){return this._debugContext.component}},{key:"context",get:function(){return this._debugContext.context}},{key:"references",get:function(){return this._debugContext.references}},{key:"providerTokens",get:function(){return this._debugContext.providerTokens}}]),e}(),da=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,n,r))).properties={},i.attributes={},i.classes={},i.styles={},i.childNodes=[],i.nativeElement=e,i}return _inherits(t,e),_createClass(t,[{key:"addChild",value:function(e){e&&(this.childNodes.push(e),e.parent=this)}},{key:"removeChild",value:function(e){var t=this.childNodes.indexOf(e);-1!==t&&(e.parent=null,this.childNodes.splice(t,1))}},{key:"insertChildrenAfter",value:function(e,t){var n,r=this,i=this.childNodes.indexOf(e);-1!==i&&((n=this.childNodes).splice.apply(n,[i+1,0].concat(_toConsumableArray(t))),t.forEach((function(t){t.parent&&t.parent.removeChild(t),e.parent=r})))}},{key:"insertBefore",value:function(e,t){var n=this.childNodes.indexOf(e);-1===n?this.addChild(t):(t.parent&&t.parent.removeChild(t),t.parent=this,this.childNodes.splice(n,0,t))}},{key:"query",value:function(e){return this.queryAll(e)[0]||null}},{key:"queryAll",value:function(e){var n=[];return function e(n,r,i){n.childNodes.forEach((function(n){n instanceof t&&(r(n)&&i.push(n),e(n,r,i))}))}(this,e,n),n}},{key:"queryAllNodes",value:function(e){var n=[];return function e(n,r,i){n instanceof t&&n.childNodes.forEach((function(n){r(n)&&i.push(n),n instanceof t&&e(n,r,i)}))}(this,e,n),n}},{key:"triggerEventHandler",value:function(e,t){this.listeners.forEach((function(n){n.name==e&&n.callback(t)}))}},{key:"children",get:function(){return this.childNodes.filter((function(e){return e instanceof t}))}}]),t}(fa),ma=new Map,va=function(e){return ma.get(e)||null};function ga(e){ma.set(e.nativeNode,e)}var ya=aa(null,"core",[{provide:Ei,useValue:"unknown"},{provide:sa,deps:[kt]},{provide:ea,deps:[]},{provide:Ai,deps:[]}]);function ba(){return vn}function wa(){return gn}function xa(e){return e?(Ni&&di(e),e):fi}function Ca(e){var t=[];return e.onStable.subscribe((function(){for(;t.length;)t.pop()()})),function(e){t.push(e)}}var ka=function e(t){_classCallCheck(this,e)};function Ea(e,t,n,r,i,a){e|=1;var o=Jn(t),s=o.matchedQueries,u=o.references;return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:e,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:o.matchedQueryIds,references:u,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:a?rr(a):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||On},provider:null,text:null,query:null,ngContent:null}}function _a(e,t,n,r,i,a){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],u=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,h=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;c||(c=On);var f=Jn(n),d=f.matchedQueries,m=f.references,v=f.matchedQueryIds,g=null,y=null;a&&(g=(o=_slicedToArray(cr(a),2))[0],y=o[1]),u=u||[];for(var b=new Array(u.length),w=0;w<u.length;w++){var x=_slicedToArray(u[w],3),C=x[0],k=x[1],E=x[2],_=_slicedToArray(cr(k),2),A=_[0],S=_[1],N=void 0,D=void 0;switch(15&C){case 4:D=E;break;case 1:case 8:N=E}b[w]={flags:C,ns:A,name:S,nonMinifiedName:S,securityContext:N,suffix:D}}l=l||[];for(var I=new Array(l.length),T=0;T<l.length;T++){var R=_slicedToArray(l[T],2),O=R[0],F=R[1];I[T]={type:0,target:O,eventName:F,propName:null}}var M=(s=s||[]).map((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1],i=_slicedToArray(cr(n),2);return[i[0],i[1],r]}));return p=function(e){if(e&&e.id===Bn){var t=null!=e.encapsulation&&e.encapsulation!==Fe.None||e.styles.length||Object.keys(e.data).length;e.id=t?"c".concat(Vn++):Pn}return e&&e.id===Pn&&(e=null),e||null}(p),h&&(t|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:v,references:m,ngContentIndex:r,childCount:i,bindings:b,bindingFlags:hr(b),outputs:I,element:{ns:g,name:y,attrs:M,template:null,componentProvider:null,componentView:h||null,componentRendererType:p,publicProviders:null,allProviders:null,handleEvent:c||On},provider:null,text:null,query:null,ngContent:null}}function Aa(e,t,n){var r,i=n.element,a=e.root.selectorOrNode,o=e.renderer;if(e.parent||!a){r=i.name?o.createElement(i.name,i.ns):o.createComment("");var s=tr(e,t,n);s&&o.appendChild(s,r)}else r=o.selectRootElement(a,!!i.componentRendererType&&i.componentRendererType.encapsulation===Fe.ShadowDom);if(i.attrs)for(var u=0;u<i.attrs.length;u++){var l=_slicedToArray(i.attrs[u],3),c=l[0],h=l[1],p=l[2];o.setAttribute(r,h,p,c)}return r}function Sa(e,t,n,r){for(var i=0;i<n.outputs.length;i++){var a=n.outputs[i],o=Na(e,n.nodeIndex,(h=a.eventName,(c=a.target)?"".concat(c,":").concat(h):h)),s=a.target,u=e;"component"===a.target&&(s=null,u=t);var l=u.renderer.listen(s||r,a.eventName,o);e.disposables[n.outputIndex+i]=l}var c,h}function Na(e,t,n){return function(r){return qn(e,t,n,r)}}function Da(e,t,n,r){if(!Un(e,t,n,r))return!1;var i=t.bindings[n],a=Nn(e,t.nodeIndex),o=a.renderElement,s=i.name;switch(15&i.flags){case 1:!function(e,t,n,r,i,a){var o=t.securityContext,s=o?e.root.sanitizer.sanitize(o,a):a;s=null!=s?s.toString():null;var u=e.renderer;null!=a?u.setAttribute(n,i,s,r):u.removeAttribute(n,i,r)}(e,i,o,i.ns,s,r);break;case 2:!function(e,t,n,r){var i=e.renderer;r?i.addClass(t,n):i.removeClass(t,n)}(e,o,s,r);break;case 4:!function(e,t,n,r,i){var a=e.root.sanitizer.sanitize(ft.STYLE,i);if(null!=a){a=a.toString();var o=t.suffix;null!=o&&(a+=o)}else a=null;var s=e.renderer;null!=a?s.setStyle(n,r,a):s.removeStyle(n,r)}(e,i,o,s,r);break;case 8:!function(e,t,n,r,i){var a=t.securityContext,o=a?e.root.sanitizer.sanitize(a,i):i;e.renderer.setProperty(n,r,o)}(33554432&t.flags&&32&i.flags?a.componentView:e,i,o,s,r)}return!0}function Ia(e,t,n){var r=[];for(var i in n)r.push({propName:i,bindingType:n[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:t,filterId:Yn(t),bindings:r},ngContent:null}}function Ta(e){for(var t=e.def.nodeMatchedQueries;e.parent&&$n(e);){var n=e.parentNodeDef;e=e.parent;for(var r=n.nodeIndex+n.childCount,i=0;i<=r;i++){var a=e.def.nodes[i];67108864&a.flags&&536870912&a.flags&&(a.query.filterId&t)===a.query.filterId&&Tn(e,i).setDirty(),!(1&a.flags&&i+a.childCount<n.nodeIndex)&&67108864&a.childFlags&&536870912&a.childFlags||(i+=a.childCount)}}if(134217728&e.def.nodeFlags)for(var o=0;o<e.def.nodes.length;o++){var s=e.def.nodes[o];134217728&s.flags&&536870912&s.flags&&Tn(e,o).setDirty(),o+=s.childCount}}function Ra(e,t){var n=Tn(e,t.nodeIndex);if(n.dirty){var r,i=void 0;if(67108864&t.flags){var a=t.parent.parent;i=Oa(e,a.nodeIndex,a.nodeIndex+a.childCount,t.query,[]),r=Dn(e,t.parent.nodeIndex).instance}else 134217728&t.flags&&(i=Oa(e,0,e.def.nodes.length-1,t.query,[]),r=e.component);n.reset(i);for(var o=t.query.bindings,s=!1,u=0;u<o.length;u++){var l=o[u],c=void 0;switch(l.bindingType){case 0:c=n.first;break;case 1:c=n,s=!0}r[l.propName]=c}s&&n.notifyOnChanges()}}function Oa(e,t,n,r,i){for(var a=t;a<=n;a++){var o=e.def.nodes[a],s=o.matchedQueries[r.id];if(null!=s&&i.push(Fa(e,o,s)),1&o.flags&&o.element.template&&(o.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=Nn(e,a);if((o.childMatchedQueries&r.filterId)===r.filterId&&(Oa(e,a+1,a+o.childCount,r,i),a+=o.childCount),16777216&o.flags)for(var l=u.viewContainer._embeddedViews,c=0;c<l.length;c++){var h=l[c],p=Kn(h);p&&p===u&&Oa(h,0,h.def.nodes.length-1,r,i)}var f=u.template._projectedViews;if(f)for(var d=0;d<f.length;d++){var m=f[d];Oa(m,0,m.def.nodes.length-1,r,i)}}(o.childMatchedQueries&r.filterId)!==r.filterId&&(a+=o.childCount)}return i}function Fa(e,t,n){if(null!=n)switch(n){case 1:return Nn(e,t.nodeIndex).renderElement;case 0:return new Qt(Nn(e,t.nodeIndex).renderElement);case 2:return Nn(e,t.nodeIndex).template;case 3:return Nn(e,t.nodeIndex).viewContainer;case 4:return Dn(e,t.nodeIndex).instance}}function Ma(e,t,n){var r=tr(e,t,n);r&&or(e,n.ngContent.index,1,r,null,void 0)}function La(e,t){return function(e,t,n){for(var r=new Array(n.length),i=0;i<n.length;i++){var a=n[i];r[i]={flags:8,name:a,ns:null,nonMinifiedName:a,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:128,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:r,bindingFlags:hr(r),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,e,new Array(t+1))}function Ba(e,t,n){for(var r=new Array(n.length-1),i=1;i<n.length;i++)r[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Pa(e,t,n){var r,i=e.renderer;r=i.createText(n.text.prefix);var a=tr(e,t,n);return a&&i.appendChild(a,r),{renderText:r}}function za(e,t){return(null!=e?e.toString():"")+t.suffix}function Va(e,t,n,r){for(var i=0,a=0,o=0,s=0,u=0,l=null,c=null,h=!1,p=!1,f=null,d=0;d<t.length;d++){var m=t[d];if(m.nodeIndex=d,m.parent=l,m.bindingIndex=i,m.outputIndex=a,m.renderParent=c,o|=m.flags,u|=m.matchedQueryIds,m.element){var v=m.element;v.publicProviders=l?l.element.publicProviders:Object.create(null),v.allProviders=v.publicProviders,h=!1,p=!1,m.element.template&&(u|=m.element.template.nodeMatchedQueries)}if(Ua(l,m,t.length),i+=m.bindings.length,a+=m.outputs.length,!c&&3&m.flags&&(f=m),20224&m.flags){h||(h=!0,l.element.publicProviders=Object.create(l.element.publicProviders),l.element.allProviders=l.element.publicProviders);var g=0!=(32768&m.flags);0==(8192&m.flags)||g?l.element.publicProviders[Mn(m.provider.token)]=m:(p||(p=!0,l.element.allProviders=Object.create(l.element.publicProviders)),l.element.allProviders[Mn(m.provider.token)]=m),g&&(l.element.componentProvider=m)}if(l?(l.childFlags|=m.flags,l.directChildFlags|=m.flags,l.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(l.childMatchedQueries|=m.element.template.nodeMatchedQueries)):s|=m.flags,m.childCount>0)l=m,Wa(m)||(c=m);else for(;l&&d===l.nodeIndex+l.childCount;){var y=l.parent;y&&(y.childFlags|=l.childFlags,y.childMatchedQueries|=l.childMatchedQueries),c=(l=y)&&Wa(l)?l.renderParent:l}}return{factory:null,nodeFlags:o,rootNodeFlags:s,nodeMatchedQueries:u,flags:e,nodes:t,updateDirectives:n||On,updateRenderer:r||On,handleEvent:function(e,n,r,i){return t[n].element.handleEvent(e,r,i)},bindingCount:i,outputCount:a,lastRenderRootNode:f}}function Wa(e){return 0!=(1&e.flags)&&null===e.element.name}function Ua(e,t,n){var r=t.element&&t.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index ".concat(t.nodeIndex,"!"))}if(20224&t.flags&&0==(1&(e?e.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ".concat(t.nodeIndex,"!"));if(t.query){if(67108864&t.flags&&(!e||0==(16384&e.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index ".concat(t.nodeIndex,"!"));if(134217728&t.flags&&e)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index ".concat(t.nodeIndex,"!"))}if(t.childCount){var i=e?e.nodeIndex+e.childCount:n-1;if(t.nodeIndex<=i&&t.nodeIndex+t.childCount>i)throw new Error("Illegal State: childCount of node leads outside of parent, at index ".concat(t.nodeIndex,"!"))}}function ja(e,t,n,r){var i=qa(e.root,e.renderer,e,t,n);return Ka(i,e.component,r),Xa(i),i}function Ha(e,t,n){var r=qa(e,e.renderer,null,null,t);return Ka(r,n,n),Xa(r),r}function Ga(e,t,n,r){var i,a=t.element.componentRendererType;return i=a?e.root.rendererFactory.createRenderer(r,a):e.root.renderer,qa(e.root,i,e,t.element.componentProvider,n)}function qa(e,t,n,r,i){var a=new Array(i.nodes.length),o=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:a,state:13,root:e,renderer:t,oldValues:new Array(i.bindingCount),disposables:o,initIndex:-1}}function Ka(e,t,n){e.component=t,e.context=n}function Xa(e){var t;Zn(e)&&(t=Nn(e.parent,e.parentNodeDef.parent.nodeIndex).renderElement);for(var n=e.def,r=e.nodes,i=0;i<n.nodes.length;i++){var a=n.nodes[i],o=void 0;switch(Rn.setCurrentNode(e,i),201347067&a.flags){case 1:var s=Aa(e,t,a),u=void 0;if(33554432&a.flags){var l=rr(a.element.componentView);u=Rn.createComponentView(e,a,l,s)}Sa(e,u,a,s),o={renderElement:s,componentView:u,viewContainer:null,template:a.element.template?Dr(e,a):void 0},16777216&a.flags&&(o.viewContainer=_r(e,a,o));break;case 2:o=Pa(e,t,a);break;case 512:case 1024:case 2048:case 256:(o=r[i])||4096&a.flags||(o={instance:Qr(e,a)});break;case 16:o={instance:Zr(e,a)};break;case 16384:(o=r[i])||(o={instance:$r(e,a)}),32768&a.flags&&Ka(Nn(e,a.parent.nodeIndex).componentView,o.instance,o.instance);break;case 32:case 64:case 128:o={value:void 0};break;case 67108864:case 134217728:o=new gi;break;case 8:Ma(e,t,a),o=void 0}r[i]=o}ro(e,no.CreateViewNodes),so(e,201326592,268435456,0)}function Qa(e){Ya(e),Rn.updateDirectives(e,1),io(e,no.CheckNoChanges),Rn.updateRenderer(e,1),ro(e,no.CheckNoChanges),e.state&=-97}function Za(e){1&e.state?(e.state&=-2,e.state|=2):e.state&=-3,_n(e,0,256),Ya(e),Rn.updateDirectives(e,0),io(e,no.CheckAndUpdate),so(e,67108864,536870912,0);var t=_n(e,256,512);ai(e,2097152|(t?1048576:0)),Rn.updateRenderer(e,0),ro(e,no.CheckAndUpdate),so(e,134217728,536870912,0),ai(e,8388608|((t=_n(e,512,768))?4194304:0)),2&e.def.flags&&(e.state&=-9),e.state&=-97,_n(e,768,1024)}function $a(e,t,n,r,i,a,o,s,u,l,c,h,p){return 0===n?function(e,t,n,r,i,a,o,s,u,l,c,h){switch(201347067&t.flags){case 1:return function(e,t,n,r,i,a,o,s,u,l,c,h){var p=t.bindings.length,f=!1;return p>0&&Da(e,t,0,n)&&(f=!0),p>1&&Da(e,t,1,r)&&(f=!0),p>2&&Da(e,t,2,i)&&(f=!0),p>3&&Da(e,t,3,a)&&(f=!0),p>4&&Da(e,t,4,o)&&(f=!0),p>5&&Da(e,t,5,s)&&(f=!0),p>6&&Da(e,t,6,u)&&(f=!0),p>7&&Da(e,t,7,l)&&(f=!0),p>8&&Da(e,t,8,c)&&(f=!0),p>9&&Da(e,t,9,h)&&(f=!0),f}(e,t,n,r,i,a,o,s,u,l,c,h);case 2:return function(e,t,n,r,i,a,o,s,u,l,c,h){var p=!1,f=t.bindings,d=f.length;if(d>0&&Un(e,t,0,n)&&(p=!0),d>1&&Un(e,t,1,r)&&(p=!0),d>2&&Un(e,t,2,i)&&(p=!0),d>3&&Un(e,t,3,a)&&(p=!0),d>4&&Un(e,t,4,o)&&(p=!0),d>5&&Un(e,t,5,s)&&(p=!0),d>6&&Un(e,t,6,u)&&(p=!0),d>7&&Un(e,t,7,l)&&(p=!0),d>8&&Un(e,t,8,c)&&(p=!0),d>9&&Un(e,t,9,h)&&(p=!0),p){var m=t.text.prefix;d>0&&(m+=za(n,f[0])),d>1&&(m+=za(r,f[1])),d>2&&(m+=za(i,f[2])),d>3&&(m+=za(a,f[3])),d>4&&(m+=za(o,f[4])),d>5&&(m+=za(s,f[5])),d>6&&(m+=za(u,f[6])),d>7&&(m+=za(l,f[7])),d>8&&(m+=za(c,f[8])),d>9&&(m+=za(h,f[9]));var v=Sn(e,t.nodeIndex).renderText;e.renderer.setValue(v,m)}return p}(e,t,n,r,i,a,o,s,u,l,c,h);case 16384:return function(e,t,n,r,i,a,o,s,u,l,c,h){var p=Dn(e,t.nodeIndex),f=p.instance,d=!1,m=void 0,v=t.bindings.length;return v>0&&Wn(e,t,0,n)&&(d=!0,m=ii(e,p,t,0,n,m)),v>1&&Wn(e,t,1,r)&&(d=!0,m=ii(e,p,t,1,r,m)),v>2&&Wn(e,t,2,i)&&(d=!0,m=ii(e,p,t,2,i,m)),v>3&&Wn(e,t,3,a)&&(d=!0,m=ii(e,p,t,3,a,m)),v>4&&Wn(e,t,4,o)&&(d=!0,m=ii(e,p,t,4,o,m)),v>5&&Wn(e,t,5,s)&&(d=!0,m=ii(e,p,t,5,s,m)),v>6&&Wn(e,t,6,u)&&(d=!0,m=ii(e,p,t,6,u,m)),v>7&&Wn(e,t,7,l)&&(d=!0,m=ii(e,p,t,7,l,m)),v>8&&Wn(e,t,8,c)&&(d=!0,m=ii(e,p,t,8,c,m)),v>9&&Wn(e,t,9,h)&&(d=!0,m=ii(e,p,t,9,h,m)),m&&f.ngOnChanges(m),65536&t.flags&&An(e,256,t.nodeIndex)&&f.ngOnInit(),262144&t.flags&&f.ngDoCheck(),d}(e,t,n,r,i,a,o,s,u,l,c,h);case 32:case 64:case 128:return function(e,t,n,r,i,a,o,s,u,l,c,h){var p=t.bindings,f=!1,d=p.length;if(d>0&&Un(e,t,0,n)&&(f=!0),d>1&&Un(e,t,1,r)&&(f=!0),d>2&&Un(e,t,2,i)&&(f=!0),d>3&&Un(e,t,3,a)&&(f=!0),d>4&&Un(e,t,4,o)&&(f=!0),d>5&&Un(e,t,5,s)&&(f=!0),d>6&&Un(e,t,6,u)&&(f=!0),d>7&&Un(e,t,7,l)&&(f=!0),d>8&&Un(e,t,8,c)&&(f=!0),d>9&&Un(e,t,9,h)&&(f=!0),f){var m,v=In(e,t.nodeIndex);switch(201347067&t.flags){case 32:m=new Array(p.length),d>0&&(m[0]=n),d>1&&(m[1]=r),d>2&&(m[2]=i),d>3&&(m[3]=a),d>4&&(m[4]=o),d>5&&(m[5]=s),d>6&&(m[6]=u),d>7&&(m[7]=l),d>8&&(m[8]=c),d>9&&(m[9]=h);break;case 64:m={},d>0&&(m[p[0].name]=n),d>1&&(m[p[1].name]=r),d>2&&(m[p[2].name]=i),d>3&&(m[p[3].name]=a),d>4&&(m[p[4].name]=o),d>5&&(m[p[5].name]=s),d>6&&(m[p[6].name]=u),d>7&&(m[p[7].name]=l),d>8&&(m[p[8].name]=c),d>9&&(m[p[9].name]=h);break;case 128:var g=n;switch(d){case 1:m=g.transform(n);break;case 2:m=g.transform(r);break;case 3:m=g.transform(r,i);break;case 4:m=g.transform(r,i,a);break;case 5:m=g.transform(r,i,a,o);break;case 6:m=g.transform(r,i,a,o,s);break;case 7:m=g.transform(r,i,a,o,s,u);break;case 8:m=g.transform(r,i,a,o,s,u,l);break;case 9:m=g.transform(r,i,a,o,s,u,l,c);break;case 10:m=g.transform(r,i,a,o,s,u,l,c,h)}}v.value=m}return f}(e,t,n,r,i,a,o,s,u,l,c,h);default:throw"unreachable"}}(e,t,r,i,a,o,s,u,l,c,h,p):function(e,t,n){switch(201347067&t.flags){case 1:return function(e,t,n){for(var r=!1,i=0;i<n.length;i++)Da(e,t,i,n[i])&&(r=!0);return r}(e,t,n);case 2:return function(e,t,n){for(var r=t.bindings,i=!1,a=0;a<n.length;a++)Un(e,t,a,n[a])&&(i=!0);if(i){for(var o="",s=0;s<n.length;s++)o+=za(n[s],r[s]);o=t.text.prefix+o;var u=Sn(e,t.nodeIndex).renderText;e.renderer.setValue(u,o)}return i}(e,t,n);case 16384:return function(e,t,n){for(var r=Dn(e,t.nodeIndex),i=r.instance,a=!1,o=void 0,s=0;s<n.length;s++)Wn(e,t,s,n[s])&&(a=!0,o=ii(e,r,t,s,n[s],o));return o&&i.ngOnChanges(o),65536&t.flags&&An(e,256,t.nodeIndex)&&i.ngOnInit(),262144&t.flags&&i.ngDoCheck(),a}(e,t,n);case 32:case 64:case 128:return function(e,t,n){for(var r=t.bindings,i=!1,a=0;a<n.length;a++)Un(e,t,a,n[a])&&(i=!0);if(i){var o,s=In(e,t.nodeIndex);switch(201347067&t.flags){case 32:o=n;break;case 64:o={};for(var u=0;u<n.length;u++)o[r[u].name]=n[u];break;case 128:var l=n[0],c=n.slice(1);o=l.transform.apply(l,_toConsumableArray(c))}s.value=o}return i}(e,t,n);default:throw"unreachable"}}(e,t,r)}function Ya(e){var t=e.def;if(4&t.nodeFlags)for(var n=0;n<t.nodes.length;n++){var r=t.nodes[n];if(4&r.flags){var i=Nn(e,n).template._projectedViews;if(i)for(var a=0;a<i.length;a++){var o=i[a];o.state|=32,Gn(o,e)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function Ja(e,t,n,r,i,a,o,s,u,l,c,h,p){return 0===n?function(e,t,n,r,i,a,o,s,u,l,c,h){var p=t.bindings.length;p>0&&jn(e,t,0,n),p>1&&jn(e,t,1,r),p>2&&jn(e,t,2,i),p>3&&jn(e,t,3,a),p>4&&jn(e,t,4,o),p>5&&jn(e,t,5,s),p>6&&jn(e,t,6,u),p>7&&jn(e,t,7,l),p>8&&jn(e,t,8,c),p>9&&jn(e,t,9,h)}(e,t,r,i,a,o,s,u,l,c,h,p):function(e,t,n){for(var r=0;r<n.length;r++)jn(e,t,r,n[r])}(e,t,r),!1}function eo(e,t){if(Tn(e,t.nodeIndex).dirty)throw Cn(Rn.createDebugContext(e,t.nodeIndex),"Query ".concat(t.query.id," not dirty"),"Query ".concat(t.query.id," dirty"),0!=(1&e.state))}function to(e){if(!(128&e.state)){if(io(e,no.Destroy),ro(e,no.Destroy),ai(e,131072),e.disposables)for(var t=0;t<e.disposables.length;t++)e.disposables[t]();!function(e){if(16&e.state){var t=Kn(e);if(t){var n=t.template._projectedViews;n&&(Oe(n,n.indexOf(e)),Rn.dirtyParentQueries(e))}}}(e),e.renderer.destroyNode&&function(e){for(var t=e.def.nodes.length,n=0;n<t;n++){var r=e.def.nodes[n];1&r.flags?e.renderer.destroyNode(Nn(e,n).renderElement):2&r.flags?e.renderer.destroyNode(Sn(e,n).renderText):(67108864&r.flags||134217728&r.flags)&&Tn(e,n).destroy()}}(e),Zn(e)&&e.renderer.destroy(),e.state|=128}}var no=function(){var e={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return e[e.CreateViewNodes]="CreateViewNodes",e[e.CheckNoChanges]="CheckNoChanges",e[e.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",e[e.CheckAndUpdate]="CheckAndUpdate",e[e.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",e[e.Destroy]="Destroy",e}();function ro(e,t){var n=e.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var i=n.nodes[r];33554432&i.flags?ao(Nn(e,r).componentView,t):0==(33554432&i.childFlags)&&(r+=i.childCount)}}function io(e,t){var n=e.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var i=n.nodes[r];if(16777216&i.flags)for(var a=Nn(e,r).viewContainer._embeddedViews,o=0;o<a.length;o++)ao(a[o],t);else 0==(16777216&i.childFlags)&&(r+=i.childCount)}}function ao(e,t){var n=e.state;switch(t){case no.CheckNoChanges:0==(128&n)&&(12==(12&n)?Qa(e):64&n&&oo(e,no.CheckNoChangesProjectedViews));break;case no.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?Qa(e):64&n&&oo(e,t));break;case no.CheckAndUpdate:0==(128&n)&&(12==(12&n)?Za(e):64&n&&oo(e,no.CheckAndUpdateProjectedViews));break;case no.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?Za(e):64&n&&oo(e,t));break;case no.Destroy:to(e);break;case no.CreateViewNodes:Xa(e)}}function oo(e,t){io(e,t),ro(e,t)}function so(e,t,n,r){if(e.def.nodeFlags&t&&e.def.nodeFlags&n)for(var i=e.def.nodes.length,a=0;a<i;a++){var o=e.def.nodes[a];if(o.flags&t&&o.flags&n)switch(Rn.setCurrentNode(e,o.nodeIndex),r){case 0:Ra(e,o);break;case 1:eo(e,o)}o.childFlags&t&&o.childFlags&n||(a+=o.childCount)}}var uo=!1;function lo(e,t,n,r,i,a){var o=i.injector.get($t);return Ha(ho(e,i,o,t,n),r,a)}function co(e,t,n,r,i,a){var o=i.injector.get($t),s=ho(e,i,new Ho(o),t,n),u=Co(r);return Uo(To.create,Ha,null,[s,u,a])}function ho(e,t,n,r,i){var a=t.injector.get(dt),o=t.injector.get(Ue),s=n.createRenderer(null,null);return{ngModule:t,injector:e,projectableNodes:r,selectorOrNode:i,sanitizer:a,rendererFactory:n,renderer:s,errorHandler:o}}function po(e,t,n,r){var i=Co(n);return Uo(To.create,ja,null,[e,t,i,r])}function fo(e,t,n,r){return n=yo.get(t.element.componentProvider.provider.token)||Co(n),Uo(To.create,Ga,null,[e,t,n,r])}function mo(e,t,n,r){return Lr(e,t,n,function(e){var t=function(e){var t=!1,n=!1;return 0===vo.size?{hasOverrides:t,hasDeprecatedOverrides:n}:(e.providers.forEach((function(e){var r=vo.get(e.token);3840&e.flags&&r&&(t=!0,n=n||r.deprecatedBehavior)})),e.modules.forEach((function(e){go.forEach((function(r,i){ie(i).providedIn===e&&(t=!0,n=n||r.deprecatedBehavior)}))})),{hasOverrides:t,hasDeprecatedOverrides:n})}(e),n=t.hasOverrides,r=t.hasDeprecatedOverrides;return n?(function(e){for(var t=0;t<e.providers.length;t++){var n=e.providers[t];r&&(n.flags|=4096);var i=vo.get(n.token);i&&(n.flags=-3841&n.flags|i.flags,n.deps=er(i.deps),n.value=i.value)}if(go.size>0){var a=new Set(e.modules);go.forEach((function(t,n){if(a.has(ie(n).providedIn)){var i={token:n,flags:t.flags|(r?4096:0),deps:er(t.deps),value:t.value,index:e.providers.length};e.providers.push(i),e.providersByKey[Mn(n)]=i}}))}}(e=e.factory((function(){return On}))),e):e}(r))}var vo=new Map,go=new Map,yo=new Map;function bo(e){var t;vo.set(e.token,e),"function"==typeof e.token&&(t=ie(e.token))&&"function"==typeof t.providedIn&&go.set(e.token,e)}function wo(e,t){var n=rr(t.viewDefFactory),r=rr(n.nodes[0].element.componentView);yo.set(e,r)}function xo(){vo.clear(),go.clear(),yo.clear()}function Co(e){if(0===vo.size)return e;var t=function(e){for(var t=[],n=null,r=0;r<e.nodes.length;r++){var i=e.nodes[r];1&i.flags&&(n=i),n&&3840&i.flags&&vo.has(i.provider.token)&&(t.push(n.nodeIndex),n=null)}return t}(e);if(0===t.length)return e;e=e.factory((function(){return On}));for(var n=0;n<t.length;n++)r(e,t[n]);return e;function r(e,t){for(var n=t+1;n<e.nodes.length;n++){var r=e.nodes[n];if(1&r.flags)return;if(3840&r.flags){var i=r.provider,a=vo.get(i.token);a&&(r.flags=-3841&r.flags|a.flags,i.deps=er(a.deps),i.value=a.value)}}}}function ko(e,t,n,r,i,a,o,s,u,l,c,h,p){var f=e.def.nodes[t];return $a(e,f,n,r,i,a,o,s,u,l,c,h,p),224&f.flags?In(e,t).value:void 0}function Eo(e,t,n,r,i,a,o,s,u,l,c,h,p){var f=e.def.nodes[t];return Ja(e,f,n,r,i,a,o,s,u,l,c,h,p),224&f.flags?In(e,t).value:void 0}function _o(e){return Uo(To.detectChanges,Za,null,[e])}function Ao(e){return Uo(To.checkNoChanges,Qa,null,[e])}function So(e){return Uo(To.destroy,to,null,[e])}var No,Do,Io,To=function(){var e={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return e[e.create]="create",e[e.detectChanges]="detectChanges",e[e.checkNoChanges]="checkNoChanges",e[e.destroy]="destroy",e[e.handleEvent]="handleEvent",e}();function Ro(e,t){Do=e,Io=t}function Oo(e,t,n,r){return Ro(e,t),Uo(To.handleEvent,e.def.handleEvent,null,[e,t,n,r])}function Fo(e,t){if(128&e.state)throw En(To[No]);return Ro(e,Po(e,0)),e.def.updateDirectives((function(e,n,r){for(var i=e.def.nodes[n],a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return 0===t?Lo(e,i,r,o):Bo(e,i,r,o),16384&i.flags&&Ro(e,Po(e,n)),224&i.flags?In(e,i.nodeIndex).value:void 0}),e)}function Mo(e,t){if(128&e.state)throw En(To[No]);return Ro(e,zo(e,0)),e.def.updateRenderer((function(e,n,r){for(var i=e.def.nodes[n],a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return 0===t?Lo(e,i,r,o):Bo(e,i,r,o),3&i.flags&&Ro(e,zo(e,n)),224&i.flags?In(e,i.nodeIndex).value:void 0}),e)}function Lo(e,t,n,r){if($a.apply(void 0,[e,t,n].concat(_toConsumableArray(r)))){var i=1===n?r[0]:r;if(16384&t.flags){for(var a={},o=0;o<t.bindings.length;o++){var s=t.bindings[o],u=i[o];8&s.flags&&(a[(f=s.nonMinifiedName,d=void 0,d=f.replace(/[$@]/g,"_"),"ng-reflect-".concat(f=d.replace(gt,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"-"+t[1].toLowerCase()}))))]=yt(u))}var l=t.parent,c=Nn(e,l.nodeIndex).renderElement;if(l.element.name)for(var h in a){var p=a[h];null!=p?e.renderer.setAttribute(c,h,p):e.renderer.removeAttribute(c,h)}else e.renderer.setValue(c,"bindings=".concat(JSON.stringify(a,null,2)))}}var f,d}function Bo(e,t,n,r){Ja.apply(void 0,[e,t,n].concat(_toConsumableArray(r)))}function Po(e,t){for(var n=t;n<e.def.nodes.length;n++){var r=e.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function zo(e,t){for(var n=t;n<e.def.nodes.length;n++){var r=e.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var Vo=function(){function e(t,n){_classCallCheck(this,e),this.view=t,this.nodeIndex=n,null==n&&(this.nodeIndex=n=0),this.nodeDef=t.def.nodes[n];for(var r=this.nodeDef,i=t;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&i;)r=Xn(i),i=i.parent;this.elDef=r,this.elView=i}return _createClass(e,[{key:"logError",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a;2&this.nodeDef.flags?(i=this.view.def,a=this.nodeDef.nodeIndex):(i=this.elView.def,a=this.elDef.nodeIndex);var o=function(e,t){for(var n=-1,r=0;r<=t;r++)3&e.nodes[r].flags&&n++;return n}(i,a),s=-1;i.factory((function(){var t;return++s===o?(t=e.error).bind.apply(t,[e].concat(n)):On})),s<o&&(e.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),e.error.apply(e,n))}},{key:"elOrCompView",get:function(){return Nn(this.elView,this.elDef.nodeIndex).componentView||this.view}},{key:"injector",get:function(){return Tr(this.elView,this.elDef)}},{key:"component",get:function(){return this.elOrCompView.component}},{key:"context",get:function(){return this.elOrCompView.context}},{key:"providerTokens",get:function(){var e=[];if(this.elDef)for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&e.push(n.provider.token),t+=n.childCount}return e}},{key:"references",get:function(){var e={};if(this.elDef){Wo(this.elView,this.elDef,e);for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&Wo(this.elView,n,e),t+=n.childCount}}return e}},{key:"componentRenderElement",get:function(){var e=function(e){for(;e&&!Zn(e);)e=e.parent;return e.parent?Nn(e.parent,Xn(e).nodeIndex):null}(this.elOrCompView);return e?e.renderElement:void 0}},{key:"renderNode",get:function(){return 2&this.nodeDef.flags?Qn(this.view,this.nodeDef):Qn(this.elView,this.elDef)}}]),e}();function Wo(e,t,n){for(var r in t.references)n[r]=Fa(e,t,t.references[r])}function Uo(e,t,n,r){var i,a,o=No,s=Do,u=Io;try{No=e;var l=t.apply(n,r);return Do=s,Io=u,No=o,l}catch(yE){if(ze(yE)||!Do)throw yE;throw i=yE,a=jo(),i instanceof Error||(i=new Error(i.toString())),kn(i,a),i}}function jo(){return Do?new Vo(Do,Io):null}var Ho=function(){function e(t){_classCallCheck(this,e),this.delegate=t}return _createClass(e,[{key:"createRenderer",value:function(e,t){return new Go(this.delegate.createRenderer(e,t))}},{key:"begin",value:function(){this.delegate.begin&&this.delegate.begin()}},{key:"end",value:function(){this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}]),e}(),Go=function(){function e(t){_classCallCheck(this,e),this.delegate=t,this.debugContextFactory=jo,this.data=this.delegate.data}return _createClass(e,[{key:"createDebugContext",value:function(e){return this.debugContextFactory(e)}},{key:"destroyNode",value:function(e){var t=va(e);!function(e){ma.delete(e.nativeNode)}(t),t instanceof fa&&(t.listeners.length=0),this.delegate.destroyNode&&this.delegate.destroyNode(e)}},{key:"destroy",value:function(){this.delegate.destroy()}},{key:"createElement",value:function(e,t){var n=this.delegate.createElement(e,t),r=this.createDebugContext(n);if(r){var i=new da(n,null,r);i.name=e,ga(i)}return n}},{key:"createComment",value:function(e){var t=this.delegate.createComment(e),n=this.createDebugContext(t);return n&&ga(new fa(t,null,n)),t}},{key:"createText",value:function(e){var t=this.delegate.createText(e),n=this.createDebugContext(t);return n&&ga(new fa(t,null,n)),t}},{key:"appendChild",value:function(e,t){var n=va(e),r=va(t);n&&r&&n instanceof da&&n.addChild(r),this.delegate.appendChild(e,t)}},{key:"insertBefore",value:function(e,t,n){var r=va(e),i=va(t),a=va(n);r&&i&&r instanceof da&&r.insertBefore(a,i),this.delegate.insertBefore(e,t,n)}},{key:"removeChild",value:function(e,t){var n=va(e),r=va(t);n&&r&&n instanceof da&&n.removeChild(r),this.delegate.removeChild(e,t)}},{key:"selectRootElement",value:function(e,t){var n=this.delegate.selectRootElement(e,t),r=jo();return r&&ga(new da(n,null,r)),n}},{key:"setAttribute",value:function(e,t,n,r){var i=va(e);i&&i instanceof da&&(i.attributes[r?r+":"+t:t]=n),this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){var r=va(e);r&&r instanceof da&&(r.attributes[n?n+":"+t:t]=null),this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){var n=va(e);n&&n instanceof da&&(n.classes[t]=!0),this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){var n=va(e);n&&n instanceof da&&(n.classes[t]=!1),this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){var i=va(e);i&&i instanceof da&&(i.styles[t]=n),this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){var r=va(e);r&&r instanceof da&&(r.styles[t]=null),this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){var r=va(e);r&&r instanceof da&&(r.properties[t]=n),this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){if("string"!=typeof e){var r=va(e);r&&r.listeners.push(new pa(t,n))}return this.delegate.listen(e,t,n)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setValue",value:function(e,t){return this.delegate.setValue(e,t)}}]),e}();var qo=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).moduleType=e,i._bootstrapComponents=n,i._ngModuleDefFactory=r,i}return _inherits(t,e),_createClass(t,[{key:"create",value:function(e){!function(){if(!uo){uo=!0;var e=Ge()?{setCurrentNode:Ro,createRootView:co,createEmbeddedView:po,createComponentView:fo,createNgModuleRef:mo,overrideProvider:bo,overrideComponentView:wo,clearOverrides:xo,checkAndUpdateView:_o,checkNoChangesView:Ao,destroyView:So,createDebugContext:function(e,t){return new Vo(e,t)},handleEvent:Oo,updateDirectives:Fo,updateRenderer:Mo}:{setCurrentNode:function(){},createRootView:lo,createEmbeddedView:ja,createComponentView:Ga,createNgModuleRef:Lr,overrideProvider:On,overrideComponentView:On,clearOverrides:On,checkAndUpdateView:Za,checkNoChangesView:Qa,destroyView:to,createDebugContext:function(e,t){return new Vo(e,t)},handleEvent:function(e,t,n,r){return e.def.handleEvent(e,t,n,r)},updateDirectives:function(e,t){return e.def.updateDirectives(0===t?ko:Eo,e)},updateRenderer:function(e,t){return e.def.updateRenderer(0===t?ko:Eo,e)}};Rn.setCurrentNode=e.setCurrentNode,Rn.createRootView=e.createRootView,Rn.createEmbeddedView=e.createEmbeddedView,Rn.createComponentView=e.createComponentView,Rn.createNgModuleRef=e.createNgModuleRef,Rn.overrideProvider=e.overrideProvider,Rn.overrideComponentView=e.overrideComponentView,Rn.clearOverrides=e.clearOverrides,Rn.checkAndUpdateView=e.checkAndUpdateView,Rn.checkNoChangesView=e.checkNoChangesView,Rn.destroyView=e.destroyView,Rn.resolveDep=ni,Rn.createDebugContext=e.createDebugContext,Rn.handleEvent=e.handleEvent,Rn.updateDirectives=e.updateDirectives,Rn.updateRenderer=e.updateRenderer,Rn.dirtyParentQueries=Ta}}();var t=function(e){var t=Array.from(e.providers),n=Array.from(e.modules),r={};for(var i in e.providersByKey)r[i]=e.providersByKey[i];return{factory:e.factory,isRoot:e.isRoot,providers:t,modules:n,providersByKey:r}}(rr(this._ngModuleDefFactory));return Rn.createNgModuleRef(this.moduleType,e||kt.NULL,this._bootstrapComponents,t)}}]),t}(Te),Ko=function e(){_classCallCheck(this,e)},Xo=function(){function e(t){_classCallCheck(this,e),this.classificationService=t,this.images=[]}return _createClass(e,[{key:"ngOnInit",value:function(){for(var e=1;e<33;e++)this.images.push(e+".jpg");this.classificationService.loadModel()}}]),e}(),Qo=function e(){_classCallCheck(this,e)},Zo=function(){var e={Decimal:0,Percent:1,Currency:2,Scientific:3};return e[e.Decimal]="Decimal",e[e.Percent]="Percent",e[e.Currency]="Currency",e[e.Scientific]="Scientific",e}(),$o=function(){var e={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return e[e.Zero]="Zero",e[e.One]="One",e[e.Two]="Two",e[e.Few]="Few",e[e.Many]="Many",e[e.Other]="Other",e}(),Yo=function(){var e={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};return e[e.Decimal]="Decimal",e[e.Group]="Group",e[e.List]="List",e[e.PercentSign]="PercentSign",e[e.PlusSign]="PlusSign",e[e.MinusSign]="MinusSign",e[e.Exponential]="Exponential",e[e.SuperscriptingExponent]="SuperscriptingExponent",e[e.PerMille]="PerMille",e[e.Infinity]="Infinity",e[e.NaN]="NaN",e[e.TimeSeparator]="TimeSeparator",e[e.CurrencyDecimal]="CurrencyDecimal",e[e.CurrencyGroup]="CurrencyGroup",e}();function Jo(e,t){var n=pi(e),r=n[ci.NumberSymbols][t];if(void 0===r){if(t===Yo.CurrencyDecimal)return n[ci.NumberSymbols][Yo.Decimal];if(t===Yo.CurrencyGroup)return n[ci.NumberSymbols][Yo.Group]}return r}var es=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function ts(e){var t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}var ns=new ve("UseV4Plurals"),rs=function e(){_classCallCheck(this,e)},is=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).locale=e,r.deprecatedPluralFn=n,r}return _inherits(t,e),_createClass(t,[{key:"getPluralCategory",value:function(e,t){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(t||this.locale,e):function(e){return pi(e)[ci.PluralCase]}(t||this.locale)(e)){case $o.Zero:return"zero";case $o.One:return"one";case $o.Two:return"two";case $o.Few:return"few";case $o.Many:return"many";default:return"other"}}}]),t}(rs),as=function(){function e(t,n,r,i){_classCallCheck(this,e),this.$implicit=t,this.ngForOf=n,this.index=r,this.count=i}return _createClass(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),os=function(){function e(t,n,r){_classCallCheck(this,e),this._viewContainer=t,this._template=n,this._differs=r,this._ngForOfDirty=!0,this._differ=null}return _createClass(e,[{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch($d){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'. NgFor only supports binding to Iterables such as Arrays."))}}var t;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}},{key:"_applyChanges",value:function(e){var t=this,n=[];e.forEachOperation((function(e,r,i){if(null==e.previousIndex){var a=t._viewContainer.createEmbeddedView(t._template,new as(null,t._ngForOf,-1,-1),null===i?void 0:i),o=new ss(e,a);n.push(o)}else if(null==i)t._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=t._viewContainer.get(r);t._viewContainer.move(s,i);var u=new ss(e,s);n.push(u)}}));for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var i=0,a=this._viewContainer.length;i<a;i++){var o=this._viewContainer.get(i);o.context.index=i,o.context.count=a,o.context.ngForOf=this._ngForOf}e.forEachIdentityChange((function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item}))}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}},{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",set:function(e){Ge()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn("trackBy must be a function, but received ".concat(JSON.stringify(e),". ")+"See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=e},get:function(){return this._trackByFn}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}(),ss=function e(t,n){_classCallCheck(this,e),this.record=t,this.view=n},us=function(){function e(t,n){_classCallCheck(this,e),this._viewContainer=t,this._context=new ls,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}return _createClass(e,[{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}},{key:"ngIf",set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}},{key:"ngIfThen",set:function(e){cs("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(e){cs("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}}]),e}(),ls=function e(){_classCallCheck(this,e),this.$implicit=null,this.ngIf=null};function cs(e,t){if(t&&!t.createEmbeddedView)throw new Error("".concat(e," must be a TemplateRef, but received '").concat(oe(t),"'."))}function hs(e,t){return Error("InvalidPipeArgument: '".concat(t,"' for pipe '").concat(oe(e),"'"))}var ps=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])\S*/g,fs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(t){if(!t)return t;if("string"!=typeof t)throw hs(e,t);return t.replace(ps,(function(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()}))}}]),e}(),ds=function(){function e(t){_classCallCheck(this,e),this._locale=t}return _createClass(e,[{key:"transform",value:function(t,n,r){if(function(e){return null==e||""===e||e!=e}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s="",u=!1;if(isFinite(e)){var l=function(e){var t,n,r,i,a,o=Math.abs(e)+"",s=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(a=o.length))t=[0],n=1;else{for(a--;"0"===o.charAt(a);)a--;for(n-=r,t=[],i=0;r<=a;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),s=n-1,n=1),{digits:t,exponent:s,integerLen:n}}(e);o&&(l=function(e){if(0===e.digits[0])return e;var t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(l));var c=t.minInt,h=t.minFrac,p=t.maxFrac;if(a){var f=a.match(es);if(null===f)throw new Error("".concat(a," is not a valid digit info"));var d=f[1],m=f[3],v=f[5];null!=d&&(c=ts(d)),null!=m&&(h=ts(m)),null!=v?p=ts(v):null!=m&&h>p&&(p=h)}!function(e,t,n){if(t>n)throw new Error("The minimum number of digits after fraction (".concat(t,") is higher than the maximum (").concat(n,")."));var r=e.digits,i=r.length-e.integerLen,a=Math.min(Math.max(t,i),n),o=a+e.integerLen,s=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(var u=o;u<r.length;u++)r[u]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=a+1),r[0]=0;for(var l=1;l<o;l++)r[l]=0}if(s>=5)if(o-1<0){for(var c=0;c>o;c--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,a);i++)r.push(0);var h=0!==a,p=t+e.integerLen,f=r.reduceRight((function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,h&&(0===r[n]&&n>=p?r.pop():h=!1),t>=10?1:0}),0);f&&(r.unshift(f),e.integerLen++)}(l,h,p);var g=l.digits,y=l.integerLen,b=l.exponent,w=[];for(u=g.every((function(e){return!e}));y<c;y++)g.unshift(0);for(;y<0;y++)g.unshift(0);y>0?w=g.splice(y,g.length):(w=g,g=[0]);var x=[];for(g.length>=t.lgSize&&x.unshift(g.splice(-t.lgSize,g.length).join(""));g.length>t.gSize;)x.unshift(g.splice(-t.gSize,g.length).join(""));g.length&&x.unshift(g.join("")),s=x.join(Jo(n,r)),w.length&&(s+=Jo(n,i)+w.join("")),b&&(s+=Jo(n,Yo.Exponential)+"+"+b)}else s=Jo(n,Yo.Infinity);return e<0&&!u?t.negPre+s+t.negSuf:t.posPre+s+t.posSuf}(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],a=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],s=o[0],u=o[1]||"";n.posPre=s.substr(0,s.indexOf("#"));for(var l=0;l<u.length;l++){var c=u.charAt(l);"0"===c?n.minFrac=n.maxFrac=l+1:"#"===c?n.maxFrac=l+1:n.posSuf+=c}var h=s.split(",");if(n.gSize=h[1]?h[1].length:0,n.lgSize=h[2]||h[1]?(h[2]||h[1]).length:0,a){var p=i.length-n.posPre.length-n.posSuf.length,f=a.indexOf("#");n.negPre=a.substr(0,f).replace(/'/g,""),n.negSuf=a.substr(f+p).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return pi(e)[ci.NumberFormats][t]}(t,Zo.Decimal),Jo(t,Yo.MinusSign)),t,Yo.Group,Yo.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error("".concat(e," is not a number"));return e}(t),r,n)}catch(i){throw hs(e,i.message)}}}]),e}(),ms=function e(){_classCallCheck(this,e)},vs=new ve("DocumentToken"),gs="browser",ys="server";function bs(e){return e===gs}function ws(e){return e===ys}var xs=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._value=e,n}return _inherits(t,e),_createClass(t,[{key:"_subscribe",value:function(e){var n=_get(_getPrototypeOf(t.prototype),"_subscribe",this).call(this,e);return n&&!n.closed&&e.next(this._value),n}},{key:"getValue",value:function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new _;return this._value}},{key:"next",value:function(e){_get(_getPrototypeOf(t.prototype),"next",this).call(this,this._value=e)}},{key:"value",get:function(){return this.getValue()}}]),t}(N);function Cs(e,t){return function(n){return n.lift(new ks(e,t))}}var ks=function(){function e(t,n){_classCallCheck(this,e),this.predicate=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Es(e,this.predicate,this.thisArg))}}]),e}(),Es=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).predicate=n,i.thisArg=r,i.count=0,i}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}]),t}(v);function _s(e){return function(t){return t.lift(new As(e))}}var As=function(){function e(t){_classCallCheck(this,e),this.notifier=t}return _createClass(e,[{key:"call",value:function(e,t){var n=new Ss(e),r=F(n,this.notifier);return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n}}]),e}(),Ss=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).seenValue=!1,n}return _inherits(t,e),_createClass(t,[{key:"notifyNext",value:function(e,t,n,r,i){this.seenValue=!0,this.complete()}},{key:"notifyComplete",value:function(){}}]),t}(M);Error;var Ns,Ds=function(){function e(t,n,r){_classCallCheck(this,e),this.nextOrObserver=t,this.error=n,this.complete=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Is(e,this.nextOrObserver,this.error,this.complete))}}]),e}(),Is=function(e){function t(e,n,i,a){var o;return _classCallCheck(this,t),(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)))._tapNext=b,o._tapError=b,o._tapComplete=b,o._tapError=i||b,o._tapComplete=a||b,r(n)?(o._context=_assertThisInitialized(o),o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||b,o._tapError=n.error||b,o._tapComplete=n.complete||b),o}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}},{key:"_error",value:function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}]),t}(v),Ts=function e(){_classCallCheck(this,e)},Rs=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;_classCallCheck(this,e),this.matches=t,this.mediaQuery=n,this.mqAlias=r,this.suffix=i,this.priority=a,this.property=""}return _createClass(e,[{key:"clone",value:function(){return new e(this.matches,this.mediaQuery,this.mqAlias,this.suffix)}}]),e}(),Os=((Ns=function(){function e(){_classCallCheck(this,e),this.stylesheet=new Map}return _createClass(e,[{key:"addStyleToElement",value:function(e,t,n){var r=this.stylesheet.get(e);r?r.set(t,n):this.stylesheet.set(e,new Map([[t,n]]))}},{key:"clearStyles",value:function(){this.stylesheet.clear()}},{key:"getStyleForElement",value:function(e,t){var n=this.stylesheet.get(e),r="";if(n){var i=n.get(t);"number"!=typeof i&&"string"!=typeof i||(r=i+"")}return r}}]),e}()).ngInjectableDef=re({factory:function(){return new Ns},token:Ns,providedIn:"root"}),Ns),Fs={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[]},Ms=new ve("Flex Layout token, config options for the library",{providedIn:"root",factory:function(){return Fs}}),Ls=new ve("FlexLayoutServerLoaded",{providedIn:"root",factory:function(){return!1}}),Bs=new ve("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:function(){return null}});function Ps(e,t){return e=e?e.clone():new Rs,t&&(e.mqAlias=t.alias,e.mediaQuery=t.mediaQuery,e.suffix=t.suffix,e.priority=t.priority),e}var zs=["row","column","row-reverse","column-reverse"];function Vs(e){if(e)switch(e.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":e="wrap-reverse";break;case"no":case"none":case"nowrap":e="nowrap";break;default:e="wrap"}return e}var Ws=function(){function e(t,n,r,i){_classCallCheck(this,e),this.elementRef=t,this.styleBuilder=n,this.styler=r,this.marshal=i,this.DIRECTIVE_KEY="",this.inputs=[],this.mru={},this.destroySubject=new N,this.styleCache=new Map}return _createClass(e,[{key:"ngOnChanges",value:function(e){var t=this;Object.keys(e).forEach((function(n){if(-1!==t.inputs.indexOf(n)){var r=n.split(".").slice(1).join(".");t.setValue(e[n].currentValue,r)}}))}},{key:"ngOnDestroy",value:function(){this.destroySubject.next(),this.destroySubject.complete(),this.marshal.releaseElement(this.nativeElement)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.marshal.init(this.elementRef.nativeElement,this.DIRECTIVE_KEY,this.updateWithValue.bind(this),this.clearStyles.bind(this),e)}},{key:"addStyles",value:function(e,t){var n=this.styleBuilder,r=n.shouldCache,i=this.styleCache.get(e);i&&r||(i=n.buildStyles(e,t),r&&this.styleCache.set(e,i)),this.mru=Object.assign({},i),this.applyStyleToElement(i),n.sideEffect(e,i,t)}},{key:"clearStyles",value:function(){var e=this;Object.keys(this.mru).forEach((function(t){e.mru[t]=""})),this.applyStyleToElement(this.mru),this.mru={}}},{key:"triggerUpdate",value:function(){this.marshal.triggerUpdate(this.nativeElement,this.DIRECTIVE_KEY)}},{key:"getFlexFlowDirection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var n=this.styler.getFlowDirection(e),r=_slicedToArray(n,2),i=r[0],a=r[1];if(!a&&t){var o=function(e){var t=function(e){var t=_slicedToArray((e=e?e.toLowerCase():"").split(" "),3),n=t[0],r=t[1],i=t[2];return zs.find((function(e){return e===n}))||(n=zs[0]),"inline"===r&&(r="inline"!==i?i:"",i="inline"),[n,Vs(r),!!i]}(e),n=_slicedToArray(t,3);return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{display:n?"inline-flex":"flex","box-sizing":"border-box","flex-direction":e,"flex-wrap":t||null}}(n[0],n[1],n[2])}(i);this.styler.applyStyleToElements(o,[e])}return i.trim()}return"row"}},{key:"applyStyleToElement",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.nativeElement;this.styler.applyStyleToElement(n,e,t)}},{key:"setValue",value:function(e,t){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,t)}},{key:"updateWithValue",value:function(e){this.addStyles(e)}},{key:"parentElement",get:function(){return this.elementRef.nativeElement.parentElement}},{key:"nativeElement",get:function(){return this.elementRef.nativeElement}},{key:"activatedValue",get:function(){return this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY)},set:function(e){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,this.marshal.activatedAlias)}}]),e}(),Us=[{alias:"xs",mediaQuery:"screen and (min-width: 0px) and (max-width: 599.9px)",priority:1e3},{alias:"sm",mediaQuery:"screen and (min-width: 600px) and (max-width: 959.9px)",priority:900},{alias:"md",mediaQuery:"screen and (min-width: 960px) and (max-width: 1279.9px)",priority:800},{alias:"lg",mediaQuery:"screen and (min-width: 1280px) and (max-width: 1919.9px)",priority:700},{alias:"xl",mediaQuery:"screen and (min-width: 1920px) and (max-width: 4999.9px)",priority:600},{alias:"lt-sm",overlapping:!0,mediaQuery:"screen and (max-width: 599.9px)",priority:950},{alias:"lt-md",overlapping:!0,mediaQuery:"screen and (max-width: 959.9px)",priority:850},{alias:"lt-lg",overlapping:!0,mediaQuery:"screen and (max-width: 1279.9px)",priority:750},{alias:"lt-xl",overlapping:!0,priority:650,mediaQuery:"screen and (max-width: 1919.9px)"},{alias:"gt-xs",overlapping:!0,mediaQuery:"screen and (min-width: 600px)",priority:-950},{alias:"gt-sm",overlapping:!0,mediaQuery:"screen and (min-width: 960px)",priority:-850},{alias:"gt-md",overlapping:!0,mediaQuery:"screen and (min-width: 1280px)",priority:-750},{alias:"gt-lg",overlapping:!0,mediaQuery:"screen and (min-width: 1920px)",priority:-650}],js="(orientation: portrait) and (min-width: 600px) and (max-width: 839.9px)",Hs="(orientation: landscape) and (min-width: 960px) and (max-width: 1279.9px)",Gs="(orientation: portrait) and (min-width: 840px)",qs="(orientation: landscape) and (min-width: 1280px)",Ks={HANDSET:"(orientation: portrait) and (max-width: 599.9px), (orientation: landscape) and (max-width: 959.9px)",TABLET:"".concat(js," , ").concat(Hs),WEB:"".concat(Gs,", ").concat(qs," "),HANDSET_PORTRAIT:"(orientation: portrait) and (max-width: 599.9px)",TABLET_PORTRAIT:"".concat(js," "),WEB_PORTRAIT:"".concat(Gs),HANDSET_LANDSCAPE:"(orientation: landscape) and (max-width: 959.9px)]",TABLET_LANDSCAPE:"".concat(Hs),WEB_LANDSCAPE:"".concat(qs)},Xs=[{alias:"handset",priority:2e3,mediaQuery:Ks.HANDSET},{alias:"handset.landscape",priority:2e3,mediaQuery:Ks.HANDSET_LANDSCAPE},{alias:"handset.portrait",priority:2e3,mediaQuery:Ks.HANDSET_PORTRAIT},{alias:"tablet",priority:2100,mediaQuery:Ks.TABLET},{alias:"tablet.landscape",priority:2100,mediaQuery:Ks.TABLET},{alias:"tablet.portrait",priority:2100,mediaQuery:Ks.TABLET_PORTRAIT},{alias:"web",priority:2200,mediaQuery:Ks.WEB,overlapping:!0},{alias:"web.landscape",priority:2200,mediaQuery:Ks.WEB_LANDSCAPE,overlapping:!0},{alias:"web.portrait",priority:2200,mediaQuery:Ks.WEB_PORTRAIT,overlapping:!0}],Qs=/(\.|-|_)/g;function Zs(e){var t=e.length>0?e.charAt(0):"",n=e.length>1?e.slice(1):"";return t.toUpperCase()+n}var $s=new ve("Token (@angular/flex-layout) Breakpoints",{providedIn:"root",factory:function(){var e=Se(Bs),t=Se(Ms),n=[].concat.apply([],(e||[]).map((function(e){return Array.isArray(e)?e:[e]})));return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r={};return e.forEach((function(e){r[e.alias]=e})),n.forEach((function(e){r[e.alias]?function(e){if(null==e)throw TypeError("Cannot convert undefined or null to object");for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];if(null!=o)for(var s in o)o.hasOwnProperty(s)&&(e[s]=o[s])}}(r[e.alias],e):r[e.alias]=e})),(t=Object.keys(r).map((function(e){return r[e]}))).forEach((function(e){e.suffix||(e.suffix=e.alias.replace(Qs,"|").split("|").map(Zs).join(""),e.overlapping=!!e.overlapping)})),t}((t.disableDefaultBps?[]:Us).concat(t.addOrientationBps?Xs:[]),n)}});function Ys(e,t){return(t&&t.priority||0)-(e&&e.priority||0)}function Js(e,t){return(e.priority||0)-(t.priority||0)}var eu,tu,nu,ru=((tu=function(){function e(t){_classCallCheck(this,e),this.findByMap=new Map,this.items=_toConsumableArray(t).sort(Js)}return _createClass(e,[{key:"findByAlias",value:function(e){return e?this.findWithPredicate(e,(function(t){return t.alias==e})):null}},{key:"findByQuery",value:function(e){return this.findWithPredicate(e,(function(t){return t.mediaQuery==e}))}},{key:"findWithPredicate",value:function(e,t){var n=this.findByMap.get(e);return n||(n=this.items.find(t)||null,this.findByMap.set(e,n)),n||null}},{key:"overlappings",get:function(){return this.items.filter((function(e){return 1==e.overlapping}))}},{key:"aliases",get:function(){return this.items.map((function(e){return e.alias}))}},{key:"suffixes",get:function(){return this.items.map((function(e){return e.suffix?e.suffix:""}))}}]),e}()).ngInjectableDef=re({factory:function(){return new tu(Ae($s))},token:tu,providedIn:"root"}),tu),iu=((eu=function(){function e(t,n,r){_classCallCheck(this,e),this._zone=t,this._platformId=n,this._document=r,this.source=new xs(new Rs(!0)),this.registry=new Map,this._observable$=this.source.asObservable()}return _createClass(e,[{key:"isActive",value:function(e){var t=this.registry.get(e);return!!t&&t.matches}},{key:"observe",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.length){var r=this._observable$.pipe(Cs((function(t){return!n||e.indexOf(t.mediaQuery)>-1})));return W(new x((function(n){var r=t.registerQuery(e);if(r.length){var i=r.pop();r.forEach((function(e){n.next(e)})),t.source.next(i)}n.complete()})),r)}return this._observable$}},{key:"registerQuery",value:function(e){var t=this,n=Array.isArray(e)?e:[e],r=[];return function(e,t){var n=e.filter((function(e){return!au[e]}));if(n.length>0){var r=n.join(", ");try{var i=t.createElement("style");i.setAttribute("type","text/css"),i.styleSheet||i.appendChild(t.createTextNode("\n/*\n  @angular/flex-layout - workaround for possible browser quirk with mediaQuery listeners\n  see http://bit.ly/2sd4HMP\n*/\n@media ".concat(r," {.fx-query-test{ }}\n"))),t.head.appendChild(i),n.forEach((function(e){return au[e]=i}))}catch(yE){console.error(yE)}}}(n,this._document),n.forEach((function(e){var n=t.registry.get(e);n||((n=t.buildMQL(e)).addListener((function(n){t._zone.run((function(){return t.source.next(new Rs(n.matches,e))}))})),t.registry.set(e,n)),n.matches&&r.push(new Rs(!0,e))})),r}},{key:"buildMQL",value:function(e){return function(e,t){return t&&window.matchMedia("all").addListener?window.matchMedia(e):{matches:"all"===e||""===e,media:e,addListener:function(){},removeListener:function(){}}}(e,bs(this._platformId))}},{key:"activations",get:function(){var e=[];return this.registry.forEach((function(t,n){t.matches&&e.push(n)})),e}}]),e}()).ngInjectableDef=re({factory:function(){return new eu(Ae(Gi),Ae(Ei),Ae(vs))},token:eu,providedIn:"root"}),eu),au={},ou={alias:"print",mediaQuery:"print",priority:1e3},su=((nu=function(){function e(t,n){_classCallCheck(this,e),this.breakpoints=t,this.layoutConfig=n,this.isPrinting=!1,this.queue=new uu,this.deactivations=[]}return _createClass(e,[{key:"withPrintQuery",value:function(e){return[].concat(_toConsumableArray(e),["print"])}},{key:"isPrintEvent",value:function(e){return e.mediaQuery.startsWith("print")}},{key:"getEventBreakpoints",value:function(e){var t=e.mediaQuery,n=this.breakpoints.findByQuery(t);return(n?[].concat(_toConsumableArray(this.printBreakPoints),[n]):this.printBreakPoints).sort(Ys)}},{key:"updateEvent",value:function(e){var t=this.breakpoints.findByQuery(e.mediaQuery);return this.isPrintEvent(e)&&(t=this.getEventBreakpoints(e)[0],e.mediaQuery=t?t.mediaQuery:""),Ps(e,t)}},{key:"interceptEvents",value:function(e){var t=this;return function(n){t.isPrintEvent(n)?n.matches&&!t.isPrinting?(t.startPrinting(e,t.getEventBreakpoints(n)),e.updateStyles()):!n.matches&&t.isPrinting&&(t.stopPrinting(e),e.updateStyles()):t.collectActivations(n)}}},{key:"blockPropagation",value:function(){var e=this;return function(t){return!(e.isPrinting||e.isPrintEvent(t))}}},{key:"startPrinting",value:function(e,t){this.isPrinting=!0,e.activatedBreakpoints=this.queue.addPrintBreakpoints(t)}},{key:"stopPrinting",value:function(e){e.activatedBreakpoints=this.deactivations,this.deactivations=[],this.queue.clear(),this.isPrinting=!1}},{key:"collectActivations",value:function(e){if(!this.isPrinting)if(e.matches)this.deactivations=[];else{var t=this.breakpoints.findByQuery(e.mediaQuery);t&&(this.deactivations.push(t),this.deactivations.sort(Ys))}}},{key:"printAlias",get:function(){return this.layoutConfig.printWithBreakpoints||[]}},{key:"printBreakPoints",get:function(){var e=this;return this.printAlias.map((function(t){return e.breakpoints.findByAlias(t)})).filter((function(e){return null!==e}))}}]),e}()).ngInjectableDef=re({factory:function(){return new nu(Ae(ru),Ae(Ms))},token:nu,providedIn:"root"}),nu),uu=function(){function e(){_classCallCheck(this,e),this.printBreakpoints=[]}return _createClass(e,[{key:"addPrintBreakpoints",value:function(e){var t=this;return e.push(ou),e.sort(Ys),e.forEach((function(e){return t.addBreakpoint(e)})),this.printBreakpoints}},{key:"addBreakpoint",value:function(e){e&&void 0===this.printBreakpoints.find((function(t){return t.mediaQuery===e.mediaQuery}))&&(this.printBreakpoints=function(e){return!!e&&e.mediaQuery.startsWith("print")}(e)?[e].concat(_toConsumableArray(this.printBreakpoints)):[].concat(_toConsumableArray(this.printBreakpoints),[e]))}},{key:"clear",value:function(){this.printBreakpoints=[]}}]),e}();function lu(e){for(var t in e){var n=e[t]||"";switch(t){case"display":e.display="flex"===n?["-webkit-flex","flex"]:"inline-flex"===n?["-webkit-inline-flex","inline-flex"]:n;break;case"align-items":case"align-self":case"align-content":case"flex":case"flex-basis":case"flex-flow":case"flex-grow":case"flex-shrink":case"flex-wrap":case"justify-content":e["-webkit-"+t]=n;break;case"flex-direction":e["-webkit-flex-direction"]=n=n||"row",e["flex-direction"]=n;break;case"order":e.order=e["-webkit-"+t]=isNaN(+n)?"0":n}}return e}var cu,hu=((cu=function(){function e(t,n,r,i){_classCallCheck(this,e),this._serverStylesheet=t,this._serverModuleLoaded=n,this._platformId=r,this.layoutConfig=i}return _createClass(e,[{key:"applyStyleToElement",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={};"string"==typeof t&&(r[t]=n,t=r),r=this.layoutConfig.disableVendorPrefixes?t:lu(t),this._applyMultiValueStyleToElement(r,e)}},{key:"applyStyleToElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this.layoutConfig.disableVendorPrefixes?e:lu(e);n.forEach((function(e){t._applyMultiValueStyleToElement(r,e)}))}},{key:"getFlowDirection",value:function(e){var t=this.lookupStyle(e,"flex-direction");return[t||"row",this.lookupInlineStyle(e,"flex-direction")||ws(this._platformId)&&this._serverModuleLoaded?t:""]}},{key:"lookupAttributeValue",value:function(e,t){return e.getAttribute(t)||""}},{key:"lookupInlineStyle",value:function(e,t){return bs(this._platformId)?e.style.getPropertyValue(t):this._getServerStyle(e,t)}},{key:"lookupStyle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";return e&&((r=this.lookupInlineStyle(e,t))||(bs(this._platformId)?n||(r=getComputedStyle(e).getPropertyValue(t)):this._serverModuleLoaded&&(r=this._serverStylesheet.getStyleForElement(e,t)))),r?r.trim():""}},{key:"_applyMultiValueStyleToElement",value:function(e,t){var n=this;Object.keys(e).sort().forEach((function(r){var i=e[r],a=Array.isArray(i)?i:[i];a.sort();var o=!0,s=!1,u=void 0;try{for(var l,c=a[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;h=h?h+"":"",bs(n._platformId)||!n._serverModuleLoaded?bs(n._platformId)?t.style.setProperty(r,h):n._setServerStyle(t,r,h):n._serverStylesheet.addStyleToElement(t,r,h)}}catch(p){s=!0,u=p}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}))}},{key:"_setServerStyle",value:function(e,t,n){t=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();var r=this._readStyleAttribute(e);r[t]=n||"",this._writeStyleAttribute(e,r)}},{key:"_getServerStyle",value:function(e,t){return this._readStyleAttribute(e)[t]||""}},{key:"_readStyleAttribute",value:function(e){var t={},n=e.getAttribute("style");if(n)for(var r=n.split(/;+/g),i=0;i<r.length;i++){var a=r[i].trim();if(a.length>0){var o=a.indexOf(":");if(-1===o)throw new Error("Invalid CSS style: ".concat(a));t[a.substr(0,o).trim()]=a.substr(o+1).trim()}}return t}},{key:"_writeStyleAttribute",value:function(e,t){var n="";for(var r in t)t[r]&&(n+=r+":"+t[r]+";");e.setAttribute("style",n)}}]),e}()).ngInjectableDef=re({factory:function(){return new cu(Ae(Os,8),Ae(Ls,8),Ae(Ei),Ae(Ms))},token:cu,providedIn:"root"}),cu),pu=function(){function e(){_classCallCheck(this,e),this.shouldCache=!0}return _createClass(e,[{key:"sideEffect",value:function(e,t,n){}}]),e}();function fu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1",r=[t,n,e],i=e.indexOf("calc");if(i>0){r[2]=du(e.substring(i).trim());var a=e.substr(0,i).trim().split(" ");2==a.length&&(r[0]=a[0],r[1]=a[1])}else if(0==i)r[2]=du(e.trim());else{var o=e.split(" ");r=3===o.length?o:[t,n,e]}return r}function du(e){return e.replace(/[\s]/g,"").replace(/[\/\*\+\-]/g," $& ")}var mu,vu=((mu=function(){function e(t,n,r){_classCallCheck(this,e),this.matchMedia=t,this.breakpoints=n,this.hook=r,this.activatedBreakpoints=[],this.elementMap=new Map,this.elementKeyMap=new WeakMap,this.watcherMap=new WeakMap,this.updateMap=new WeakMap,this.clearMap=new WeakMap,this.subject=new N,this.observeActivations()}return _createClass(e,[{key:"onMediaChange",value:function(e){var t=this.findByQuery(e.mediaQuery);t&&((e=Ps(e,t)).matches&&-1===this.activatedBreakpoints.indexOf(t)?(this.activatedBreakpoints.push(t),this.activatedBreakpoints.sort(Ys),this.updateStyles()):e.matches||-1===this.activatedBreakpoints.indexOf(t)||(this.activatedBreakpoints.splice(this.activatedBreakpoints.indexOf(t),1),this.activatedBreakpoints.sort(Ys),this.updateStyles()))}},{key:"init",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];gu(this.updateMap,e,t,n),gu(this.clearMap,e,t,r),this.buildElementKeyMap(e,t),this.watchExtraTriggers(e,t,i)}},{key:"getValue",value:function(e,t,n){var r=this.elementMap.get(e);if(r){var i=void 0!==n?r.get(n):this.getActivatedValues(r,t);if(i)return i.get(t)}}},{key:"hasValue",value:function(e,t){var n=this.elementMap.get(e);if(n){var r=this.getActivatedValues(n,t);if(r)return void 0!==r.get(t)||!1}return!1}},{key:"setValue",value:function(e,t,n,r){var i=this.elementMap.get(e);if(i){var a=(i.get(r)||new Map).set(t,n);i.set(r,a),this.elementMap.set(e,i)}else i=(new Map).set(r,(new Map).set(t,n)),this.elementMap.set(e,i);var o=this.getValue(e,t);void 0!==o&&this.updateElement(e,t,o)}},{key:"trackValue",value:function(e,t){return this.subject.asObservable().pipe(Cs((function(n){return n.element===e&&n.key===t})))}},{key:"updateStyles",value:function(){var e=this;this.elementMap.forEach((function(t,n){var r=new Set(e.elementKeyMap.get(n)),i=e.getActivatedValues(t);i&&i.forEach((function(t,i){e.updateElement(n,i,t),r.delete(i)})),r.forEach((function(r){if(i=e.getActivatedValues(t,r)){var a=i.get(r);e.updateElement(n,r,a)}else e.clearElement(n,r)}))}))}},{key:"clearElement",value:function(e,t){var n=this.clearMap.get(e);if(n){var r=n.get(t);r&&(r(),this.subject.next({element:e,key:t,value:""}))}}},{key:"updateElement",value:function(e,t,n){var r=this.updateMap.get(e);if(r){var i=r.get(t);i&&(i(n),this.subject.next({element:e,key:t,value:n}))}}},{key:"releaseElement",value:function(e){var t=this.watcherMap.get(e);t&&(t.forEach((function(e){return e.unsubscribe()})),this.watcherMap.delete(e));var n=this.elementMap.get(e);n&&(n.forEach((function(e,t){return n.delete(t)})),this.elementMap.delete(e))}},{key:"triggerUpdate",value:function(e,t){var n=this,r=this.elementMap.get(e);if(r){var i=this.getActivatedValues(r,t);i&&(t?this.updateElement(e,t,i.get(t)):i.forEach((function(t,r){return n.updateElement(e,r,t)})))}}},{key:"buildElementKeyMap",value:function(e,t){var n=this.elementKeyMap.get(e);n||(n=new Set,this.elementKeyMap.set(e,n)),n.add(t)}},{key:"watchExtraTriggers",value:function(e,t,n){var r=this;if(n&&n.length){var i=this.watcherMap.get(e);if(i||(i=new Map,this.watcherMap.set(e,i)),!i.get(t)){var a=W.apply(void 0,_toConsumableArray(n)).subscribe((function(){var n=r.getValue(e,t);r.updateElement(e,t,n)}));i.set(t,a)}}}},{key:"findByQuery",value:function(e){return this.breakpoints.findByQuery(e)}},{key:"getActivatedValues",value:function(e,t){for(var n=0;n<this.activatedBreakpoints.length;n++){var r=e.get(this.activatedBreakpoints[n].alias);if(r&&(void 0===t||r.has(t)))return r}var i=e.get("");return void 0===t||i&&i.has(t)?i:void 0}},{key:"observeActivations",value:function(){var e,t=this.breakpoints.items.map((function(e){return e.mediaQuery}));this.matchMedia.observe(this.hook.withPrintQuery(t)).pipe((e=this.hook.interceptEvents(this),function(t){return t.lift(new Ds(e,void 0,void 0))}),Cs(this.hook.blockPropagation())).subscribe(this.onMediaChange.bind(this))}},{key:"activatedAlias",get:function(){return this.activatedBreakpoints[0]?this.activatedBreakpoints[0].alias:""}}]),e}()).ngInjectableDef=re({factory:function(){return new mu(Ae(iu),Ae(ru),Ae(su))},token:mu,providedIn:"root"}),mu);function gu(e,t,n,r){if(void 0!==r){var i=e.get(t);i||(i=new Map,e.set(t,i)),i.set(n,r)}}var yu="inline",bu=["row","column","row-reverse","column-reverse"];function wu(e){var t=_slicedToArray((e=e?e.toLowerCase():"").split(" "),3),n=t[0],r=t[1],i=t[2];return bu.find((function(e){return e===n}))||(n=bu[0]),r===yu&&(r=i!==yu?i:"",i=yu),[n,Cu(r),!!i]}function xu(e){return _slicedToArray(wu(e),1)[0].indexOf("row")>-1}function Cu(e){if(e)switch(e.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":e="wrap-reverse";break;case"no":case"none":case"nowrap":e="nowrap";break;default:e="wrap"}return e}var ku,Eu,_u=((ku=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"buildStyles",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{display:n?"inline-flex":"flex","box-sizing":"border-box","flex-direction":e,"flex-wrap":t||null}}((t=_slicedToArray(wu(e),3))[0],t[1],t[2]);var t}}]),t}(pu)).ngInjectableDef=re({factory:function(){return new ku},token:ku,providedIn:"root"}),ku),Au=["fxLayout","fxLayout.xs","fxLayout.sm","fxLayout.md","fxLayout.lg","fxLayout.xl","fxLayout.lt-sm","fxLayout.lt-md","fxLayout.lt-lg","fxLayout.lt-xl","fxLayout.gt-xs","fxLayout.gt-sm","fxLayout.gt-md","fxLayout.gt-lg"],Su=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))).inputs=Au,e}return _inherits(t,e),t}(function(e){function t(e,n,r,i){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,r,n,i))).elRef=e,a.styleUtils=n,a.styleBuilder=r,a.marshal=i,a.DIRECTIVE_KEY="layout",a.styleCache=Nu,a.init(),a}return _inherits(t,e),t}(Ws)),Nu=new Map,Du={"margin-left":null,"margin-right":null,"margin-top":null,"margin-bottom":null},Iu=((Eu=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._styler=e,n}return _inherits(t,e),_createClass(t,[{key:"buildStyles",value:function(e,t){return e.endsWith(Bu)?(n=e=e.slice(0,e.indexOf(Bu)),r=t.directionality,i="0px",a="0px","rtl"===r?a="-"+n:i="-"+n,{margin:"0px ".concat(i," ").concat("-"+n," ").concat(a)}):{};var n,r,i,a}},{key:"sideEffect",value:function(e,t,n){var r,i,a,o,s=n.items;if(e.endsWith(Bu)){var u=(r=e=e.slice(0,e.indexOf(Bu)),i=n.directionality,a="0px",o="0px","rtl"===i?o=r:a=r,{padding:"0px ".concat(a," ").concat(r," ").concat(o)});this._styler.applyStyleToElements(u,n.items)}else{var l=s.pop(),c=function(e,t){var n=Pu(t.directionality,t.layout),r=Object.assign({},Du);return r[n]=e,r}(e,n);this._styler.applyStyleToElements(c,s),this._styler.applyStyleToElements(Du,[l])}}}]),t}(pu)).ngInjectableDef=re({factory:function(){return new Eu(Ae(hu))},token:Eu,providedIn:"root"}),Eu),Tu=["fxLayoutGap","fxLayoutGap.xs","fxLayoutGap.sm","fxLayoutGap.md","fxLayoutGap.lg","fxLayoutGap.xl","fxLayoutGap.lt-sm","fxLayoutGap.lt-md","fxLayoutGap.lt-lg","fxLayoutGap.lt-xl","fxLayoutGap.gt-xs","fxLayoutGap.gt-sm","fxLayoutGap.gt-md","fxLayoutGap.gt-lg"],Ru=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))).inputs=Tu,e}return _inherits(t,e),t}(function(e){function t(e,n,r,i,a,o){var s;_classCallCheck(this,t),(s=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,i,o))).elRef=e,s.zone=n,s.directionality=r,s.styleUtils=i,s.styleBuilder=a,s.marshal=o,s.layout="row",s.DIRECTIVE_KEY="layout-gap",s.observerSubject=new N;var u=[s.directionality.change,s.observerSubject.asObservable()];return s.init(u),s.marshal.trackValue(s.nativeElement,"layout").pipe(_s(s.destroySubject)).subscribe(s.onLayoutChange.bind(_assertThisInitialized(s))),s}return _inherits(t,e),_createClass(t,[{key:"ngAfterContentInit",value:function(){this.buildChildObservable(),this.triggerUpdate()}},{key:"ngOnDestroy",value:function(){_get(_getPrototypeOf(t.prototype),"ngOnDestroy",this).call(this),this.observer&&this.observer.disconnect()}},{key:"onLayoutChange",value:function(e){var t=this,n=e.value.split(" ");this.layout=n[0],bu.find((function(e){return e===t.layout}))||(this.layout="row"),this.triggerUpdate()}},{key:"updateWithValue",value:function(e){var t=this,n=this.childrenNodes.filter((function(e){return 1===e.nodeType&&t.willDisplay(e)})).sort((function(e,n){var r=+t.styler.lookupStyle(e,"order"),i=+t.styler.lookupStyle(n,"order");return isNaN(r)||isNaN(i)||r===i?0:r>i?1:-1}));if(n.length>0){var r=this.directionality.value,i=this.layout;"row"===i&&"rtl"===r?this.styleCache=Ou:"row"===i&&"rtl"!==r?this.styleCache=Mu:"column"===i&&"rtl"===r?this.styleCache=Fu:"column"===i&&"rtl"!==r&&(this.styleCache=Lu),this.addStyles(e,{directionality:r,items:n,layout:i})}}},{key:"clearStyles",value:function(){var e=Object.keys(this.mru).length>0,n=e?"padding":Pu(this.directionality.value,this.layout);e&&_get(_getPrototypeOf(t.prototype),"clearStyles",this).call(this),this.styleUtils.applyStyleToElements(_defineProperty({},n,""),this.childrenNodes)}},{key:"willDisplay",value:function(e){var t=this.marshal.getValue(e,"show-hide");return!0===t||void 0===t&&"none"!==this.styleUtils.lookupStyle(e,"display")}},{key:"buildChildObservable",value:function(){var e=this;this.zone.runOutsideAngular((function(){"undefined"!=typeof MutationObserver&&(e.observer=new MutationObserver((function(t){t.some((function(e){return e.addedNodes&&e.addedNodes.length>0||e.removedNodes&&e.removedNodes.length>0}))&&e.observerSubject.next()})),e.observer.observe(e.nativeElement,{childList:!0}))}))}},{key:"childrenNodes",get:function(){for(var e=this.nativeElement.children,t=[],n=e.length;n--;)t[n]=e[n];return t}}]),t}(Ws)),Ou=new Map,Fu=new Map,Mu=new Map,Lu=new Map,Bu=" grid";function Pu(e,t){switch(t){case"column":return"margin-bottom";case"column-reverse":return"margin-top";case"row":return"rtl"===e?"margin-left":"margin-right";case"row-reverse":return"rtl"===e?"margin-right":"margin-left";default:return"rtl"===e?"margin-left":"margin-right"}}function zu(e){if(null==e)throw TypeError("Cannot convert undefined or null to object");for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];if(null!=o)for(var s in o)o.hasOwnProperty(s)&&(e[s]=o[s])}return e}var Vu,Wu,Uu=((Vu=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).layoutConfig=e,n}return _inherits(t,e),_createClass(t,[{key:"buildStyles",value:function(e,t){var n=_toArray(e.split(" ")),r=n[0],i=n[1],a=n.slice(2).join(" "),o=t.direction.indexOf("column")>-1?"column":"row",s=xu(o)?"max-width":"max-height",u=xu(o)?"min-width":"min-height",l=String(a).indexOf("calc")>-1,c=l||"auto"===a,h=String(a).indexOf("%")>-1&&!l,p=String(a).indexOf("px")>-1||String(a).indexOf("rem")>-1||String(a).indexOf("em")>-1||String(a).indexOf("vw")>-1||String(a).indexOf("vh")>-1,f=l||p;i="0"==i?0:i;var d=!(r="0"==r?0:r)&&!i,m={},v={"max-width":null,"max-height":null,"min-width":null,"min-height":null};switch(a||""){case"":var g=!1!==this.layoutConfig.useColumnBasisZero;a="row"===o?"0%":g?"0.000000001px":"auto";break;case"initial":case"nogrow":r=0,a="auto";break;case"grow":a="100%";break;case"noshrink":i=0,a="auto";break;case"auto":break;case"none":r=0,i=0,a="auto";break;default:f||h||isNaN(a)||(a+="%"),"0%"===a&&(f=!0),"0px"===a&&(a="0%"),m=zu(v,l?{"flex-grow":r,"flex-shrink":i,"flex-basis":f?a:"100%"}:{flex:"".concat(r," ").concat(i," ").concat(f?a:"100%")})}return m.flex||m["flex-grow"]||(m=zu(v,l?{"flex-grow":r,"flex-shrink":i,"flex-basis":a}:{flex:"".concat(r," ").concat(i," ").concat(a)})),"0%"!==a&&"0px"!==a&&"0.000000001px"!==a&&"auto"!==a&&(m[u]=d||f&&r?a:null,m[s]=d||!c&&i?a:null),m[u]||m[s]?t.hasWrap&&(m[l?"flex-basis":"flex"]=m[s]?l?m[s]:"".concat(r," ").concat(i," ").concat(m[s]):l?m[u]:"".concat(r," ").concat(i," ").concat(m[u])):m=zu(v,l?{"flex-grow":r,"flex-shrink":i,"flex-basis":a}:{flex:"".concat(r," ").concat(i," ").concat(a)}),zu(m,{"box-sizing":"border-box"})}}]),t}(pu)).ngInjectableDef=re({factory:function(){return new Vu(Ae(Ms))},token:Vu,providedIn:"root"}),Vu),ju=["fxFlex","fxFlex.xs","fxFlex.sm","fxFlex.md","fxFlex.lg","fxFlex.xl","fxFlex.lt-sm","fxFlex.lt-md","fxFlex.lt-lg","fxFlex.lt-xl","fxFlex.gt-xs","fxFlex.gt-sm","fxFlex.gt-md","fxFlex.gt-lg"],Hu=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))).inputs=ju,e}return _inherits(t,e),t}(function(e){function t(e,n,r,i,a){var o;return _classCallCheck(this,t),(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,i,n,a))).elRef=e,o.styleUtils=n,o.layoutConfig=r,o.styleBuilder=i,o.marshal=a,o.DIRECTIVE_KEY="flex",o.direction="",o.wrap=!1,o.flexGrow="1",o.flexShrink="1",o.init(),o.parentElement&&(o.marshal.trackValue(o.parentElement,"layout").pipe(_s(o.destroySubject)).subscribe(o.onLayoutChange.bind(_assertThisInitialized(o))),o.marshal.trackValue(o.nativeElement,"layout-align").pipe(_s(o.destroySubject)).subscribe(o.triggerReflow.bind(_assertThisInitialized(o)))),o}return _inherits(t,e),_createClass(t,[{key:"onLayoutChange",value:function(e){var t=e.value.split(" ");this.direction=t[0],this.wrap=void 0!==t[1]&&"wrap"===t[1],this.triggerUpdate()}},{key:"updateWithValue",value:function(e){this.direction||(this.direction=this.getFlexFlowDirection(this.parentElement,!1!==this.layoutConfig.addFlexToParent));var t=this.direction,n=t.startsWith("row"),r=this.wrap;n&&r?this.styleCache=Ku:n&&!r?this.styleCache=Gu:!n&&r?this.styleCache=Xu:n||r||(this.styleCache=qu);var i=fu(String(e).replace(";",""),this.flexGrow,this.flexShrink);this.addStyles(i.join(" "),{direction:t,hasWrap:r})}},{key:"triggerReflow",value:function(){var e=this.activatedValue;if(void 0!==e){var t=fu(e+"",this.flexGrow,this.flexShrink);this.marshal.updateElement(this.nativeElement,this.DIRECTIVE_KEY,t.join(" "))}}},{key:"shrink",get:function(){return this.flexShrink},set:function(e){this.flexShrink=e||"1",this.triggerReflow()}},{key:"grow",get:function(){return this.flexGrow},set:function(e){this.flexGrow=e||"1",this.triggerReflow()}}]),t}(Ws)),Gu=new Map,qu=new Map,Ku=new Map,Xu=new Map,Qu=((Wu=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"buildStyles",value:function(e,t){var n={},r=_slicedToArray(e.split(" "),2),i=r[0],a=r[1];switch(i){case"center":n["justify-content"]="center";break;case"space-around":n["justify-content"]="space-around";break;case"space-between":n["justify-content"]="space-between";break;case"space-evenly":n["justify-content"]="space-evenly";break;case"end":case"flex-end":n["justify-content"]="flex-end";break;case"start":case"flex-start":default:n["justify-content"]="flex-start"}switch(a){case"start":case"flex-start":n["align-items"]=n["align-content"]="flex-start";break;case"center":n["align-items"]=n["align-content"]="center";break;case"end":case"flex-end":n["align-items"]=n["align-content"]="flex-end";break;case"space-between":n["align-content"]="space-between",n["align-items"]="stretch";break;case"space-around":n["align-content"]="space-around",n["align-items"]="stretch";break;case"baseline":n["align-content"]="stretch",n["align-items"]="baseline";break;case"stretch":default:n["align-items"]=n["align-content"]="stretch"}return zu(n,{display:t.inline?"inline-flex":"flex","flex-direction":t.layout,"box-sizing":"border-box","max-width":"stretch"===a?xu(t.layout)?null:"100%":null,"max-height":"stretch"===a&&xu(t.layout)?"100%":null})}}]),t}(pu)).ngInjectableDef=re({factory:function(){return new Wu},token:Wu,providedIn:"root"}),Wu),Zu=["fxLayoutAlign","fxLayoutAlign.xs","fxLayoutAlign.sm","fxLayoutAlign.md","fxLayoutAlign.lg","fxLayoutAlign.xl","fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg"],$u=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))).inputs=Zu,e}return _inherits(t,e),t}(function(e){function t(e,n,r,i){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,r,n,i))).elRef=e,a.styleUtils=n,a.styleBuilder=r,a.marshal=i,a.DIRECTIVE_KEY="layout-align",a.layout="row",a.inline=!1,a.init(),a.marshal.trackValue(a.nativeElement,"layout").pipe(_s(a.destroySubject)).subscribe(a.onLayoutChange.bind(_assertThisInitialized(a))),a}return _inherits(t,e),_createClass(t,[{key:"updateWithValue",value:function(e){var t=this.layout||"row",n=this.inline;"row"===t&&n?this.styleCache=nl:"row"!==t||n?"row-reverse"===t&&n?this.styleCache=il:"row-reverse"!==t||n?"column"===t&&n?this.styleCache=rl:"column"!==t||n?"column-reverse"===t&&n?this.styleCache=al:"column-reverse"!==t||n||(this.styleCache=tl):this.styleCache=Ju:this.styleCache=el:this.styleCache=Yu,this.addStyles(e,{layout:t,inline:n})}},{key:"onLayoutChange",value:function(e){var t=this,n=e.value.split(" ");this.layout=n[0],this.inline=e.value.includes("inline"),bu.find((function(e){return e===t.layout}))||(this.layout="row"),this.triggerUpdate()}}]),t}(Ws)),Yu=new Map,Ju=new Map,el=new Map,tl=new Map,nl=new Map,rl=new Map,il=new Map,al=new Map,ol=function e(){_classCallCheck(this,e)},sl=function(){function e(t){_classCallCheck(this,e),this.classificationService=t,this.predictions=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"getImagePath",value:function(){return"assets/test_images/"+this.image}},{key:"predict",value:function(){0===this.predictions.length&&(this.predictions=this.classificationService.predict(this.imageEl.nativeElement))}}]),e}(),ul=function(e,t){return(ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function ll(e,t){function n(){this.constructor=e}ul(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function cl(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function hl(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var pl=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n=(t={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return fl(t,n[0],n[1]),n.join("=")})),t);"tfjsflags"in n&&n.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,n[1])}))}},e}();function fl(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function dl(){return ml}var ml=null,vl=new Map,gl=new Map;function yl(e,t){var n=xl(e,t);return vl.get(n)}function bl(e){for(var t=vl.entries(),n=[];;){var r=t.next(),i=r.value;if(r.done)break;var a=i[1];i[0].split("_")[0]===e&&n.push(a)}return n}function wl(e){var t=e.kernelName,n=e.backendName,r=xl(t,n);if(vl.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");vl.set(r,e)}function xl(e,t){return t+"_"+e}function Cl(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function kl(e,t,n){return Math.max(e,Math.min(t,n))}function El(e){return e%2==0?e:e+1}function _l(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Al(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Sl(e,t,n){void 0===n&&(n=""),Al(Tl(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function Nl(e){Al(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function Dl(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||Gl(e)&&!n)for(var r=0;r<e.length;++r)Dl(e[r],t,n);else t.push(e);return t}function Il(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Tl(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Rl(e){return e%1==0}function Ol(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Fl(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Ml(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ll(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0;!function o(){if(e())r();else{var s=t(++a);null!=n&&a>=n?i():setTimeout(o,s)}}()}))}function Bl(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function Pl(e,t){var n=t.length;return Al((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),Al(e.every((function(e){return Rl(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function zl(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:Pl(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Vl(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Wl(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Ul(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function jl(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Hl(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Gl(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function ql(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Kl(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Xl(e){return"string"==typeof e||e instanceof String}function Ql(e){return"boolean"==typeof e}function Zl(e){return"number"==typeof e}function $l(e){return Array.isArray(e)?$l(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Zl(e)?"float32":Xl(e)?"string":Ql(e)?"bool":"float32"}function Yl(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Jl(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function ec(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function tc(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Dl(e)),n&&Ul(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function nc(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*u,s,r)}return i}(0,e,t)}function rc(e,t){for(var n=ic(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ic(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function ac(){return dl().platform.now()}function oc(e){e.forEach((function(t){Al(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function sc(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",dl().platform.encode(e,t)}function uc(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",dl().platform.decode(e,t)}var lc=Object.freeze({shuffle:Cl,clamp:kl,nearestLargerEven:El,sum:_l,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:Al,assertShapesMatch:Sl,assertNonNull:Nl,flatten:Dl,sizeFromShape:Il,isScalarShape:function(e){return 0===e.length},arraysEqual:Tl,isInt:Rl,tanh:Ol,sizeToSquarishShape:Fl,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Cl(t),t},rightPad:Ml,repeatedTry:Ll,inferFromImplicitShape:Bl,parseAxisParam:Pl,squeezeShape:zl,getTypedArrayFromDType:Vl,getArrayFromDType:Wl,checkConversionForErrors:Ul,isValidDtype:jl,hasEncodingLoss:Hl,isTypedArray:Gl,bytesPerElement:ql,bytesFromStringArray:Kl,isString:Xl,isBoolean:Ql,isNumber:Zl,inferDtype:$l,isFunction:Yl,nearestDivisor:Jl,computeStrides:ec,toTypedArray:tc,toNestedArray:nc,makeOnesTypedArray:rc,makeZerosTypedArray:ic,now:ac,assertNonNegativeIntegerDimensions:oc,fetch:function(e,t){return dl().platform.fetch(e,t)},encodeString:sc,decodeString:uc}),cc=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new hc)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}(),hc=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,a){var o=Ml(r+"ms",9),s=Ml(e,25),u=t.rank,l=t.size,c=Ml(t.shape.toString(),14),h="";for(var p in i){var f=i[p].shape||t.shape,d=f.length;h+=p+": "+d+"D "+(d>0?f:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+h+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),pc=7;function fc(e,t,n){return Ml(Array.isArray(e)?parseFloat(e[0].toFixed(pc))+" + "+parseFloat(e[1].toFixed(pc))+"j":Xl(e)?"'"+e+"'":"bool"===n?dc(e):parseFloat(e.toFixed(pc)).toString(),t)}function dc(e){return 0===e?"false":"true"}function mc(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var vc=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Il(e),null!=n){var i=n.length;Al(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Wl(t,this.size),this.strides=ec(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Al(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return gc().makeTensor(this.values,this.shape,this.dtype)},e}(),gc=null,yc=null,bc=null,wc=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Il(e),this.strides=ec(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),Al(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),yc.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return cl(this,void 0,void 0,(function(){var e;return hl(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,yc.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return yc.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return cl(this,void 0,void 0,(function(){var e;return hl(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,nc(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return nc(this.shape,this.dataSync())},e.prototype.data=function(){return cl(this,void 0,void 0,(function(){var e,t;return hl(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=gc().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return uc(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=gc().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return uc(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return cl(this,void 0,void 0,(function(){var e;return hl(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,gc().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(gc().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),yc.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),yc.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),yc.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),yc.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),yc.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),yc.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),yc.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=ec(t),a=function(e,t,n,r){var i=Il(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,u="complex64"===n?mc(e):e;if(s>1)for(var l=0;l<i/a;l++)for(var c=l*a,h=0;h<a;h++)o[h]=Math.max(o[h],fc(u[c+h],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[fc(mc(t)[0],0,r)]:"bool"===r?[dc(t[0])]:[t[0].toString()];if(1===l){if(u>20){var c=Array.from(t.slice(0,3*s)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(c=mc(c),h=mc(h)),["["+c.map((function(e,t){return fc(e,a[t],r)})).join(", ")+", ..., "+h.map((function(e,t){return fc(e,a[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?mc(t):Array.from(t)).map((function(e,t){return fc(e,a[t],r)})).join(", ")+"]"]}var p=n.slice(1),f=i.slice(1),d=i[0]*s,m=[];if(u>20){for(var v=0;v<3;v++){var g=(y=v*d)+d;m.push.apply(m,e(t.slice(y,g),p,r,f,a,!1))}for(m.push("..."),v=u-3;v<u;v++)g=(y=v*d)+d,m.push.apply(m,e(t.slice(y,g),p,r,f,a,v===u-1))}else for(v=0;v<u;v++){var y;g=(y=v*d)+d,m.push.apply(m,e(t.slice(y,g),p,r,f,a,v===u-1))}var b=2===l?",":"";for(m[0]="["+m[0]+b,v=1;v<m.length-1;v++)m[v]=" "+m[v]+b;var w=",\n";for(v=2;v<l;v++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":w),m}(e,t,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),yc.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),yc.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),yc.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),yc.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),yc.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),yc.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),yc.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),yc.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),yc.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),yc.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),yc.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),yc.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),bc("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.batchNorm=function(e,t,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),yc.batchNorm(this,e,t,n,r,i)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),yc.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),yc.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),yc.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),yc.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),yc.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),yc.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),yc.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),yc.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),yc.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),yc.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),yc.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),yc.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),yc.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),yc.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),yc.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),yc.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),yc.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),yc.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),yc.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),yc.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),yc.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),yc.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),yc.modStrict(this,e)},e.prototype.squaredDifference=function(e){return this.throwIfDisposed(),yc.squaredDifference(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),yc.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),yc.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),yc.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),yc.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),yc.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),yc.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),yc.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),yc.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),yc.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),yc.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),yc.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),yc.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),yc.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),yc.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),yc.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),yc.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),yc.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),yc.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),yc.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),yc.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),yc.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),yc.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),yc.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),yc.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),yc.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),yc.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),yc.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),yc.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),yc.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),yc.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),yc.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),yc.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),yc.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),yc.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),yc.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),yc.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),yc.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),yc.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),yc.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),yc.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),yc.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),yc.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),yc.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),yc.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),yc.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),yc.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),yc.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),yc.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),yc.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),yc.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),yc.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),yc.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),yc.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),yc.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),yc.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),yc.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),yc.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),yc.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),yc.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),yc.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),yc.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),yc.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),yc.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),yc.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),yc.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),yc.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),yc.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),yc.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),yc.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),yc.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),yc.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),yc.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),yc.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),yc.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),yc.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),gc().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),yc.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),yc.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),yc.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),yc.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),yc.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),yc.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),yc.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),yc.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),yc.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),yc.spectral.irfft(this)},e}();Object.defineProperty(wc,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var xc,Cc,kc,Ec,_c,Ac,Sc=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return ll(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Tl(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");gc().disposeTensor(this),this.dataId=e.dataId,gc().incRef(this,null)},t.prototype.dispose=function(){gc().disposeVariable(this),this.isDisposedInternal=!0},t}(wc);Object.defineProperty(Sc,Symbol.hasInstance,{value:function(e){return e instanceof wc&&null!=e.assign&&e.assign instanceof Function}}),(Ac=xc||(xc={})).R0="R0",Ac.R1="R1",Ac.R2="R2",Ac.R3="R3",Ac.R4="R4",Ac.R5="R5",Ac.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Cc||(Cc={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(kc||(kc={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ec||(Ec={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(_c||(_c={}));var Nc={float32:Ec,int32:Cc,bool:kc,complex64:_c};function Dc(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Nc[e][t]}function Ic(e){return Dc(e,"int32")}function Tc(e,t){if(e.dtype===t.dtype)return[e,t];var n=Dc(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Rc(e,t){Al(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function Oc(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof wc)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var Fc,Mc=Object.freeze({makeTypesMatch:Tc,assertTypesMatch:Rc,isTensorInList:function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},getTensorsInContainer:Oc}),Lc=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Bc=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Lc}return e.prototype.ready=function(){return cl(this,void 0,void 0,(function(){var e,t,n;return hl(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?[4,this.initializeBackend(n=e[t]).success]:[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return cl(this,void 0,void 0,(function(){var t,n,r;return hl(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new cc(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;bl(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;bl(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.asyncInit;if(i||r.success)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=r-t-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,u=this;void 0===a&&(a=[]),void 0===o&&(o=[]);var l=[],c=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,p=function(e){c&&(l=e.map((function(e){return u.keep(u.clone(e))})))},f=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=yl(r,this.backendName);return h=null!=v?function(){var e=u.backend.numDataIds();m=v.kernelFunc({inputs:t,attrs:i,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){return u.makeTensorFromDataId(e.dataId,e.shape,e.dtype)})),l=s.filter((function(e,t){return o[t]}));return p((a||[]).slice().concat(l)),s}:function(){var t=u.backend.numDataIds();m=u.tidy((function(){return e(u.backend,p)}));var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return h()})):h()})),c&&this.addTapeNode(r,t,s,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var i=e;"string"===(n=n||"float32")&&Xl(e[0])&&(i=e.map((function(e){return sc(e)})));var a=r.write(i,t,n),o=new wc(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=Kl(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new wc(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new Sc(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*ql(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Sc||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return cl(this,void 0,void 0,(function(){var t,n;return hl(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i){var a=this,o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},s=function(e){return gl.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=ic(r.size,r.dtype);return a.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i)}),this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Oc(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),Al(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));Al(a instanceof wc,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(d=e[a]).inputs;for(var s in o){for(var u=o[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){d.outputs.forEach((function(e){return r[e.id]=!0})),l=!0,i[d.id]=!0;break}if(l)break}}var h={};h[n.id]=!0;var p={};for(a=e.length-1;a>=0;a--)for(o=(d=e[a]).inputs,c=0;c<d.outputs.length;c++)if(h[d.outputs[c].id]){for(var s in o)h[o[s].id]=!0,p[d.id]=!0;break}var f=[];for(a=0;a<e.length;a++){var d;if(i[(d=e[a]).id]&&p[d.id]){var m={};for(var s in d.inputs){var v=d.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},d);g.inputs=m,g.outputs=d.outputs,f.push(g)}}return f}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=rc(Il(e=a.shape),"float32"),Pc.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];a.push(null!=n?n:null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!Tl(r.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in i.inputs)s(u)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:a,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return Al(Yl(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];Al(r.every((function(e){return e instanceof wc})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return Al((n=e.apply(void 0,r.concat([i]))).value instanceof wc,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),Al(Yl(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];Al(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),Al(a.every((function(e){return e instanceof wc})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return cl(this,void 0,void 0,(function(){var t,n;return hl(this,(function(r){switch(r.label){case 0:return t=ac(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=ac()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Lc,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),Pc=function(){var e=function(){if(null==Fc){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Fc=e}return Fc}();if(null==e._tfengine){var t=new pl(e);e._tfengine=new Bc(t)}return function(e){ml=e}(e._tfengine.ENV),gc=function(){return e._tfengine},e._tfengine}();function zc(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Vc=dl();Vc.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Vc.registerFlag("IS_BROWSER",(function(){return zc()})),Vc.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Vc.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Vc.registerFlag("PROD",(function(){return!1})),Vc.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Vc.getBool("DEBUG")})),Vc.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Vc.registerFlag("IS_TEST",(function(){return!1}));var Wc,Uc,jc,Hc={},Gc={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qc(e,t){Hc[e]=t}function Kc(e){e in Hc||(Hc[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Hc[e]}),!1),1===e?t.getContext("webgl",Gc)||t.getContext("experimental-webgl",Gc):t.getContext("webgl2",Gc)}(e));var t=Hc[e];return t.isContextLost()?(delete Hc[e],Kc(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Hc[e])}function Xc(e,t){return[t,e]}function Qc(e){var t=Il(e);return Fl(Math.ceil(t/4))}function Zc(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function $c(e,t){var n,r,i,a,o,s,u,l,c,h=e;return 2===dl().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,i=h.RGBA16F,a=h.RGBA32F,o=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=h.RGBA,o=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function Yc(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+nh(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Wc||(Wc={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Uc||(Uc={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jc||(jc={}));var Jc=5.96e-8,eh=65504;function th(e){return!!(dl().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||Jc<Math.abs(e)&&Math.abs(e)<eh)}function nh(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function rh(e,t,n){return Ah(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function ih(e,t,n){var r=Ah(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Yc(e,t,(function(){return e.shaderSource(r,n)})),Yc(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ah(e,t,n){var r=Ah(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Yc(e,t,(function(){return e.shaderSource(r,n)})),Yc(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=uh.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return Ml((t+1).toString(),a)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var l=o.slice(0,r-1),c=o.slice(r-1,r),h=o.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Ml(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var oh,sh,uh=/ERROR: [0-9]+:([0-9]+):/g;function lh(e,t){return Ah(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function ch(e,t,n){if(Yc(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function hh(e,t,n){if(Yc(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function ph(e,t,n){var r=Ah(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Yc(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Yc(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function fh(e,t,n){var r=Ah(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Yc(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),Yc(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function dh(e,t){return Ah(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function mh(e,t){var n=dl().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function vh(e,t){return Ah(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function gh(e,t,n,r,i,a,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Yc(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),Yc(e,t,(function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,o,s)})),Yc(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function yh(e,t,n,r){Sh(e,r),Yc(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function bh(e,t,n,r){return Ah(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function wh(e,t,n){return e.getUniformLocation(t,n)}function xh(e,t,n,r,i,a){Yc(e,t,(function(){return yh(e,t,r,a)})),Yc(e,t,(function(){return e.uniform1i(i,a)}))}function Ch(e,t,n,r){Yc(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),Yc(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function kh(e,t,n){Yc(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Yc(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Eh(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+_h(e,t))}function _h(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Ah(e,t,n,r){var i=Yc(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function Sh(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Nh(e,t){return void 0===t&&(t=2),Il(e.slice(0,e.length-t))}function Dh(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ih(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Nh(e)].concat(Dh(e))),t}function Th(e,t){var n;void 0===t&&(t=!1);var r=dl().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?El(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=zl(e);e=i.newShape}var a=Il(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Nh(e),s=2,u=2;return e.length&&(s=(n=Dh(e))[0],u=n[1]),Fl(a=o*(s/2)*(u/2)).map((function(e){return 2*e}))}return Fl(a)}function Rh(e){return e%2==0}function Oh(e,t){if(Tl(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Rh(n)&&Rh(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Rh(e[0])&&Rh(t[0])}function Fh(e){if(null==oh){var t=Kc(e);oh=t.getParameter(t.MAX_TEXTURE_SIZE)}return oh}function Mh(e){if(null==sh){var t=Kc(e);sh=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,sh)}function Lh(e){if(0===e)return 0;var t=Kc(e);return Bh(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Bh(t,"EXT_disjoint_timer_query")?1:0}function Bh(e,t){return null!=e.getExtension(t)}function Ph(e){try{if(null!=Kc(e))return!0}catch(e){return!1}return!1}function zh(e){if(0===e)return!1;var t=Kc(e);if(1===e){if(!Bh(t,"OES_texture_float"))return!1}else if(!Bh(t,"EXT_color_buffer_float"))return!1;return Wh(t)}function Vh(e){if(0===e)return!1;var t=Kc(e);if(1!==e){if(Bh(t,"EXT_color_buffer_float"))return Wh(t);if(Bh(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=$c(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!Bh(t,"OES_texture_float")&&!!Bh(t,"WEBGL_color_buffer_float")&&Wh(t)}function Wh(e){var t=$c(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function Uh(e){return 2===e&&null!=Kc(e).fenceSync}var jh=Object.freeze({callAndCheck:Yc,canBeRepresented:th,getWebGLErrorMessage:nh,getExtensionOrThrow:rh,createVertexShader:ih,createFragmentShader:ah,createProgram:lh,linkProgram:ch,validateProgram:hh,createStaticVertexBuffer:ph,createStaticIndexBuffer:fh,getNumChannels:function(){return 2===dl().getNumber("WEBGL_VERSION")?1:4},createTexture:dh,validateTextureSize:mh,createFramebuffer:vh,bindVertexBufferToProgramAttribute:gh,bindTextureUnit:yh,unbindTextureUnit:function(e,t,n){Sh(e,n),Yc(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:bh,getProgramUniformLocation:wh,bindTextureToProgramUniformSampler:xh,bindCanvasToFramebuffer:function(e,t){Yc(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Yc(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),Yc(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:Ch,unbindColorTextureFromFramebuffer:kh,validateFramebuffer:Eh,getFramebufferErrorMessage:_h,getBatchDim:Nh,getRowsCols:Dh,getShapeAs3D:Ih,getTextureShapeFromLogicalShape:Th,isReshapeFree:Oh,getWebGLMaxTextureSize:Fh,resetMaxTextureSize:function(){oh=null},resetMaxTexturesInShader:function(){sh=null},getMaxTexturesInShader:Mh,getWebGLDisjointQueryTimerVersion:Lh,hasExtension:Bh,isWebGLVersionEnabled:Ph,isCapableOfRenderingToFloatTexture:zh,isDownloadFloatTextureEnabled:Vh,isWebGLFenceEnabled:Uh}),Hh=dl();function Gh(e){dl().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function qh(){return Pc.memory()}function Kh(e,t){return Pc.tidy(e,t)}function Xh(e){Oc(e).forEach((function(e){return e.dispose()}))}function Qh(e){return Pc.keep(e)}function Zh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];dl().getBool("IS_TEST")||console.warn.apply(console,e)}function $h(e,t){var n=e;if(Gl(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Gl(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&dl().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Gl(t)){Al(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),Al(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else Al(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function Yh(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function Jh(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof wc)return Yh(r,e.dtype,t,n),e;var i=$l(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Yh(r,i,t,n),null==e||!Gl(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+(null==e?"null":e.constructor.name)+"'");var a=$h(e,i);Gl(e)||Array.isArray(e)||(e=[e]);var o="string"!==i?tc(e,i,dl().getBool("DEBUG")):Dl(e,[],!0);return Pc.makeTensor(o,a,i)}function ep(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return Jh(e,t+"["+r+"]",n)}),r)}function tp(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function np(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function rp(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function ip(e,t){return np(e,t.map((function(e){return 1})),t)}function ap(e,t,n){Al(tp(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function op(e,t){if(tp(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function sp(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function up(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function lp(e,t){var n=e[0].length;e.forEach((function(e,t){Al(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),Al(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)Al(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function cp(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function hp(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Pc.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Pc.endScope(i),i}catch(e){throw Pc.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Hh.registerFlag("HAS_WEBGL",(function(){return Hh.getNumber("WEBGL_VERSION")>0})),Hh.registerFlag("WEBGL_VERSION",(function(){return Ph(2)?2:Ph(1)?1:0})),Hh.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Hh.get("WEBGL_VERSION")})),Hh.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Hh.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Hh.registerFlag("WEBGL_PACK",(function(){return Hh.getBool("HAS_WEBGL")})),Hh.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_PACK_CLIP",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Hh.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_PACK_REDUCE",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_CONV_IM2COL",(function(){return Hh.getBool("WEBGL_PACK")})),Hh.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Fh(Hh.getNumber("WEBGL_VERSION"))})),Hh.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Mh(Hh.getNumber("WEBGL_VERSION"))})),Hh.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Hh.getNumber("WEBGL_VERSION");return 0===e?0:Lh(e)})),Hh.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Hh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Hh.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return zh(Hh.getNumber("WEBGL_VERSION"))})),Hh.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Hh.getBool("WEBGL_FORCE_F16_TEXTURES")&&Hh.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Hh.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Vh(Hh.getNumber("WEBGL_VERSION"))})),Hh.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Uh(Hh.getNumber("WEBGL_VERSION"))})),Hh.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Hh.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),bc=Gh;var pp=hp({complex_:function(e,t){var n=Jh(e,"real","complex"),r=Jh(t,"imag","complex");return Sl(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Pc.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),fp=hp({real_:function(e){var t=Jh(e,"input","real");return Pc.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),dp=hp({imag_:function(e){var t=Jh(e,"input","imag");return Pc.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function mp(e,t,n){return vp(e,t,$h(e,n),n)}function vp(e,t,n,r){if(null==r&&(r=$l(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Gl(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){oc(t);var i=Il(t),a=Il(n);Al(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=o!==n.length-1||n[o]!==Il(t.slice(o));Al(n[o]===t[o]||!s,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return Gl(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?tc(e,r,dl().getBool("DEBUG")):Dl(e,[],!0),Pc.makeTensor(e,t,r)}function gp(e,t){if((Gl(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Gl(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vp(e,[],[],t)}function yp(e,t){Nl(e);var n=$h(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vp(e,null,n,t)}function bp(e,t,n){if(Nl(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=$h(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vp(e,t,r,n)}function wp(e,t,n){if(Nl(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=$h(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vp(e,t,r,n)}function xp(e,t,n){if(Nl(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=$h(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vp(e,t,r,n)}function Cp(e,t,n,r){return void 0===t&&(t=!0),Pc.makeVariable(e,t,n,r)}function kp(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=kp(e,"float32"),r=Ep(e,"float32");return pp(n,r)}var i=rc(Il(e),t);return Pc.makeTensor(i,e,t)}function Ep(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Ep(e,"float32"),r=Ep(e,"float32");return pp(n,r)}var i=ic(Il(e),t);return Pc.makeTensor(i,e,t)}function _p(e,t,n){return Pc.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function Ap(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Pc.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function Sp(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Ep([0],r);var i=ic(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return yp(i,r)}var Np=hp({onesLike_:function(e){var t=Jh(e,"x","onesLike");if("complex64"===t.dtype){var n=Np(fp(t)),r=Dp(dp(t));return pp(n,r)}return Pc.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return Dp(e)}}}))}}),Dp=hp({zerosLike_:function(e){var t=Jh(e,"x","zerosLike");return Pc.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return Dp(e)}}}))}}),Ip=hp({concat_:function(e,t){void 0===t&&(t=0),Al(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=ep(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=Pl(t,n[0].shape)[0];var r=cp(n.map((function(e){return e.shape})),t);if(0===Il(r))return mp([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));return lp(i,t),Pc.runKernelFunc((function(e){return e.concat(n,t)}),n,(function(e){var n=i.map((function(e){return e[t]}));return Mp(e,n,t).map((function(e){return function(){return e}}))}),"Concat",{axis:t})}}),Tp=hp({concat1d_:function(e){return Ip(e,0)}}),Rp=hp({concat2d_:function(e,t){return Ip(e,t)}}),Op=hp({concat3d_:function(e,t){return Ip(e,t)}}),Fp=hp({concat4d_:function(e,t){return Ip(e,t)}}),Mp=hp({split_:function(e,t,n){void 0===n&&(n=0);var r,i=Jh(e,"x","split");return n=Pl(n,i.shape)[0],"number"==typeof t?(Al(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(Al(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),Pc.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return Ip(e,n)}}}))}});function Lp(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Bp=Lp((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var n=new r(e),a=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.alea=a}(0,e)})),Pp=Lp((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xor128=a}(0,e)})),zp=Lp((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)})),Vp=Lp((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&(a.x&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)})),Wp=Lp((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n=i[a]=(n^=n>>>15)^(e^=e>>>12),t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=0==(n=s[127&a]^=r+(o=o+1640531527|0))?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,s[i]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&(a.X&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)})),Up=Lp((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.tychei=a}(0,e)})),jp=Lp((function(e){!function(t,r){var i,a=this,o=256,s=6,u="random",l=r.pow(o,s),c=r.pow(2,52),h=2*c,p=o-1;function f(e,n,p){var f=[],y=v(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),f),b=new d(f),w=function(){for(var e=b.g(s),t=l,n=0;e<c;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,v(g(b.S),t),(n.pass||p||function(e,t,n,i){return i&&(i.S&&m(i,b),e.state=function(){return m(b,{})}),n?(r[u]=e,t):e})(w,y,"global"in n?n.global:this==r,n.state)}function d(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=p&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=p&i+1],n=n*o+s[p&(s[i]=s[a=p&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",i=0;i<r.length;)t[p&i]=p&(n^=19*t[p&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+u]=f,v(r.random(),t),e.exports){e.exports=f;try{i=n(1)}catch(e){}}}([],Math)}));jp.alea=Bp,jp.xor128=Pp,jp.xorwow=zp,jp.xorshift7=Vp,jp.xor4096=Wp,jp.tychei=Up;var Hp=jp.alea,Gp=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Hp(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),qp=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=Hp(i.toString()),this.randn=new Gp(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-(a*=a*a)+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Kp=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Hp(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Xp(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",oc(e),new vc(e,t,n)}var Qp=hp({batchToSpaceND_:function(e,t,n){var r=Jh(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return Al(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),Al(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),Al(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),Pc.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),Zp=hp({broadcastTo_:function(e,t){var n=Jh(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var a=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])a[o]=1;else if(1!==n.shape[o])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=a.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===s.length?n.clone():Pc.runKernelFunc((function(e){return e.tile(n,a)}),{input:n},(function(e){return{input:function(){return e.sum(s,!0)}}}))}}),$p=hp({cast_:function(e,t){var n=Jh(e,"x","cast");if(!jl(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Pc.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",{dtype:t})}}),Yp=hp({clone_:function(e){var t=Jh(e,"x","clone",null);return Pc.runKernelFunc((function(){return Pc.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),Jp=hp({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=Jh(e,"x","cumsum"),a=op([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=up(1,i.rank)[0],u=Pc.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),ef=hp({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=Jh(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return Al(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),Al(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),Al(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),Pc.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),tf=hp({expandDims_:function(e,t){void 0===t&&(t=0);var n=Jh(e,"x","expandDims",null);Al(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(Al(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),mf(n,r)}}),nf=hp({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=Xp([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return bf(tf(s,0),[n[0],1,1]);if(2===n.length)return bf(tf(tf(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return bf(tf(tf(tf(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),rf=hp({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=Jh(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,u=Pc.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?u.as1D():u}}),af=hp({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=Jh(e,"indices","oneHot","int32"),a=i.shape.concat([t]);return i=i.flatten(),Pc.runKernelFunc((function(e){return e.oneHot(i,t,n,r)}),{$indices:i},(function(e){return{$indices:function(){return Ep(i.shape,"float32")}}})).reshape(a)}}),of=hp({pad_:function(e,t,n){void 0===n&&(n=0);var r=Jh(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Pc.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",{paddings:t,constantValue:n})}}),sf=hp({pad1d_:function(e,t,n){return void 0===n&&(n=0),Al(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),of(e,[t],n)}}),uf=hp({pad2d_:function(e,t,n){return void 0===n&&(n=0),Al(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),of(e,t,n)}}),lf=hp({pad3d_:function(e,t,n){return void 0===n&&(n=0),Al(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),of(e,t,n)}}),cf=hp({pad4d_:function(e,t,n){return void 0===n&&(n=0),Al(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),of(e,t,n)}}),hf=hp({rand_:function(e,t,n){var r=Il(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return Pc.makeTensor(i,e,n)}}),pf=hp({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Gp(t,n,r,!1,i),o=Xp(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),ff=hp({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new qp(t,n,r,i),o=Xp(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),df=hp({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Xp(e,r),o=new Kp(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),mf=hp({reshape_:function(e,t){var n=Jh(e,"x","reshape",null);return t=Bl(t,n.size),Al(n.size===Il(t),(function(){return"new shape and old shape must have the same number of elements."})),Pc.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",{shape:t})}}),vf=hp({spaceToBatchND_:function(e,t,n){var r=Jh(e,"x","spaceToBatchND");return Al(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),Al(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),Al(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),Pc.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),gf=hp({squeeze_:function(e,t){var n=Jh(e,"x","squeeze");return mf(n,zl(n.shape,t).newShape)}}),yf=hp({stack_:function(e,t){void 0===t&&(t=0);var n=ep(e,"tensors","stack");if(Al(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].shape,i=n[0].dtype;Al(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){Sl(r,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){Al(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var a=n.map((function(e){return e.expandDims(t)}));return Ip(a,t)}}),bf=hp({tile_:function(e,t){var n=Jh(e,"x","tile",null);return Al(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."})),Pc.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=Dp(r);if(1===r.rank)for(var i=0;i<t[0];++i)n=n.add(e.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<t[0];++i)for(var a=0;a<t[1];++a)n=n.add(e.slice([i*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(var o=0;o<t[2];++o)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",{reps:t},[n])}}),wf=hp({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Gp(t,n,r,!0,i),o=Xp(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),xf=hp({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=Jh(e,"x","unstack");return Al(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length),Pc.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return yf(e,t)}}}),"Unpack",{axis:t})}}),Cf=function(e,t){return cl(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,c,h;return hl(this,(function(p){switch(p.label){case 0:return n=Jh(e,"x","setdiff1d"),r=Jh(t,"y","setdiff1d"),Al(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),Al(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),Al(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=p.sent(),[4,r.data()];case 2:for(a=p.sent(),o=new Set(a),s=0,c=0;c<i.length;c++)o.has(i[c])||s++;for(u=new vc([s],n.dtype),l=new vc([s],"int32"),c=0,h=0;c<i.length;c++)o.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}}))}))};function kf(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function Ef(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function _f(e,t,n,r){void 0===r&&(r=!0);var i=[];i.push(r?e[0]/n:e[0]*n);for(var a=1;a<e.length;++a)i.push(a<=t.length?r?t[a-1]*e[a]:e[a]/t[a-1]:e[a]);return i}function Af(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Sf(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function Nf(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=o[a],s.push(o[a]);var l=ec(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,i,u,l]}var Df=30;function If(e){return e<=Df?e:Jl(e,Math.floor(Math.sqrt(e)))}function Tf(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,i=n.length,a=1,o=r;o<i;++o)a*=n[o];return{sliceRank:r,numUpdates:t.size/(r<1?1:r),sliceSize:a,strides:ec(n.slice(0,r)).concat([1]),outputSize:Il(n)}}function Rf(e,t,n){Al(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),Al(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){Al(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function Of(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Ff(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function Mf(e,t,n,r,i){var a=t[i];(e&1<<i||null==a)&&(a=(n[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var o=r[i];return a<0&&(a+=o),kl(0,a,o-1)}function Lf(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?kl(0,a,s):kl(-1,a,s-1)}function Bf(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Pf(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function zf(e){return Pc.customGrad(e)}Object.freeze({assertParamsValid:Rf,maskToAxes:Of,computeOutShape:Ff,startForAxis:Mf,stopForAxis:Lf,isSliceContinous:Bf,computeFlatOffset:Pf});var Vf=hp({softmax_:function(e,t){void 0===t&&(t=-1);var n=Jh(e,"logits","softmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return zf((function(e,n){var r=e.logSumExp([t],!0),i=e.toFloat().sub(r).exp();return n([i]),{value:i,gradFunc:function(e,n){var r=n[0],i=e.mul(r);return i.sub(i.sum([t],!0).mul(r))}}}))(n)}}),Wf=hp({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=Jh(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return zf((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),Uf=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),jf=function(){function e(){}return e.prototype.time=function(e){return Hf("time")},e.prototype.read=function(e){return Hf("read")},e.prototype.readSync=function(e){return Hf("readSync")},e.prototype.numDataIds=function(){return Hf("numDataIds")},e.prototype.disposeData=function(e){return Hf("disposeData")},e.prototype.write=function(e,t,n){return Hf("write")},e.prototype.move=function(e,t,n,r){return Hf("move")},e.prototype.memory=function(){return Hf("memory")},e.prototype.floatPrecision=function(){return Hf("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return Hf("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return Hf("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return Hf("slice")},e.prototype.stridedSlice=function(e,t,n,r){return Hf("stridedSlice")},e.prototype.unstack=function(e,t){return Hf("unstack")},e.prototype.reverse=function(e,t){return Hf("reverse")},e.prototype.concat=function(e,t){return Hf("concat")},e.prototype.neg=function(e){return Hf("neg")},e.prototype.add=function(e,t){return Hf("add")},e.prototype.addN=function(e){return Hf("addN")},e.prototype.subtract=function(e,t){return Hf("subtract")},e.prototype.multiply=function(e,t){return Hf("multiply")},e.prototype.realDivide=function(e,t){return Hf("realDivide")},e.prototype.floorDiv=function(e,t){return Hf("floorDiv")},e.prototype.sum=function(e,t){return Hf("sum")},e.prototype.prod=function(e,t){return Hf("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return Hf("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return Hf("argMin")},e.prototype.argMax=function(e,t){return Hf("argMax")},e.prototype.equal=function(e,t){return Hf("equal")},e.prototype.notEqual=function(e,t){return Hf("notEqual")},e.prototype.less=function(e,t){return Hf("less")},e.prototype.lessEqual=function(e,t){return Hf("lessEqual")},e.prototype.greater=function(e,t){return Hf("greater")},e.prototype.greaterEqual=function(e,t){return Hf("greaterEqual")},e.prototype.logicalNot=function(e){return Hf("logicalNot")},e.prototype.logicalAnd=function(e,t){return Hf("logicalAnd")},e.prototype.logicalOr=function(e,t){return Hf("logicalOr")},e.prototype.where=function(e){return Hf("where")},e.prototype.select=function(e,t,n){return Hf("select")},e.prototype.topk=function(e,t,n){return Hf("topk")},e.prototype.min=function(e,t){return Hf("min")},e.prototype.minimum=function(e,t){return Hf("minimum")},e.prototype.mod=function(e,t){return Hf("mod")},e.prototype.max=function(e,t){return Hf("max")},e.prototype.maximum=function(e,t){return Hf("maximum")},e.prototype.all=function(e,t){return Hf("all")},e.prototype.any=function(e,t){return Hf("any")},e.prototype.squaredDifference=function(e,t){return Hf("squaredDifference")},e.prototype.ceil=function(e){return Hf("ceil")},e.prototype.floor=function(e){return Hf("floor")},e.prototype.round=function(e){return Hf("round")},e.prototype.sign=function(e){return Hf("sign")},e.prototype.isNaN=function(e){return Hf("isNaN")},e.prototype.isInf=function(e){return Hf("isInf")},e.prototype.isFinite=function(e){return Hf("isFinite")},e.prototype.pow=function(e,t){return Hf("pow")},e.prototype.exp=function(e){return Hf("exp")},e.prototype.expm1=function(e){return Hf("expm1")},e.prototype.log=function(e){return Hf("log")},e.prototype.log1p=function(e){return Hf("log1p")},e.prototype.sqrt=function(e){return Hf("sqrt")},e.prototype.rsqrt=function(e){return Hf("rsqrt")},e.prototype.square=function(e){return Hf("square")},e.prototype.reciprocal=function(e){return Hf("reciprocal")},e.prototype.relu=function(e){return Hf("relu")},e.prototype.relu6=function(e){return Hf("relu6")},e.prototype.prelu=function(e,t){return Hf("prelu")},e.prototype.elu=function(e){return Hf("elu")},e.prototype.eluDer=function(e,t){return Hf("eluDer")},e.prototype.selu=function(e){return Hf("selu")},e.prototype.int=function(e){return Hf("int")},e.prototype.clip=function(e,t,n){return Hf("clip")},e.prototype.abs=function(e){return Hf("abs")},e.prototype.complexAbs=function(e){return Hf("complexAbs")},e.prototype.sigmoid=function(e){return Hf("sigmoid")},e.prototype.softplus=function(e){return Hf("softplus")},e.prototype.sin=function(e){return Hf("sin")},e.prototype.cos=function(e){return Hf("cos")},e.prototype.tan=function(e){return Hf("tan")},e.prototype.asin=function(e){return Hf("asin")},e.prototype.acos=function(e){return Hf("acos")},e.prototype.atan=function(e){return Hf("atan")},e.prototype.atan2=function(e,t){return Hf("atan2")},e.prototype.sinh=function(e){return Hf("sinh")},e.prototype.cosh=function(e){return Hf("cosh")},e.prototype.tanh=function(e){return Hf("tanh")},e.prototype.asinh=function(e){return Hf("asinh")},e.prototype.acosh=function(e){return Hf("acosh")},e.prototype.atanh=function(e){return Hf("atanh")},e.prototype.erf=function(e){return Hf("erf")},e.prototype.step=function(e,t){return Hf("step")},e.prototype.fusedConv2d=function(e){return Hf("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return Hf("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return Hf("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return Hf("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return Hf("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return Hf("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return Hf("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return Hf("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return Hf("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return Hf("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return Hf("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return Hf("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return Hf("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return Hf("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return Hf("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return Hf("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return Hf("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return Hf("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return Hf("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return Hf("reshape")},e.prototype.cast=function(e,t){return Hf("cast")},e.prototype.tile=function(e,t){return Hf("tile")},e.prototype.pad=function(e,t,n){return Hf("pad")},e.prototype.transpose=function(e,t){return Hf("transpose")},e.prototype.gather=function(e,t,n){return Hf("gather")},e.prototype.gatherND=function(e,t){return Hf("gatherND")},e.prototype.scatterND=function(e,t,n){return Hf("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return Hf("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return Hf("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return Hf("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return Hf("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return Hf("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return Hf("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,a){return Hf("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return Hf("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){return Hf("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return Hf("multinomial")},e.prototype.oneHot=function(e,t,n,r){return Hf("oneHot")},e.prototype.cumsum=function(e,t,n,r){return Hf("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return Hf("nonMaxSuppression")},e.prototype.fft=function(e){return Hf("fft")},e.prototype.ifft=function(e){return Hf("ifft")},e.prototype.complex=function(e,t){return Hf("complex")},e.prototype.real=function(e){return Hf("real")},e.prototype.imag=function(e){return Hf("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,a){return Hf("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return Hf("depthToSpace")},e.prototype.split=function(e,t,n){return Hf("split")},e.prototype.sparseToDense=function(e,t,n,r){return Hf("sparseToDense")},e.prototype.diag=function(e){return Hf("diag")},e.prototype.fill=function(e,t,n){return Hf("fill")},e.prototype.onesLike=function(e){return Hf("onesLike")},e.prototype.zerosLike=function(e){return Hf("zerosLike")},e.prototype.linspace=function(e,t,n){return Hf("linspace")},e.prototype.dispose=function(){return Hf("dispose")},e}();function Hf(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Gf(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i;(t[t.length-1-i]||1)>1&&1===(e[a]||1)&&r.unshift(a)}return r}function qf(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1;(null==i||1===i&&t[a]>1)&&n.unshift(a)}return n}function Kf(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function Xf(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,u=Jf(t),l=u[0],c=u[1];if("channelsLast"===o)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[l,c,e[1],e[1]]}return Zf(e,s,n,r,i,a,!1,o)}function Qf(e,t,n,r,i,a,o){void 0===o&&(o="NDHWC");var s,u,l=ed(t),c=l[0],h=l[1],p=l[2];if("NDHWC"===o)u="channelsLast",s=[c,h,p,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[c,h,p,e[1],e[1]]}return $f(e,s,n,r,i,!1,u,a)}function Zf(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],p=u[3];if("channelsLast"===s)l=e[0],c=e[1],h=e[2],p=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],p=e[1],c=e[2],h=e[3]}var f,d=t[0],m=t[1],v=t[3],g=Jf(n),y=g[0],b=g[1],w=Jf(r),x=w[0],C=w[1],k=td(d,x),E=td(m,C),_=function(e,t,n,r,i,a,o,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,i){null==r&&(r=Yf(e,t,n));var a=e[1],o=nd((e[0]-t+2*r)/n+1,i);Al(Rl(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=nd((a-t+2*r)/n+1,i);return Al(Rl(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],a,r,e,s);l=h[0],c=h[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/i);var p=Math.max(0,(l-1)*r+a-t),f=Math.max(0,(c-1)*i+o-n),d=Math.floor(p/2),m=p-d,v=Math.floor(f/2);u={top:d,bottom:m,left:v,right:f-v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-o+1)/i)}return{padInfo:u,outHeight:l,outWidth:c}}(i,c,h,y,b,k,E,a),A=_.outHeight,S=_.outWidth,N=o?v*p:v;return"channelsFirst"===s?f=[l,N,A,S]:"channelsLast"===s&&(f=[l,A,S,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:p,outHeight:A,outWidth:S,outChannels:N,padInfo:_.padInfo,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:m,effectiveFilterHeight:k,effectiveFilterWidth:E,dilationHeight:x,dilationWidth:C,inShape:e,outShape:f,filterShape:t}}function $f(e,t,n,r,i,a,o,s){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],p=u[3],f=u[4];if("channelsLast"===o)l=e[0],c=e[1],h=e[2],p=e[3],f=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);l=e[0],f=e[1],c=e[2],h=e[3],p=e[4]}var d,m=t[0],v=t[1],g=t[2],y=t[4],b=ed(n),w=b[0],x=b[1],C=b[2],k=ed(r),E=k[0],_=k[1],A=k[2],S=td(m,E),N=td(v,_),D=td(g,A),I=function(e,t,n,r,i,a,o,s,u,l,c){var h,p,f,d;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,i,a){null==i&&(i=Yf(e,t,r));var o=e[1],s=e[2],u=nd((e[0]-t+2*i)/r+1,a);Al(Rl(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var l=nd((o-t+2*i)/r+1,a);Al(Rl(l),(function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"}));var c=nd((s-t+2*i)/r+1,a);return Al(Rl(c),(function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"})),[u,l,c,1]}([t,n,r,1],s,0,i,e,c);p=m[0],f=m[1],d=m[2]}else if("same"===e){var v=((p=Math.ceil(t/i))-1)*i+s-t,g=((f=Math.ceil(n/a))-1)*a+u-n,y=((d=Math.ceil(r/o))-1)*o+l-r,b=Math.floor(v/2),w=v-b,x=Math.floor(g/2),C=g-x,k=Math.floor(y/2);h={top:x,bottom:C,left:k,right:y-k,front:b,back:w,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-s+1)/i),f=Math.ceil((n-u+1)/a),d=Math.ceil((r-l+1)/o)}return{padInfo:h,outDepth:p,outHeight:f,outWidth:d}}(i,c,h,p,w,x,C,S,N,D,s),T=I.outDepth,R=I.outHeight,O=I.outWidth,F=a?y*f:y;return"channelsFirst"===o?d=[l,F,T,R,O]:"channelsLast"===o&&(d=[l,T,R,O,F]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:h,inWidth:p,inChannels:f,outDepth:T,outHeight:R,outWidth:O,outChannels:F,padInfo:I.padInfo,strideDepth:w,strideHeight:x,strideWidth:C,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:S,effectiveFilterHeight:N,effectiveFilterWidth:D,dilationDepth:E,dilationHeight:_,dilationWidth:A,inShape:e,outShape:d,filterShape:t}}function Yf(e,t,n,r){void 0===r&&(r=1);var i=td(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Jf(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function ed(e){return"number"==typeof e?[e,e,e]:e}function td(e,t){return t<=1?e:e+(e-1)*(t-1)}function nd(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function rd(e){var t=Jf(e);return 1===t[0]&&1===t[1]&&1===t[2]}function id(e,t){return rd(e)||rd(t)}function ad(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function od(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Ep(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!Hl(e.dtype,t))return Pc.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=gp(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function sd(e,t){return Pc.makeTensorFromDataId(e.dataId,t,e.dtype)}function ud(e,t,n){var r=(t-e)/(n-1),i=ic(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return yp(i,"float32")}function ld(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function cd(e,t){return{real:e[2*t],imag:e[2*t+1]}}function hd(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function pd(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function fd(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,a=0,o=!1;r<i;){var s=n(t,e[a=r+(i-r>>>1)]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||dd)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function dd(e,t){return e>t?1:e<t?-1:0}function md(e,t,n,r,i){return gd(e,t,n,r,i,0).selectedIndices}function vd(e,t,n,r,i,a){var o=gd(e,t,n,r,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function gd(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(wd),l=a>0?-.5/a:0,c=[],h=[];c.length<n&&u.length>0;){var p=u.pop(),f=p.score,d=p.boxIndex,m=p.suppressBeginIndex;if(f<i)break;for(var v=!1,g=c.length-1;g>=m;--g){var y=yd(e,d,c[g]);if(y>=r){v=!0;break}if(p.score=p.score*bd(r,l,y),p.score<=i)break}p.suppressBeginIndex=c.length,v||(p.score===f?(c.push(d),h.push(p.score)):p.score>i&&fd(u,p,wd))}var b=c.length;return s&&(c.fill(0,b),h.fill(0,b)),{selectedIndices:yp(c,"int32"),selectedScores:yp(h,"float32"),numValidOutputs:gp(b,"int32")}}function yd(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),p=Math.max(i[1],i[3]),f=(s-a)*(u-o),d=(h-l)*(p-c);if(f<=0||d<=0)return 0;var m=Math.max(a,l),v=Math.max(o,c),g=Math.min(s,h),y=Math.min(u,p),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+d-b)}function bd(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function wd(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function xd(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function Cd(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=Xp(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var u=e.locToIndex(o);i.values[r]=e.values[u]}return i.toTensor()}function kd(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],u=o[1],l=Vl(n,s*r),c=Vl("int32",s*r),h=0;h<s;h++){for(var p=h*u,f=e.subarray(p,p+u),d=[],m=0;m<f.length;m++)d.push({value:f[m],index:m});d.sort((function(e,t){return t.value-e.value}));var v=h*r,g=l.subarray(v,v+r),y=c.subarray(v,v+r);for(m=0;m<r;m++)g[m]=d[m].value,y[m]=d[m].index}var b=t.slice();return b[b.length-1]=r,[mp(l,b,n),mp(c,b,"int32")]}function Ed(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=Xp(e,"int32"),a=Xp([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]);a.values.set(o,r*e.length)}return a.toTensor()}Object.freeze({castTensor:od,reshapeTensor:sd,linspaceImpl:ud,upcastType:Dc,axesAreInnerMostDims:tp,combineLocations:np,computeOutAndReduceShapes:rp,expandShapeToKeepDim:ip,assertAxesAreInnerMostDims:ap,getAxesPermutation:op,getUndoAxesPermutation:sp,getInnerMostAxes:up,getBroadcastDims:Gf,getReductionAxes:qf,assertAndGetBroadcastShape:Kf,assertParamsConsistent:lp,computeOutShape:cp,computePool2DInfo:Xf,computePool3DInfo:Qf,computeConv2DInfo:Zf,computeConv3DInfo:$f,computeDefaultPad:Yf,tupleValuesAreOne:rd,eitherStridesOrDilationsAreOne:id,convertConv2DDataFormat:ad});var _d=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Ad=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Sd=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=Math.ceil(e.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===t?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Nd(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function Dd(e,t){return 1===t?[e]:Nd(e,t)}function Id(){var e,t,n,r,i,a,o,s,u,l;return 2===dl().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Td(e,t,n){void 0===n&&(n="index");var r=ec(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function Rd(e){var t=ec(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Od="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Fd(e){return"offset"+e}function Md(e){var t=e.name,n=Il(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Ld(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Bd(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Pd(e,t){return t.map((function(t){return e[t]})).join(", ")}var zd=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Al(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=Math.ceil(e[e.length-1]/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,o,s=this.outputShape,u=s.length,l=Ld(u),c=Dd("coords",u);if(1===i){var h=Ld(o=u+1);a="\n        "+h+" sourceLocR = "+h+"("+c.join()+", 0);\n        ++"+c[u-1]+";\n        "+h+" sourceLocG = "+h+"("+c.join()+", 0);\n        ++"+c[u-2]+";\n        "+h+" sourceLocA = "+h+"("+c.join()+", 0);\n        --"+c[u-1]+";\n        "+h+" sourceLocB = "+h+"("+c.join()+", 0);\n        --"+c[u-2]+";"}else o=u,a="\n        "+l+" sourceLocR = coords;\n        ++"+c[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+c[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+c[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+c[u-2]+";";var p=["x","y","z","w","u","v"].slice(0,o),f="."+p[o-1],d=p.map((function(e){return"int "+e})),m=Dd("sourceLocR",o-1).concat("inIdx.r"),v=Dd("sourceLocG",o-1).concat("inIdx.g"),g=Dd("sourceLocB",o-1).concat("inIdx.b"),y=Dd("sourceLocA",o-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",x="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+g.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+d.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+d.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+c[u-1]+" < "+(s[u-1]-1)+";\n        bool hasNextRow = "+c[u-2]+" < "+(s[u-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+x+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+x+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Vd=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n      const float avgMultiplier = float("+1/(e.filterHeight*e.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+";\n            wR += "+e.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+e.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wd=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-e.padInfo.front)+", "+(n-1-e.padInfo.top)+", "+(r-1-e.padInfo.left)+");\n      const float avgMultiplier = float("+1/(e.filterDepth*e.filterHeight*e.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+t+";\n            wD += "+e.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+e.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+e.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+e.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ud=function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Kf(e,t),Kf(e,n);var o="0.0";null!=r&&(Kf(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Kf(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},jd=function(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Kf(e,t),Kf(e,n);var o="vec4(0.0)";null!=r&&(Kf(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(Kf(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Hd=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Kf(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Gd="return a + b;",qd="return a - b;",Kd="return a * b;",Xd="return (a < 0.) ? b * a : a;",Qd=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Kf(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Zd="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",$d=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Kf(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===Il(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+Ld(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=Dd("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},Yd=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Jd=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),em=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},tm=function(e){this.outputShape=[],this.outputShape=cp(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++)r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+t[n-1]+"));");r.push("else setOutput(getT"+t.length+"(yR, yC-"+t[t.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},nm=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=cp(e,t);var n=this.outputShape,r=n.length,i=Ld(r),a=Dd("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=o[t],c=o.slice(-2),h=o.join(),p="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+c.join()+"));\n        }";for(u=1;u<s.length;u++){var f=s[u-1];p+="\n        if ("+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+rm(o,l,f)+"),\n            vec2("+rm(c,l,f)+"));\n        }"}var d=s[s.length-1];p+="\n        return getChannel(\n          getT"+s.length+"("+rm(o,l,d)+"),\n          vec2("+rm(c,l,d)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+p+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function rm(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var im=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+e.strideHeight+" - "+e.padInfo.top+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+e.strideWidth+" - "+e.padInfo.left+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===e.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},am=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r="channelsLast"===e.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(r?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(r?1:2)+"], coords["+(r?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+r+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},om=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+e.strideDepth+" - "+e.padInfo.front+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+e.strideHeight+" - "+e.padInfo.top+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+e.strideWidth+" - "+e.padInfo.left+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sm=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-e.padInfo.front)+", "+(n-1-e.padInfo.top)+", "+(r-1-e.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+e.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},um=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+e.outChannels/e.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+e.strideHeight+" - "+e.padInfo.top+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+e.strideWidth+" - "+e.padInfo.left+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},lm=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},cm=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,d="channelsLast"===e.dataFormat,m=d?1:2,v=d?2:3,g=d?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+d+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+d+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+p+") *\n                    getW(wR, wC, "+p+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+p+", xR, xC) *\n                    getW(wR, wC, "+p+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2)\n              );\n\n              if ("+d+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2),\n                getW(wR, wC, "+p+" + 2, d2)\n              );\n\n              if ("+d+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1),\n                  getX(batch, xR, xC, "+p+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC),\n                  getX(batch, "+p+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+b+"\n        setOutput(result);\n      }\n    "},hm=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,h=e.filterHeight,p=e.filterWidth,f=4*Math.floor(e.inChannels/4),d=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},pm=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,d=e.outChannels/e.inChannels,m="",v="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",v="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+d+";\n        int q = d2 - d1 * "+d+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+p+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+v+"\n        setOutput(result);\n      }\n    "},fm=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,d=f,m="int xR; int xC; int xCOffset;",v=0;v<p;v++)for(var g=0;g<f;g++)m+="\n          vec4 xTexelR"+v+"C"+2*g+" = vec4(0.);\n          vec4 wR"+v+"C"+g+" = vec4(0.);\n          vec4 xR"+v+"C"+g+" = vec4(0.);";for(v=0;v<p;v++)for(var y=0;y<d;y++){if(m+="\n          xR = xRCorner + "+v*c+";\n          xC = xCCorner + "+(g=2*y)*h+";\n        ",1===l){if(g<f&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+".xy);\n                } else {\n                  xR"+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = xTexelR"+v+"C"+g+";\n              ",g+1<f)){var b=s%2==0?El(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+g+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+";\n                "}}else g<f&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n              ",g+1<f&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+".xy);\n              ",g+1<f&&(m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n                ")),m+="}");g<f&&(m+="\n            vec4 wTexelR"+v+"C"+g+" = getW("+v+", "+g+", d1, q);\n            wR"+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+".xz);\n          ",g+1<f&&(m+="\n              vec4 wTexelR"+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+", d1, q);\n              wR"+v+"C"+(g+1)+" =\n                vec4(wTexelR"+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<p;v++)for(g=0;g<f;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var w="",x="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",x="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+C+"\n        "+x+"\n        setOutput(result);\n      }\n    "},dm=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],u=n[0],l=n[1];this.outputShape=[t[0],u,l,e[3]];var c=[o-1+".0",s-1+".0"],h=c[0],p=c[1],f=u>1?[""+(o-1)/(u-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],d=l>1?[""+(s-1)/(l-1),"(x2-x1) * width_ratio","x1*"+p+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+p];this.userCode="\n      const float height_ratio = float("+f[0]+");\n      const float width_ratio = float("+d[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+f[1]+";\n        float width_scale = "+d[1]+";\n\n        float in_y = "+f[2]+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+d[2]+";\n        if( in_x < 0.0 || in_x > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},mm=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Ld(r)+" coords = getOutputCoords();\n        int end = "+vm(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+vm(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function vm(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var gm=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Wc.DENSE;var t=Qc(e),n=Id();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Td(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},ym=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Wc.DENSE;var t=Qc(e),n=Id();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Td(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},bm=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),wm=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},xm=function(e){this.variableNames=["A"],this.outTexUsage=Uc.DOWNLOAD;var t=Id();this.outputShape=e,this.userCode="\n      "+Od+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},Cm=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Uc.DOWNLOAD;var t=Id();this.outputShape=e,this.userCode="\n      "+Od+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},km=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Id(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Rd(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},Em=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Id(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Rd(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},_m=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Am=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),Sm=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=Ld(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)i.push(a===t?"int(getIndices("+r[a]+"))":""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Nm=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Ld(t.length),i=Ld(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Dm(e,t){var n=Id();return ih(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Im(e,t){return ph(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Tm(e,t){return fh(e,t,new Uint16Array([0,1,2,2,1,3]))}function Rm(e,t,n,r,i,a,o){mh(n,r);var s=dh(e,t),u=e.TEXTURE_2D;return Yc(e,t,(function(){return e.bindTexture(u,s)})),Yc(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Yc(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Yc(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Yc(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Yc(e,t,(function(){return e.texImage2D(u,0,i,n,r,0,a,o,null)})),Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Om(e,t,n,r,i){var a=Xc(n,r);return Rm(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function Fm(e,t,n,r,i){var a=Xc(n,r);return Rm(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Mm(e,t,n,r,i){var a=Xc(n,r);return Rm(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function Lm(e,t,n,r,i){var a=Zc(n,r);return Rm(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function Bm(e,t,n,r,i){var a=Zc(n,r);return Rm(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function Pm(e,t,n,r){return Yc(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),gh(e,t,n,"clipSpacePos",r,3,20,0)&&gh(e,t,n,"uv",r,2,20,12)}function zm(e,t,n,r,i,a,o){var s,u,l;Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*i*4),u=e.FLOAT,l=o.internalFormatPackedFloat),s.set(a),Yc(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,i,0,e.RGBA,u,s)})),Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Vm(e,t,n,r){Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?Yc(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):Yc(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),Yc(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Wm(e,t,n,r,i){var a=e.createBuffer();Yc(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return Yc(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),Yc(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),Yc(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function Um(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function jm(e,t,n,r,i){var a=Xc(n,r),o=a[0],s=a[1],u=new Uint8Array(n*r*4);return Yc(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function Hm(e,t,n,r,i,a,o,s){var u=e,l=new Float32Array(function(e,t){var n=Zc(e,t);return n[0]*n[1]*4}(a,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function Gm(e,t,n,r){var i=new Float32Array(n*r*4);return Yc(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var qm=Object.freeze({createVertexShader:Dm,createVertexBuffer:Im,createIndexBuffer:Tm,createFloat32MatrixTexture:Om,createFloat16MatrixTexture:Fm,createUnsignedBytesMatrixTexture:Mm,createPackedMatrixTexture:Lm,createFloat16PackedMatrixTexture:Bm,bindVertexProgramAttributeStreams:Pm,uploadDenseMatrixToTexture:zm,uploadPixelDataToTexture:Vm,createBufferFromOutputTexture:Wm,downloadFloat32MatrixFromBuffer:Um,downloadByteEncodedFloatMatrixFromOutputTexture:jm,downloadPackedMatrixFromBuffer:Hm,downloadMatrixFromPackedOutputTexture:Gm}),Km=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=dl().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,qc(t,e)):this.gl=Kc(t);var n="WEBGL_color_buffer_float";if(1===dl().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=rh(this.gl,this.debug,"OES_texture_float"),Bh(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=rh(this.gl,this.debug,"OES_texture_half_float");else if(dl().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Bh(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=rh(this.gl,this.debug,"EXT_color_buffer_half_float");else if(dl().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(Bh(this.gl,n="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Bh(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Im(this.gl,this.debug),this.indexBuffer=Tm(this.gl,this.debug),this.framebuffer=vh(this.gl,this.debug),this.textureConfig=$c(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return dl().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Yc(t,this.debug,(function(){return t.finish()})),Yc(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Yc(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Yc(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Yc(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Yc(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Om(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Fm(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Mm(this.gl,this.debug,e,t)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Vm(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),zm(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Bm(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Lm(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(kh(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Yc(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return jm(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return Hm(this.gl,e,0,0,0,i,a)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Um(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Wm(this.gl,this.debug,t,n);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(dl().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Gm(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ah(t,this.debug,e),r=Dm(t,this.debug),i=lh(t,this.debug);return Yc(t,this.debug,(function(){return t.attachShader(i,r)})),Yc(t,this.debug,(function(){return t.attachShader(i,n)})),ch(t,this.debug,i),this.debug&&hh(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Pm(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Yc(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&hh(this.gl,this.debug,this.program),Yc(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?bh(this.gl,this.debug,e,t):wh(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Yc(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),xh(this.gl,this.debug,0,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Zc(t,n);this.setOutputMatrixTextureDriver(e,r[0],r[1])},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&hh(this.gl,this.debug,this.program),Eh(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Yc(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Yc(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=rh(this.gl,this.debug,2===dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return cl(this,void 0,void 0,(function(){var t=this;return hl(this,(function(n){switch(n.label){case 0:return[4,Ll((function(){return t.disposed||t.isQueryAvailable(e,dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Ll((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ch(this.gl,this.debug,e,this.framebuffer),this.debug&&Eh(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ch(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Eh(this.gl)):kh(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ch(r,this.debug,e,this.framebuffer),this.debug&&Eh(r),this.outputTexture=e,Yc(r,this.debug,(function(){return r.viewport(0,0,t,n)})),Yc(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),Yc(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Xm(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!Tl(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!Tl(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var Qm=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.inChannels,i=n.strideWidth,a=n.strideHeight,o=n.padInfo,s=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,c=n.dataFormat,h=o.left,p=o.top,f=r*n.filterWidth,d=Id(),m="channelsLast"===c,v=m?0:1,g=m?1:2,y="",b=0;b<=1;b++)for(var w=0;w<=1;w++)y+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+s+")) * "+a+" - "+p+";\n            d0 = offsetY + "+l+" * (pos / "+f+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+s+".) * "+i+". - "+h+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+f+".) / "+r+".));\n\n              if(d1 < "+t[g]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+r+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+d.output+" = result;\n      }\n    "},Zm=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a=t,o=e[3]-1;this.outputShape=e;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+o+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+s+")":1===i?"1.0/("+s+")":"exp(log("+s+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},$m=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Ym=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a=t,o=e[3]-1;this.outputShape=e;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+o+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+s+")":1===i?"1.0/("+s+")":"exp(log("+s+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},Jm=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+";\n          wR += "+e.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(t*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ev=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-e.padInfo.front)+", "+(n-1-e.padInfo.top)+", "+(r-1-e.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+t+";\n           wD += "+e.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+e.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+e.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+e.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(t*n*r-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+n+" * "+r+" +\n                  wR * "+r+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tv=function(e,t,n,r,i,a,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=Math.ceil((n?e[1]:e[2])/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",f="";a&&(p=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",f="result = activation(result);");var d=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+c[0]+" * "+h[0]+");\n          result += ("+c[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+d+"\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},nv=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),rv=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},iv=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Dd("rc",t),r=Ld(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},av=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=Ld(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},ov=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=Ld(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=Dd("rc",r),u=Dd("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",d=0,m=1===r?2:4;d<m;d++)f+="\n        "+h[d]+"\n        if ("+p+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(f+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},sv=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,f="0.0";if(p||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+a+");\n        const ivec2 pads = ivec2("+c+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(d="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+c+", "+h+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},uv=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var v="avg"===t,g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+a+", "+o+");\n        const ivec3 pads = ivec3("+f+", "+d+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+p+" +\n                      wR * "+p+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),w=r%4,x="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+f+", "+d+", "+m+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},lv=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,h="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===t?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},cv=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Td(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Rd(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},hv=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],l=[n&&s>1?i-1:i,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=l[0]/c[0],p=l[1]/c[1],f=1/h,d=1/p,m=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},pv=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[1],a=e[2];this.outputShape=[e[0],t,n,e[3]];var o=[r&&t>1?i-1:i,r&&n>1?a-1:a],s=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+o[0]/s[0]+",\n          "+o[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},fv=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[1],a=e[2],o=e[3];this.outputShape=[e[0],t,n,o];var s=[r&&t>1?i-1:i,r&&n>1?a-1:a],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/u[0]+",\n          "+s[1]/u[1]+",\n          "+s[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(o-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},dv=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],l=[n&&s>1?i-1:i,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=l[0]/c[0],p=l[1]/c[1],f=1/h,d=1/p,m=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},mv=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[1],a=e[2];this.outputShape=[e[0],t,n,e[3]];var o=[r&&t>1?i-1:i,r&&n>1?a-1:a],s=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+o[0]/s[0]+",\n          "+o[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},vv=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=Ld(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},gv=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Dd("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=Ld(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},yv=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Ld(i.length),u=Ld(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round(getIndices("+l+"));\n              flattenedIndex += index * "+(t>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+c+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},bv=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";i%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},wv=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&o.push(""+a[u]);r=o.join(),i=s.join()}var l=Ld(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},xv=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Ld(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return Cv.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+Cv[t]+" = start["+t+"] + coords."+Cv[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Cv=["x","y","z","w","u","v"],kv=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Ld(this.rank),n=Dd("coords",this.rank),r=Dd("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Ev=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=Ld(n.length),a=Ld(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},_v=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=Av(t,n),a=Sv(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===jc.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===jc.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===jc.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===jc.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===jc.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=Sv(t,Av(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Av(e,t){if(e===Uc.UPLOAD)return jc.PACKED_2X2_FLOAT32;if(e===Uc.RENDER||null==e)return function(e){return dl().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?jc.PACKED_2X2_FLOAT32:jc.UNPACKED_FLOAT32:e?jc.PACKED_2X2_FLOAT16:jc.UNPACKED_FLOAT16}(t);if(e===Uc.DOWNLOAD||e===Uc.PIXELS)return jc.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Sv(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Nv=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=Ld(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Dv=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=Ld(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Iv=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Ld(this.rank),a=Nd("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Tv=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Rv="if (isnan(x)) return x;",Ov="return x;",Fv="return abs(x);",Mv=Rv+"\n  return (x < 0.0) ? 0.0 : x;\n",Lv=Rv+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Bv="return (x >= 0.0) ? x : (exp(x) - 1.0);",Pv="return -x;",zv="return ceil(x);",Vv="return floor(x);",Wv="return exp(x);",Uv="return exp(x) - 1.0;",jv="return x;",Hv="return x;",Gv="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",qv="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Kv="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Xv=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Qv=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Dd("rc",t),r=Ld(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},Zv={};function $v(e,t){if(void 0===t&&(t=!1),"linear"===e)return t?Hv:Ov;if("relu"===e)return t?Gv:Mv;if("elu"===e)return t?Kv:Bv;if("relu6"===e)return t?qv:Lv;if("prelu"===e)return t?Zd:Xd;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var Yv=600,Jv=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!dl().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=Kc(dl().getNumber("WEBGL_VERSION"));r.binaryCache=(n=dl().getNumber("WEBGL_VERSION"))in Zv?Zv[n]:(Zv[n]={},Zv[n]),r.gpgpu=new Km(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new _v(r.gpgpu),r.numMBBeforeWarning=null==dl().global.screen?1024:dl().global.screen.height*dl().global.screen.width*window.devicePixelRatio*Yv/1024/1024,r.texData=new Uf(r,Pc),r}return ll(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(dl().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Uc.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(dl().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Uc.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.shape;if(null!=t.slice){var o;o=t.isPacked?new Xv(a,jv):new Tv(a,jv);var s=this.runWebGLProgram(o,[{dataId:e,shape:a,dtype:r}],r),u=this.readSync(s.dataId);return this.disposeData(s.dataId),u}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var l,c,h=null!=this.activeTimers;return h&&(l=ac()),c="complex64"===r?ld(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=ac()-l),this.convertAndCacheOnCPU(e,c)},t.prototype.read=function(e){return cl(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,l,c,h,p,f,d,m,v,g,y,b;return hl(this,(function(w){switch(w.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,a=n.dtype,o=n.complexTensors,s=n.isPacked,null!=n.slice)return u=s?new Xv(i,jv):new Tv(i,jv),l=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:a}],a),c=this.read(l.dataId),this.disposeData(l.dataId),[2,c];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!dl().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===dl().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,"complex64"!==a&&dl().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(e),f=this.texData.get(p.dataId),h=(b=this.gpgpu).createBufferFromTexture.apply(b,[f.texture].concat(Qc(i)))),this.pendingRead.set(e,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:w.sent(),w.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([o.real.data(),o.imag.data()])];case 3:return m=w.sent(),d=ld(m[0],m[1]),[3,5];case 4:null==h?d=this.getValuesFromTexture(e):(v=Il(i),d=this.gpgpu.downloadFloat32MatrixFromBuffer(h,v)),w.label=5;case 5:return null!=p&&this.disposeData(p.dataId),g=this.convertAndCacheOnCPU(e,d),y=this.pendingRead.get(e),this.pendingRead.delete(e),y.forEach((function(e){return e(g)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,g]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!th(n)){if(dl().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.isPacked,o=Il(r);if(dl().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Qc(r))).subarray(0,o);return this.disposeData(s.dataId),l}var c=dl().getBool("WEBGL_PACK")&&!0===a,h=c?Ih(r):r,p=c?new Cm(h):new xm(h),f=this.runWebGLProgram(p,[{shape:h,dtype:i,dataId:e}],"float32"),d=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeData(f.dataId),m},t.prototype.time=function(e){return cl(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return hl(this,(function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=Dl(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=Dl(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return o=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:_l(o),getExtraProfileInfo:function(){return o.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:ac(),endMs:null}},t.prototype.endTimer=function(e){return dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=ac(),e)},t.prototype.getQueryTime=function(e){return cl(this,void 0,void 0,(function(){var t;return hl(this,(function(n){return dl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return dl().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Pc.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Pc.keep(e.clone()),imag:Pc.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===Il(n))return mp([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=Bf(e.shape,t,n);if(r||!i){var a=dl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kv(n):new xv(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=Pf(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=Ff(t,n,r);if(i.some((function(e){return 0===e})))return mp([],i);var a=new Ev(t,r,i);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=dl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gv(e.shape,t):new vv(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return fp(e)})),r=e.map((function(e){return dp(e)}));return pp(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>dl().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),a=this.concat(e.slice(0,i),t),o=this.concat(e.slice(i),t);return this.concat([a,o],t)}if(dl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new nm(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=cp(e.map((function(e){return e.shape})),t),l=e.map((function(e){return e.as2D(-1,Il(e.shape.slice(t)))})),c=new tm(l.map((function(e){return e.shape})));return this.compileAndRun(c,l).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Pv,e.dtype);var t=new Tv(e.shape,Pv);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,o,1),l=1===a?2:1,c=1===a?t.as3D(s,1,o):t;return this.multiply(u,c).sum(l,!0)}var h=Dc(e.dtype,t.dtype),p=new tv(e.shape,[s,i,a],n,r);return this.compileAndRun(p,[e,t],h)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],l=i?n.shape[1]:n.shape[2],c=t.shape[0],h=Dc(t.dtype,n.dtype),p=null!=a,f=null!=s,d=o?$v(o,!0):null,m=new tv(t.shape,[c,u,l],r,i,p,d,f),v=[t,n];return a&&v.push(a),s&&v.push(s),this.compileAndRun(m,v,h)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new Hd("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new Hd("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),u=this.compileAndRun(a,o),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Kd,e.dtype);var c=new Qd(Kd,e.shape,t.shape);return this.compileAndRun(c,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var u=null;if(null!=i&&(u=i.shape,o.push(i)),dl().getBool("WEBGL_PACK_NORMALIZATION")){var l=new jd(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,o)}var c=new Ud(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=dl().getBool("WEBGL_PACK_NORMALIZATION")?new Ym(e.shape,t,n,r,i):new Zm(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new $m(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return uc(e)}));return Cd(Xp(e.shape,e.dtype,n),t)}var r=new Nv(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=dl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ov(e.shape,t,n):new av(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=dl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Iv(e.shape,t):new Dv(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new Sm(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){Al(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=kf(e.shape,t,r),a=Ef(i.length,t.length),o=_f(e.shape,t,r),s=Af(n,t.length),u=Sf(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Al(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=kf(o.shape,t,r,!1),u=Ef(s.length,t.length,!1),l=_f(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(l)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=If(i),o=new lv({windowSize:a,inSize:i,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=If(i),o=new Sd({windowSize:a,inSize:i,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(o,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=If(r[r.length-1]),a=new zd(r,i,t,null==n),o=this.compileAndRun(a,null==n?[e]:[e,n],"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o},t.prototype.sum=function(e,t){ap("sum",t,e.rank);var n=rp(e.shape,t),r=n[0],i=Il(n[1]),a=e.as2D(-1,i),o=Ic(e.dtype);return this.reduce(a,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=rp(e.shape,t),r=n[0],i=Il(n[1]),a=e.as2D(-1,i),o=Ic(e.dtype);return this.reduce(a,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=op([r],e.rank),a=e;null!=i&&(a=e.transpose(i),r=up(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)r.push(a!==t?e[a]:n);return r}(a.shape,r,n),s=Il([a.shape[r]]),u=a.as2D(-1,s),l=Ic(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(o);return null!=i&&(c=c.transpose(sp(i))),c},t.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=Df?(n=e,r=!0):n=Jl(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Jl(e,n+1);return n}(o,i),u=new bv({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),l=this.compileAndRun(u,[e,n],r);return l.shape[1]===i?l:(n=Sp(0,i).tile([o/s]),this.segOpCompute(l,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(ap("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!dl().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=rp(e.shape,r),a=i[0],o=Il(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new mm(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Qd("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Qd("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Qd("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Qd("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Qd("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Qd("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new Tv(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Qd("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Qd("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new wv(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Dc(t.dtype,n.dtype))},t.prototype.where=function(e){Zh("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Ed(e.shape,t)},t.prototype.topk=function(e,t,n){return kd(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){ap("min",t,e.rank);var n=rp(e.shape,t),r=n[0],i=Il(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Qd("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Qd("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);ap("max",t,e.rank);var n=rp(e.shape,t),r=n[0],i=Il(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Qd("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){ap("all",t,e.rank);var n=rp(e.shape,t),r=n[0],i=Il(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){ap("any",t,e.rank);var n=rp(e.shape,t),r=n[0],i=Il(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.squaredDifference=function(e,t){var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("return (a - b) * (a - b);",e.shape,t.shape):new Qd("return (a - b) * (a - b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.realDivide=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Qd("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Qd("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Gd);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Dc(e.dtype,t.dtype);if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Gd,n);var r=new Qd(Gd,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new Xv(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new $d(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,o),l=new Qd(n,e.shape,t.shape);return r.compileAndRun(l,[s,u],Dc(a.dtype,o.dtype))})),s=o[0],u=o[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>dl().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return Dc(e,t)})),a=e.map((function(e){return e.shape})),o=dl().getBool("WEBGL_PACK")?new Ad(e[0].shape,a):new _d(e[0].shape,a);return this.compileAndRun(o,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,qd);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Dc(e.dtype,t.dtype);if(dl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,qd,e.dtype);var r=new Qd(qd,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Qd("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Dc(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,zv,e.dtype);var t=new Tv(e.shape,zv);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Vv,e.dtype);var t=new Tv(e.shape,Vv);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new Tv(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new Tv(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new Tv(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new Tv(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new Tv(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Wv,e.dtype);var t=new Tv(e.shape,Wv);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Uv,e.dtype);var t=new Tv(e.shape,Uv);return this.compileAndRun(t,[e])},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Tv(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new Tv(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new Tv(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Tv(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new Tv(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=dl().getBool("WEBGL_PACK")?new Xv(e.shape,Gv):new Tv(e.shape,Mv),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=dl().getBool("WEBGL_PACK")?new Xv(e.shape,qv):new Tv(e.shape,Lv),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d(Zd,e.shape,t.shape):new Qd(Xd,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Kv,e.dtype);var t=new Tv(e.shape,Bv);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Qd("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new Tv(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new Tv(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=dl().getBool("WEBGL_PACK_CLIP")?new Jd(e.shape):new Yd(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(dl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Fv,e.dtype);var t=new Tv(e.shape,Fv);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new em(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new Tv(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new Tv(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new Tv(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $d("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Qd("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new Tv(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new Tv(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new Tv(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new Tv(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new Tv(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new Tv(e.shape,function(e){return void 0===e&&(e=0),Rv+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,a){var o=e.shape,s=this.texData.get(e.dataId),u="channelsLast"===n.dataFormat,l=o[2]%2!=0&&!!s.isPacked;if((1==o[0]*o[1]*o[2]||1===n.outChannels)&&n.inChannels>1e3||!dl().getBool("WEBGL_LAZILY_UNPACK")||!dl().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var c=this.reshape(e,[1,u?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],n.inChannels]),h=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:c,b:h,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),n.outShape)}var p={dataId:e.dataId,shape:[1,u?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),n.inChannels],dtype:e.dtype},f=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,Al(Oh(s.shape,p.shape),(function(){return"packed reshape "+s.shape+" to "+p.shape+" isn't free"}));var d=this.reshape(t,[1,n.inChannels,n.outChannels]),m=this.fusedBatchMatMul({a:p,b:d,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),v=this.texData.get(m.dataId);return Al(v.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=f,v.shape=n.outShape,Pc.makeTensorFromDataId(m.dataId,n.outShape,m.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,a){var o=n.outWidth,s=n.outHeight,u="channelsLast"===n.dataFormat,l=n.filterWidth*n.filterHeight*n.inChannels,c=s*o,h=[l,c],p=e.squeeze([0]),f=t.reshape([1,l,-1]),d=new Qm(h,p.shape,n),m=this.compileAndRun(d,[p]).reshape([1,h[0],h[1]]),v=null!=r,g=null!=a,y=i?$v(i,!0):null,b=new tv(m.shape,[1,c,n.outChannels],!0,!1,v,y,g),w=[m,f];return r&&w.push(r),g&&w.push(a),this.compileAndRun(b,w).reshape(u?[1,s,o,n.outChannels]:[1,n.outChannels,s,o])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,a,o);if(dl().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,a,o);var s=null!=i,u=null!=o,l=a?$v(a,!1):null,c=new cm(r,s,l,u),h=[t,n];return i&&h.push(i),o&&h.push(o),this.compileAndRun(c,h)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(dl().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new cm(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new am(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new im(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=dl().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,l=o?$v(o,u):null,c=[n,r],h=null!=a,p=null!=s;return h&&c.push(a),p&&c.push(s),u?(t=new fm(i,h,l,p),this.compileAndRun(t,c)):(t=new pm(i,h,l,p),this.compileAndRun(t,c))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return dl().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new fm(n),this.compileAndRun(r,[e,t])):(r=new pm(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new lm(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new um(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new hm(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new sm(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new om(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new sv(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new sv(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new sv(r,"max",!0),a=this.compileAndRun(i,[t]),o=new Jm(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new Vd(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return od(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new uv(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new Wd(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new uv(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new uv(r,"max",!0),a=this.compileAndRun(i,[t]),o=new ev(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!Oh(e.shape,t)&&(null===n.texture||!Oh(n.shape,t))){var r=this.packedReshape(e,t);return Pc.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return sd(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=dl().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new fv(e.shape,t,n,r):new pv(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new hv(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new mv(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new dv(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:Vf(e),a=new nv(i.shape[0],i.shape[1],n),o=a.getCustomSetupFunc(r);return this.compileAndRun(a,[i],"int32",o)},t.prototype.oneHot=function(e,t,n,r){var i=new rv(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new wm(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return Zh("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),md(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new dm(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){Al(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i=("NHWC"===n?e.shape[1]:e.shape[2])*t,a=("NHWC"===n?e.shape[2]:e.shape[3])*t,o=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),s=new bm("NHWC"===n?[r,i,a,o]:[r,o,i,a],t,n);return this.compileAndRun(s,[e])},t.prototype.split=function(e,t,n){return xd(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=Tf(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/o,o],c=e.reshape([a,i]),h=t.reshape([a,o]);if(0===u)return sd(mp([]),n);var p=gp(0),f=new yv(a,i,c.rank,h.rank,s,l);return this.compileAndRun(f,[h,c,p]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=Tf(0,e,n),a=new yv(i.numUpdates,i.sliceRank,e.rank,t.rank,i.strides,[i.outputSize,1],!1);return this.compileAndRun(a,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new _m("return real * expR - imag * expI;",e.shape,t),i=new _m("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Nf(e,t),a=i[0],o=i[1],s=i[2],u=i[3],l=t.reshape([o,r]),c=e.reshape([e.size/s,s]),h=new Nm(r,u,[o,s]);return this.compileAndRun(h,[c,l]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||$l(t))){var r=Wl(n,Il(e));return r.fill(t),Pc.makeTensor(r,e,n,this)}var i=new Am(e,t),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return ud(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return Pc.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Qv(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new iv(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Nh(e.shape)].concat(Dh(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[Nh(t)].concat(Dh(t)),a=new cv(i,n),o=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=Ih(i);return t=r?new ym(o):new gm(o),{dtype:a,shape:i,dataId:this.runWebGLProgram(t,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var a=this;void 0===i&&(i=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Wc.DENSE){var u=Qc(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Il(o.shape))return s.values=Vl(o.dtype,0),o;var l=[],c=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Il(t.shape)<=dl().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Oh(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var h,p={shape:o.shape,texData:s,isUniform:!1},f=function(e,t,n){var r="";return t.concat(n).forEach((function(e){r+=e.shape+"_"+(e.isUniform?"uniform":e.texData.texShape)+"_"+(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)})),e.constructor.name+"_"+r+"_"+e.userCode}(e,c,p),d=this.getAndSaveBinary(f,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=function(e,t,n,r){var i=[];e.forEach((function(e){var t=Il(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";return r+=n?function e(t){var n;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+Id().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=Id();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=Id();if(null!=i&&Tl(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){var s=Bd(t,n.slice(1));return"\n        "+e(s)+"\n        vec4 "+i+"(int b, int row, int col) {\n          return "+i+"("+Pd(["b","row","col"],[1,2])+");\n        }\n      "}var u=o[0],l=o[1],c=Math.ceil(n[2]/2);return"\n    vec4 "+i+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+l+", "+c*Math.ceil(n[1]/2)+", "+c+", b, row, col);\n      return "+Id().texture2D+"("+r+", uv);\n    }\n  "}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],u=o[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),h="int b, int row, int col",p="b * "+c+" + (row / 2) * "+l+" + (col / 2)",f=2;f<n-1;f++)h="int b"+f+", "+h,p="b"+f+" * "+(c*=t[n-f-1])+" + "+p;return"\n    vec4 "+i+"("+h+") {\n      int index = "+p+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Id().texture2D+"("+r+", uv);\n    }\n  "}(t)}}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+Fd(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Md(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=Fd(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape;if(null!=a&&Tl(n,a))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+a[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var o=zl(n),s=o.newShape,u=o.keptDims;if(s.length<n.length){var l=Bd(t,s);return"\n      "+e(l)+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+Pd(["row","col"],u)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+Md(t)+"\n      }\n    ";var c=a[0],h=a[1],p=Fd(r);return 1===h?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===c?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+c+", "+h+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[1]*n[2],o=n[2],s=zl(n),u=s.newShape,l=s.keptDims;if(u.length<n.length){var c=Bd(t,u);return"\n        "+e(c)+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+Pd(["row","col","depth"],l)+");\n        }\n      "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+o+", 1)));\n        "+Md(t)+"\n      }\n    ";var h=t.shapeInfo.texShape,p=h[0],f=h[1],d=t.shapeInfo.flatOffset;return f===a&&null==d?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+o+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+p+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":f===o&&null==d?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+p+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+o+" + depth + "+Fd(r)+";\n        vec2 uv = uvFromFlat("+p+", "+f+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[3],o=n[2]*a,s=n[1]*o,u=zl(n),l=u.newShape,c=u.keptDims;if(l.length<n.length){var h=Bd(t,l);return"\n      "+e(h)+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+Pd(["row","col","depth","depth2"],c)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+o+", "+a+", 1)));\n        "+Md(t)+"\n      }\n    ";var p=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,d=f[0],m=f[1];return m===s&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+o+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===a&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+m+", index + "+Fd(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[4],o=n[3]*a,s=n[2]*o,u=n[1]*s,l=zl(n),c=l.newShape,h=l.keptDims;if(c.length<n.length){var p=Bd(t,c);return"\n      "+e(p)+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+Pd(["row","col","depth","depth2","depth3"],h)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+o+", "+a+")) +\n          depth3;\n        "+Md(t)+"\n      }\n    ";var f=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,m=d[0],v=d[1];return v===u&&null==f?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+o+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===a&&null==f?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+o+" +\n          depth2 * "+a+" + depth3 + "+Fd(r)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=zl(n),o=a.newShape,s=a.keptDims;if(o.length<n.length){var u=Bd(t,o);return"\n      "+e(u)+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+Pd(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var l=n[5],c=n[4]*l,h=n[3]*c,p=n[2]*h,f=n[1]*p;if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+p+", "+h+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+Md(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],g=m[1];return g===f&&null==d?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+p+", "+h+", "+c+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===l&&null==d?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+p+" + depth * "+h+" +\n          depth2 * "+c+" + depth3 * "+l+" + depth4 + "+Fd(r)+";\n      vec2 uv = uvFromFlat("+v+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(r+=n?function(e,t){var n,r,i=e.name,a=i.charAt(0).toUpperCase()+i.slice(1),o="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,l=Gf(e.shapeInfo.logicalShape,t.logicalShape),c=Ld(u),h=u-s,p=["x","y","z","w","u","v"];n=0===s?"":u<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords."+p[e+h]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+p[t+h]})).join(", ");var f="return outputValue;",d=1===Il(e.shapeInfo.logicalShape),m=1===Il(t.logicalShape);if(1!==s||d||m){if(d&&!m)f=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){var v=s-2,g=s-1;l.indexOf(v)>-1&&l.indexOf(g)>-1?f="return vec4(outputValue.x);":l.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+r+");\n      "+f+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=e.shapeInfo.logicalShape.length,o=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===o&&null==e.shapeInfo.flatOffset&&Tl(e.shapeInfo.texShape,t.texShape))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var s=Ld(o),u=Gf(e.shapeInfo.logicalShape,t.logicalShape),l=o-a,c=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+s+" coords = getOutputCoords();\n      "+(0===a?"":o<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords."+c[e+l]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(o<2&&a>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+c[t+l]})).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),l=t.texShape,c=Id(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),p=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Tl(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",u=2;u<e.length-1;u++)o="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+o,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,l),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Tl(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=Td(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Td(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Td(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Td(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(p+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[p,h,o,s,a,u,n].join("\n")}(a,s,i,t.packedInputs),l=e.createProgram(u),c=null,h=e.getUniformLocation(l,"NAN",!1);1===dl().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var p={},f=0;f<t.variableNames.length;f++){var d=t.variableNames[f];p[d]=e.getUniformLocation(l,d,!1),p["offset"+d]=e.getUniformLocation(l,"offset"+d,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:p,inShapeInfos:o,outShapeInfo:s,infLoc:c,nanLoc:h}}(a.gpgpu,e,c,p)})),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(e,t,n,r,i){Xm(t.inShapeInfos,n),Xm([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===dl().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(Il(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,d,c,p,r),l.forEach((function(e){return a.disposeData(e.dataId)})),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!dl().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var v=this.unpackTensor(o);return this.disposeData(o.dataId),v}return o},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1);var a=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,i);return Pc.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(dl().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Kh((function(){if(!dl().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=dl().getBool("DEBUG");dl().set("DEBUG",!1);var n=e.abs(gp(1e-8)).dataSync()[0];if(dl().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.usage,s=n.isPacked;if(null==n.texture){var u,l=null!=this.activeTimers;l&&(u=ac());var c=n.texShape;if(null==c&&(c=Th(r,s),n.texShape=c),null!=a){var h=Ih(r),p=void 0,f=c[1],d=c[0],m=a instanceof Uint8Array;s?(f=(t=Zc(c[0],c[1]))[0],p=new Em(h,[d=t[1],f],m)):p=new km(h,[d,f],m);var v=this.makeTensorInfo([d,f],i);this.texData.get(v.dataId).usage=m?Uc.PIXELS:Uc.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),f,d,a);var g=this.runWebGLProgram(p,[v],i,null,!0),y=this.texData.get(g.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(v.dataId),this.texData.delete(g.dataId),n.values=null,l&&(this.uploadWaitMs+=ac()-u)}else{var b=this.acquireTexture(c,o,i,s);n.texture=b}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*ql(t)},t}(jf);zc()&&Pc.registerBackend("webgl",(function(){return new Jv}),2),function(e){var t=e.kernelName;gl.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),gl.set(t,e)}({kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}});var eg=hp({square_:function(e){var t=Jh(e,"x","square");return Pc.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},[t],[])}}),tg=hp({abs_:function(e){var t=Jh(e,"x","abs");return"complex64"===t.dtype?Pc.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):Pc.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),ng=hp({acos_:function(e){var t=Jh(e,"x","acos");return Pc.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(gp(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),rg=hp({acosh_:function(e){var t=Jh(e,"x","acosh");return Pc.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),ig=hp({asin_:function(e){var t=Jh(e,"x","asin");return Pc.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(gp(1).sub(n.toFloat().square()).sqrt())}}}))}}),ag=hp({asinh_:function(e){var t=Jh(e,"x","asinh");return Pc.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(gp(1).add(n.toFloat().square()).sqrt())}}}))}}),og=hp({atan_:function(e){var t=Jh(e,"x","atan");return Pc.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),sg=hp({atanh_:function(e){var t=Jh(e,"x","atanh");return Pc.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(gp(1).sub(n.toFloat().square()))}}}))}}),ug=hp({ceil_:function(e){var t=Jh(e,"x","ceil");return Pc.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),lg=hp({clipByValue_:function(e,t,n){var r=Jh(e,"x","clipByValue");return Al(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."})),Pc.runKernelFunc((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),Dp(e))}}}),"ClipByValue",{min:t,max:n},[r])}}),cg=hp({cos_:function(e){var t=Jh(e,"x","cos");return Pc.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},[t])}}),hg=hp({cosh_:function(e){var t=Jh(e,"x","cosh");return Pc.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),pg=hp({erf_:function(e){var t=Jh(e,"x","erf");return Al("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),Pc.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),fg=hp({exp_:function(e){var t=Jh(e,"x","exp");return Pc.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),dg=hp({expm1_:function(e){var t=Jh(e,"x","expm1");return Pc.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),mg=hp({floor_:function(e){var t=Jh(e,"x","floor");return Pc.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),vg=hp({log_:function(e){var t=Jh(e,"x","log");return Pc.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},[t])}}),gg=hp({log1p_:function(e){var t=Jh(e,"x","log1p");return Pc.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),yg=hp({logSigmoid_:function(e){var t=Jh(e,"x","logSigmoid");return Pc.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),bg=hp({neg_:function(e){var t=Jh(e,"x","neg");return Pc.runKernelFunc((function(e){return e.neg(t)}),{$x:t},(function(e){return{$x:function(){return e.neg()}}}))}}),wg=hp({reciprocal_:function(e){var t=Jh(e,"x","reciprocal");return Pc.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),xg=hp({round_:function(e){var t=Jh(e,"x","round");return Pc.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),Cg=hp({rsqrt_:function(e){var t=Jh(e,"x","rsqrt");return Pc.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},[t])}}),kg=hp({sigmoid_:function(e){var t=Jh(e,"x","sigmoid");return Pc.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(gp(1).sub(n)))}}}),"Sigmoid")}}),Eg=hp({sign_:function(e){var t=Jh(e,"x","sign");return Pc.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),_g=hp({isNaN_:function(e){var t=Jh(e,"x","isNaN");return Pc.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),Ag=hp({isInf_:function(e){var t=Jh(e,"x","isInf");return Pc.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),Sg=hp({isFinite_:function(e){var t=Jh(e,"x","isFinite");return Pc.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return Dp(e)}}}))}}),Ng=hp({sin_:function(e){var t=Jh(e,"x","sin");return Pc.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},[t])}}),Dg=hp({sinh_:function(e){var t=Jh(e,"x","sinh");return Pc.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),Ig=hp({softplus_:function(e){var t=Jh(e,"x","softplus");return Pc.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),Tg=hp({sqrt_:function(e){var t=Jh(e,"x","sqrt");return Pc.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),Rg=hp({step_:function(e,t){void 0===t&&(t=0);var n=Jh(e,"x","step");return Pc.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return Dp(e)}}}))}}),Og=hp({tan_:function(e){var t=Jh(e,"x","tan");return Pc.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),Fg=hp({tanh_:function(e){var t=Jh(e,"x","tanh");return Pc.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return gp(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function Mg(e,t,n,r,i,a){var o,s,u=Jh(e,"x","batchNorm"),l=Jh(t,"mean","batchNorm"),c=Jh(n,"variance","batchNorm");return null!=i&&(o=Jh(i,"scale","batchNorm")),null!=r&&(s=Jh(r,"offset","batchNorm")),Al(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),Al(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."})),Al(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."})),null!=o&&Al(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&Al(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Pg(u,l,c,s,o,a)}function Lg(e,t,n,r,i,a){var o,s,u=Jh(e,"x","batchNorm"),l=Jh(t,"mean","batchNorm"),c=Jh(n,"variance","batchNorm");return null!=i&&(o=Jh(i,"scale","batchNorm")),null!=r&&(s=Jh(r,"offset","batchNorm")),Al(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),Al(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."})),Al(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."})),null!=o&&Al(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&Al(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Pg(u,l,c,s,o,a)}function Bg(e,t,n,r,i,a){var o,s,u=Jh(e,"x","batchNorm"),l=Jh(t,"mean","batchNorm"),c=Jh(n,"variance","batchNorm");return null!=i&&(o=Jh(i,"scale","batchNorm")),null!=r&&(s=Jh(r,"offset","batchNorm")),Al(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),Al(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."})),Al(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."})),null!=o&&Al(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&Al(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Pg(u,l,c,s,o,a)}function Pg(e,t,n,r,i,a){null==a&&(a=.001);var o,s,u,l=Jh(e,"x","batchNorm"),c=Jh(t,"mean","batchNorm"),h=Jh(n,"variance","batchNorm");return null!=i&&(o=Jh(i,"scale","batchNorm")),null!=r&&(s=Jh(r,"offset","batchNorm")),Al(c.rank===h.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Al(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Al(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,Pc.runKernelFunc((function(e,t){var n=e.batchNormalization(u,zg(c),zg(h),a,zg(o),zg(s));return t([l,c,h,o]),n}),{x:l,mean:c,variance:h,scale:o,offset:s},(function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=null==o?gp(1):o,l=qf(r.shape,u.shape),c=[];if(1===r.rank){for(var h=0;h<u.shape.length-1;++h)c.push(u.shape[h]);c.push(1)}var p=n.sub(r),f=e.mul(s),d=Cg(i.add(gp(a))),m=d.mul(d).mul(d).mul(gp(-.5));return{x:function(){return 1===r.rank?e.mul(bf(d.as4D(1,1,1,r.shape[0]),c)).mul(s).reshape(n.shape):e.mul(d).mul(s).reshape(n.shape)},mean:function(){var e=d.mul(gp(-1)).mul(f);return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)},variance:function(){var e=m.mul(p).mul(f);return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)},scale:function(){var t=p.mul(d),n=e.mul(t);return 1===r.rank&&(n=n.sum(l)),n.reshape(r.shape)},offset:function(){var t=e;return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)}}}),"BatchNormalization",{varianceEpsilon:a},[l,c,h,o]).reshape(l.shape)}function zg(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Vg(){Gh("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Wg=hp({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Vg(),Mg(e,t,n,a,i,r)}}),Ug=hp({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Vg(),Lg(e,t,n,a,i,r)}}),jg=hp({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Vg(),Bg(e,t,n,a,i,r)}}),Hg=hp({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Vg(),Pg(e,t,n,a,i,r)}}),Gg=hp({batchNorm_:Pg}),qg=hp({batchNorm2d_:Mg}),Kg=hp({batchNorm3d_:Lg}),Xg=hp({batchNorm4d_:Bg}),Qg=hp({logicalAnd_:function(e,t){var n=Jh(e,"a","logicalAnd","bool"),r=Jh(t,"b","logicalAnd","bool");return Kf(n.shape,r.shape),Pc.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),Zg=hp({logicalNot_:function(e){var t=Jh(e,"x","logicalNot","bool");return Pc.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),$g=hp({logicalOr_:function(e,t){var n=Jh(e,"a","logicalOr","bool"),r=Jh(t,"b","logicalOr","bool");return Kf(n.shape,r.shape),Pc.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),Yg=hp({logicalXor_:function(e,t){var n=Jh(e,"a","logicalXor","bool"),r=Jh(t,"b","logicalXor","bool");return Kf(n.shape,r.shape),$g(e,t).logicalAnd(Qg(e,t).logicalNot())}}),Jg=hp({where_:function(e,t,n){var r=Jh(t,"a","where"),i=Jh(n,"b","where"),a=Jh(e,"condition","where","bool");return Sl(r.shape,i.shape,"Error in where: "),1===a.rank?Al(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):Sl(a.shape,i.shape,"Error in where: "),Pc.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return Dp(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),ey=function(e){return cl(this,void 0,void 0,(function(){var t,n,r;return hl(this,(function(i){switch(i.label){case 0:return[4,(t=Jh(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=Ed(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},ty=hp({add_:function(e,t){var n,r=Jh(e,"a","add"),i=Jh(t,"b","add");n=Tc(r,i);var a=Kf((r=n[0]).shape,(i=n[1]).shape);return Pc.runKernelFunc((function(e){return e.add(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=qf(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=qf(i.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(i.shape)}}}),"Add")}}),ny=hp({addN_:function(e){Al(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),Al(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return Jh(e,"tensors"+t,"addN")})),n=t[0];return t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!Tl(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),Pc.runKernelFunc((function(e){return e.addN(t)}),t,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),ry=hp({addStrict_:function(e,t){var n=Jh(e,"a","addStrict"),r=Jh(t,"b","addStrict");return Sl(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),iy=hp({atan2_:function(e,t){var n,r=Jh(e,"a","atan2"),i=Jh(t,"b","atan2");n=Tc(r,i);var a=Kf((r=n[0]).shape,(i=n[1]).shape);return Pc.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=ty(n.square(),r.square()),i=e.mul(r.div(t)),o=qf(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=ty(n.square(),r.square()),i=bg(e.mul(n.div(t))),o=qf(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),ay=hp({div_:function(e,t){var n,r=Jh(e,"a","div"),i=Jh(t,"b","div");if(n=Tc(r,i),i=n[1],"int32"===(r=n[0]).dtype&&"int32"===i.dtype)return uy(r,i);var a=Kf(r.shape,i.shape);return Pc.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=qf(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=qf(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"Div")}}),oy=hp({divNoNan_:function(e,t){var n,r=Jh(e,"a","div"),i=Jh(t,"b","div");r=(n=Tc(r,i))[0];var a=ay(r,i=n[1]),o=Dp(a),s=i.equal(o);return Jg(s,o,a)}}),sy=hp({divStrict_:function(e,t){var n=Jh(e,"a","div"),r=Jh(t,"b","div");return Sl(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),uy=hp({floorDiv_:function(e,t){var n,r=Jh(e,"a","floorDiv"),i=Jh(t,"b","floorDiv");n=Tc(r,i);var a=Kf((r=n[0]).shape,(i=n[1]).shape);return Pc.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=qf(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=qf(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),ly=hp({maximum_:function(e,t){var n,r=Jh(e,"a","maximum"),i=Jh(t,"b","maximum");return n=Tc(r,i),i=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),i=i.toInt()),Kf(r.shape,i.shape),Pc.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),cy=hp({maximumStrict_:function(e,t){var n=Jh(e,"a","maximumStrict"),r=Jh(t,"b","maximumStrict");return Sl(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),hy=hp({minimum_:function(e,t){var n,r=Jh(e,"a","minimum"),i=Jh(t,"b","minimum");return n=Tc(r,i),i=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),i=i.toInt()),Kf(r.shape,i.shape),Pc.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),py=hp({minimumStrict_:function(e,t){var n=Jh(e,"a","minimumStrict"),r=Jh(t,"b","minimumStrict");return Sl(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),fy=hp({mod_:function(e,t){var n,r=Jh(e,"a","mod"),i=Jh(t,"b","mod");n=Tc(r,i);var a=Kf((r=n[0]).shape,(i=n[1]).shape);return Pc.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=qf(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=qf(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),dy=hp({modStrict_:function(e,t){var n=Jh(e,"a","modStrict"),r=Jh(t,"b","modStrict");return Sl(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),my=hp({mul_:function(e,t){var n,r=Jh(e,"a","mul"),i=Jh(t,"b","mul");n=Tc(r,i);var a=Kf((r=n[0]).shape,(i=n[1]).shape);return Pc.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=qf(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=qf(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),vy=hp({mulStrict_:function(e,t){var n=Jh(e,"a","mul"),r=Jh(t,"b","mul");return Sl(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),gy=hp({pow_:function(e,t){var n=Jh(e,"base","pow"),r=Jh(t,"exp","pow"),i=Kf(n.shape,r.shape);return e=n.cast(Dc(n.dtype,r.dtype)),t=r.cast(Dc(n.dtype,r.dtype)),Pc.runKernelFunc((function(e,t){var i=e.pow(n,r);return t([n,r,i]),i}),{$base:n,$exp:r},(function(e,t){var n=t[0],r=t[1],a=t[2];return{$base:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(gp(1))))),o=qf(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},$exp:function(){var t=n.greater(0),o=n.log().where(t,Dp(n)),s=e.mul(a.mul(o)),u=qf(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}))}}),yy=hp({powStrict_:function(e,t){return Sl(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),by=hp({squaredDifference_:function(e,t){var n,r=Jh(e,"a","squaredDifference"),i=Jh(t,"b","squaredDifference");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1],i=gp(2);return{$a:function(){return e.mul(n.sub(r).mul(i))},$b:function(){return e.mul(r.sub(n).mul(i))}}}))}}),wy=hp({squaredDifferenceStrict_:function(e,t){var n=Jh(e,"a","squaredDifferenceStrict"),r=Jh(t,"b","squaredDifferenceStrict");return Sl(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),xy=hp({sub_:function(e,t){var n,r=Jh(e,"a","sub"),i=Jh(t,"b","sub");n=Tc(r,i);var a=Kf((r=n[0]).shape,(i=n[1]).shape);return Pc.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=qf(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=qf(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),Cy=hp({subStrict_:function(e,t){var n=Jh(e,"a","subStrict"),r=Jh(t,"b","subStrict");return Sl(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),ky=hp({equal_:function(e,t){var n,r=Jh(e,"a","equal"),i=Jh(t,"b","equal");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),Ey=hp({equalStrict_:function(e,t){var n=Jh(e,"a","equalStrict"),r=Jh(t,"b","equalStrict");return Sl(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),_y=hp({greater_:function(e,t){var n,r=Jh(e,"a","greater"),i=Jh(t,"b","greater");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),Ay=hp({greaterEqual_:function(e,t){var n,r=Jh(e,"a","greaterEqual"),i=Jh(t,"b","greaterEqual");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return Dp(n)},b:function(){return Dp(r)}}}),"GreaterEqual")}}),Sy=hp({greaterEqualStrict_:function(e,t){var n=Jh(e,"a","greaterEqualStrict"),r=Jh(t,"b","greaterEqualStrict");return Sl(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Ny=hp({greaterStrict_:function(e,t){var n=Jh(e,"a","greaterStrict"),r=Jh(t,"b","greaterStrict");return Sl(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Dy=hp({less_:function(e,t){var n,r=Jh(e,"a","less"),i=Jh(t,"b","less");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),Iy=hp({lessEqual_:function(e,t){var n,r=Jh(e,"a","lessEqual"),i=Jh(t,"b","lessEqual");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),Ty=hp({lessEqualStrict_:function(e,t){var n=Jh(e,"a","lessEqualStrict"),r=Jh(t,"b","lessEqualStrict");return Sl(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Ry=hp({lessStrict_:function(e,t){var n=Jh(e,"a","lessStrict"),r=Jh(t,"b","lessStrict");return Sl(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Oy=hp({notEqual_:function(e,t){var n,r=Jh(e,"a","notEqual"),i=Jh(t,"b","notEqual");return n=Tc(r,i),Kf((r=n[0]).shape,(i=n[1]).shape),Pc.runKernelFunc((function(e){return e.notEqual(r,i)}),{$a:r,$b:i})}}),Fy=hp({notEqualStrict_:function(e,t){var n=Jh(e,"a","notEqualStrict"),r=Jh(t,"b","notEqualStrict");return Sl(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function My(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ly(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var By=hp({gather_:function(e,t,n){void 0===n&&(n=0);var r=Jh(e,"x","gather"),i=Jh(t,"indices","gather","int32");n=Pl(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return Pc.runKernelFunc((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{$x:r},(function(e,t){var i=t[0];return{$x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),l=u.length,c=My(0,s),h=My(s+1,s+1+l),p=Ly([o,[a],u]),f=e.reshape(p),d=i.reshape([a]),m=Ly([[s],c,h]),v=f.transpose(m),g=Py(v,d,r.shape[n]),y=sp(m);return g.transpose(y)}}})).reshape(a.outputShape)}}),Py=hp({unsortedSegmentSum_:function(e,t,n){var r=Jh(e,"x","unsortedSegmentSum"),i=Jh(t,"segmentIds","unsortedSegmentSum","int32");return Al(Rl(n),(function(){return"numSegments must be of dtype int"})),Pc.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=ly(t,Dp(t)),r=By(e,n),i=Ay(t,gp(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=tf(i,o+1);i=Qg(i,kp(r.shape,"bool"));var s=Dp(r);return Jg(i,r,s)}(e,n)}}}))}});function zy(e,t,n,r,i,a,o){void 0===a&&(a="NHWC"),Al(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,l=!1;3===t.rank&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),Al(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),Al(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),Al(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var c="NHWC"===a?s[3]:s[1],h="NHWC"===a?u.shape[3]:u.shape[1];Al(c===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."})),Al(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&Al(Rl(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var p=ad(a),f=Zf(s,n.shape,r,1,i,o,!1,p),d=Pc.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,f);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return jy(e,n,r,i,a,1,o)},filter:function(){return Gy(e,s,n.shape,r,i,a,o)}}}));return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Vy(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e);return 1===t[0]&&1===t[1]&&1===t[2]}function Wy(e,t,n,r,i){Al(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=o.shape[4];Al(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),Al(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),Al(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),Al(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),Al(l===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."}));var c=$f(a,n.shape,r,1,i),h=Pc.runKernelFunc((function(e){return e.conv3dDerInput(o,n,c)}),{dy5D:o});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Uy=hp({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=Jh(e,"x","conv1d"),u=Jh(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Al(3===l.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."})),Al(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&Al(Rl(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),Al(l.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),Al(id(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),Al("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=jy(p,h,[1,n],r,"NHWC",[1,a],o);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),jy=hp({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=Jh(e,"x","conv2d"),u=Jh(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Al(4===l.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."})),Al(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&Al(Rl(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var h="NHWC"===i?l.shape[3]:l.shape[1];Al(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),Al(id(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var p=ad(i),f=Zf(l.shape,u.shape,n,a,r,o,!1,p),d=Pc.runKernelFunc((function(e,t){var n=e.conv2d(l,u,f);return t([u,l]),n}),{x:l,filter:u},(function(e,t){var o=t[0],s=t[1];return Al(rd(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return qy(s.shape,e,o,n,r,i)},filter:function(){return Gy(s,e,o.shape,n,r,i)}}}),"Conv2D",f,[u,l]);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),Hy=hp({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=Jh(e,"x","conv3d"),s=Jh(t,"filter","conv3d"),u=o,l=!1;4===o.rank&&(l=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),Al(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),Al(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),Al(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),Al(function(e,t){return Vy(e)||Vy(t)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),Al("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var c=$f(u.shape,s.shape,n,a,r),h=Pc.runKernelFunc((function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){Al(Vy(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return Wy(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),Al(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),Al(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),Al(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),Al(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),Al(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=$f(a.shape,n,r,1,i);return Pc.runKernelFunc((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Gy=hp({conv2dDerFilter_:function(e,t,n,r,i,a,o){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Al(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),Al(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),Al(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];Al(l===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."})),Al(c===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."})),null!=o&&Al(Rl(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var h=ad(a),p=Zf(s.shape,n,r,1,i,o,!1,h);return Pc.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,p)}),{x4D:s,dy4D:u})}}),qy=hp({conv2dDerInput_:zy}),Ky=hp({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=Jh(e,"x","depthwiseConv2d"),u=Jh(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Al(4===l.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."})),Al(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),Al(l.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),Al(id(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&Al(Rl(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var h=Zf(l.shape,u.shape,n,a,r,o,!0),p=Pc.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(l,u,h);return t([l,u]),n}),{x:l,filter:u},(function(e,t){Al(rd(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return Xy(n.shape,e,r,h)},filter:function(){return Qy(n,e,r.shape,h)}}}),"DepthwiseConv2dNative",h,[l,u]);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),Xy=hp({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=Pc.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Qy=hp({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Pc.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),Zy=hp({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=Jh(e,"x","separableConv2d"),u=Jh(t,"depthwiseFilter","separableConv2d"),l=Jh(n,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(3===s.rank&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Al(4===c.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."})),Al(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),Al(4===l.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),Al(1===l.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."})),Al(1===l.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."}));var p=u.shape[2],f=u.shape[3];Al(l.shape[2]===p*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*f+", but got "+l.shape[2]+"."}));var d=Ky(c,u,r,i,o,a),m=jy(d,l,1,"valid",o);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),$y=hp({conv2dTranspose_:function(e,t,n,r,i,a){return zy(n,Jh(e,"x","conv2dTranspose"),Jh(t,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),Yy=hp({conv3dTranspose_:function(e,t,n,r,i){return Wy(n,Jh(e,"x","conv3dTranspose"),Jh(t,"filter","conv3dTranspose"),r,i)}}),Jy=hp({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Jh(e,"a","matMul"),o=Jh(t,"b","matMul");i=Tc(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?o.shape[o.rank-2]:o.shape[o.rank-1],h=a.shape.slice(0,-2),p=o.shape.slice(0,-2),f=Il(h),d=Il(p);Al(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),Al(Tl(h,p),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+p+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),Al(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([l,c]),v=n?a.as3D(f,s,l):a.as3D(f,l,s),g=r?o.as3D(d,c,u):o.as3D(d,u,c);return Pc.runKernelFunc((function(e,t){var i=e.batchMatMul(v,g,n,r);return t([v,g]),i}),{a:v,b:g},(function(e,t){var i=t[0],a=t[1];return n||r?!n&&r?{a:function(){return e.matMul(a,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return a.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return a.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(a,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}}),"BatchMatMul",{transposeA:n,transposeB:r}).reshape(m)}}),eb=hp({dot_:function(e,t){var n=Jh(e,"t1","dot"),r=Jh(t,"t2","dot");Al(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return Al(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),tb=hp({outerProduct_:function(e,t){var n=Jh(e,"v1","outerProduct"),r=Jh(t,"v2","outerProduct");return Al(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),nb=hp({reverse_:function(e,t){var n=Jh(e,"x","reverse");if(0===n.rank)return n.clone();var r=Pl(t,n.shape);return Pc.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),rb=hp({reverse1d_:function(e){var t=Jh(e,"x","reverse");return Al(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),nb(t,0)}}),ib=hp({reverse2d_:function(e,t){var n=Jh(e,"x","reverse");return Al(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),nb(n,t)}}),ab=hp({reverse3d_:function(e,t){var n=Jh(e,"x","reverse");return Al(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),nb(n,t)}}),ob=hp({reverse4d_:function(e,t){var n=Jh(e,"x","reverse");return Al(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),nb(n,t)}});function sb(e,t,n,r,i,a){var o=Jh(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),Al(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),Al(id(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&Al(Rl(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var l=Xf(s.shape,t,n,r,i,a);if(1===l.filterWidth&&1===l.filterHeight&&Tl(l.inShape,l.outShape))return o.clone();var c=Pc.runKernelFunc((function(e,t){var n=e.maxPool(s,l);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=Jh(e,"dy","maxPoolBackprop"),l=Jh(t,"input","maxPoolBackprop"),c=Jh(n,"output","maxPoolBackprop");Al(l.rank===u.rank,(function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),Al(id(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),Al(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),Al(4===l.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."}));var h=Xf(l.shape,r,i,a,o,void 0);return Pc.runKernelFunc((function(e){return e.maxPoolBackprop(u,l,c,h)}),{$dy:u,$input:l})}(e,o,s,t,n,r,i)}}}),"MaxPool",l,[s]);return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function ub(e,t,n,r,i,a){var o=Jh(e,"x","avgPool","float32");null==r&&(r=[1,1]),Al(id(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Al(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&Al(Rl(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var l=Xf(s.shape,t,n,r,i,a);if(1===l.filterWidth&&1===l.filterHeight&&Tl(l.inShape,l.outShape))return o.clone();var c=Pc.runKernelFunc((function(e){return e.avgPool(s,l)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=Jh(e,"dy","avgPoolBackprop"),s=Jh(t,"input","avgPoolBackprop");Al(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),Al(id(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var u=s,l=o,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Al(4===l.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."})),Al(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var h=Xf(u.shape,n,r,i,a),p=Pc.runKernelFunc((function(e){return e.avgPoolBackprop(l,u,h)}),{dy4D:l,input4D:u});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}(e,s,t,n,r,i)}}}),"AvgPool",l);return c=c.cast(o.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var lb=hp({maxPool_:function(e,t,n,r,i){return sb(e,t,n,1,r,i)}}),cb=hp({avgPool_:function(e,t,n,r,i){return ub(e,t,n,1,r,i)}}),hb=hp({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=Jh(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Al(id(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var l,c=Xf(s.shape,t,a,i,r),h=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var p=1===h[0]&&1===h[1],f=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([c.inHeight,c.inWidth],h,l),d=f[1],m=p?r:"valid",v=p?s:vf(s,h,f[0]),g=("avg"===n?function(){return ub(v,t,a,1,m)}:function(){return sb(v,t,a,1,m)})(),y=p?g:Qp(g,h,d);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),pb=hp({maxPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=Jh(e,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),Al(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),Al("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),Al(id(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&Al(Rl(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var c=Qf(u.shape,t,n,o,r,i,a),h=Pc.runKernelFunc((function(e,t){var n=e.maxPool3d(u,c);return t([u,n]),n}),{x:u},(function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=Jh(e,"dy","maxPool3dBackprop"),l=Jh(t,"input","maxPool3dBackprop"),c=Jh(n,"output","maxPool3dBackprop"),h=u,p=l,f=c,d=!1;4===l.rank&&(d=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),p=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),Al(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."})),Al(5===p.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."})),Al(5===f.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."})),null==a&&(a=[1,1,1]),Al(id(i,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),null!=s&&Al(Rl(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var m=Qf(p.shape,r,i,a,o,s),v=Pc.runKernelFunc((function(e){return e.maxPool3dBackprop(h,p,f,m)}),{dy5D:h,input5D:p});return d?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(e,s,u,t,n,o,r,i)}}}));return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),fb=hp({avgPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=Jh(e,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),Al(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),Al("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),Al(id(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&Al(Rl(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var c=Qf(u.shape,t,n,o,r,i,a),h=Pc.runKernelFunc((function(e){return e.avgPool3d(u,c)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,i,a,o){var s=Jh(e,"dy","avgPool3dBackprop"),u=Jh(t,"input","avgPool3dBackprop"),l=s,c=u,h=!1;4===u.rank&&(h=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),Al(5===l.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."})),Al(5===c.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."})),null==i&&(i=[1,1,1]),Al(id(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=o&&Al(Rl(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var p=Qf(c.shape,n,r,i,a,o),f=Pc.runKernelFunc((function(e){return e.avgPool3dBackprop(l,c,p)}),{dy5D:l,input5D:c});return h?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(e,u,t,n,o,r,i)}}}));return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),db=hp({slice_:function(e,t,n){var r,i,a=Jh(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){Al(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(Al(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),Rf(a,r,i);var o=a.shape;return Pc.runKernelFunc((function(e){return e.slice(a,r,i)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{x:function(){return e.pad(t)}}}),"Slice",{begin:r,size:i})}}),mb=hp({slice1d_:function(e,t,n){var r=Jh(e,"x","slice1d");return Al(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),db(r,[t],[n])}}),vb=hp({slice2d_:function(e,t,n){var r=Jh(e,"x","slice2d");return Al(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),db(r,t,n)}}),gb=hp({slice3d_:function(e,t,n){var r=Jh(e,"x","slice3d");return Al(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),db(r,t,n)}}),yb=hp({slice4d_:function(e,t,n){var r=Jh(e,"x","slice4d");return Al(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),db(r,t,n)}});function bb(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(ip(t.shape,r))),e.rank<n.rank&&(e=e.reshape(ip(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var wb=hp({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","all","bool"),i=Pl(t,r.shape),a=i,o=op(a,r.rank);null!=o&&(r=r.transpose(o),a=up(a.length,r.rank));var s=Pc.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var u=ip(s.shape,i);return s.reshape(u)}return s}}),xb=hp({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","any","bool"),i=Pl(t,r.shape),a=i,o=op(a,r.rank);null!=o&&(r=r.transpose(o),a=up(a.length,r.rank));var s=Pc.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var u=ip(s.shape,i);return s.reshape(u)}return s}}),Cb=hp({argMax_:function(e,t){void 0===t&&(t=0);var n=Jh(e,"x","argMax");null==t&&(t=0);var r=Pl(t,n.shape),i=op(r,n.rank);return null!=i&&(n=n.transpose(i),r=up(r.length,n.rank)),Pc.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return Dp(n)}}}),"ArgMax",{axis:r[0]},[n])}}),kb=hp({argMin_:function(e,t){void 0===t&&(t=0);var n=Jh(e,"x","argMin");null==t&&(t=0);var r=Pl(t,n.shape),i=op(r,n.rank);return null!=i&&(n=n.transpose(i),r=up(r.length,n.rank)),Pc.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return Dp(n)}}}))}}),Eb=hp({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","logSumExp"),i=Pl(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var u=ip(s.shape,i);return s.reshape(u)}return s}}),_b=hp({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","max"),i=r,a=Pl(t,r.shape),o=a,s=op(o,r.rank);null!=s&&(r=r.transpose(s),o=up(o.length,r.rank));var u=Pc.runKernelFunc((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{x:r},(function(e,t){return bb(e,t[1],t[0],a,s)}),"Max",{axes:o},[r],[!0]);if(n){var l=ip(u.shape,a);u=u.reshape(l)}return u}}),Ab=hp({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","mean"),i=Pl(t,r.shape),a=Il(rp(r.shape,i)[1]);return zf((function(e){var r=gp(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(kp(e.shape,"float32")).div(a)}}}))(r)}}),Sb=hp({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","min"),i=r,a=Pl(t,r.shape),o=a,s=op(o,r.rank);null!=s&&(r=r.transpose(s),o=up(o.length,r.rank));var u=Pc.runKernelFunc((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{x:r},(function(e,t){return bb(e,t[1],t[0],a,s)}),"Min",{axes:o},[r],[!0]);if(n){var l=ip(u.shape,a);u=u.reshape(l)}return u}}),Nb=hp({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Pl(t,(e=Jh(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;n||(a=ip(i.shape,r));var o=e.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(r,n)}}}),Db=hp({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=Pl(t,r.shape);return zf((function(e){var t=op(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=up(r.length,e.rank));var o=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(kp(e.shape,"float32"))},s=Pc.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return o(e)}}}),"Sum",{axes:r});if(n){var u=ip(s.shape,i);s=s.reshape(u)}return{value:s,gradFunc:o}}))(r)}}),Ib=hp({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Jh(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=Pl(t,r.shape),a=op(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=up(o.length,r.rank));var u=Pc.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var l=ip(u.shape,i);u=u.reshape(l)}return u}}),Tb=hp({elu_:function(e){var t=Jh(e,"x","elu");return Pc.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return Pc.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),Rb=hp({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=Jh(e,"x","leakyRelu");return ly(gp(t).mul(n),n)}}),Ob=hp({prelu_:function(e,t){var n=Jh(e,"x","prelu"),r=Jh(t,"alpha","prelu");return Pc.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return Jg(i,e,e.mul(r))},alpha:function(){var t=Jg(i,Dp(e),e.mul(n)),a=qf(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),Fb=hp({relu_:function(e){var t=Jh(e,"x","relu");return"bool"===t.dtype?t.toInt():Pc.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),Mb=hp({relu6_:function(e){var t=Jh(e,"x","relu6");return"bool"===t.dtype?t.toInt():Pc.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),Lb=hp({selu_:function(e){var t=Jh(e,"x","selu");return Pc.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(gp(0)),r=gp(1.7580993408473768),i=gp(1.0507009873554805),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return Jg(t,a,o)}}}))}}),Bb=hp({transpose_:function(e,t){var n=Jh(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),Al(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){Al(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1?n.clone():Pc.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=sp(t);return{x:function(){return e.transpose(n)}}}),"Transpose",{perm:t})}}),Pb=hp({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=Jh(e,"x","localResponseNormalization");Al(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),Al(Rl(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Pc.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return Pc.runKernelFunc((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),zb=hp({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(gp(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Jh(e,"x","norm"),t,n),a=i.shape;if(r){var o=Pl(n,e.shape);a=ip(i.shape,o)}return i.reshape(a)}}),Vb=hp({basicLSTMCell_:function(e,t,n,r,i,a){var o=Jh(e,"forgetBias","basicLSTMCell"),s=Jh(t,"lstmKernel","basicLSTMCell"),u=Jh(n,"lstmBias","basicLSTMCell"),l=Jh(r,"data","basicLSTMCell"),c=Jh(i,"c","basicLSTMCell"),h=Jh(a,"h","basicLSTMCell"),p=l.concat(h,1).matMul(s).add(u),f=p.shape[1]/4,d=[p.shape[0],f],m=p.slice([0,0],d),v=p.slice([0,f],d),g=p.slice([0,2*f],d),y=p.slice([0,3*f],d),b=m.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(o.add(g).sigmoid())),w=b.tanh().mulStrict(y.sigmoid());return[b,w]}}),Wb=hp({multiRNNCell_:function(e,t,n,r){for(var i=Jh(t,"data","multiRNNCell"),a=ep(n,"c","multiRNNCell"),o=ep(r,"h","multiRNNCell"),s=i,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],p=[];for(l=0;l<u.length;l+=2)h.push(u[l]),p.push(u[l+1]);return[h,p]}}),Ub=hp({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=Jh(e,"v","movingAverage"),o=Jh(t,"x","movingAverage"),s=Jh(n,"decay","movingAverage");Rc(a,o),Al(Tl(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=gp(1),l=u.sub(s),c=o.sub(a).mul(l);if(i){Al(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=Jh(r,"step","movingAverage");c=c.div(u.sub(gy(s,h)))}return a.add(c)}}),jb=hp({stridedSlice_:function(e,t,n,r,i,a,o,s,u){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var l=Jh(e,"x","stridedSlice"),c=Of(s),h=l.shape.slice();c.forEach((function(e){t[e]=0,n[e]=1,h.splice(e,0,1)})),l=l.reshape(h);for(var p=0;p<l.rank;p++)t[p]=Mf(i,t,r,l.shape,p),n[p]=Lf(a,n,r,l.shape,p),r[p]=r[p]||1;var f=Of(u);f.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var d=Ff(t,n,r),m=d.filter((function(e,t){return-1===f.indexOf(t)}));return r.every((function(e){return 1===e}))?db(l,t,d).reshape(m):Pc.runKernelFunc((function(e){return e.stridedSlice(l,t,n,r)}),{$x:l}).reshape(m)}}),Hb=hp({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=Jh(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=Pc.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),Gb=hp({scatterND_:function(e,t,n){var r=Jh(e,"indices","scatterND","int32"),i=Jh(t,"updates","scatterND");return function(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}(n,t,e)}(i,r,n),Pc.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{$indices:r,$updates:i})}}),qb=hp({fft_:function(e){Al("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.as2D(e.size/t,t);return Pc.runKernelFunc((function(e){return e.fft(n)}),{input:e}).reshape(e.shape)}}),Kb=hp({ifft_:function(e){Al("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.as2D(e.size/t,t);return Pc.runKernelFunc((function(e){return e.ifft(n)}),{input:e}).reshape(e.shape)}}),Xb=hp({rfft_:function(e,t){Al("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(Ep(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=pp(n,u).as2D(i,r),c=qb(l),h=Math.floor(r/2)+1,p=fp(c),f=dp(c),d=p.split([h,r-h],p.shape.length-1),m=f.split([h,r-h],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=h,pp(d[0],m[0]).reshape(v)}}),Qb=hp({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=Kb(r);return fp(i)}var a=[n,2*(t-1)],o=fp(e).as2D(n,t),s=dp(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(gp(-1)),c=o.concat(u,1),h=s.concat(l,1);return r=pp(c,h).as2D(a[0],a[1]),i=Kb(r),fp(i)}}),Zb=Object.freeze({fft:qb,ifft:Kb,rfft:Xb,irfft:Qb}),$b=hp({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=Jh(e,"sparseIndices","sparseToDense","int32"),a=Jh(t,"sparseValues","sparseToDense"),o=Jh(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");if(0!==t.rank&&(1!==t.rank||t.size!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),Pc.runKernelFunc((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),Yb=hp({gatherND_:function(e,t){var n=Jh(t,"indices","gatherND","int32"),r=Jh(e,"x","gatherND");return Pc.runKernelFunc((function(e){return e.gatherND(r,n)}),{$x:r,$indices:n})}}),Jb=hp({diag_:function(e){var t=Jh(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return Pc.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),ew=hp({dropout_:function(e,t,n,r){var i=Jh(e,"x","dropout");if(Al("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),Al(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof wc?i.clone():i;var a=function(e,t){if(null==t)return e.shape.slice();if(Tl(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(i,n),o=1-t,s=df(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(s)}});function tw(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return yp(i,"float32")}var nw,rw=hp({hannWindow_:function(e){return tw(e,.5,.5)}}),iw=hp({hammingWindow_:function(e){return tw(e,.54,.46)}}),aw=hp({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(db(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=Ip([db(e,a,t-s),_p([s],i)]);o.push(u),a+=n}return 0===o.length?bp([],[0,t]):Ip(o).as2D(o.length,t)}}),ow=hp({stft_:function(e,t,n,r,i){void 0===i&&(i=rw),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var a=aw(e,t,n),o=my(a,i(t)),s=[],u=0;u<a.shape[0];u++)s.push(Xb(o.slice([u,0],[1,t]),r));return Ip(s)}}),sw=Object.freeze({hannWindow:rw,hammingWindow:iw,frame:aw,stft:ow});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(nw||(nw={}));var uw=hp({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=nw.SUM_BY_NONZERO_WEIGHTS);var i=Jh(e,"labels","absoluteDifference"),a=Jh(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Jh(n,"weights","absoluteDifference")),Sl(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return lw(s,o,r)}}),lw=hp({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=nw.SUM_BY_NONZERO_WEIGHTS);var r=Jh(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=Jh(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===nw.NONE)return a;if(n===nw.SUM)return a.sum();if(n===nw.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(gp(o)):s}if(n===nw.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(gp(r.size));var u=i.mul(kp(r.shape)).notEqual(gp(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),cw=hp({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=nw.SUM_BY_NONZERO_WEIGHTS);var a=Jh(e,"labels","cosineDistance"),o=Jh(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Jh(r,"weights","cosineDistance")),Sl(a.shape,o.shape,"Error in cosineDistance: ");var u=gp(1).sub(a.mul(o).sum(n,!0));return lw(u,s,i)}}),hw=hp({hingeLoss_:function(e,t,n,r){void 0===r&&(r=nw.SUM_BY_NONZERO_WEIGHTS);var i=Jh(e,"labels","hingeLoss"),a=Jh(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Jh(n,"weights","hingeLoss")),Sl(i.shape,a.shape,"Error in hingeLoss: ");var s=gp(1);i=gp(2).mul(i).sub(s);var u=s.sub(i.mul(a)).relu();return lw(u,o,r)}}),pw=hp({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=nw.SUM_BY_NONZERO_WEIGHTS);var a=Jh(e,"labels","huberLoss"),o=Jh(t,"predictions","huberLoss"),s=null;null!=n&&(s=Jh(n,"weights","huberLoss")),Sl(a.shape,o.shape,"Error in huberLoss: ");var u=gp(r),l=o.sub(a).abs(),c=hy(l,u),h=l.sub(c),p=gp(.5).mul(c.square()).add(u.mul(h));return lw(p,s,i)}}),fw=hp({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=nw.SUM_BY_NONZERO_WEIGHTS);var a=Jh(e,"labels","logLoss"),o=Jh(t,"predictions","logLoss"),s=null;null!=n&&(s=Jh(n,"weights","logLoss")),Sl(a.shape,o.shape,"Error in logLoss: ");var u=gp(1),l=gp(r),c=a.mul(o.add(l).log()).neg().sub(u.sub(a).mul(u.sub(o).add(l).log()));return lw(c,s,i)}}),dw=hp({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=nw.SUM_BY_NONZERO_WEIGHTS);var i=Jh(e,"labels","meanSquaredError"),a=Jh(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Jh(n,"weights","meanSquaredError")),Sl(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return lw(s,o,r)}}),mw=hp({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=nw.SUM_BY_NONZERO_WEIGHTS);var a=Jh(e,"multiClassLabels","sigmoidCrossEntropy"),o=Jh(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Jh(n,"weights","sigmoidCrossEntropy")),Sl(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=gp(r),l=gp(1),c=gp(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var h=function(e,t){var n=Jh(e,"labels","sigmoidCrossEntropyWithLogits"),r=Jh(t,"logits","sigmoidCrossEntropyWithLogits");Sl(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return lw(h,s,i)}}),vw=hp({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=nw.SUM_BY_NONZERO_WEIGHTS);var a=Jh(e,"onehotLabels","softmaxCrossEntropy"),o=Jh(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Jh(n,"weights","softmaxCrossEntropy")),Sl(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=gp(r),l=gp(1),c=gp(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var h=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return zf((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=ip(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return lw(h,s,i)}}),gw=Object.freeze({get Reduction(){return nw},absoluteDifference:uw,computeWeightedLoss:lw,cosineDistance:cw,hingeLoss:hw,huberLoss:pw,logLoss:fw,meanSquaredError:dw,sigmoidCrossEntropy:mw,softmaxCrossEntropy:vw});function yw(e,t){return void 0===t&&(t=!1),Pc.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=nf(n),a=e.clone(),o=bp([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=i;t=Pc.tidy((function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=bp([[-1]]).where(l.greater(0),bp([[1]])),h=l.sub(c.mul(u)),p=t.div(h);s=1===p.shape[0]?o.clone():o.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var f=c.matMul(h).div(u).neg(),d=a.slice([e,0],[n-e,r]),m=f.mul(s);if(0===e)a=d.sub(m.matMul(s.transpose().matMul(d)));else{var v=d.sub(m.matMul(s.transpose().matMul(d)));a=a.slice([0,0],[e,r]).concat(v,0)}var g=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=g.sub(g.matMul(s).matMul(m.transpose()));else{var y=g.sub(g.matMul(s).matMul(m.transpose()));i=i.slice([0,0],[n,e]).concat(y,1)}return[s,a,i]})),s=t[0],a=t[1],i=t[2],Xh([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var bw=hp({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=Jh(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],s=a[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var u=Sp(0,o,1,"int32").reshape([-1,1]),l=Sp(0,s,1,"int32"),c=xy(u,l),h=Qg(c.lessEqual(gp(+t,"int32")),c.greaterEqual(gp(-n,"int32"))),p=Ep([o,s],r.dtype);return yf(xf(r.reshape([-1,o,s])).map((function(e){return Jg(h,e,p)}))).reshape(i)}}),ww=hp({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,Al(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){Al(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=Mp(e,e.shape[0],0).map((function(e){return gf(e,[0])}));Al(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(Pc.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Db(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(zb(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?yf(a,0):a}}),xw=hp({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return yw(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=xf(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach((function(e){var n=yw(e,t),r=n[1];i.push(n[0]),a.push(r)})),[yf(i,0).reshape(e.shape),yf(a,0).reshape(e.shape)]}}),Cw=Object.freeze({bandPart:bw,gramSchmidt:ww,qr:xw});function kw(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);var o=e.shape[0];return n=Math.min(n,o),Al(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),Al(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),Al(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),Al(1===t.rank,(function(){return"scores must be a 1D tensor"})),Al(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),Al(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var Ew=hp({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=Jh(e,"images","resizeBilinear");Al(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),Al(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=Pc.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{x:i},(function(e,t){return{x:function(){return Pc.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),_w=hp({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=Jh(e,"images","resizeNearestNeighbor");Al(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),Al(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),Al("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=Pc.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return Pc.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Aw=hp({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=Jh(e,"boxes","nonMaxSuppression"),o=Jh(t,"scores","nonMaxSuppression"),s=kw(a,o,n,r,i);return Pc.runKernelFunc((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:i=s.scoreThreshold})}}),Sw=hp({nonMaxSuppressionWithScore_:function(e,t,n,r,i,a){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var o=Jh(e,"boxes","nonMaxSuppression"),s=Jh(t,"scores","nonMaxSuppression"),u=kw(o,s,n,r,i,a),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=Pc.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),Nw=hp({cropAndResize_:function(e,t,n,r,i,a){var o=Jh(e,"image","cropAndResize"),s=Jh(t,"boxes","cropAndResize","float32"),u=Jh(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var l=s.shape[0];return Al(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),Al(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."})),Al(1===u.rank&&u.shape[0]===l,(function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."})),Al(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),Al(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),Al("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),Pc.runKernelFunc((function(e,t){return e.cropAndResize(o,s,u,r,i,a)}),{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),Dw=Object.freeze({resizeBilinear:Ew,resizeNearestNeighbor:_w,nonMaxSuppression:Aw,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),cl(this,void 0,void 0,(function(){var a,o,s,u,l;return hl(this,(function(c){switch(c.label){case 0:return a=Jh(e,"boxes","nonMaxSuppressionAsync"),o=Jh(t,"scores","nonMaxSuppressionAsync"),s=kw(a,o,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return u=c.sent(),l=md(u[0],u[1],n,r,i),a!==e&&a.dispose(),o!==t&&o.dispose(),[2,l]}}))}))},nonMaxSuppressionWithScore:Sw,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,a){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),cl(this,void 0,void 0,(function(){var o,s,u,l,c;return hl(this,(function(h){switch(h.label){case 0:return o=Jh(e,"boxes","nonMaxSuppressionAsync"),s=Jh(t,"scores","nonMaxSuppressionAsync"),u=kw(o,s,n,r,i,a),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=h.sent(),c=vd(l[0],l[1],n,r,i,a),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,c]}}))}))},cropAndResize:Nw}),Iw=function(e,t){return!(e>0)||"linear"===t},Tw=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Rw=function(e,t){var n=t,r=qf(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Ow=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Fb(e);if("elu"===t)return Tb(e);if("relu6"===t)return Mb(e);if("prelu"===t)return Ob(e,n);throw new Error("Unknown fused activation "+t+".")},Fw=hp({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,o=e.transposeB,s=void 0!==o&&o,u=e.bias,l=e.activation,c=void 0===l?"linear":l,h=e.preluActivationWeights;if(!1===Iw(Pc.state.gradientDepth,c)){var p=Jy(n,r,a,s);return null!=u&&(p=ty(p,u)),Ow(p,c,h)}var f=Jh(n,"a","fused matMul"),d=Jh(r,"b","fused matMul");t=Tc(f,d),f=t[0],d=t[1];var m=a?f.shape[f.rank-2]:f.shape[f.rank-1],v=s?d.shape[d.rank-1]:d.shape[d.rank-2],g=a?f.shape[f.rank-1]:f.shape[f.rank-2],y=s?d.shape[d.rank-2]:d.shape[d.rank-1],b=f.shape.slice(0,-2),w=d.shape.slice(0,-2),x=Il(b),C=Il(w);Al(f.rank>=2&&d.rank>=2&&f.rank===d.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+d.rank+"."})),Al(Tl(b,w),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+w+") of Tensors with shapes "+f.shape+" and "+d.shape+" must match."})),Al(m===v,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+f.shape+" and "+d.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var k,E,_=f.shape.slice(0,-2).concat([g,y]),A=a?f.as3D(x,m,g):f.as3D(x,g,m),S=s?d.as3D(C,y,v):d.as3D(C,v,y);null!=u&&Kf(_,(k=Tc(k=Jh(u,"bias","fused matMul"),f)[0]).shape),null!=h&&(E=Jh(h,"prelu weights","fused matMul"));var N={$a:A,$b:S};return null!=u&&(N.$bias=k),null!=h&&(N.$preluActivationWeights=E),Pc.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:A,b:S,transposeA:a,transposeB:s,bias:k,activation:c,preluActivationWeights:E});return t([A,S,n]),n}),N,(function(e,t){var n=t[0],r=t[1],i=Tw(e,t[2],c),o={};return null!=u&&(o={$bias:function(){return Rw(k,i)}}),a||s?!a&&s?Object.assign({$a:function(){return i.matMul(r,!1,!1)},$b:function(){return i.matMul(n,!0,!1)}},o):a&&!s?Object.assign({$a:function(){return r.matMul(i,!1,!0)},$b:function(){return n.matMul(i,!1,!1)}},o):Object.assign({$a:function(){return r.matMul(i,!0,!0)},$b:function(){return i.matMul(n,!0,!0)}},o):Object.assign({$a:function(){return i.matMul(r,!1,!0)},$b:function(){return n.matMul(i,!0,!1)}},o)})).reshape(_)}}),Mw=hp({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,h=e.activation,p=void 0===h?"linear":h,f=e.preluActivationWeights;if(!1===Iw(Pc.state.gradientDepth,p=p||"linear")){var d=jy(t,n,r,i,o,u,l);return null!=c&&(d=ty(d,c)),Ow(d,p,f)}var m=Jh(t,"x","conv2d"),v=Jh(n,"filter","conv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),Al(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),Al(4===v.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."})),null!=l&&Al(Rl(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."})),Al(g.shape[3]===v.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."})),Al(id(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),Al("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var b,w,x=Zf(g.shape,v.shape,r,u,i,l);null!=c&&(b=Tc(b=Jh(c,"bias","fused conv2d"),m)[0],Kf(x.outShape,b.shape)),null!=f&&(w=Jh(f,"prelu weights","fused conv2d"));var C={x:g,filter:v};null!=c&&(C.bias=b),null!=f&&(C.preluActivationWeights=w);var k=Pc.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:g,filter:v,convInfo:x,bias:b,activation:p,preluActivationWeights:w});return t([v,g,n]),n}),C,(function(e,t){var n=t[0],a=t[1],o=Tw(e,t[2],p);Al(rd(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var s={};return null!=c&&(s={bias:function(){return Rw(b,o)}}),Object.assign({x:function(){return qy(a.shape,o,n,r,i)},filter:function(){return Gy(a,o,n.shape,r,i)}},s)}),"FusedConv2D",{convInfo:x,activation:p},[v,g],[!0]);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),Lw=hp({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,h=e.activation,p=void 0===h?"linear":h,f=e.preluActivationWeights;if(!1===Iw(Pc.state.gradientDepth,p)){var d=Ky(t,n,r,i,o,u,l);return null!=c&&(d=ty(d,c)),Ow(d,p,f)}var m=Jh(t,"x","depthwiseConv2d"),v=Jh(n,"filter","depthwiseConv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),Al(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),Al(4===v.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."})),Al(g.shape[3]===v.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."})),null==u&&(u=[1,1]),Al(id(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=l&&Al(Rl(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."}));var b,w,x=Zf(g.shape,v.shape,r,u,i,l,!0);null!=c&&(b=Tc(b=Jh(c,"bias","fused conv2d"),m)[0],Kf(x.outShape,b.shape)),null!=f&&(w=Jh(f,"prelu weights","fused depthwiseConv2d"));var C={x:g,filter:v};null!=c&&(C.bias=b),null!=f&&(C.preluActivationWeights=w);var k=Pc.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:v,convInfo:x,bias:b,activation:p,preluActivationWeights:w});return t([v,g,n]),n}),C,(function(e,t){Al(rd(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],i=Tw(e,t[2],p),a={};return null!=c&&(a={bias:function(){return Rw(b,i)}}),Object.assign({x:function(){return Xy(r.shape,i,n,x)},filter:function(){return Qy(r,i,n.shape,x)}},a)}),"FusedDepthwiseConv2D",{convInfo:x,activation:p},[v,g],[!0]);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),Bw=Object.freeze({matMul:Fw,conv2d:Mw,depthwiseConv2d:Lw}),Pw=Object.freeze({image:Dw,linalg:Cw,losses:gw,spectral:Zb,fused:Bw,signal:sw,square:eg,conv1d:Uy,conv2d:jy,conv3d:Hy,depthwiseConv2d:Ky,separableConv2d:Zy,conv2dTranspose:$y,conv3dTranspose:Yy,op:hp,batchNormalization2d:Wg,batchNormalization3d:Ug,batchNormalization4d:jg,batchNormalization:Hg,batchNorm:Gg,batchNorm2d:qg,batchNorm3d:Kg,batchNorm4d:Xg,booleanMaskAsync:function(e,t,n){return cl(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h,p,f,d,m;return hl(this,(function(v){switch(v.label){case 0:for(r=Jh(e,"tensor","boolMask"),i=Jh(t,"mask","boolMask","bool"),a=null==n?0:n,s=r.shape,Al((o=i.rank)>0,(function(){return"mask cannot be scalar"})),Sl(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+o;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+o)),h=r.reshape(c),p=i.reshape([-1]),[4,ey(p)];case 1:return f=v.sent(),d=f.squeeze([1]),m=By(h,d,a),e!==r&&r.dispose(),t!==i&&i.dispose(),d.dispose(),h.dispose(),p.dispose(),f.dispose(),[2,m]}}))}))},complex:pp,real:fp,imag:dp,concat:Ip,concat1d:Tp,concat2d:Rp,concat3d:Op,concat4d:Fp,split:Mp,matMul:Jy,dot:eb,outerProduct:tb,reverse:nb,reverse1d:rb,reverse2d:ib,reverse3d:ab,reverse4d:ob,maxPool:lb,avgPool:cb,pool:hb,maxPool3d:pb,avgPool3d:fb,slice:db,slice1d:mb,slice2d:vb,slice3d:gb,slice4d:yb,abs:tg,acos:ng,acosh:rg,asin:ig,asinh:ag,atan:og,atanh:sg,ceil:ug,clipByValue:lg,cos:cg,cosh:hg,erf:pg,exp:fg,expm1:dg,floor:mg,log:vg,log1p:gg,logSigmoid:yg,neg:bg,reciprocal:wg,round:xg,rsqrt:Cg,sigmoid:kg,sign:Eg,isNaN:_g,isInf:Ag,isFinite:Sg,sin:Ng,sinh:Dg,softplus:Ig,sqrt:Tg,step:Rg,tan:Og,tanh:Fg,all:wb,any:xb,argMax:Cb,argMin:kb,logSumExp:Eb,max:_b,mean:Ab,min:Sb,moments:Nb,sum:Db,prod:Ib,equal:ky,equalStrict:Ey,greater:_y,greaterEqual:Ay,greaterEqualStrict:Sy,greaterStrict:Ny,less:Dy,lessEqual:Iy,lessEqualStrict:Ty,lessStrict:Ry,notEqual:Oy,notEqualStrict:Fy,add:ty,addN:ny,addStrict:ry,atan2:iy,div:ay,divNoNan:oy,divStrict:sy,floorDiv:uy,maximum:ly,maximumStrict:cy,minimum:hy,minimumStrict:py,mod:fy,modStrict:dy,mul:my,mulStrict:vy,pow:gy,powStrict:yy,squaredDifference:by,squaredDifferenceStrict:wy,sub:xy,subStrict:Cy,elu:Tb,leakyRelu:Rb,prelu:Ob,relu:Fb,relu6:Mb,selu:Lb,logicalAnd:Qg,logicalNot:Zg,logicalOr:$g,logicalXor:Yg,where:Jg,whereAsync:ey,buffer:Xp,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Qp,broadcastTo:Zp,cast:$p,clone:Yp,cumsum:Jp,depthToSpace:ef,expandDims:tf,eye:nf,multinomial:rf,oneHot:af,pad:of,pad1d:sf,pad2d:uf,pad3d:lf,pad4d:cf,rand:hf,randomNormal:pf,randomGamma:ff,randomUniform:df,reshape:mf,spaceToBatchND:vf,squeeze:gf,stack:yf,tile:bf,truncatedNormal:wf,unstack:xf,setdiff1dAsync:Cf,fill:_p,linspace:Ap,ones:kp,range:Sp,scalar:gp,tensor:mp,tensor1d:yp,tensor2d:bp,tensor3d:wp,tensor4d:xp,tensor5d:function(e,t,n){if(Nl(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=$h(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vp(e,t,r,n)},tensor6d:function(e,t,n){if(Nl(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=$h(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return vp(e,t=t||r,r,n)},variable:Cp,zeros:Ep,onesLike:Np,zerosLike:Dp,transpose:Bb,softmax:Vf,logSoftmax:Wf,localResponseNormalization:Pb,norm:zb,gather:By,unsortedSegmentSum:Py,basicLSTMCell:Vb,multiRNNCell:Wb,movingAverage:Ub,stridedSlice:jb,topk:Hb,scatterND:Gb,fft:qb,ifft:Kb,rfft:Xb,irfft:Qb,sparseToDense:$b,gatherND:Yb,diag:Jb,dropout:ew,hannWindow:rw,hammingWindow:iw,frame:aw,stft:ow,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),cl(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h,p,f,d,m,v;return hl(this,(function(g){switch(g.label){case 0:return r=Jh(e,"predictions","inTopK"),i=Jh(t,"targets","inTopK"),Al(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),Al(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),Sl(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],Al(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return o=g.sent(),[4,i.data()];case 2:for(s=g.sent(),c=(u=[o.length/a,a])[1],h=Vl("bool",l=u[0]),p=0;p<l;p++){for(d=o.subarray(f=p*c,f+c),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort((function(e,t){return t.value-e.value})),h[p]=0,v=0;v<n;v++)if(m[v].index===s[p]){h[p]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,mp(h,i.shape,"bool")]}}))}))}});function zw(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Al("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function Vw(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Ww=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Uf(t,Pc),t}return ll(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,dl().get("IS_NODE")&&Zh("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.complexTensors;return"complex64"===t.dtype?ld(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return uc(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Xp(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return Pc.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return cl(this,void 0,void 0,(function(){var t;return hl(this,(function(n){return t=ac(),e(),[2,{kernelMs:ac()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Pc.keep(e.clone()),imag:Pc.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(zw(e,"slice"),Bf(e.shape,t,n)){var r=Pf(t,e.strides),i=Il(n);return mp(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=Xp(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){zw(e,"stridedSlice");var i=Ff(t,n,r);if(i.some((function(e){return 0===e})))return mp([],i);for(var a=Xp(i,e.dtype),o=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[c]*r[c]+t[c];a.set.apply(a,[o.get.apply(o,l)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Xp([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.reverse=function(e,t){zw(e,"reverse");for(var n=Xp(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return fp(e)})),i=e.map((function(e){return dp(e)}));return pp(this.concat(r,t),this.concat(i,t))}var a=e.map((function(e){var n=Il(e.shape.slice(t));return e.as2D(-1,n)})),o=cp(a.map((function(e){return e.shape})),1),s=Xp(o,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var l=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var a=i*o[1]+l,u=0;u<e.shape[1];++u)s[a+u]=t[r++];l+=e.shape[1]}))}var c=cp(e.map((function(e){return e.shape})),t);return mp(s,c,e[0].dtype)},t.prototype.neg=function(e){return zw(e,"neg"),this.multiply(gp(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,Dc(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;zw(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=Xp(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,Dc(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return zw([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){zw([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=c[0],p=c[1],f=c[2],d=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=d[0],v=d[1],g=d[2],y=a*o,b=Xp([s,a,o],e.dtype),w=b.values,x=this.blockSize,C=0;C<s;C++)for(var k=0;k<a;k+=x)for(var E=0;E<o;E+=x)for(var _=0;_<i;_+=x)for(var A=Math.min(k+x,a),S=Math.min(E+x,o),N=Math.min(_+x,i),D=k;D<A;D++)for(var I=E;I<S;I++){for(var T=0,R=_;R<N;R++)T+=u[C*h+D*p+R*f]*l[R*m+I*v+C*g];w[C*y+(D*o+I)]+=T}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.bias,n=e.activation,r=e.preluActivationWeights,i=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return t&&(i=this.add(i,t)),n&&(i=Vw(this,i,n,r)),i},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,Dc(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.realDivide=function(e,t){return zw([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},t.prototype.floorDiv=function(e,t){return zw([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){zw(e,"sum"),ap("sum",t,e.rank);for(var n=rp(e.shape,t),r=n[1],i=Ep(n[0],Dc(e.dtype,"int32")),a=Il(r),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<o.length;++u){for(var l=u*a,c=0,h=0;h<a;++h)c+=s[l+h];o[u]=c}return i},t.prototype.prod=function(e,t){zw(e,"sum");for(var n=rp(e.shape,t),r=n[1],i=Ep(n[0],Dc(e.dtype,"int32")),a=Il(r),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<o.length;++u){for(var l=u*a,c=1,h=0;h<a;++h)c*=s[l+h];o[u]=c}return i},t.prototype.unsortedSegmentSum=function(e,t,n){zw(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=gp(a,"int32"),s=ky(o,t).asType("float32").mul(e).sum(0);r.push(s)}return yf(r)},t.prototype.argMin=function(e,t){zw(e,"argMin");var n=[t];ap("argMin",n,e.rank);for(var r=rp(e.shape,n),i=r[1],a=Ep(r[0],"int32"),o=Il(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*o,h=u[c],p=0,f=0;f<o;++f){var d=u[c+f];d<h&&(h=d,p=f)}s[l]=p}return a},t.prototype.argMax=function(e,t){zw(e,"argMax");var n=[t];ap("argMax",n,e.rank);for(var r=rp(e.shape,n),i=r[1],a=Ep(r[0],"int32"),o=Il(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*o,h=u[c],p=0,f=0;f<o;++f){var d=u[c+f];d>h&&(h=d,p=f)}s[l]=p}return a},t.prototype.cumsum=function(e,t,n,r){if(zw(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=Dc(e.dtype,"int32"),a=Ep(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var h=0;h<u;h++){var p=l(c,h);if(0===h)o[p]=n?0:s[p];else{var f=l(c,h-1);o[p]=n?s[f]+o[f]:s[p]+o[f]}}return a},t.prototype.equal=function(e,t){return zw([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return zw([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return zw([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return zw([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return zw([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return zw([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){zw(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return zw([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return zw([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){zw([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=Ep(t.shape,Dc(t.dtype,n.dtype)),s=this.readSync(o.dataId),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:Il(t.shape.slice(1)),c=0;c<r.length;c++)for(var h=0;h<l;h++)s[u++]=1===r[c]?i[c]:a[c];return o},t.prototype.where=function(e){zw([e],"where");var t=this.readSync(e.dataId);return Ed(e.shape,t)},t.prototype.topk=function(e,t,n){return zw(e,"topk"),kd(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){zw(e,"min"),ap("min",t,e.rank);for(var n=rp(e.shape,t),r=n[1],i=Ep(n[0],e.dtype),a=Il(r),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<o.length;++u){for(var l=u*a,c=s[l],h=0;h<a;++h){var p=s[l+h];p<c&&(c=p)}o[u]=c}return i},t.prototype.minimum=function(e,t){return zw([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return zw([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){zw(e,"max"),ap("max",t,e.rank);for(var n=rp(e.shape,t),r=n[1],i=Ep(n[0],e.dtype),a=Il(r),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<o.length;++u){for(var l=u*a,c=s[l],h=0;h<a;++h){var p=s[l+h];p>c&&(c=p)}o[u]=c}return i},t.prototype.maximum=function(e,t){return zw([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){zw(e,"all"),ap("all",t,e.rank);for(var n=rp(e.shape,t),r=n[1],i=Ep(n[0],e.dtype),a=Il(r),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<o.length;++u){for(var l=u*a,c=s[l],h=0;h<a;++h)c=c&&s[l+h];o[u]=c}return i},t.prototype.any=function(e,t){zw(e,"any"),ap("any",t,e.rank);for(var n=rp(e.shape,t),r=n[1],i=Ep(n[0],e.dtype),a=Il(r),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<o.length;++u){for(var l=u*a,c=s[l],h=0;h<a;++h)c=c||s[l+h];o[u]=c}return i},t.prototype.squaredDifference=function(e,t){return zw([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){zw(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){zw(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){zw(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=t[r]<0?-1:t[r]>0?1:0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){zw(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){zw(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){zw(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){zw(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);n[r]=t[r]-i<.5?Math.floor(t[r]):t[r]-i>.5?Math.ceil(t[r]):i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){zw(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){zw(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){zw(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.log(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){zw(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.log1p(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){zw(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.sqrt(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){zw(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/Math.sqrt(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){zw(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){zw(e,"relu");for(var t=Ep(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){zw(e,"relu");for(var t=Ep(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return zw([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){zw(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){zw([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){zw(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){zw(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r)t[r]=Math.hypot(n[2*r],n[2*r+1]);return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){zw(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){zw(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){zw(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,u=Math.exp(r[i]);a=s?u:o?r[i]:Math.log(1+u),n[i]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){zw(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){zw(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){zw(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){zw(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){zw(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){zw(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return zw([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){zw(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){zw(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){zw(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Ol(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){zw(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){zw(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){zw(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){zw(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),a=Math.abs(n[r]),o=1/(1+.3275911*a);t[r]=i*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),zw(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];n[i]=isNaN(a)?NaN:a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.bias,n=e.activation,r=e.preluActivationWeights,i=this.conv2d(e.input,e.filter,e.convInfo);return t&&(i=this.add(i,t)),n&&(i=Vw(this,i,n,r)),i},t.prototype.conv2d=function(e,t,n){zw([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l="channelsLast"===n.dataFormat,c=Xp(n.outShape,e.dtype),h=e.strides[0],p=l?e.strides[1]:e.strides[2],f=l?e.strides[2]:1,d=l?1:e.strides[1],m=c.strides[0],v=l?c.strides[1]:c.strides[2],g=l?c.strides[2]:1,y=l?1:c.strides[1],b=this.readSync(e.dataId),w=this.readSync(t.dataId),x=c.values,C=0;C<n.batchSize;++C)for(var k=C*h,E=C*m,_=0;_<n.outHeight;++_)for(var A=E+_*v,S=_*n.strideHeight-u,N=0;N<r;N++){var D=S+N*a;if(!(D<0||D>=n.inHeight))for(var I=N*t.strides[0],T=k+D*p,R=0;R<n.outWidth;++R)for(var O=A+R*g,F=R*n.strideWidth-s,M=0;M<i;M++){var L=F+M*o;if(!(L<0||L>=n.inWidth))for(var B=T+L*f,P=I+M*t.strides[1],z=0;z<n.inChannels;++z){for(var V=b[B+z*d],W=0;W<n.outChannels;++W)x[O+W*y]+=V*w[P+W];P+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,h=n.padInfo.top,p=Xp(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),m=p.values,v=0;v<n.batchSize;++v)for(var g=v*e.strides[0],y=v*p.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*p.strides[1],x=b*n.strideDepth-l,C=0;C<r;C++){var k=x+C*o;if(!(k<0||k>=n.inDepth))for(var E=C*t.strides[0],_=g+k*e.strides[1],A=0;A<n.outHeight;++A)for(var S=w+A*p.strides[2],N=A*n.strideHeight-h,D=0;D<i;D++){var I=N+D*s;if(!(I<0||I>=n.inHeight))for(var T=E+D*t.strides[1],R=_+I*e.strides[2],O=0;O<n.outWidth;++O)for(var F=S+O*n.outChannels,M=O*n.strideWidth-c,L=0;L<a;L++){var B=M+L*u;if(!(B<0||B>=n.inWidth))for(var P=R+B*n.inChannels,z=T+L*t.strides[2],V=0;V<n.inChannels;++V){for(var W=f[P+V],U=0;U<n.outChannels;++U)m[F+U]+=W*d[z+U];z+=n.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){zw([e,t],"conv2dDerInput");for(var r=Xp(n.inShape,"float32"),i=r.values,a=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,u=s[0],l=s[1],c=s[2],h=n.batchSize,p=n.filterHeight,f=n.filterWidth,d=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,w=n.strideHeight,x=n.strideWidth,C=p-1-n.padInfo.top,k=f-1-n.padInfo.left,E="channelsLast"===n.dataFormat,_=r.strides[0],A=E?r.strides[1]:r.strides[2],S=E?r.strides[2]:1,N=E?1:r.strides[1],D=e.strides[0],I=E?e.strides[1]:e.strides[2],T=E?e.strides[2]:1,R=E?1:e.strides[1],O=0;O<h;++O)for(var F=0;F<d;++F)for(var M=0;M<m;++M)for(var L=M-C,B=Math.max(0,Math.ceil(L/w)),P=Math.min(y,(p+L)/w),z=0;z<v;++z){for(var V=z-k,W=Math.max(0,Math.ceil(V/x)),U=Math.min(b,(f+V)/x),j=0,H=B;H<P;++H)for(var G=H*w-L,q=W;q<U;++q)for(var K=D*O+I*H+T*q,X=u*(p-1-G)+l*(f-1-(q*x-V))+c*F,Q=0;Q<g;++Q)j+=a[K+R*Q]*o[X+Q];i[_*O+A*M+S*z+N*F]=j}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Xp(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(e.dataId),h=e.strides,p=h[0],f=h[1],d=h[2],m=h[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],w=g[2],x=g[3],C=n.batchSize,k=n.filterDepth,E=n.filterHeight,_=n.filterWidth,A=n.inChannels,S=n.inDepth,N=n.inHeight,D=n.inWidth,I=n.outChannels,T=n.outDepth,R=n.outHeight,O=n.outWidth,F=n.strideDepth,M=n.strideHeight,L=n.strideWidth,B=k-1-n.padInfo.front,P=E-1-n.padInfo.top,z=_-1-n.padInfo.left,V=0;V<C;++V)for(var W=0;W<A;++W)for(var U=0;U<S;++U)for(var j=U-B,H=Math.max(0,Math.ceil(j/F)),G=Math.min(T,(k+j)/F),q=0;q<N;++q)for(var K=q-P,X=Math.max(0,Math.ceil(K/M)),Q=Math.min(R,(E+K)/M),Z=0;Z<D;++Z){for(var $=Z-z,Y=Math.max(0,Math.ceil($/L)),J=Math.min(O,(_+$)/L),ee=0,te=H;te<G;++te)for(var ne=te*F-j,re=X;re<Q;++re)for(var ie=re*M-K,ae=Y;ae<J;++ae)for(var oe=p*V+f*te+d*re+m*ae,se=y*(k-1-ne)+b*(E-1-ie)+w*(_-1-(ae*L-$))+x*W,ue=0;ue<I;++ue)ee+=c[oe+ue]*v[se+ue];i[o*V+s*U+u*q+l*Z+W]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){zw([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=Xp(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(t),f=0;f<a;++f)for(var d=Math.max(0,Math.ceil((c-f)/r)),m=Math.min(n.outHeight,(n.inHeight+c-f)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((l-v)/i)),y=Math.min(n.outWidth,(n.inWidth+l-v)/i),b=0;b<n.inChannels;++b)for(var w=0;w<n.outChannels;++w){for(var x=0,C=0;C<n.batchSize;++C)for(var k=d;k<m;++k)for(var E=f+k*r-c,_=g;_<y;++_){var A=v+_*i-l;x+=s?h.get(C,E,A,b)*p.get(C,k,_,w):h.get(C,b,E,A)*p.get(C,w,k,_)}u.set(x,f,v,b,w)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Xp(n.filterShape,"float32"),c=l.values,h=l.strides,p=h[0],f=h[1],d=h[2],m=h[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],w=g[2],x=g[3],C=this.readSync(e.dataId),k=e.strides,E=k[0],_=k[1],A=k[2],S=k[3],N=n.padInfo.front,D=n.padInfo.left,I=n.padInfo.top,T=0;T<o;++T)for(var R=Math.max(0,Math.ceil((N-T)/r)),O=Math.min(n.outDepth,(n.inDepth+N-T)/r),F=T*p,M=0;M<s;++M)for(var L=Math.max(0,Math.ceil((I-M)/i)),B=Math.min(n.outHeight,(n.inHeight+I-M)/i),P=M*f+F,z=0;z<u;++z)for(var V=Math.max(0,Math.ceil((D-z)/a)),W=Math.min(n.outWidth,(n.inWidth+D-z)/a),U=z*d+P,j=0;j<n.inChannels;++j)for(var H=j*m+U,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*E,Q=K*y,Z=R;Z<O;++Z)for(var $=(T+Z*r-N)*_+X,Y=Z*b+Q,J=L;J<B;++J)for(var ee=(M+J*i-I)*A+$,te=J*w+Y,ne=V;ne<W;++ne)q+=C[(z+ne*a-D)*S+ee+j]*v[ne*x+te+G];c[H+G]=q}return l.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.bias,n=e.activation,r=e.preluActivationWeights,i=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return t&&(i=this.add(i,t)),n&&(i=Vw(this,i,n,r)),i},t.prototype.depthwiseConv2D=function(e,t,n){zw([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Xp(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),f=c.values,d=0;d<n.batchSize;++d)for(var m=d*e.strides[0],v=d*c.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*c.strides[1],b=g*n.strideHeight-s,w=0;w<r;++w){var x=b+w*a;if(!(x<0||x>=n.inHeight))for(var C=w*t.strides[0],k=m+x*e.strides[1],E=0;E<n.outWidth;++E)for(var _=y+E*c.strides[2],A=E*n.strideWidth-u,S=0;S<i;++S){var N=A+S*o;if(!(N<0||N>=n.inWidth))for(var D=k+N*n.inChannels,I=_,T=C+S*t.strides[1],R=0;R<n.inChannels;++R){for(var O=h[D+R],F=0;F<l;++F)f[I+F]+=O*p[T+F];I+=l,T+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){zw([e,t],"depthwiseConv2DDerInput");for(var r=Xp(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,h=c[0],p=c[1],f=c[2],d=this.readSync(t.dataId),m=t.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,C=n.inChannels,k=n.inHeight,E=n.inWidth,_=n.outHeight,A=n.outWidth,S=n.strideHeight,N=n.strideWidth,D=w-1-n.padInfo.top,I=x-1-n.padInfo.left,T=n.outChannels/C,R=0;R<b;++R)for(var O=0;O<C;++O)for(var F=0;F<k;++F)for(var M=F-D,L=Math.max(0,Math.ceil(M/S)),B=Math.min(_,(w+M)/S),P=0;P<E;++P){for(var z=P-I,V=Math.max(0,Math.ceil(z/N)),W=Math.min(A,(x+z)/N),U=0,j=L;j<B;++j)for(var H=j*S-M,G=V;G<W;++G)for(var q=h*R+p*j+f*G,K=v*(w-1-H)+g*(x-1-(G*N-z))+y*O,X=0;X<T;++X)U+=l[q+(O*T+X)]*d[K+X];i[o*R+s*F+u*P+O]=U}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){zw([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=Xp(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,h=this.bufferSync(e),p=this.bufferSync(t),f=0;f<a;++f)for(var d=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((u-v)/i)),y=Math.min(n.outWidth,(n.inWidth+u-v)/i),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/c),x=b%c,C=0,k=0;k<n.batchSize;++k)for(var E=d;E<m;++E)for(var _=f+E*r-l,A=g;A<y;++A)C+=h.get(k,_,v+A*i-u,w)*p.get(k,E,A,b);s.set(C,f,v,w,x)}return s.toTensor()},t.prototype.tile=function(e,t){return zw(e,"tile"),Cd(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){zw(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=Xp(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,u)].concat(l))}return o.toTensor()},t.prototype.transpose=function(e,t){zw(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=this.readSync(e.dataId),a=Xp(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=a.locToIndex(u);a.values[c]=i[r]}return a.toTensor()},t.prototype.gather=function(e,t,n){zw([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=Xp(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=i[u[n]];var c=o.locToIndex(l);a.values[s]=o.values[c]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){zw([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=kf(e.shape,t,r),a=Ef(i.length,t.length),o=_f(e.shape,t,r),s=Af(n,t.length),u=Sf(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){zw([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=kf(o.shape,t,r,!1),u=Ef(s.length,t.length,!1),l=_f(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(l)},t.prototype.pool=function(e,t,n){zw(e,"pool");for(var r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),f=Xp(t.outShape,e.dtype),d=f.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],v=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*m,w=y*e.strides[0],x=0;x<t.inChannels;++x)for(var C=0;C<t.outHeight;++C)for(var k=C*r-l,E=Math.max(0,k),_=Math.min(t.inHeight,s+k),A=b+C*v,S=0;S<t.outWidth;++S){for(var N=S*i-c,D=Math.max(0,N),I=Math.min(t.inWidth,u+N),T=h,R=0,O=0,F=E;F<_;F+=a){for(var M=w+F*e.strides[1],L=D;L<I;L+=o){var B=p[M+L*e.strides[2]+x];"max"===n&&B>T?T=B:"avg"===n&&(R+=B,O++)}if(isNaN(T))break}d[A+S*g+x]="avg"===n?R/O:T}return f.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=Xp(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,h=this.bufferSync(e),p=0;p<t.batchSize;++p)for(var f=0;f<t.inChannels;++f)for(var d=0;d<t.outHeight;++d){for(var m=d*r-l,v=m;v<0;)v+=a;for(var g=Math.min(t.inHeight,s+m),y=0;y<t.outWidth;++y){for(var b=y*i-c,w=b;w<0;)w+=o;for(var x=Math.min(t.inWidth,u+b),C=Number.NEGATIVE_INFINITY,k=-1,E=v;E<g;E+=a)for(var _=E-m,A=w;A<x;A+=o){var S=A-b,N=h.get(p,E,A,f);N>C&&(C=N,k=_*u+S)}n.set(k,p,d,y,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){zw([t,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,r),a=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=c-1-r.padInfo.left,p=l-1-r.padInfo.top,f=Xp(t.shape,"float32"),d=this.bufferSync(i),m=this.bufferSync(e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-p,x=b-h,C=0,k=0;k<l;k+=s){var E=(w+k)/a;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var _=0;_<c;_+=u){var A=(x+_)/o;if(!(A<0||A>=r.outWidth||Math.floor(A)!==A)){var S=l*c-1-d.get(v,E,A,g)===k*c+_?1:0;0!==S&&(C+=m.get(v,E,A,g)*S)}}}f.set(C,v,y,b,g)}return f.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){zw([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,h=c-1-n.padInfo.left,p=l-1-n.padInfo.top,f=Xp(t.shape,"float32"),d=1/(a*o),m=this.bufferSync(e),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-p,x=b-h,C=0,k=0;k<l;k+=s){var E=(w+k)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var _=0;_<c;_+=u){var A=(x+_)/i;A<0||A>=n.outWidth||Math.floor(A)!==A||(C+=m.get(v,E,A,g))}}f.set(C*d,v,y,b,g)}return f.toTensor()},t.prototype.pool3d=function(e,t,n){zw(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,d=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=Xp(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[3]*t.outShape[4],C=t.outShape[4],k=0;k<t.batchSize;++k)for(var E=k*b,_=k*e.strides[0],A=0;A<t.inChannels;++A)for(var S=0;S<t.outDepth;++S){for(var N=S*r-p,D=N;D<0;)D+=o;for(var I=Math.min(t.inDepth,l+N),T=E+S*w,R=0;R<t.outHeight;++R){for(var O=R*i-f,F=O;F<0;)F+=s;for(var M=Math.min(t.inHeight,c+O),L=T+R*x,B=0;B<t.outWidth;++B){for(var P=B*a-d,z=P;z<0;)z+=u;for(var V=Math.min(t.inWidth,h+P),W=L+B*C,U=m,j=0,H=0,G=D;G<I;G+=o){for(var q=_+G*e.strides[1],K=F;K<M;K+=s){for(var X=q+K*e.strides[2],Q=z;Q<V;Q+=u){var Z=v[X+Q*e.strides[3]+A];if("max"===n&&Z>U?U=Z:"avg"===n&&(j+=Z,H++),isNaN(U))break}if(isNaN(U))break}if(isNaN(U))break}y[W+A]="avg"===n?j/H:U}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return zw(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){zw([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,p=n.effectiveFilterDepth,f=n.effectiveFilterHeight,d=n.effectiveFilterWidth,m=p-1-n.padInfo.front,v=d-1-n.padInfo.left,g=f-1-n.padInfo.top,y=Xp(t.shape,"float32"),b=1/(o*s*u),w=this.bufferSync(e),x=0;x<n.batchSize;++x)for(var C=0;C<n.inChannels;++C)for(var k=0;k<n.inDepth;++k)for(var E=0;E<n.inHeight;++E)for(var _=0;_<n.inWidth;++_){for(var A=k-m,S=E-g,N=_-v,D=0,I=0;I<p;I+=l){var T=(A+I)/r;if(!(T<0||T>=n.outDepth||Math.floor(T)!==T))for(var R=0;R<f;R+=c){var O=(S+R)/i;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var F=0;F<d;F+=h){var M=(N+F)/a;M<0||M>=n.outWidth||Math.floor(M)!==M||(D+=w.get(x,T,O,M,C))}}}y.set(D*b,x,k,E,_,C)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return zw(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Xp(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,d=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-p,w=b;w<0;)w+=o;for(var x=Math.min(t.inDepth,l+b),C=0;C<t.outHeight;++C){for(var k=C*i-f,E=k;E<0;)E+=s;for(var _=Math.min(t.inHeight,c+k),A=0;A<t.outWidth;++A){for(var S=A*a-d,N=S;N<0;)N+=u;for(var D=Math.min(t.inWidth,h+S),I=Number.NEGATIVE_INFINITY,T=-1,R=w;R<x;R+=o)for(var O=R-b,F=E;F<_;F+=s)for(var M=F-k,L=N;L<D;L+=u){var B=L-S,P=m.get(v,R,F,L,g);P>=I&&(I=P,T=O*c*h+M*c+B)}n.set(T,v,y,C,A,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){zw([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=h-1-r.padInfo.front,m=f-1-r.padInfo.left,v=p-1-r.padInfo.top,g=Xp(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),w=0;w<r.batchSize;++w)for(var x=0;x<r.inChannels;++x)for(var C=0;C<r.inDepth;++C)for(var k=0;k<r.inHeight;++k)for(var E=0;E<r.inWidth;++E){for(var _=C-d,A=k-v,S=E-m,N=0,D=0;D<h;D+=u){var I=(_+D)/a;if(!(I<0||I>=r.outDepth||Math.floor(I)!==I))for(var T=0;T<p;T+=l){var R=(A+T)/o;if(!(R<0||R>=r.outHeight||Math.floor(R)!==R))for(var O=0;O<f;O+=c){var F=(S+O)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var M=h*p*f-1-y.get(w,I,R,F,x)===D*p*f+T*f+O?1:0;0!==M&&(N+=b.get(w,I,R,F,x)*M)}}}}g.set(N,w,C,k,E,x)}return g.toTensor()},t.prototype.cast=function(e,t){return od(e,t,this)},t.prototype.reshape=function(e,t){return sd(e,t)},t.prototype.avgPool=function(e,t){return zw(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){zw(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],l=this.readSync(e.dataId),c=new Float32Array(Il([a,t,n,u])),h=[r&&t>1?o-1:o,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=0,d=h[0]/p[0],m=h[1]/p[1],v=0;v<a;v++)for(var g=0;g<t;g++)for(var y=d*g,b=Math.floor(y),w=y-b,x=Math.min(o-1,Math.ceil(y)),C=v*e.strides[0]+b*e.strides[1],k=v*e.strides[0]+x*e.strides[1],E=0;E<n;E++)for(var _=m*E,A=Math.floor(_),S=_-A,N=Math.min(s-1,Math.ceil(_)),D=C+A*e.strides[2],I=k+A*e.strides[2],T=C+N*e.strides[2],R=k+N*e.strides[2],O=0;O<u;O++){var F=l[D+O],M=l[I+O],L=F+(l[T+O]-F)*S;c[f++]=L+(M+(l[R+O]-M)*S-L)*w}return mp(c,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){zw([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],h=new Float32Array(i*a*o*s),p=[n&&l>1?a-1:a,n&&c>1?o-1:o],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],d=p[0]/f[0],m=p[1]/f[1],v=this.readSync(e.dataId),g=0,y=0;y<i;y++)for(var b=y*t.strides[0],w=0;w<l;w++)for(var x=w*d,C=Math.floor(x),k=Math.min(Math.ceil(x),a-1),E=b+C*t.strides[1],_=b+k*t.strides[1],A=x-C,S=1-A,N=0;N<c;N++)for(var D=N*m,I=Math.floor(D),T=Math.min(Math.ceil(D),o-1),R=D-I,O=1-R,F=E+I*t.strides[2],M=E+T*t.strides[2],L=_+I*t.strides[2],B=_+T*t.strides[2],P=S*O,z=S*R,V=A*O,W=A*R,U=0;U<s;U++){var j=v[g++];h[F+U]+=j*P,h[M+U]+=j*z,h[L+U]+=j*V,h[B+U]+=j*W}return xp(h,[i,o,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){zw(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],l=this.readSync(e.dataId),c=new Float32Array(a*t*n*u),h=[r&&t>1?o-1:o,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=h[0]/p[0],d=h[1]/p[1],m=0,v=0;v<a;v++)for(var g=v*e.strides[0],y=0;y<t;y++)for(var b=f*y,w=g+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],x=0;x<n;x++)for(var C=d*x,k=w+Math.min(s-1,r?Math.round(C):Math.floor(C))*e.strides[2],E=0;E<u;E++)c[m++]=l[k+E];return mp(c,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){zw([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],h=new Float32Array(i*a*o*s),p=this.readSync(e.dataId),f=[n&&l>1?a-1:a,n&&c>1?o-1:o],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=f[0]/d[0],v=f[1]/d[1],g=1/m,y=1/v,b=2*Math.ceil(g)+2,w=2*Math.ceil(y)+2,x=0;x<i;x++)for(var C=x*t.strides[0],k=0;k<a;k++)for(var E=C+k*t.strides[1],_=Math.floor(k*g),A=Math.floor(_-b/2),S=0;S<o;S++)for(var N=E+S*t.strides[2],D=Math.floor(S*y),I=Math.floor(D-w/2),T=0;T<s;T++){for(var R=0,O=0;O<b;O++){var F=O+A;if(!(F<0||F>=l)){var M=C+F*e.strides[1],L=F*m;if(k===Math.min(a-1,n?Math.round(L):Math.floor(L)))for(var B=0;B<w;B++){var P=B+I;if(!(P<0||P>=c)){var z=M+P*e.strides[2],V=P*v;S===Math.min(o-1,n?Math.round(V):Math.floor(V))&&(R+=p[z+T])}}}}h[N+T]=R}return xp(h,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){zw([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=i?this.readSync(i.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),h=new Float32Array(o.length),p=c.length,f=l.length,d=u.length,m=s.length,v=0,g=0,y=0,b=0,w=0;w<o.length;++w)h[w]=c[v++]+(o[w]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),v>=p&&(v=0),g>=m&&(g=0),y>=f&&(y=0),b>=d&&(b=0);return xp(h,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){zw(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),u=0;r<=i;r++){var l=s[r];u+=l*l}return u}for(var h=0;h<u;h++){var p=c(h),f=s[h]*Math.pow(n+r*p,-i);l[h]=f}return xp(l,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){zw(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=this.readSync(n.dataId),h=new Float32Array(e.size),p=e.size,f=0;f<p;f++){for(var d=f%s,m=f-d+Math.max(0,d-r),v=f-d+Math.min(s,d+r+1),g=0,y=m;y<v;y++)g+=Math.pow(l[y],2);for(g=a*g+i,y=m;y<v;y++){var b=-2*a*o*l[y]*c[f]/g;f===y&&(b+=Math.pow(g,-o)),h[y]+=b*=u[f]}}return xp(h,e.shape)},t.prototype.multinomial=function(e,t,n,r){zw(e,"multinomial");for(var i=t?e:Vf(e),a=i.shape[0],o=i.shape[1],s=Ep([a,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(i.dataId),c=0;c<a;++c){var h=c*o,p=new Float32Array(o-1);p[0]=l[h];for(var f=1;f<p.length;++f)p[f]=p[f-1]+l[h+f];for(var d=Hp(r.toString()),m=c*n,v=0;v<n;++v){var g=d();u[m+v]=p.length;for(var y=0;y<p.length;y++)if(g<p[y]){u[m+v]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){zw(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return bp(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return zw(e,"nonMaxSuppression"),md(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=Xp(e.shape,"float32"),a=Xp(e.shape,"float32"),o=fp(e).as2D(n,r),s=dp(e).as2D(n,r),u=0;u<n;u++)for(var l=o.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),h=pp(l,c),p=this.readSync(this.fftImpl(h,t).dataId),f=0;f<r;f++){var d=cd(p,f);i.values[u*r+f]=d.real,a.values[u*r+f]=d.imag}return pp(i.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=pp(fp(i).div(gp(r)),dp(i).div(gp(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return pp(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=pp(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),u=pp(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),u=this.fftRadix2(u,i,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=pp(l.real,l.imag).mul(u),h=o.add(c),p=o.sub(c),f=fp(h).concat(fp(p)),d=dp(h).concat(dp(p));return pp(f,d).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var u=pd(i*s,t,n),l=cd(e,s);a+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}n&&(a/=t,o/=t),hd(r,a,o,i)}return r},t.prototype.depthToSpace=function(e,t,n){Al("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),Al(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,u=a*t,l=o/(t*t),c=this.readSync(e.dataId),h=new Float32Array(r*s*u*l),p=0,f=0;f<r;++f)for(var d=0;d<s;++d)for(var m=Math.floor(d/t),v=d%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(v*t+g%t)*l,w=0;w<l;++w)h[p++]=c[w+b+o*(y+a*(m+i*f))];return xp(h,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=Kf(e.shape,t.shape),a=Xp(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Gf(e.shape,i),l=Gf(t.shape,i),c=a.values;if(u.length+l.length===0)for(var h=0;h<c.length;++h)c[h]=r(o[h%o.length],s[h%s.length]);else{var p=this.bufferSync(e),f=this.bufferSync(t),d=function(n){var i=a.indexToLoc(n),h=i.slice(-e.rank);u.forEach((function(e){return h[e]=0}));var d=p.locToIndex(h),m=i.slice(-t.rank);l.forEach((function(e){return m[e]=0}));var v=f.locToIndex(m);c[n]=r(o[d],s[v])};for(h=0;h<c.length;++h)d(h)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Kf(e.shape,t.shape),i=Xp(r,"float32"),a=Xp(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Gf(e.shape,r),l=Gf(t.shape,r),c=i.values,h=a.values;if(u.length+l.length===0)for(var p=0;p<c.length;p++){var f=p%o.length,d=p%s.length,m=n(o[2*f],o[2*f+1],s[2*d],s[2*d+1]);c[p]=m.real,h[p]=m.imag}else{var v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),p=a.slice(-e.rank);u.forEach((function(e){return p[e]=0}));var f=v.locToIndex(p),d=a.slice(-t.rank);l.forEach((function(e){return d[e]=0}));var m=g.locToIndex(d),y=n(o[2*f],o[2*f+1],s[2*m],s[2*m+1]);c[r]=y.real,h[r]=y.imag};for(p=0;p<c.length;p++)y(p)}return this.complex(i.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return xd(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],u=o[1],l=o[2],c=o[3],h=t.shape[0],p=r[0],f=r[1],d=Xp([h,p,f,c],"float32"),m=this.readSync(t.dataId),v=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=d.strides,w=0;w<h;w++){var x=4*w,C=m[x],k=m[x+1],E=m[x+2],_=m[x+3],A=v[w];if(!(A>=s))for(var S=p>1?(E-C)*(u-1)/(p-1):0,N=f>1?(_-k)*(l-1)/(f-1):0,D=0;D<p;D++){var I=p>1?C*(u-1)+D*S:.5*(C+E)*(u-1);if(I<0||I>u-1)for(var T=0;T<f;T++)for(var R=0;R<c;R++){var O=R+T*b[2]+D*b[1]+w*b[0];d.values[O]=a}else if("bilinear"===i){var F=Math.floor(I),M=Math.ceil(I),L=I-F;for(T=0;T<f;T++)if((G=f>1?k*(l-1)+T*N:.5*(k+_)*(l-1))<0||G>l-1)for(R=0;R<c;R++)d.values[O=R+T*b[2]+D*b[1]+w*b[0]]=a;else{var B=Math.floor(G),P=Math.ceil(G),z=G-B;for(R=0;R<c;R++){var V=g[O=R+B*y[2]+F*y[1]+A*y[0]],W=g[O=R+P*y[2]+F*y[1]+A*y[0]],U=g[O=R+B*y[2]+M*y[1]+A*y[0]],j=V+(W-V)*z,H=U+(g[O=R+P*y[2]+M*y[1]+A*y[0]]-U)*z;d.values[O=R+T*b[2]+D*b[1]+w*b[0]]=j+(H-j)*L}}}else for(T=0;T<f;++T){var G;if((G=f>1?k*(l-1)+T*N:.5*(k+_)*(l-1))<0||G>l-1)for(R=0;R<c;R++)d.values[O=R+T*b[2]+D*b[1]+w*b[0]]=a;else{var q=Math.round(G),K=Math.round(I);for(R=0;R<c;R++)d.values[R+T*b[2]+D*b[1]+w*b[0]]=g[R+q*y[2]+K*y[1]+A*y[0]]}}}}return d.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=Tf(0,e,n);return this.scatter(e,t,n,i.outputSize,i.sliceSize,i.numUpdates,i.sliceRank,i.strides,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Nf(e,t),a=i[0],o=i[1],s=i[2],u=i[3];if(0===o)return mp([],a,e.dtype);for(var l=new vc([o,s],e.dtype),c=this.readSync(t.dataId),h=this.readSync(e.dataId),p=0;p<o;p++){for(var f=[],d=0,m=0;m<r;m++){var v=c[p*r+m];d+=v*u[m],f.push(v)}if(d<0||d>=e.size/s)throw new Error("Invalid indices: "+f+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[p*s+g]=h[d*s+g]}return l.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=Tf(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,l=gp(0);return this.scatter(e,t,n,u,o,a,i,s,l,!0)},t.prototype.fill=function(e,t,n){var r=Wl(n=n||$l(t),Il(e));return r.fill(t),Pc.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=Wl(e.dtype,Il(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return ud(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,a,o,s,u,l){var c=[r/i,i],h=this.readSync(e.dataId),p=this.readSync(t.dataId);if(0===r)return mp([],n,t.dtype);var f=new vc(c,t.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var d=0;d<a;d++){for(var m=[],v=0,g=0;g<o;g++){var y=h[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)l?f.values[v*i+b]+=p[d*i+b]:f.values[v*i+b]=0===t.rank?p[0]:p[d*i+b]}return f.toTensor().reshape(n)},t}(jf);Pc.registerBackend("cpu",(function(){return new Ww}),1),wl({kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;zw(t,"square");for(var r=n.data.get(t.dataId).values,i=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];i[a]=o*o}return{dataId:n.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}}),wl({kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=t.boxes,i=t.scores,a=n.maxOutputSize,o=n.iouThreshold,s=n.scoreThreshold,u=n.softNmsSigma,l=e.backend;zw(r,"NonMaxSuppressionWithScore");var c=vd(l.data.get(r.dataId).values,l.data.get(i.dataId).values,a,o,s,u);return[c.selectedIndices,c.selectedScores]}}),wl({kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=new Tv(t.shape,"return x * x;");return n.runWebGLProgram(r,[t],t.dtype)}});var Uw,jw=function(e){this.variableNames=["A"];var t=Id(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Hw=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Id(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "};wl({kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.inputs.pixels,r="undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement,a=r?[n.videoWidth,n.videoHeight]:[n.width,n.height],o=a[0],s=a[1],u=[s,o],l=[s,o,e.attrs.numChannels];(i||r)&&(null==Uw&&(Uw=document.createElement("canvas").getContext("2d")),Uw.canvas.width=o,Uw.canvas.height=s,Uw.drawImage(n,0,0,o,s),n=Uw.canvas);var c=t.makeTensorInfo(u,"int32");t.texData.get(c.dataId).usage=Uc.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(c.dataId),n);var h=dl().getBool("WEBGL_PACK")?new Hw(l):new jw(l),p=t.runWebGLProgram(h,[c],"int32");return t.disposeData(c.dataId),p}}),wl({kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;Zh("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t.scores,a=r.maxOutputSize,o=r.iouThreshold,s=r.scoreThreshold,u=r.softNmsSigma,l=n,c=vd(l.readSync(t.boxes.dataId),l.readSync(i.dataId),a,o,s,u);return[c.selectedIndices,c.selectedScores]}});var Gw=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();dl().get("IS_BROWSER")&&dl().setPlatform("browser",new Gw);var qw,Kw=function(){function e(){this.util=n(3),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=dl().global.fetch?dl().global.fetch(e,t):(null==qw&&(qw=n(2)),qw(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();dl().get("IS_NODE")&&dl().setPlatform("node",new Kw);var Xw={float32:4,int32:4,uint16:2,uint8:1,bool:1},Qw=4;function Zw(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=Il(o),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=Xw[l.dtype],h=e.slice(r,r+s*c),p="uint8"===l.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===a)u=Float32Array.from(p,(function(e){return e*l.scale+l.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=Int32Array.from(p,(function(e){return Math.round(e*l.scale+l.min)}))}r+=s*c}else if("string"===a){var f=Il(t.shape);u=[];for(var d=0;d<f;d++){var m=new Uint32Array(e.slice(r,r+Qw))[0];r+=Qw;var v=new Uint8Array(e.slice(r,r+m));u.push(v),r+=m}}else{var g=Xw[a];if(h=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(h);else if("int32"===a)u=new Int32Array(h);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=new Uint8Array(h)}r+=s*g}n[i]=mp(u,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}function $w(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}var Yw="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Jw(e){return Yw?Buffer.byteLength(e):new Blob([e]).size}function ex(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function tx(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function nx(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Jw(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Jw(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var rx=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),ix="://",ax=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){Al(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(ix)&&(t=t.slice(0,t.indexOf(ix))),Al(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();Al(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function ox(e){if(-1===e.indexOf(ix))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ax.getSchemes().join(","));return{scheme:e.split(ix)[0],path:e.split(ix)[1]}}function sx(e,t,n){return void 0===n&&(n=!1),cl(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h;return hl(this,(function(p){switch(p.label){case 0:return Al(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),Al((r=rx.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),Al(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],Al((a=rx.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),Al(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=a[0],s=ox(e).scheme,u=ox(e).path,l=s===ox(e).scheme,[4,i.load()];case 1:return c=p.sent(),n&&l?[4,ax.getManager(s).removeModel(u)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,o.save(c)];case 4:return h=p.sent(),!n||l?[3,6]:[4,ax.getManager(s).removeModel(u)];case 5:p.sent(),p.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var ux="models_store",lx="model_info_store";function cx(){if(!dl().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function hx(e){var t=e.result;t.createObjectStore(ux,{keyPath:"modelPath"}),t.createObjectStore(lx,{keyPath:"modelPath"})}var px=function(){function e(e){if(this.indexedDB=cx(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return hx(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(ux,"readonly"),s=o.objectStore(ux).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var u,l=nx(t),c=a.transaction(lx,"readwrite"),h=c.objectStore(lx),p=h.put({modelPath:n.modelPath,modelArtifactsInfo:l});p.onsuccess=function(){var i=(u=a.transaction(ux,"readwrite")).objectStore(ux).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});i.onsuccess=function(){return e({modelArtifactsInfo:l})},i.onerror=function(e){var t=(h=c.objectStore(lx)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},p.onerror=function(e){return a.close(),r(p.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),fx=function(e){return dl().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(px.URL_SCHEME)?(t=e.slice(px.URL_SCHEME.length),new px(t)):null;var t};rx.registerSaveRouter(fx),rx.registerLoadRouter(fx);var dx=function(){function e(){this.indexedDB=cx()}return e.prototype.listModels=function(){return cl(this,void 0,void 0,(function(){var e=this;return hl(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return hx(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(lx,"readonly"),a=i.objectStore(lx).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return cl(this,void 0,void 0,(function(){var t=this;return hl(this,(function(n){var r;return e=(r=e).startsWith(px.URL_SCHEME)?r.slice(px.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return hx(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(lx,"readwrite"),s=o.objectStore(lx),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(ux,"readwrite")).objectStore(ux).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(dl().getBool("IS_BROWSER"))try{ax.registerManager(px.URL_SCHEME,new dx)}catch(Ac){}var mx="/",vx="tensorflowjs_models",gx="info",yx="model_topology",bx="weight_specs",wx="weight_data",xx="model_metadata";function Cx(e){return{info:[vx,e,gx].join(mx),topology:[vx,e,yx].join(mx),weightSpecs:[vx,e,bx].join(mx),weightData:[vx,e,wx].join(mx),modelMetadata:[vx,e,xx].join(mx)}}function kx(e){var t=e.split(mx);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(mx)}var Ex=function(){function e(e){if(!dl().getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Cx(this.modelPath)}return e.prototype.save=function(e){return cl(this,void 0,void 0,(function(){var t,n,r;return hl(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=nx(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){return Yw?Buffer.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return cl(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return hl(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Yw){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),_x=function(e){return dl().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ex.URL_SCHEME)?(t=e.slice(Ex.URL_SCHEME.length),new Ex(t)):null;var t};rx.registerSaveRouter(_x),rx.registerLoadRouter(_x);var Ax=function(){function e(){Al(dl().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Al(void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return cl(this,void 0,void 0,(function(){var e,t,n,r,i,a;return hl(this,(function(o){for(e={},t=vx+mx,n=mx+gx,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=kx(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return cl(this,void 0,void 0,(function(){var t,n;return hl(this,(function(r){var i;if(e=(i=e).startsWith(Ex.URL_SCHEME)?i.slice(Ex.URL_SCHEME.length):i,t=Cx(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(dl().getBool("IS_BROWSER"))try{ax.registerManager(Ex.URL_SCHEME,new Ax)}catch(Ac){}var Sx="model",Nx=".json",Dx=".weights.bin";function Ix(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Tx=function(){function e(t){if(!dl().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t=Sx),this.modelTopologyFileName=t+Nx,this.weightDataFileName=t+Dx}return e.prototype.save=function(e){return cl(this,void 0,void 0,(function(){var t,n,r,i;return hl(this,(function(a){switch(a.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,[4,Ix((function(){return r.dispatchEvent(new MouseEvent("click"))}))];case 2:return a.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,Ix((function(){return i.dispatchEvent(new MouseEvent("click"))}))]);case 3:a.sent(),a.label=4;case 4:return[2,{modelArtifactsInfo:nx(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),Rx=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return cl(this,void 0,void 0,(function(){var e,t,n=this;return hl(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=o.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void i(e)}var c=[],h=[],p=[];u.forEach((function(e){e.paths.forEach((function(e){h.push(e),p.push(null)})),c.push.apply(c,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=h.indexOf(e);p[i]=n,-1===p.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:ex(p),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return tx(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=tx(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function Ox(e,t,n,r){!function(e){Al(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){Al(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),Al(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),Al(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function Fx(e,t){return cl(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,c;return hl(this,(function(h){switch(h.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?dl().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=h.sent(),[3,4];case 2:return[4,Ox(r,t.onProgress,i,a)];case 3:o=h.sent(),h.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,Ox(s,t.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}}))}))}function Mx(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),cl(t,void 0,void 0,(function(){var t,a,o,s,u,l,c,h,p,f;return hl(this,(function(d){switch(d.label){case 0:if(t=n.map((function(){return!1})),a={},o=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var u=Xw["quantization"in e?e.quantization.dtype:e.dtype]*Il(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:u})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=u}))})),!o.every((function(e){return e})))throw u=i.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),c=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)}))})),[4,e(c)];case 1:return h=d.sent(),p={},f=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=h[f+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,l=0;l<t;l++){var c=new Uint8Array(h[f+l]);s.set(c,u),u+=c.byteLength}a[e].forEach((function(e){var t=Zw(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)p[n]=t[n]})),f+=t})),[2,p]}}))}))}}rx.registerSaveRouter((function(e){return dl().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Tx.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Tx(e)}(e.slice(Tx.URL_SCHEME.length)):null}));var Lx=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(Al("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=dl().platform.fetch,Al(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&Al(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return cl(this,void 0,void 0,(function(){var t,n;return hl(this,(function(r){switch(r.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:nx(e),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}}))}))},e.prototype.load=function(){return cl(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,u,l,c,h;return hl(this,(function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,e.json()];case 3:return t=p.sent(),[3,5];case 4:throw p.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.weightsManifest,a=t.generatedBy,o=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==(r=t.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:h=p.sent(),l=h[0],c=h[1],p.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:c,userDefinedMetadata:u,generatedBy:a,convertedBy:o,format:s}]}}))}))},e.prototype.loadWeights=function(e){return cl(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,l,c;return hl(this,(function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[],s=0,u=e;s<u.length;s++)o.push.apply(o,u[s].weights);return l=[],e.forEach((function(e){e.paths.forEach((function(e){l.push(a+e+i)}))})),[4,Fx(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return c=h.sent(),[2,[o,ex(c)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Bx(e){return null!=e.match(Lx.URL_SCHEME_REGEX)}var Px=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return Bx(e)})):Bx(e))?zx(e,{onProgress:t}):null};function zx(e,t){return new Lx(e,t)}rx.registerSaveRouter(Px),rx.registerLoadRouter(Px);var Vx,Wx=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),Ux=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),jx=Object.freeze({browserFiles:function(e){return new Rx(e)},browserHTTPRequest:function(e,t){return zx(e,t)},concatenateArrayBuffers:ex,decodeWeights:Zw,encodeWeights:function(e,t){return cl(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return hl(this,(function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var o=i[a],u=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+u.dtype);var l={name:o,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise((function(e){return cl(s,void 0,void 0,(function(){var t,n,r,i,a,o,s;return hl(this,(function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(t=l.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+Qw*t.length,r=new Uint8Array(n),i=0,a=0;a<t.length;a++)o=t[a],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,i),r.set(o,i+=Qw),i+=o.length;return e(r),[2]}}))}))}));r.push(c)}else r.push(u.data());null!=t&&(l.group=t),n.push(l)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:$w(u.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Wx(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Wx({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Wx({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return rx.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:nx,getSaveHandlers:function(e){return rx.getSaveHandlers(e)},http:zx,isHTTPScheme:Bx,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),cl(this,void 0,void 0,(function(){return hl(this,(function(i){return[2,Mx((function(e){return Fx(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return rx.registerLoadRouter(e)},registerSaveRouter:function(e){return rx.registerSaveRouter(e)},weightsLoaderFactory:Mx,withSaveHandler:function(e){return new Ux(e)},copyModel:function(e,t){return cl(this,void 0,void 0,(function(){return hl(this,(function(n){return[2,sx(e,t,!1)]}))}))},listModels:function(){return cl(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return hl(this,(function(s){switch(s.label){case 0:e=ax.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?[4,ax.getManager(i=r[n]).listModels()]:[3,4];case 2:for(o in a=s.sent())t[i+ix+o]=a[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return cl(this,void 0,void 0,(function(){return hl(this,(function(n){return[2,sx(e,t,!0)]}))}))},removeModel:function(e){return cl(this,void 0,void 0,(function(){var t;return hl(this,(function(n){return t=ox(e),[2,ax.getManager(t.scheme).removeModel(t.path)]}))}))}}),Hx=hp({confusionMatrix_:function(e,t,n){var r=Jh(e,"labels","confusionMatrix"),i=Jh(t,"predictions","confusionMatrix");Al(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),Al(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),Al(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),Al(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),Al(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=af(r.asType("int32"),n),o=af(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}}),Gx=(Object.freeze({confusionMatrix:Hx}),hp({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=yl("FromPixels",Pc.backendName))return Pc.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],h=l[1];if(o?s=e.getContext("2d").getImageData(0,0,c,h).data:r||n?s=e.data:(a||i)&&(null==Vx&&(Vx=document.createElement("canvas").getContext("2d")),Vx.canvas.width=c,Vx.canvas.height=h,Vx.drawImage(e,0,0,c,h),s=Vx.getImageData(0,0,c,h).data),4===t)u=new Int32Array(s);else{var p=c*h;u=new Int32Array(p*t);for(var f=0;f<p;f++)for(var d=0;d<t;++d)u[f*t+d]=s[4*f+d]}return wp(u,[h,c,t],"int32")}})),qx=Object.freeze({toPixels:function(e,t){return cl(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,c,h,p,f,d,m,v,g,y,b,w,x,C;return hl(this,(function(k){switch(k.label){case 0:if(n=Jh(e,"img","toPixels"),e instanceof wc||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=k.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=k.sent(),h=c[0][0],p=c[1][0],u.dispose(),l.dispose(),"float32"===n.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(f="float32"===n.dtype?255:1,d=new Uint8ClampedArray(a*i*4),m=0;m<i*a;++m)v=void 0,g=void 0,y=void 0,b=void 0,1===o?(v=s[m]*f,g=s[m]*f,y=s[m]*f,b=255):3===o?(v=s[3*m]*f,g=s[3*m+1]*f,y=s[3*m+2]*f,b=255):4===o&&(v=s[4*m]*f,g=s[4*m+1]*f,y=s[4*m+2]*f,b=s[4*m+3]*f),d[0+(w=4*m)]=Math.round(v),d[w+1]=Math.round(g),d[w+2]=Math.round(y),d[w+3]=Math.round(b);return null!=t&&(t.width=a,t.height=i,x=t.getContext("2d"),C=new ImageData(d,a,i),x.putImageData(C,0,0)),n!==e&&n.dispose(),[2,d]}}))}))},fromPixels:Gx}),Kx=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Xx=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Qx(e){Al(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),Al("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),Al(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Xx.register(e)}var Zx=Object.freeze({Serializable:Kx,SerializationMap:Xx,registerClass:Qx}),$x=.001,Yx=.1;function Jx(){return 32===Pc.backend.floatPrecision()?$x:Yx}function eC(e,t,n){var r=!0;if((Gl(e)||Gl(t))&&(r=!1),Gl(e)&&Gl(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=$h(e),s=$h(t);if(!Tl(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var u=Gl(e)?e:Dl(e),l=Gl(t)?t:Dl(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var h=u[c],p=l[c];if(!n(h,p))throw new Error("Arrays differ: actual["+c+"] = "+h+", expected["+c+"] = "+p+".\nActual:   "+u+".\nExpected: "+l+".")}}function tC(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:Yx,expectArraysClose:function(e,t,n){return null==n&&(n=Jx()),eC(e,t,(function(e,t){return tC(e,t,n)}))},testEpsilon:Jx,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Xl(e)||Xl(e[0])||Xl(t)||Xl(t[0])?eC(e,n,(function(e,t){return e==t})):eC(e,t,(function(e,t){return tC(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=Jx()),!tC(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:qm,webgl_util:jh,forceHalfFloat:function(){dl().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Jv,setWebGLContext:qc,GPGPUContext:Km});var nC=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ll(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return Xh(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){Al(Yl(e),(function(){return"The f passed in variableGrads(f) must be a function"})),Al(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Sc})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Pc.registeredVariables)t.push(Pc.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;Al((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=Pc.gradients(e,t,null,!0),s=o.value,u=o.grads;Al(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),Al(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var l={};return t.forEach((function(e,t){null!=u[t]&&(l[e.name]=u[t])})),null!=i&&i.forEach((function(e){return l[e.name]=null})),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Xh(this.iterations_)},t.prototype.saveIterations=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:gp(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return cl(this,void 0,void 0,(function(){var t;return hl(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(Kx);Object.defineProperty(nC,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var rC=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=Pc.backend.epsilon()),i}return ll(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Pc.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Kh((function(){return Dp(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Kh((function(){return Dp(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Kh((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Xh(this.accumulatedGrads.map((function(e){return e.variable}))),Xh(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){var e;return hl(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){var t;return hl(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedGrads=e.slice(0,t=e.length/2).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(nC);Qx(rC);var iC=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return ll(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Pc.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Kh((function(){return _p(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;Kh((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(Pc.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Xh(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(nC);Qx(iC);var aC=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Kh((function(){a.accBeta1=gp(n).variable(),a.accBeta2=gp(r).variable()})),null==i&&(a.epsilon=Pc.backend.epsilon()),a}return ll(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Kh((function(){var r=xy(1,t.accBeta1),i=xy(1,t.accBeta2);n.forEach((function(n,a){var o=Pc.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Kh((function(){return Dp(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Kh((function(){return Dp(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedSecondMoment[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),p=c.div(r),f=h.div(i);u.assign(c),l.assign(h);var d=p.div(f.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(d)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Xh(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Xh(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){var e;return hl(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){var t,n=this;return hl(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Kh((function(){n.accBeta1.assign(gy(n.beta1,n.iterations_+1)),n.accBeta2.assign(gy(n.beta2,n.iterations_+1))})),this.accumulatedFirstMoment=e.slice(0,t=e.length/2).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(nC);Qx(aC);var oC=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],Kh((function(){o.iteration=gp(0).variable(),o.accBeta1=gp(n).variable()})),null==i&&(o.epsilon=Pc.backend.epsilon()),o}return ll(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Kh((function(){var r=xy(1,t.accBeta1),i=ay(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=Pc.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Dp(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:Dp(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedWeightedInfNorm[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=l.mul(t.beta2),p=s.abs(),f=h.maximum(p);u.assign(c),l.assign(f);var d=i.div(r).mul(c.div(f.add(t.epsilon))).add(o);o.assign(d)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Xh(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Xh(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(nC);Qx(oC);var sC=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return ll(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=Pc.registeredVariables[n];Kh((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Qh(gp(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(nC);Qx(sC);var uC=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=gp(i.momentum),i}return ll(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Pc.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Kh((function(){return Dp(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Kh((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Xh(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){return hl(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){return hl(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(sC);Qx(uC);var lC=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;return o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=Pc.backend.epsilon()),o}return ll(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Pc.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Kh((function(){return Dp(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Kh((function(){return Dp(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Kh((function(){return Dp(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Kh((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),l=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(l);var c=i.sub(l);i.assign(c)}else{var h=o.mul(t.decay).add(a.square().mul(1-t.decay));l=s.mul(t.momentum).add(a.mul(t.learningRate).div(h.add(t.epsilon).sqrt())),o.assign(h),s.assign(l),c=i.sub(l),i.assign(c)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Xh(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Xh(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Xh(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return cl(this,void 0,void 0,(function(){var e;return hl(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return cl(this,void 0,void 0,(function(){var t;return hl(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedMeanSquares=e.slice(0,t=this.centered?e.length/3:e.length/2).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(nC);Qx(lC);var cC=function(){function e(){}return e.sgd=function(e){return new sC(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new uC(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new lC(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new aC(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new rC(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new oC(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new iC(e,t)},e}(),hC={sgd:cC.sgd,momentum:cC.momentum,adadelta:cC.adadelta,adagrad:cC.adagrad,rmsprop:cC.rmsprop,adamax:cC.adamax,adam:cC.adam},pC="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function fC(){return new Promise((function(e){return pC((function(){return e()}))}))}yc=Pw;var dC=function(e,t){return(dC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function mC(e,t){function n(){this.constructor=e}dC(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var vC,gC=function(){return(gC=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function yC(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function bC(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function wC(){return null==vC&&(vC=Pc.backend.epsilon()),vC}var xC=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return mC(t,e),t}(Error),CC=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return mC(t,e),t}(Error),kC=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return mC(t,e),t}(Error),EC=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return mC(t,e),t}(Error),_C=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return mC(t,e),t}(Error);function AC(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n}function SC(e,t){if(!e)throw new _C(t)}function NC(e,t){for(var n=0,r=0,i=e;r<i.length;r++)i[r]===t&&n++;return n}function DC(e){return 1===e.length?e[0]:e}function IC(e){return Array.isArray(e)?e:[e]}function TC(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function RC(e){return e.length<=1?e:-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}!function(e){mC((function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}),e)}(Error);var OC={};function FC(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function MC(e,t,n,r,i){var a,o,s;if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===i&&(i=!1),"string"==typeof e){var u=void 0;if(e in n)u=n[e];else if(e in OC)u=OC[e];else if(null==(u=t[e]))throw new kC("Unknown "+r+": "+e+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return u}var l=e;if(null==l.className||null==l.config)throw new kC(r+": Improper config format: "+JSON.stringify(l)+".\n'className' and 'config' must set.");var c=l.className,h=void 0,p=void 0;if(c in n?(h=(a=n[c])[0],p=a[1]):c in OC?(h=(o=OC.className)[0],p=o[1]):c in t&&(h=(s=t[c])[0],p=s[1]),null==h)throw new kC("Unknown "+r+": "+c+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=p){for(var f={},d=0,m=Object.keys(OC);d<m.length;d++)f[x=m[d]]=OC[x];for(var v=0,g=Object.keys(n);v<g.length;v++)f[x=g[v]]=n[x];l.config.customObjects=f;for(var y=gC({},OC),b=0,w=Object.keys(n);b<w.length;b++){var x=w[b];OC[x]=n[x]}!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return e(t)}));else for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],a=t[i];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?e(a):t[i]=a.value)}}(l.config);var C=p(h,l.config,n,i);return OC=gC({},y),C}y=gC({},OC);for(var k=0,E=Object.keys(n);k<E.length;k++)OC[x=E[k]]=n[x];return C=new h(l.config),OC=gC({},y),C}function LC(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function BC(e){if(null==e)return e;for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];-1===t.indexOf(i)&&t.push(i)}return t}function PC(e){if(null==e)throw new kC("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function zC(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new kC(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")}function VC(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),SC(n>=0),SC(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function WC(e,t){Array.isArray(e)?(lc.assert(e.length>0,(function(){return t+" is unexpectedly an empty array."})),e.forEach((function(e,n){return WC(e,"element "+(n+1)+" of "+t)}))):lc.assert(Number.isInteger(e)&&e>0,(function(){return"Expected "+t+" to be a positive integer, but got "+function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"==typeof t?'"'+t+'"':""+t}(e)+"."}))}function UC(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function jC(e,t){return Kh((function(){return Tg(Db(vy(e,e),t,!0))}))}var HC=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.getConfig=function(){return{}},t}(Zx.Serializable),GC=function(e){function t(t){var n=e.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return mC(t,e),t.prototype.apply=function(e){var t=this;return Kh((function(){var n=jC(e,t.axis),r=lg(n,0,t.maxValue);return my(e,ay(r,ty(wC(),n)))}))},t.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},t.className="MaxNorm",t}(HC);Zx.registerClass(GC);var qC=function(e){function t(t){var n=e.call(this)||this;return n.defaultAxis=0,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return mC(t,e),t.prototype.apply=function(e){var t=this;return Kh((function(){return ay(e,ty(wC(),jC(e,t.axis)))}))},t.prototype.getConfig=function(){return{axis:this.axis}},t.className="UnitNorm",t}(HC);Zx.registerClass(qC);var KC=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return Fb(e)},t.className="NonNeg",t}(HC);Zx.registerClass(KC);var XC=function(e){function t(t){var n=e.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=t.minValue?t.minValue:n.defaultMinValue,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.rate=null!=t.rate?t.rate:n.defaultRate,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return mC(t,e),t.prototype.apply=function(e){var t=this;return Kh((function(){var n=jC(e,t.axis),r=ty(my(t.rate,lg(n,t.minValue,t.maxValue)),my(1-t.rate,n));return my(e,ay(r,ty(wC(),n)))}))},t.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},t.className="MinMaxNorm",t}(HC);Zx.registerClass(XC);var QC={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ZC(e){return FC(e)}function $C(e,t){return void 0===t&&(t={}),MC(e,Zx.SerializationMap.getMap().classNameMap,t,"constraint")}function YC(e){return null==e?null:"string"==typeof e?$C({className:e in QC?QC[e]:e,config:{}}):e instanceof HC?e:$C(e)}Object.freeze({maxNorm:function(e){return new GC(e)},unitNorm:function(e){return new qC(e)},nonNeg:function(){return new KC},minMaxNorm:function(e){return new XC(e)}});var JC=["channelsFirst","channelsLast"],ek=["valid","same","causal"],tk=["max","avg"],nk=["sum","mul","concat","ave"],rk=new Map;function ik(e){zC(JC,"DataFormat",e)}function ak(e){zC(ek,"PaddingMode",e)}function ok(e){zC(tk,"PoolMode",e)}var sk=[],uk="/";function lk(e,t){sk.push(e);try{var n=t();return sk.pop(),n}catch(e){throw sk.pop(),e}}function ck(e){if(!fk(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===sk.length?"":sk.join(uk)+uk)+e}function hk(e){if(!fk(e))throw new Error("Not a valid tensor name: '"+e+"'");rk.has(e)||rk.set(e,0);var t=rk.get(e);if(rk.set(e,rk.get(e)+1),t>0){var n=e+"_"+t;return rk.set(n,1),n}return e}var pk=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function fk(e){return!!e.match(pk)}function dk(e){return e===parseInt(e.toString(),10)}function mk(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,i=t;i<n;++i)r*=e[i];return r}function vk(e){return yp(e=Array.isArray(e)?new Float32Array(e):e)}function gk(e){return Sb(vk(e)).dataSync()[0]}function yk(e){return _b(vk(e)).dataSync()[0]}function bk(e,t){if(t<e)throw new kC("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],r=e;r<t;++r)n.push(r);return n}function wk(e,t){return e.asType(t)}function xk(e,t){void 0===t&&(t=-1);var n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function Ck(e,t,n){return Kh((function(){switch(e.rank){case 1:return mb(e,t,n);case 2:return vb(e,[t,0],[n,e.shape[1]]);case 3:return gb(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return yb(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return db(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return db(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new kC("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}))}function kk(e,t,n){return Kh((function(){switch(e.rank){case 1:return mb(e,t,n);case 2:return vb(e,[0,t],[e.shape[0],n]);case 3:return gb(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return yb(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new kC("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function Ek(e,t,n,r){return Kh((function(){switch(e.rank){case 1:return mb(e,t,n);case 2:switch(r){case 1:return Ck(e,t,n);case 2:return kk(e,t,n);default:throw new kC("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return Ck(e,t,n);case 2:return gb(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return kk(e,t,n);default:throw new kC("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return Ck(e,t,n);case 2:return yb(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return yb(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return kk(e,t,n);default:throw new kC("The axis is not within the rank of the tensor "+r)}default:throw new kC("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function _k(e,t){var n;return void 0===t&&(t=-1),t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),Ip(e,t)}function Ak(e,t){switch(e.rank){case 1:return Tp([e,t]);case 2:return Rp([e,t],0);case 3:return Op([e,t],0);case 4:return Fp([e,t],0);default:throw new kC("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function Sk(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new kC("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+e.rank+")");return bf(e,t)}function Nk(e,t,n,r,i){return void 0===t&&(t=0),void 0===n&&(n=1),pf(e,t,n,r,i)}function Dk(e,t,n,r){if(e.rank<2||t.rank<2)throw new EC("dot requires both inputs to be rank >= 2 but got x shape = "+e.shape+" and y shape = "+t.shape);if(t.rank>=3&&e.shape.slice(-1)[0]!==(c=t.shape.slice(-2)[0]))throw new EC("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+e.shape+" and  y shape = "+t.shape);if(2===e.rank&&2===t.rank){var i=!1,a=!1;return Bw.matMul({a:e,b:t,transposeA:i,transposeB:a,bias:r?Rk(e.rank,r,"channelsLast"):null,activation:n})}var o=e.shape.slice(),s=o.pop();e=e.reshape([-1,s]);var u=t.shape.slice(),l=u.pop(),c=u.pop(),h=u.concat([l]),p=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(p).reshape([c,-1]);var f=o.concat(h);return Bw.matMul({a:e,b:t,transposeA:i=!1,transposeB:a=!1,bias:r?Rk(e.rank,r,"channelsLast"):null,activation:n}).reshape(f)}function Ik(e,t,n){return Kh((function(){return t=Array.isArray(t)?yp(t,"int32"):t.toInt(),By(e,t,n)}))}function Tk(e){return vy(e,e)}function Rk(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new kC("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new kC("Unsupported input rank by biasAdd: "+t.rank)}function Ok(e,t,n){return Kh((function(){return null==n&&(n="channelsLast"),ik(n),e.add(Rk(e.rank,t,n))}))}function Fk(e,t,n,r){return Kh((function(){return ew(e,t,n,r)}))}function Mk(e,t,n){return void 0===n&&(n=!1),n?e():t()}var Lk=["fanIn","fanOut","fanAvg"],Bk=["normal","uniform","truncatedNormal"],Pk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t}(Zx.Serializable),zk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e,t){return Ep(e,t)},t.className="Zeros",t}(Pk);Zx.registerClass(zk);var Vk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e,t){return kp(e,t)},t.className="Ones",t}(Pk);Zx.registerClass(Vk);var Wk=function(e){function t(t){var n=e.call(this)||this;if("object"!=typeof t)throw new kC("Expected argument of type ConstantConfig but got "+t);if(void 0===t.value)throw new kC("config must have value set but got "+t);return n.value=t.value,n}return mC(t,e),t.prototype.apply=function(e,t){var n=this;return Kh((function(){return my(gp(n.value),kp(e,t))}))},t.prototype.getConfig=function(){return{value:this.value}},t.className="Constant",t}(Pk);Zx.registerClass(Wk);var Uk=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return mC(t,e),t.prototype.apply=function(e,t){return df(e,this.minval,this.maxval,t)},t.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},t.className="RandomUniform",t}(Pk);Zx.registerClass(Uk);var jk=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return mC(t,e),t.prototype.apply=function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new EC("randomNormal does not support dType "+t+".");return Nk(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="RandomNormal",t}(Pk);Zx.registerClass(jk);var Hk=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return mC(t,e),t.prototype.apply=function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new EC("truncatedNormal does not support dType "+t+".");return wf(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="TruncatedNormal",t}(Pk);Zx.registerClass(Hk);var Gk=function(e){function t(t){var n=e.call(this)||this;return n.gain=null!=t.gain?t.gain:1,n}return mC(t,e),t.prototype.apply=function(e,t){var n=this;return Kh((function(){if(2!==e.length||e[0]!==e[1])throw new kC("Identity matrix initializer can only be used for 2D square matrices.");return my(n.gain,nf(e[0]))}))},t.prototype.getConfig=function(){return{gain:this.gain}},t.className="Identity",t}(Pk);Zx.registerClass(Gk);var qk=function(e){function t(t){var n=e.call(this)||this;if(t.scale<0)throw new kC("scale must be a positive float. Got: "+t.scale);return n.scale=null==t.scale?1:t.scale,n.mode=null==t.mode?"fanIn":t.mode,function(e){zC(Lk,"FanMode",e)}(n.mode),n.distribution=null==t.distribution?"normal":t.distribution,function(e){zC(Bk,"Distribution",e)}(n.distribution),n.seed=t.seed,n}return mC(t,e),t.prototype.apply=function(e,t){var n=function(e,t){var n,r;if(void 0===t&&(t="channelsLast"),ik(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length))if("channelsFirst"===t){var i=mk(e,2);n=e[1]*i,r=e[0]*i}else"channelsLast"===t&&(i=mk(e,0,e.length-2),n=e[e.length-2]*i,r=e[e.length-1]*i);else{var a=mk(e);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}(e),r=n[0],i=n[1],a=this.scale;if(a/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,i):Math.max(1,(r+i)/2),"normal"===this.distribution){var o=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new EC(this.getClassName()+" does not support dType "+t+".");return wf(e,0,o,t,this.seed)}var s=Math.sqrt(3*a);return df(e,-s,s,t)},t.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},t.className="VarianceScaling",t}(Pk);Zx.registerClass(qk);var Kk=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})||this}return mC(t,e),t.prototype.getClassName=function(){return qk.className},t.className="GlorotUniform",t}(qk);Zx.registerClass(Kk);var Xk=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})||this}return mC(t,e),t.prototype.getClassName=function(){return qk.className},t.className="GlorotNormal",t}(qk);Zx.registerClass(Xk);var Qk=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return mC(t,e),t.prototype.getClassName=function(){return qk.className},t.className="HeNormal",t}(qk);Zx.registerClass(Qk);var Zk=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})||this}return mC(t,e),t.prototype.getClassName=function(){return qk.className},t.className="HeUniform",t}(qk);Zx.registerClass(Zk);var $k=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return mC(t,e),t.prototype.getClassName=function(){return qk.className},t.className="LeCunNormal",t}(qk);Zx.registerClass($k);var Yk=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})||this}return mC(t,e),t.prototype.getClassName=function(){return qk.className},t.className="LeCunNormal",t}(qk);Zx.registerClass(Yk);var Jk=function(e){function t(t){var n=e.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==t.gain?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,null!=n.seed)throw new EC("Random seed is not implemented for Orthogonal Initializer yet.");return n}return mC(t,e),t.prototype.apply=function(e,t){var n=this;return Kh((function(){if(2!==e.length)throw new EC("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+e[0]*e[1]+") elements: Slowness may result.");var t=Nk(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Cw.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),my(n.gain,r)}))},t.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},t.className="Orthogonal",t}(Pk);Zx.registerClass(Jk);var eE={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function tE(e,t){return void 0===t&&(t={}),MC(e,Zx.SerializationMap.getMap().classNameMap,t,"initializer")}function nE(e){return FC(e)}function rE(e){if("string"==typeof e){var t=e in eE?eE[e]:e;if("GlorotNormal"===t)return new Xk;if("GlorotUniform"===t)return new Kk;if("HeNormal"===t)return new Qk;if("HeUniform"===t)return new Zk;if("LeCunNormal"===t)return new $k;if("LeCunUniform"===t)return new Yk;var n={};return n.className=t,n.config={},tE(n)}return e instanceof Pk?e:tE(e)}Object.freeze({zeros:function(){return new zk},ones:function(){return new Vk},constant:function(e){return new Wk(e)},randomUniform:function(e){return new Uk(e)},randomNormal:function(e){return new jk(e)},truncatedNormal:function(e){return new Hk(e)},identity:function(e){return new Gk(e)},varianceScaling:function(e){return new qk(e)},glorotUniform:function(e){return new Kk(e)},glorotNormal:function(e){return new Xk(e)},heNormal:function(e){return new Qk(e)},heUniform:function(e){return new Zk(e)},leCunNormal:function(e){return new $k(e)},leCunUniform:function(e){return new Yk(e)},orthogonal:function(e){return new Jk(e)}});var iE=0;function aE(){return iE++}var oE={};function sE(e){return void 0===e&&(e=""),e in oE||(oE[e]=0),oE[e]+=1,e+oE[e].toString()}function uE(e){return Array.isArray(e)&&Array.isArray(e[0])}function lE(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function cE(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new kC("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function hE(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new kC("Expected exactly 1 Shape; got "+e.length)}return e}function pE(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];t+=0===i.shape.length?1:i.shape.reduce((function(e,t){return e*t}))}return t}var fE="Variable",dE=function(){function e(e,t,n,r,i){void 0===t&&(t="float32"),void 0===n&&(n=fE),void 0===r&&(r=!0),void 0===i&&(i=null),this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=aE(),this.originalName=ck(n=null==n?fE:n),this.name=hk(this.originalName),this.trainable_=r,this.constraint=i,this.val=Cp(e,this.trainable_,this.name,this.dtype)}return e.prototype.read=function(){return this.assertNotDisposed(),this.val},e.prototype.write=function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},e.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},e.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!0,configurable:!0}),e}();function mE(e){return e.map((function(e){return e.read()}))}function vE(e){e.forEach((function(e){e[0].write(e[1])}))}var gE,yE,bE=function(e){this.dtype=e.dtype,this.shape=e.shape,this.ndim=null!=e.shape?e.shape.length:e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}},wE=function(e,t,n,r,i,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=aE(),null!=a&&(this.originalName=ck(a),this.name=hk(this.originalName)),this.rank=t.length},xE=0,CE=function(){function e(e,t){this.callArgs=t,this.id=xE++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,r=e.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var r=n[t];e.push(null!=r?r.name:null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}(),kE=0,EE=function(e){function t(t){var n=e.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=kE++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=t.name;if(!r){var i=n.getClassName();r=TC(i)+"_"+sE(i)}if(n.name=r,n.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){var a=void 0;if(null!=t.batchInputShape)a=t.batchInputShape;else if(null!=t.inputShape){var o=null;null!=t.batchSize&&(o=t.batchSize),a=[o].concat(t.inputShape)}n.batchInputShape=a;var s=t.dtype;null==s&&(s=t.inputDType),null==s&&(s="float32"),n.dtype=s}return n.initialWeights=null!=t.weights?t.weights:null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return mC(t,e),t.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},t.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new CC("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new kC("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},t.prototype.getInputAt=function(e){return DC(this.getNodeAtIndex(e,"input").inputTensors)},t.prototype.getOutputAt=function(e){return DC(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(t.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new xC("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new xC("Layer "+this.name+" is not connected, no input to return.");return DC(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new xC("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new xC("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return DC(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),t.prototype.calculateLosses=function(){return this.losses.map((function(e){return e()}))},Object.defineProperty(t.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},t.prototype.assertInputCompatibility=function(e){if(e=IC(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=IC(this.inputSpec);if(e.length!==t.length)throw new kC("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(null!=i){var a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new kC("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+a);if(null!=i.maxNDim&&a>i.maxNDim)throw new kC("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+a);if(null!=i.minNDim&&a<i.minNDim)throw new kC("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+a+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new kC("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var o=r.shape;for(var s in i.axes){var u=Number(s),l=i.axes[s];if(null!=l&&-1===[l,null].indexOf(u>=0?o[u]:o[o.length+u]))throw new kC("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+o+".")}}if(null!=i.shape)for(var c=0;c<i.shape.length;++c){var h=i.shape[c],p=r.shape[c];if(null!=h&&null!=p&&h!==p)throw new kC("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape="+r.shape+".")}}}}},t.prototype.call=function(e,t){return e},t.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},t.prototype.setCallHook=function(e){this._callHook=e},t.prototype.clearCallHook=function(){this._callHook=null},t.prototype.apply=function(e,t){var n=this;t=t||{},this.assertNotDisposed();for(var r=IC(e),i=!0,a=0,o=r;a<o.length;a++)if(!(o[a]instanceof wE)){i=!1;break}for(var s=!0,u=0,l=r;u<l.length;u++)if(l[u]instanceof wE){s=!1;break}if(i===s)throw new kC("Arguments to apply() must be all SymbolicTensors or all Tensors");return lk(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);for(var i=[],a=0,o=IC(e);a<o.length;a++)i.push(o[a].shape);n.build(DC(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&s&&(n._refCount=1)}if(n.assertInputCompatibility(e),s){for(var u=[],l=0,c=IC(d=n.call(e,t));l<c.length;l++){var h=c[l];-1!==r.indexOf(h)&&(h=h.clone()),u.push(h)}if(d=DC(u),null!=n.activityRegularizer)throw new EC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}var p=function(e){for(var t=[],n=0,r=e=IC(e);n<r.length;n++)t.push(r[n].shape);return DC(t)}(e),f=n.computeOutputShape(p),d=void 0,m="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?p[0]:p),d=null!=f&&f.length>0&&Array.isArray(f[0])?f.map((function(r,i){return new wE(m,r,n,IC(e),t,n.name,i)})):new wE(m,f,n,IC(e),t,n.name),n.addInboundNode(e,d,null,null,p,f,t),n._refCount++,null!=n.activityRegularizer)throw new EC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}))},t.prototype.warnOnIncompatibleInputShape=function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor ("+JSON.stringify(e)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(t.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new xC("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var e=[],t=0,n=this.inboundNodes;t<n.length;t++){var r=JSON.stringify(n[t].outputShapes);-1===e.indexOf(r)&&e.push(r)}if(1===e.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new xC("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),t.prototype.countParams=function(){if(!this.built)throw new CC("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return pE(this.weights)},t.prototype.build=function(e){this.built=!0},t.prototype.getWeights=function(e){return void 0===e&&(e=!1),mE(e?this.trainableWeights:this.weights)},t.prototype.setWeights=function(e){var t=this;Kh((function(){var n=t.weights;if(n.length!==e.length)throw new kC('You called setWeights(weights) on layer "'+t.name+'" with a weight list of length '+e.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+e+"...");if(0!==n.length){for(var r=[],i=mE(n),a=0;a<i.length;++a){var o=i[a],s=n[a],u=e[a];if(!lc.arraysEqual(o.shape,u.shape))throw new kC("Layer weight shape "+o.shape+" not compatible with provided weight shape "+u.shape);r.push([s,u])}vE(r)}}))},t.prototype.addWeight=function(e,t,n,r,i,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new kC("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=rE("zeros"));var s=r.apply(t,n),u=new dE(s,n,e,a,o);return s.dispose(),null!=i&&this.addLoss((function(){return i.apply(u.read())})),null==a&&(a=!0),a?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u},t.prototype.setFastWeightInitDuringBuild=function(e){this.fastWeightInitDuringBuild=e},t.prototype.addLoss=function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=IC(e),null!=this._losses&&(t=this.losses).push.apply(t,e))},t.prototype.computeOutputShape=function(e){return e},t.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")}))}return null}return t},t.prototype.addInboundNode=function(e,t,n,r,i,a,o){void 0===o&&(o=null);var s=IC(e);t=IC(t),n=IC(n),r=IC(r),i=lE(i),a=lE(a);for(var u=[],l=[],c=[],h=0,p=s;h<p.length;h++){var f=p[h];u.push(f.sourceLayer),l.push(f.nodeIndex),c.push(f.tensorIndex)}new CE({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(var d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d},t.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},t.prototype.disposeWeights=function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length},t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}},t}(Zx.Serializable),_E=function(e){function t(t){var n=e.call(this,{dtype:t.dtype,name:null!=t.name?t.name:sE("input").toString()})||this;if(null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new kC("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=t.batchInputShape;if(null==r){if(null==t.inputShape)throw new kC("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new kC("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var a=new wE(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new CE({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return mC(t,e),t.prototype.apply=function(e,t){throw new kC("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},t.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},t.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},t.className="InputLayer",t}(EE);function AE(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new kC("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new _E({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function SE(e){return yC(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u;return bC(this,(function(l){switch(l.label){case 0:if(null==e)return[2];for(i in t=[],n=[],r=[],e)"number"!=typeof(a=e[i])&&(t.push((o=a).data()),n.push(i),r.push(o));return t.length>0?[4,Promise.all(t)]:[3,2];case 1:for(s=l.sent(),u=0;u<s.length;++u)e[n[u]]=s[u][0];Xh(r),l.label=2;case 2:return[2]}}))}))}function NE(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}Zx.registerClass(_E),(yE=gE||(gE={}))[yE.SILENT=0]="SILENT",yE[yE.VERBOSE=1]="VERBOSE";var DE=125,IE=function(){function e(){this.validationData=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.onEpochBegin=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return[2]}))}))},e.prototype.onEpochEnd=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return[2]}))}))},e.prototype.onBatchBegin=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return[2]}))}))},e.prototype.onBatchEnd=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return[2]}))}))},e.prototype.onTrainBegin=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return[2]}))}))},e.prototype.onTrainEnd=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return[2]}))}))},e.prototype.setModel=function(e){},e}(),TE=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setParams(e)},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setModel(e)},e.prototype.onEpochBegin=function(e,t){return yC(this,void 0,void 0,(function(){var n,r;return bC(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onEpochEnd=function(e,t){return yC(this,void 0,void 0,(function(){var n,r;return bC(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchBegin=function(e,t){return yC(this,void 0,void 0,(function(){var n,r;return bC(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchEnd=function(e,t){return yC(this,void 0,void 0,(function(){var n,r;return bC(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainBegin=function(e){return yC(this,void 0,void 0,(function(){var t,n;return bC(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainEnd=function(e){return yC(this,void 0,void 0,(function(){var t,n;return bC(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e}(),RE=function(e){function t(){return e.call(this)||this}return mC(t,e),t.prototype.onEpochBegin=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return this.seen=0,this.totals={},[2]}))}))},t.prototype.onBatchEnd=function(e,t){return yC(this,void 0,void 0,(function(){var e,n,r,i,a=this;return bC(this,(function(o){for(i in null==t&&(t={}),this.seen+=e=null==t.size?0:t.size,n=function(n){var i=t[n];if("number"==typeof i)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+i*e;else{var o=void 0;n in r.totals?o=r.totals[n]:r.totals[n]=0;var s=Kh((function(){return ty(a.totals[n],my(i,e))}));r.totals[n]=s,null!=o&&o.dispose()}},r=this,t)n(i);return[2]}))}))},t.prototype.onEpochEnd=function(e,t){return yC(this,void 0,void 0,(function(){var e,n,r,i,a=this;return bC(this,(function(o){if(null!=t)for(e=function(e){if(null==n.totals[e])return"continue";"number"==typeof n.totals[e]?t[e]=n.totals[e]/n.seen:Kh((function(){var n=my(ay(1,a.seen),a.totals[e]);t[e]=n,a.totals[e].dispose(),Qh(t[e])}))},n=this,r=0,i=this.params.metrics;r<i.length;r++)e(i[r]);return[2]}))}))},t}(IE),OE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.onTrainBegin=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return this.epoch=[],this.history={},[2]}))}))},t.prototype.onEpochEnd=function(e,t){return yC(this,void 0,void 0,(function(){var n;return bC(this,(function(r){for(n in null==t&&(t={}),this.epoch.push(e),t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n]);return[2]}))}))},t.prototype.syncData=function(){return yC(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s;return bC(this,(function(u){switch(u.label){case 0:for(r in e=[],t=[],n=[],this.history)for(i=this.history[r],a=0;a<i.length;++a)"number"!=typeof i[a]&&(e.push(i[a].data()),t.push(r),n.push(a));return[4,Promise.all(e)];case 1:for(o=u.sent(),s=0;s<o.length;++s)this.history[t[s]][n[s]].dispose(),this.history[t[s]][n[s]]=o[s][0];return[2]}}))}))},t}(IE),FE=function(e){function t(t,n){var r=e.call(this)||this;if(r.currentEpoch=0,r.yieldEvery=n||"auto","auto"===r.yieldEvery&&(r.yieldEvery=DE),"never"===r.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return lc.isNumber(r.yieldEvery)&&(r.maybeWait=function(e,t){var n,r=lc.now();return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o=lc.now();return o-r<t?n:(r=o,n=e.apply(void 0,i))}}(r.maybeWait.bind(r),r.yieldEvery)),r.trainBegin=t.onTrainBegin,r.trainEnd=t.onTrainEnd,r.epochBegin=t.onEpochBegin,r.epochEnd=t.onEpochEnd,r.batchBegin=t.onBatchBegin,r.batchEnd=t.onBatchEnd,r.yield=t.onYield,r}return mC(t,e),t.prototype.maybeWait=function(e,t,n){return yC(this,void 0,void 0,(function(){var r;return bC(this,(function(i){switch(i.label){case 0:return r=[],null==this.yield?[3,2]:[4,SE(n)];case 1:i.sent(),r.push(this.yield(e,t,n)),i.label=2;case 2:return r.push(fC()),[4,Promise.all(r)];case 3:return i.sent(),[2]}}))}))},t.prototype.onEpochBegin=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){switch(n.label){case 0:return this.currentEpoch=e,null==this.epochBegin?[3,3]:[4,SE(t)];case 1:return n.sent(),[4,this.epochBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onEpochEnd=function(e,t){return yC(this,void 0,void 0,(function(){var n;return bC(this,(function(r){switch(r.label){case 0:return n=[],null==this.epochEnd?[3,2]:[4,SE(t)];case 1:r.sent(),n.push(this.epochEnd(e,t)),r.label=2;case 2:return"epoch"===this.yieldEvery&&n.push(fC()),[4,Promise.all(n)];case 3:return r.sent(),[2]}}))}))},t.prototype.onBatchBegin=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,SE(t)];case 1:return n.sent(),[4,this.batchBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onBatchEnd=function(e,t){return yC(this,void 0,void 0,(function(){var n;return bC(this,(function(r){switch(r.label){case 0:return n=[],null==this.batchEnd?[3,2]:[4,SE(t)];case 1:r.sent(),n.push(this.batchEnd(e,t)),r.label=2;case 2:return"batch"===this.yieldEvery?n.push(fC()):lc.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),[4,Promise.all(n)];case 3:return r.sent(),[2]}}))}))},t.prototype.onTrainBegin=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(t){switch(t.label){case 0:return null==this.trainBegin?[3,3]:[4,SE(e)];case 1:return t.sent(),[4,this.trainBegin(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.onTrainEnd=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(t){switch(t.label){case 0:return null==this.trainEnd?[3,3]:[4,SE(e)];case 1:return t.sent(),[4,this.trainEnd(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t}(IE);function ME(e,t){return null==e&&(e={}),e instanceof IE?[e]:Array.isArray(e)&&e[0]instanceof IE?e:IC(e).map((function(e){return new FE(e,t)}))}var LE=function(){function e(){}return e.registerCallbackConstructor=function(t,n){lc.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got "+t})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)},e.checkForDuplicate=function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new kC("Duplicate callback constructor.")}))},e.clear=function(){e.constructors={}},e.createCallbacks=function(t){var n=[];for(var r in e.constructors){var i=+r;t>=i&&n.push.apply(n,e.constructors[i])}return n.map((function(e){return new e}))},e.constructors={},e}();function BE(e,t,n,r,i,a,o,s,u){var l=new OE,c=[new RE].concat(LE.createCallbacks(t));null!=e&&c.push.apply(c,e),c.push(l);var h=new TE(c);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:l}}function PE(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),MC(e,Zx.SerializationMap.getMap().classNameMap,t,"layer",n)}function zE(e,t){return Kh((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=Db(Tk(e),t,!0),r=_p(n.shape,wC()),i=Tg(ly(n,r));return ay(e,i)}))}function VE(e,t){return Kh((function(){return Ab(Tk(xy(t,e)),-1)}))}function WE(e,t){return Kh((function(){return Ab(tg(xy(t,e)),-1)}))}function UE(e,t){return Kh((function(){var n=xy(e,t),r=lg(tg(e),wC(),Number.MAX_VALUE),i=tg(ay(n,r));return my(100,Ab(i,-1))}))}function jE(e,t,n){return void 0===n&&(n=!1),Kh((function(){if(n)t=Vf(t);else{var r=Db(t,t.shape.length-1,!0);t=ay(t,r)}return t=lg(t,wC(),1-wC()),bg(Db(my(e.toFloat(),vg(t)),t.shape.length-1))}))}function HE(e,t){return Kh((function(){var n=mg(function(e){var t=[mk(e.shape)];return e.reshape(t)}(e)).toInt(),r=(t=lg(t,wC(),1-wC())).shape;return jE(af(n,r[r.length-1]).reshape(r),t,!1)}))}function GE(e,t){return Kh((function(){var n;return n=lg(t,wC(),1-wC()),n=vg(ay(n,xy(1,n))),Ab(function(e,t){if(!lc.arraysEqual(e.shape,t.shape))throw new kC("logits and labels must have the same shape, but got shapes "+JSON.stringify(e.shape)+" and "+JSON.stringify(t.shape));return Kh((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function qE(e,t){return Kh((function(){var n=zE(e,-1),r=zE(t,-1),i=my(n,r);return bg(Db(i,-1))}))}var KE={meanSquaredError:VE,meanAbsoluteError:WE,meanAbsolutePercentageError:UE,meanSquaredLogarithmicError:function(e,t){return Kh((function(){var n=lg(t,wC(),Number.MAX_VALUE),r=vg(ty(1,n)),i=lg(e,wC(),Number.MAX_VALUE),a=vg(ty(1,i));return Ab(Tk(xy(r,a)),-1)}))},squaredHinge:function(e,t){return Kh((function(){var n=ly(0,xy(1,my(e,t)));return Ab(Tk(n),-1)}))},hinge:function(e,t){return Kh((function(){var n=ly(0,xy(1,my(e,t)));return Ab(n,-1)}))},categoricalHinge:function(e,t){return Kh((function(){var n=Db(my(e,t),-1),r=_b(my(xy(1,e),t),-1);return ly(0,ty(1,xy(r,n)))}))},logcosh:function(e,t){return Kh((function(){var n=Math.log(2),r=xy(t,e),i=xy(ty(r,Ig(my(-2,r))),n);return Ab(i,-1)}))},categoricalCrossentropy:jE,sparseCategoricalCrossentropy:HE,binaryCrossentropy:GE,kullbackLeiblerDivergence:function(e,t){return Kh((function(){var n=lg(e,wC(),1),r=lg(t,wC(),1);return Db(my(e,vg(ay(n,r))),-1)}))},poisson:function(e,t){return Kh((function(){var n=vg(ty(wC(),t));return Ab(xy(t,my(e,n)),-1)}))},cosineProximity:qE};function XE(e){if("string"==typeof e){if(e in KE)return KE[e];var t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss "+e+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new kC(t)}return e}function QE(e,t){return Kh((function(){var n=my(.5,Np(t)),r=wk(_y(t,n),e.dtype);return Ab(ky(e,r),-1)}))}function ZE(e,t){return Kh((function(){return wk(ky(Cb(e,-1),Cb(t,-1)),"float32")}))}function $E(e,t){return Kh((function(){return Qg(e.equal(1),t.equal(1)).sum().cast("float32")}))}function YE(e,t){return Kh((function(){var n=$E(e,t),r=function(e,t){return Kh((function(){return Qg(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),i=n.add(r);return Jg(_y(i,0),n.div(i),0).cast("float32")}))}function JE(e,t){return GE(e,t)}function e_(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),ky(e,t).asType("float32")}var t_=jE,n_=HE,r_={binaryAccuracy:QE,categoricalAccuracy:ZE,precision:YE,categoricalCrossentropy:t_,sparseCategoricalCrossentropy:n_,mse:VE,MSE:VE,mae:WE,MAE:WE,mape:UE,MAPE:UE,cosine:qE};function i_(e){if(SC(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;for(var t=void 0,n=0,r=Object.keys(KE);n<r.length;n++){var i=r[n];if(KE[i]===e){t=i;break}}if(void 0!==t)return t;for(var a=0,o=Object.keys(r_);a<o.length;a++)if(r_[i=o[a]]===e){t=i;break}return void 0!==t?t:e.name}var a_=1048576;function o_(e,t,n){if(void 0===n&&(n=!1),null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];if("string"!=typeof i)return!1;if(!e(t[i]))return!1}return!0}if(Array.isArray(t)){for(var a=0,o=t;a<o.length;a++)if(!e(o[a]))return!1;return!0}return!1}var s=typeof t;return"string"===s||"number"===s||"boolean"===s}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>a_&&console.warn('User-defined metadata of model "'+t+'" is too large in size (length='+r.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+a_+".")}}function s_(e,t,n){void 0===n&&(n=console.log);for(var r="",i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[i]).slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function u_(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}s_([e.name+" ("+e.getClassName()+")",r,e.countParams().toString()],t,n)}function l_(e,t,n,r){var i;try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}for(var a=[],o=0,s=e.inboundNodes;o<s.length;o++){var u=s[o];if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var l=0;l<u.inboundLayers.length;++l)a.push(u.inboundLayers[l].name+"["+u.nodeIndices[l]+"]["+u.tensorIndices[l]+"]")}var c=e.name,h=e.getClassName(),p=0===a.length?"":a[0];for(s_([c+" ("+h+")",i,e.countParams().toString(),p],t,r),l=1;l<a.length;++l)s_(["","","",a[l]],t,r)}function c_(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function h_(e,t){if(null===e)return null;if("string"==typeof e)return RC(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,i=0;i<r;++i){var a=e[i];c_(t,i,a)?n.push(a):n.push(h_(a,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var l=u[s],c=e[l];if("name"===l&&"string"==typeof c)o[l]=c;else{var h=RC(l);o[h]=h_(c,h)}}return o}var p_=function(){function e(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;for(var r=0,i=t;r<i.length;r++){var a=i[r];this.add(a.key,a.value)}}}return e.prototype.add=function(e,t,n){if(null!=this.id2Value[e.id])throw new kC("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return $p(t,e.dtype)}catch(n){throw new kC("The dtype of the feed ("+t.dtype+") can not be cast to the dtype of the key '"+e.name+"' ("+e.dtype+").")}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this},e.prototype.addFeed=function(e){this.add(e.key,e.value)},e.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},e.prototype.names=function(){return Object.keys(this.name2Id)},e.prototype.getValue=function(e){if(e instanceof wE){if(null==this.id2Value[e.id])throw new kC("Nonexistent key: "+e.name);return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new kC("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]},e.prototype.getMask=function(e){if(e instanceof wE){if(null==this.id2Value[e.id])throw new kC("Nonexistent key: "+e.name);return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new kC("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]},e.prototype.disposeMasks=function(){null!=this.id2Mask&&Xh(this.id2Mask)},e}(),f_={},d_={};function m_(e,t,n,r){for(var i=null!=n&&n.training,a=Array.isArray(e),o=a?e:[e],s=o.map((function(e){return e.name})),u=[],l=t.names(),c=0,h=s;c<h.length;c++){var p=h[c];-1!==l.indexOf(p)?u.push(t.getValue(p)):u.push(null)}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,d,m=s.join(",")+"|"+t.names().join(",");if(null==f_[m]){var v=function(e,t){lc.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var i=g_(e[0],t);n=i.sorted,r=i.recipientMap}else for(var a=new Set,o=0,s=e;o<s.length;o++){for(var u=g_(s[o],t),l=u.recipientMap,c=0,h=u.sorted;c<h.length;c++){var p=h[c];a.has(p.name)||(n.push(p),a.add(p.name))}var f=function(e){null==r[e]&&(r[e]=new Set),l[e].forEach((function(t){return r[e].add(t)}))};for(var d in l)f(d)}return{sorted:n,recipientCounts:v_(r)}}(o,t);d=v.recipientCounts,f_[m]=f=v.sorted,d_[m]=d}f=f_[m],d={},i||Object.assign(d,d_[m]);for(var g=new p_(t),y=0;y<f.length;++y){if(null!=r){var b=qh().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var w=f[y],x=w.sourceLayer;if(!(x instanceof _E)){for(var C=[],k=[],E=[],_=!1,A=0,S=w.inputs;A<S.length;A++){var N=S[A],D=g.getValue(N),I=g.getMask(N);C.push(D),k.push(I),null!=I&&(_=!0),i||(d[N.name]--,0!==d[N.name]||t.hasKey(N)||-1!==s.indexOf(N.name)||D.isDisposed||!0===N.sourceLayer.stateful||E.push(D))}_&&((n=n||{}).mask=k[0]);var T=IC(x.apply(C,n)),R=null;x.supportsMasking&&(R=x.computeMask(C,k));for(var O=y_(w),F=Array.isArray(O)?O:[O],M=0;M<F.length;++M){g.hasKey(F[M])||g.add(F[M],T[M],Array.isArray(R)?R[0]:R);var L=s.indexOf(F[M].name);-1!==L&&(u[L]=T[M])}i||Xh(E)}}return g.disposeMasks(),a?u:u[0]}function v_(e){var t={};for(var n in e)t[n]=e[n].size;return t}function g_(e,t){for(var n=new Set,r=[],i={},a=0,o=t.names();a<o.length;a++)n.add(o[a]);var s=[],u=[];for(s.push(e);s.length>0;){var l=s[s.length-1];if(n.has(l.name))s.pop();else{var c=u[u.length-1]===s.length-1;if(0===l.inputs.length||c)s.pop(),r.push(l),n.add(l.name),c&&u.pop();else{u.push(s.length-1);for(var h=0,p=l.inputs;h<p.length;h++){var f=p[h];null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),n.has(f.name)||s.push(f)}}}}return{sorted:r,recipientMap:i}}function y_(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r)for(var i=0,a=e.sourceLayer.inboundNodes[r].outputTensors;i<a.length;i++)if(a[i].id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}var b_=function(e){function t(n){var r=e.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var i=r.getClassName().toLowerCase();r.name=sE(i)}if(r.supportsMasking=!1,r.trainable_=!0,r.inputs=Array.isArray(n.inputs)?n.inputs.slice():[n.inputs],r.outputs=Array.isArray(n.outputs)?n.outputs.slice():[n.outputs],BC(r.inputs).length!==r.inputs.length)throw new kC("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map((function(e){return e.name})));BC(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map((function(e){return e.name}))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];for(var a=0,o=r.outputs;a<o.length;a++){var s=(A=o[a]).sourceLayer,u=A.nodeIndex,l=A.tensorIndex;r.outputLayers.push(s),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(l)}for(var c=0,h=r.inputs;c<h.length;c++)s=(A=h[c]).sourceLayer,l=A.tensorIndex,SC(0===(u=A.nodeIndex),"input layer has >1 nodes"),SC(0===l,"input layer has >1 tensors"),r.inputLayers.push(s),r.inputLayersNodeIndices.push(u),r.inputLayersTensorIndices.push(l);r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var p=0;p<r.inputLayers.length;p++){if(!((s=r.inputLayers[p])instanceof _E))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+n.inputs+". Input "+p+" (0-based) originates from layer type "+s.getClassName()+".");r.inputNames.push(s.name),r.feedInputShapes.push(s.batchInputShape),r.feedInputNames.push(s.name)}for(var f=0,d=r.outputLayers;f<d.length;f++)r.outputNames.push((s=d[f]).name);r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));for(var m={},v={},g={},y={},b={},w=[],x=function e(n,i,a,o,s,u){null!=o&&null!=s&&null!=u||(o=n.sourceLayer,s=n.nodeIndex,u=n.tensorIndex);var l=o.inboundNodes[s];if(-1!==a.indexOf(l))throw new CC("The tensor "+n.name+' at layer "'+o.name+'" is part of a cycle.');if(-1===i.indexOf(l)){r.containerNodes.add(t.nodeKey(o,s)),o.id in b||(b[o.id]=Object.keys(b).length),-1===a.indexOf(l)&&a.push(l);for(var c=l.inboundLayers.length,h=0;h<c;h++)e(l.inputTensors[h],i,a,l.inboundLayers[h],l.nodeIndices[h],l.tensorIndices[h]);for(i.push(l);a.indexOf(l)>=0;)a.splice(a.indexOf(l),1);w.push(l)}},C=[],k=[],E=0,_=r.outputs;E<_.length;E++){var A=_[E];x(A,C,k)}for(var S=0,N=w.slice().reverse();S<N.length;S++){v[(K=N[S]).id]=K,K.id in m||(m[K.id]=0);var D=m[K.id];for(D=Math.max(D,null==g[K.outboundLayer.id]?0:g[K.outboundLayer.id]),g[K.outboundLayer.id]=D,y[K.outboundLayer.id]=K.outboundLayer,m[K.id]=D,p=0;p<K.inboundLayers.length;p++){var I=K.inboundLayers[p].inboundNodes[u=K.nodeIndices[p]];m[I.id]=Math.max(D+1,null==m[I.id]?0:m[I.id]),v[I.id]=I}}var T={};for(var R in m)(D=m[R])in T||(T[D]=[]),T[D].push(v[R]);var O={};for(var F in g)(D=g[F])in O||(O[D]=[]),O[D].push(y[F]);var M=Object.keys(O).map((function(e){return parseInt(e,10)})).sort(LC);r.layers=[];for(var L=0,B=M;L<B.length;L++){var P=O[D=B[L]];P.sort((function(e,t){var n=b[e.id],r=b[t.id];return n<r?-1:n>r?1:0}));for(var z=0,V=P;z<V.length;z++)(s=V[z])instanceof t&&r.internalContainerRefs.push(s),r.layers.push(s)}r.layersByDepth=O,M=Object.keys(T).map((function(e){return parseInt(e,10)})).sort(LC);for(var W=r.inputs.slice(),U=[],j=0,H=M;j<H.length;j++)for(var G=0,q=T[D=H[j]];G<q.length;G++){var K;if(null!=(s=(K=q[G]).outboundLayer)){for(var X=0,Q=K.inputTensors;X<Q.length;X++)if(-1===W.indexOf(A=Q[X]))throw new CC("Graph disconnected: cannot obtain value for tensor "+A+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+U);for(var Z=0,$=K.outputTensors;Z<$.length;Z++)W.push(A=$[Z]);U.push(s.name)}}r.nodesByDepth=T;for(var Y=r.layers.map((function(e){return e.name})),J=function(e){var t=Y.filter((function(t){return t===e})).length;if(1!==t)throw new CC('The name "'+e+'" is used '+t+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Y))},ee=0,te=Y;ee<te.length;ee++)J(te[ee]);return r.outboundNodes=[],r.inboundNodes=[],new CE({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return mC(t,e),t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(var t=0,n=this.layers;t<n.length;t++)e.numDisposedVariables+=n[t].dispose().numDisposedVariables;for(var r=0,i=this.internalContainerRefs;r<i.length;r++)e.numDisposedVariables+=i[r].dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new kC("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++)e=e.concat(n[t].trainableWeights);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],a=0,o=this.layers;a<o.length;a++)i.push.apply(i,(r=o[a]).trainableWeights);return i.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.loadWeights=function(e,t){void 0===t&&(t=!0);for(var n={},r=0,i=0,a=this.layers;i<a.length;i++)for(var o=0,s=a[i].weights;o<s.length;o++){var u=s[o];if(null!=n[u.originalName])throw new kC("Duplicate weight name: "+u.originalName);n[u.originalName]=u,r++}var l=[];for(var c in e){if(null!=n[c])l.push([n[c],e[c]]);else if(t)throw new kC("Provided weight data has no target variable: "+c);delete n[c]}if(t){var h=[];for(var p in n)h.push(p);if(h.length>0)throw new kC(h.length+" of "+r+" weights are not set: "+h)}vE(l)},t.prototype.updatedConfig=function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 1.5.1",t.backend="TensorFlow.js",t},t.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=function e(t,n){if(null==t)return null;if("string"==typeof t)return TC(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],i=t.length,a=0;a<i;++a){var o=t[a];c_(n,a,o)?r.push(o):r.push(e(o,n))}return r}for(var s={},u=0,l=Object.keys(t);u<l.length;u++){var c=l[u],h=t[c];s[TC(c)]="name"!==c&&"className"!==c||"string"!=typeof h?e(h,c):h}return s}(this.updatedConfig());return t?JSON.stringify(n):n},t.prototype.call=function(e,t){var n=this;return Kh((function(){e=IC(e);for(var r=new p_,i=0;i<n.inputs.length;++i)r.add(n.inputs[i],e[i]);return m_(n.outputs,r,t)}))},t.prototype.computeMask=function(e,t){var n=this;return Kh((function(){var r;return e=IC(e),r=null==t?AC(null,e.length):IC(t),n.runInternalGraph(e,r)[1]}))},t.prototype.computeOutputShape=function(e){var t=lE(e);if(t.length!==this.inputLayers.length)throw new kC("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<t.length;r++){var i=this.inputLayers[r];n[b=i.name+"_0_0"]=t[r]}var a=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(LC);if(a.length>1)for(var o=0,s=a;o<s.length;o++)for(var u=0,l=this.nodesByDepth[s[o]];u<l.length;u++){var c=l[u];if(i=c.outboundLayer,-1===this.inputLayers.map((function(e){return e.id})).indexOf(i.id)){for(var h=[],p=0;p<c.inboundLayers.length;p++){var f=c.tensorIndices[p],d=n[b=c.inboundLayers[p].name+"_"+c.nodeIndices[p]+"_"+f];h.push(d)}var m=lE(i.computeOutputShape(DC(h))),v=i.inboundNodes.indexOf(c);for(p=0;p<m.length;p++)n[b=i.name+"_"+v+"_"+p]=m[p]}}var g=[],y=[];for(r=0;r<this.outputLayers.length;r++){var b=(i=this.outputLayers[r]).name+"_"+(v=this.outputLayersNodeIndices[r])+"_"+(f=this.outputLayersTensorIndices[r]);y.push(b)}for(r=0;r<y.length;r++){var w=y[r];SC(w in n),g.push(n[w])}return DC(g)},t.prototype.runInternalGraph=function(e,t){null==t&&(t=AC(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],a=e[r],o=t[r];n[i.id]=[a,o]}for(var s=0,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(LC);s<u.length;s++)for(var l=0,c=this.nodesByDepth[u[s]];l<c.length;l++){for(var h=c[l],p=h.outboundLayer,f=h.inputTensors,d=h.outputTensors,m=new Array,v=0,g=f;v<g.length;v++)(i=g[v]).id in n&&m.push(n[i.id]);if(m.length===f.length){var y={},b=void 0,w=void 0,x=void 0,C=void 0;if(null!=h.callArgs&&(y=h.callArgs),1===m.length){var k=m[0],E=k[0],_=k[1];null==y.mask&&(y.mask=_),x=IC(p.call(E,y)),C=IC(p.computeMask(E,_)),b=[E],w=[_]}else b=m.map((function(e){return e[0]})),w=m.map((function(e){return e[1]})),null==y.mask&&(y.mask=w),x=IC(p.call(b,y)),C=IC(p.computeMask(b,w));if(p.activityRegularizer)throw new EC("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<d.length;++r)n[(i=d[r]).id]=[a=x[r],o=C[r]]}}for(var A=[],S=[],N=[],D=0,I=this.outputs;D<I.length;D++){SC((i=I[D]).id in n,"Could not compute output "+i.name+" : "+i.id);var T=n[i.id],R=T[0];o=T[1],N.push(R.shape),A.push(R),S.push(o)}return[A,S,N]},t.prototype.buildNodeConversionMap=function(e){for(var n,r={},i=0,a=this.layers;i<a.length;i++){var o=a[i];n=o instanceof t?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=t.nodeKey(o,s);this.containerNodes.has(u)&&(r[u]=n,n+=1)}}return r},t.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new kC("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new kC("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===e)return i}throw new kC("No such layer: "+e)},t.prototype.calculateLosses=function(){var e=this;return Kh((function(){for(var n=[],r=0,i=e.layers;r<i.length;r++)for(var a=i[r],o=0;o<a.inboundNodes.length;++o){var s=t.nodeKey(a,o);e.containerNodes.has(s)&&n.push.apply(n,a.calculateLosses())}return n}))},t.prototype.getConfig=function(){for(var e={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],i=0,a=this.layers;i<a.length;i++){for(var o=(w=a[i]).getClassName(),s=w.getConfig(),u=[],l=0;l<w.inboundNodes.length;l++){var c=w.inboundNodes[l],h=t.nodeKey(w,l),p={};if(this.containerNodes.has(h)){if(c.callArgs)try{JSON.stringify(c.callArgs),p=c.callArgs}catch(e){console.warn("Layer "+w.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),p={}}if(c.inboundLayers.length>0){for(var f=[],d=0;d<c.inboundLayers.length;d++){var m=c.inboundLayers[d],v=c.nodeIndices[d],g=c.tensorIndices[d];null==(C=n[t.nodeKey(m,v)])&&(C=0),f.push([m.name,C,g,p])}u.push(f)}}}var y={};y.name=w.name,y.className=o,y.config=s,y.inboundNodes=u,r.push(y)}e.layers=r;var b=[];for(d=0;d<this.inputLayers.length;d++){var w=this.inputLayers[d];h=t.nodeKey(w,v=this.inputLayersNodeIndices[d]),this.containerNodes.has(h)&&(null!==(C=n[h])&&void 0!==C||(C=0),b.push([w.name,C,g=this.inputLayersTensorIndices[d]]))}e.inputLayers=b;var x=[];for(d=0;d<this.outputLayers.length;d++){var C;h=t.nodeKey(w=this.outputLayers[d],v=this.outputLayersNodeIndices[d]),this.containerNodes.has(h)&&(null!==(C=n[h])&&void 0!==C||(C=0),x.push([w.name,C,g=this.outputLayersTensorIndices[d]]))}return e.outputLayers=x,e},t.fromConfig=function(e,t,n,r){void 0===n&&(n={}),void 0===r&&(r=!1);var i={},a={};function o(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function s(e,t){for(var n,r=[],a=0,s=t;a<s.length;a++){var u=s[a],l=u[0],c=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(l in i))return void o(e,t);var p=i[l];if(p.inboundNodes.length<=c)return void o(e,t);r.push(p.inboundNodes[c].outputTensors[h])}r.length>0&&e.apply(DC(r),n)}function u(e){var n=e.name,a=PE(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(r),i[n]=a,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new kC("Corrupted configuration, expected array for nodeData: "+e);o(a,e)}))}for(var l=t.name,c=t.layers,h=0,p=c;h<p.length;h++)u(m=p[h]);for(;!PC(a);)for(var f=0,d=c;f<d.length;f++){var m=d[f];if((D=i[m.name]).name in a){var v=a[D.name];delete a[D.name];for(var g=0,y=v;g<y.length;g++)s(D,y[g])}}for(var b=[],w=[],x=0,C=t.inputLayers;x<C.length;x++){var k=(m=C[x])[0],E=m[1],_=m[2];SC(k in i);var A=(D=i[k]).inboundNodes[E].outputTensors;b.push(A[_])}for(var S=0,N=t.outputLayers;S<N.length;S++){var D;k=(m=N[S])[0],E=m[1],_=m[2],SC(k in i),A=(D=i[k]).inboundNodes[E].outputTensors,w.push(A[_])}return new e({inputs:b,outputs:w,name:l})},Object.defineProperty(t.prototype,"stateful",{get:function(){if(this._stateful)throw new kC("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++)if(t[e].stateful)return!0;return!1},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){var e=this;Kh((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))},t}(EE);function w_(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided "+n+" is an array of "+e.length+" element(s), but the model has "+r+" outputs. Make sure a set of weights is provided for each model output.");return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var i=[];return t.forEach((function(t){i.push(t in e?e[t]:null)})),i}throw new Error("The model has multiple ("+r+") outputs, so "+n+" must be either an array with "+r+" elements or an object with "+t+" keys. Provided "+n+" not understood: "+JSON.stringify(e))}(e,t,"classWeight")}function x_(e,t,n,r){return yC(this,void 0,void 0,(function(){var i,a,o,s,u;return bC(this,(function(l){switch(l.label){case 0:if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");return null==n?[3,2]:(i=Kh((function(){if(1===e.shape.length)return e.clone();if(2===e.shape.length){if(e.shape[1]>1)return e.argMax(1);if(1===e.shape[1])return e.reshape([e.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+e.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+e.rank+") during handling of class weights. The rank is expected to be 1 or 2.")})),s=(o=Array).from,[4,i.data()]);case 1:return a=s.apply(o,[l.sent()]),Xh(i),u=[],a.forEach((function(e){if(null==n[e])throw new Error("classWeight must contain all classes in the training data. The class "+e+" exists in the data but not in classWeight");u.push(n[e])})),[2,yp(u,"float32")];case 2:return[2,null]}}))}))}function C_(e,t){return my(e,t)}var k_=32;function E_(e,t){var n,r;r=t.ys,lc.assert(null!=(n=t.xs)&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t}));var i=__("input",e.inputNames,n),a=__("output",e.outputNames,r),o=i[0].shape[0];lc.assert(i.length===e.inputs.length,(function(){return"LayersModel has "+e.inputs.length+" inputs, but the dataset provides "+i.length+" inputs.  (Expected input keys: "+JSON.stringify(e.inputNames)+")"})),lc.assert(a.length===e.outputs.length,(function(){return"LayersModel has "+e.outputs.length+" outputs, but the dataset provides "+a.length+" outputs.  (Expected output keys: "+JSON.stringify(e.outputNames)+")"}));for(var s=function(t){lc.assert(i[t].shape[0]===o,(function(){return"Batch size mismatch: input "+e.inputNames[t]+" has "+i[t].shape[0]+"; expected  "+o+" based on input "+e.inputNames[0]+"."}))},u=0;u<i.length;u++)s(u);for(var l=function(t){lc.assert(a[t].shape[0]===o,(function(){return"Batch size mismatch: output "+e.outputNames[t]+" has "+a[t].shape[0]+"; expected  "+o+" based on input "+e.inputNames[0]+"."}))},c=0;c<a.length;c++)l(c);return{xs:i,ys:a}}function __(e,t,n){if(n instanceof wc)return[n];if(Array.isArray(n))return lc.assert(n.length===t.length,(function(){return"Received an array of "+n.length+" Tensors, but expected "+t.length+" to match the "+e+" keys "+t+"."})),n;for(var r=[],i=0,a=t;i<a.length;i++){var o=a[i];if(null==n[o])throw new kC("The feature data generated by the dataset lacks the required "+e+" key '"+o+"'.");r.push(n[o])}return r}function A_(e,t,n){return yC(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h,p,f,d,m,v,g,y,b,w,x,C,k,E,_,A,S,N,D,I,T,R,O,F;return bC(this,(function(M){switch(M.label){case 0:if(r=null!=n.batchesPerEpoch,lc.assert(null!=e.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),lc.assert(null!=n,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),lc.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs})),lc.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch})),lc.assert(null==n.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0,M.label=1;case 1:return M.trys.push([1,,26,27]),a=void 0,o=void 0,(i=null!=n.validationData)&&(S_(n.validationData)?lc.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches})):(s=function(e){if(3===e.length)throw new EC("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData),a=s.xs,o=s.ys)),u=e.makeTrainFunction(),l=e.getDedupedMetricsNames(),c=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),h=ME(n.callbacks,n.yieldEvery),p=BE(h,null==n.verbose?1:n.verbose,n.epochs,null,null,function(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,i,c),d=p.history,(f=p.callbackList).setModel(e),e.history=d,[4,f.onTrainBegin()];case 2:return M.sent(),e.stopTraining_=!1,m=null==n.initialEpoch?0:n.initialEpoch,[4,t.iterator()];case 3:v=M.sent(),M.label=4;case 4:return m<n.epochs?(g={},[4,f.onEpochBegin(m)]):[3,23];case 5:return M.sent(),y=0,b=0,r?[3,7]:[4,t.iterator()];case 6:v=M.sent(),M.label=7;case 7:return!r||y<n.batchesPerEpoch?[4,v.next()]:[3,21];case 8:return w=M.sent(),r&&w.done?(console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+y+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):null==w.value?[3,15]:(x=E_(e,w.value),C=x.xs,k=x.ys,(E={}).batch=b,E.size=C[0].shape[0],[4,f.onBatchBegin(b,E)]);case 9:if(M.sent(),_=[],null==n.classWeight)return[3,13];A=w_(n.classWeight,e.outputNames),F=0,M.label=10;case 10:return F<A.length?(N=(S=_).push,[4,x_(k[F],null,A[F])]):[3,13];case 11:N.apply(S,[M.sent()]),M.label=12;case 12:return++F,[3,10];case 13:for(D=C.concat(k).concat(_),I=u(D),Xh(D),F=0;F<l.length;++F)E[l[F]]=T=I[F],Qh(T);return[4,f.onBatchEnd(b,E)];case 14:M.sent(),NE(E),b++,y++,M.label=15;case 15:return(r?y>=n.batchesPerEpoch:w.done)?i?(R=void 0,S_(n.validationData)?(O=IC,[4,e.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return R=O.apply(void 0,[M.sent()]),[3,18];case 17:R=IC(e.evaluate(a,o,{batchSize:null==n.validationBatchSize?k_:n.validationBatchSize,verbose:0})),M.label=18;case 18:for(F=0;F<e.metricsNames.length;++F)g["val_"+e.metricsNames[F]]=R[F];M.label=19;case 19:return[3,21];case 20:return e.stopTraining_?[3,21]:[3,7];case 21:return[4,f.onEpochEnd(m,g)];case 22:return M.sent(),m++,e.stopTraining_?[3,23]:[3,4];case 23:return[4,f.onTrainEnd()];case 24:return M.sent(),[4,e.history.syncData()];case 25:return M.sent(),[2,e.history];case 26:return e.isTraining=!1,[7];case 27:return[2]}}))}))}function S_(e){return"function"==typeof e.iterator}function N_(e,t,n){return yC(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h,p;return bC(this,(function(f){switch(f.label){case 0:if(r=null!=(n=n||{}).batches,i=e.testFunction,a=[],n.verbose>0)throw new EC("Verbose mode is not implemented yet.");return lc.assert(!r||n.batches>0&&Number.isInteger(n.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches)})),function(e){return"function"==typeof e.next}(t)?(s=t,[3,3]):[3,1];case 1:return[4,t.iterator()];case 2:s=f.sent(),f.label=3;case 3:o=s,u=0,l=0,c=function(){var t;return bC(this,(function(s){switch(s.label){case 0:return[4,o.next()];case 1:return t=s.sent(),a=Kh((function(){if(t.value){var n=E_(e,t.value),r=n.xs.concat(n.ys),o=Kh((function(){return i(r)}));if(Xh(r),0===l)for(var s=0;s<o.length;++s)a.push(gp(0));var c=r[0].shape[0],h=function(e){var t=o[e],n=a[e];a[e]=Kh((function(){return ty(a[e],my(c,t))})),l>0&&Xh(n)};for(s=0;s<o.length;++s)h(s);Xh(o),u+=c,++l}return a})),t.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+n.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}}))},f.label=4;case 4:return!r||l<n.batches?[5,c()]:[3,6];case 5:return"break"===f.sent()?[3,6]:[3,4];case 6:for(h=0;h<a.length;++h)p=a[h],a[h]=ay(a[h],u),Xh(p);return[2,DC(a)]}}))}))}function D_(e){lc.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got "+e}))}function I_(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return Ck(e,t,n-t)})):Ck(e,t,n-t)}function T_(e,t){return Kh((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return T_(e,t)})):Ik(e,"int32"===t.dtype?t:t.toInt())}))}function R_(e,t){for(var n=[],r=0,i=null;r<e;)(i=r+t)>=e&&(i=e),n.push([r,i]),r=i;return n}function O_(e,t,n,r,i,a,o,s,u,l,c,h,p,f,d){return yC(this,void 0,void 0,(function(){var m,v,g,y,b,w,x,C;return bC(this,(function(k){switch(k.label){case 0:if(null==i&&(i=32),null==a&&(a=1),null==c&&(c=!0),null==p&&(p=0),m=!1,null!=u&&null!=l&&(m=!0),null!=d&&(m=!0,null==f))throw new kC("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(v=e.checkNumSamples(n,i,f,"steps_per_epoch"))&&(g=bk(0,v)),null==o&&(o=1),y=BE(s,o,a,p,v,f,i,m,h),w=y.history,(b=y.callbackList).setModel(e),e.history=w,[4,b.onTrainBegin()];case 1:k.sent(),e.stopTraining_=!1,x=function(a){var o,s,h,p,d;return bC(this,(function(y){switch(y.label){case 0:return[4,b.onEpochBegin(a)];case 1:if(y.sent(),o={},null==f)return[3,2];throw new EC("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===c)throw new EC("batch shuffling is not implemneted yet");c&&lc.shuffle(g),s=yp(g),h=R_(v,i),p=function(a){var c;return bC(this,(function(p){switch(p.label){case 0:return[4,b.onBatchBegin(a,c={})];case 1:return p.sent(),Kh((function(){var p=h[a][0],f=h[a][1],d=Ck(s,p,f-p);c.batch=a,c.size=f-p;for(var v=T_(n,d),g=t(v),y=0;y<r.length;++y){var b=r[y],w=g[y];c[b]=w,Qh(w)}if(a===h.length-1&&m){var x=e.testLoop(u,l,i);for(y=0;y<r.length;++y)b=r[y],Qh(w=x[y]),o["val_"+b]=w}})),[4,b.onBatchEnd(a,c)];case 2:return p.sent(),NE(c),e.stopTraining_?[2,"break"]:[2]}}))},d=0,y.label=3;case 3:return d<h.length?[5,p(d)]:[3,6];case 4:if("break"===y.sent())return[3,6];y.label=5;case 5:return++d,[3,3];case 6:s.dispose(),y.label=7;case 7:return[4,b.onEpochEnd(a,o)];case 8:return y.sent(),e.stopTraining_?[2,"break"]:[2]}}))},C=p,k.label=2;case 2:return C<a?[5,x(C)]:[3,5];case 3:if("break"===k.sent())return[3,5];k.label=4;case 4:return++C,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return k.sent(),[4,e.history.syncData()];case 7:return k.sent(),[2,e.history]}}))}))}function F_(e,t,n,r){return void 0===r&&(r={}),yC(this,void 0,void 0,(function(){var i,a,o,s,u,l,c,h,p,f,d,m,v,g,y,b,w,x,C,k;return bC(this,(function(E){switch(E.label){case 0:if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0,E.label=1;case 1:return E.trys.push([1,,7,8]),D_(h=null==r.batchSize?32:r.batchSize),[4,e.standardizeUserData(t,n,r.sampleWeight,r.classWeight,!1,h)];case 2:if(p=E.sent(),i=p[0],a=p[1],c=p[2],f=!1,d=void 0,!(null!=r.validationData&&r.validationData.length>0))return[3,4];if(f=!0,2!==r.validationData.length)throw 3===r.validationData.length?new EC("validationData including sample weights is not supported yet."):new kC("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+r.validationData+" is invalid.");return[4,e.standardizeUserData(o=r.validationData[0],s=r.validationData[1],null,null,!0,h)];case 3:return m=E.sent(),d=(u=m[0]).concat(l=m[1]),[3,5];case 4:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(f=!0,v=Math.floor(i[0].shape[0]*(1-r.validationSplit)),u=I_(i,v,g=i[0].shape[0]),i=I_(i,0,v),l=I_(a,v,g),a=I_(a,0,v),d=u.concat(l)):null!=r.validationSteps&&(f=!0),E.label=5;case 5:return y=i.concat(a).concat(c),e.checkTrainableWeightsConsistency(),b=e.makeTrainFunction(),w=e.getDedupedMetricsNames(),x=void 0,C=void 0,f?(e.makeTestFunction(),x=e.testFunction,C=w.slice().concat(w.map((function(e){return"val_"+e})))):(x=null,d=[],C=w.slice()),k=ME(r.callbacks,r.yieldEvery),[4,O_(e,b,y,w,h,r.epochs,r.verbose,k,x,d,r.shuffle,C,r.initialEpoch,null,null)];case 6:return[2,E.sent()];case 7:return e.isTraining=!1,L_(i,t),L_(a,n),L_(u,o),L_(l,s),null!=c&&Xh(c),[7];case 8:return[2]}}))}))}function M_(e){var t=[];e instanceof wc&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(xk(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function L_(e,t){if(null!=e){var n=[];if(t instanceof wc)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t)n.push(t[r].id);var i=[];if(e instanceof wc)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var a in e){var o=e[a];-1===n.indexOf(o.id)&&i.push(o)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function B_(e){return Array.isArray(e)}function P_(e){return!function(e){return e instanceof wc}(e)&&!B_(e)}function z_(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=""),null==t||0===t.length){if(null!=e){var a=!1;if(B_(e)&&e.length>0)a=!0;else if(P_(e)){for(var o in e)if(e.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new kC("Error when checking model "+i+" expected no data, but got "+e)}return[]}if(null==e)return t.map((function(e){return null}));var s;if(P_(e)){e=e,s=[];for(var u=0,l=t;u<l.length;u++){var c=l[u];if(null==e[c])throw new kC('No data provided for "'+c+'". Need data for each key in: '+t);s.push(e[c])}}else if(B_(e)){if((e=e).length!==t.length)throw new kC("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(e=e,t.length>1)throw new kC("The model "+i+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}if(s=M_(s),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var p=s[h];if(p.shape.length!==n[h].length)throw new kC("Error when checking "+i+": expected "+t[h]+" to have "+n[h].length+" dimension(s). but got array with shape "+p.shape);for(var f=0;f<n[h].length;++f)if(0!==f||r){var d=n[h][f];if(null!=d&&d>=0&&p.shape[f]!==d)throw new kC("Error when checking "+i+": expected "+t[h]+" to have shape ["+n[h]+"], but got array with shape ["+p.shape+"].")}}return s}function V_(e,t,n,r,i){var a;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(e)){if(e.length!==t.length)throw new kC("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");a=e}else{if(t.length>1)throw new kC("The model expects "+t.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=a[o];if(s.shape.length!==n[o].length)throw new kC("Error when checking "+i+": expected "+t[o]+" to have "+n[o].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[o].length;++u)if(0!==u||r){var l=n[o][u];if(null!=l&&l!==s.shape[u])throw new kC("Error when checking "+i+": expected "+t[o]+" to have shape "+JSON.stringify(n[o])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var W_=function(e){function t(t){var n=e.call(this,t)||this;return n.isTraining=!1,n}return mC(t,e),t.prototype.summary=function(e,t,n){if(void 0===n&&(n=console.log),!this.built)throw new kC("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n,r){void 0===r&&(r=console.log);var i,a=function(e){var t=!0,n=[],r=[];for(var i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(var a=0,o=n;a<o.length;a++){var s=o[a];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,s)}if(t)for(var u=0,l=e.layers;u<l.length;u++){for(var c=!1,h=0,p=l[u].inboundNodes;h<p.length;h++)if(-1!==r.indexOf(p[h])){if(c){t=!1;break}c=!0}if(!t)break}return t}(e),o=["Layer (type)","Output shape","Param #"];if(a?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!a)for(var s in o.push("Receives inputs"),i=[],e.nodesByDepth)i.push.apply(i,e.nodesByDepth[s]);r("_".repeat(t)),s_(o,n,r),r("=".repeat(t));for(var u=e.layers,l=0;l<u.length;++l)a?u_(u[l],n,r):l_(u[l],n,i,r),r((l===u.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var c=function(e){return pE(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights)}(e),h=pE(e.nonTrainableWeights);r("Total params: "+(c+h)),r("Trainable params: "+c),r("Non-trainable params: "+h),r("_".repeat(t))}(this,e,t,n)},t.prototype.compile=function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return hC.adagrad(.01)},Adadelta:function(){return hC.adadelta(1,.95,wC())},Adam:function(){return hC.adam(.001,.9,.999,wC())},Adamax:function(){return hC.adamax(.002,.9,.999,wC(),0)},RMSProp:function(){return hC.rmsprop(.001,.9,0,wC())},SGD:function(){return hC.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new kC("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof nC))throw new kC("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new kC("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");n=e.loss.map((function(e){return XE(e)}))}else{var r=XE(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new kC('Unknown entry in loss dictionary: "'+i+'". Only expected the following keys: '+this.outputNames);for(var a=0,o=this.outputNames;a<o.length;a++){var s=o[a];null==e.loss[s]&&console.warn('Output "'+s+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+s+" during training"),n.push(XE(e.loss[s]))}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var l=this.internalOutputShapes[u];this.feedOutputNames.push(this.outputNames[u]),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[u])}var c=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],lk("loss",(function(){for(var e=0;e<t.outputs.length;++e)-1===c.indexOf(e)&&t.outputs.length>1&&(t.metricsTensors.push([t.lossFunctions[e],e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map((function(e){return n}));for(var r=[],i=0,a=t;i<a.length;i++){var o=a[i],s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}(e.metrics,this.outputNames);lk("metric",(function(){for(var e=function(e){if(-1!==c.indexOf(e))return"continue";!function(n){for(var r,i,a,o=function(n){if("string"==typeof n&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var o=t.internalOutputShapes[e];1===o[o.length-1]||t.lossFunctions[e]===GE?-1!==["accuracy","acc"].indexOf(n)?i=QE:-1!==["crossentropy","ce"].indexOf(n)&&(i=JE):t.lossFunctions[e]===HE?-1!==["accuracy","acc"].indexOf(n)?i=e_:-1!==["crossentropy","ce"].indexOf(n)&&(i=n_):-1!==["accuracy","acc"].indexOf(n)?i=ZE:-1!==["crossentropy","ce"].indexOf(n)&&(i=t_);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),a=i,r=""+s}else{var u=function(e){if("string"==typeof e&&e in r_)return r_[e];if("string"!=typeof e&&null!=e)return e;throw new kC("Unknown metric "+e)}(n);a=u,r=""+i_(n)}var l;lk(r,(function(){l=a})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,l)},s=0,u=n;s<u.length;s++)o(u[s])}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights},t.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},t.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;D_(r);var i=this.standardizeUserDataXY(e,t,!0,r);try{var a=i[0].concat(i[1]);return this.makeTestFunction(),DC(this.testLoop(this.testFunction,a,r,n.verbose,n.steps))}finally{L_(i[0],e),L_(i[1],t)}},t.prototype.evaluateDataset=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){return this.makeTestFunction(),[2,N_(this,e,t)]}))}))},t.prototype.checkNumSamples=function(e,t,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if(i=null,null!=t)throw new kC("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new kC("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i},t.prototype.execute=function(e,t){if(Array.isArray(t)&&0===t.length)throw new kC("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),i=new p_;if(e instanceof wc&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new kC("The number of inputs provided ("+e.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var a=0;a<this.inputs.length;++a)i.add(this.inputs[a],e[a])}else for(var o=0,s=this.inputs;o<s.length;o++){var u=s[o],l=e[u.name];if(null==l)throw new kC("No value is provided for the model's input "+u.name);i.add(u,l)}var c=m_(r,i);return n?c:c[0]},t.prototype.retrieveSymbolicTensors=function(e){for(var t=AC(null,e.length),n=e.length,r=0,i=this.layers;r<i.length;r++){for(var a=i[r],o=Array.isArray(a.output)?a.output:[a.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var l=s.indexOf(e[u]);if(-1!==l&&(t[u]=o[l],n--),0===n)break}if(0===n)break}if(n>0){var c=[];throw t.forEach((function(t,n){null==t&&c.push(e[n])})),new kC("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return t},t.prototype.predictLoop=function(e,t,n){var r=this;return void 0===t&&(t=32),void 0===n&&(n=!1),Kh((function(){var i=r.checkNumSamples(e);if(n)throw new EC("Verbose predictLoop() is not implemented yet.");for(var a=R_(i,t),o=r.outputs.map((function(e){return[]})),s=function(t){Kh((function(){var n=I_(e,a[t][0],a[t][1]),i=[];if(Array.isArray(n))for(var o=0;o<n.length;++o)i.push({key:r.inputs[o],value:n[o]});else i.push({key:r.inputs[0],value:n});var s=new p_(i);return m_(r.outputs,s)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<a.length;++u)s(u);return DC(o.map((function(e){return Ip(e,0)})))}))},t.prototype.predict=function(e,t){void 0===t&&(t={});var n=M_(e);V_(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return D_(r),this.predictLoop(n,r)}finally{L_(n,e)}},t.prototype.predictOnBatch=function(e){V_(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)},t.prototype.standardizeUserDataXY=function(e,t,n,r){if(void 0===n&&(n=!0),null==this.optimizer_)throw new CC("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var i=[],a=0;a<this.feedOutputShapes.length;++a){var o=this.feedOutputShapes[a];i.push(this.feedLossFns[a]===HE?o.slice(0,o.length-1).concat([1]):o)}if(function(e,t,n){var r=BC(e.map((function(e){return e.shape[0]})));r.sort();var i=BC(t.map((function(e){return e.shape[0]})));if(i.sort(),r.length>1)throw new kC("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map((function(e){return e.shape}))));if(i.length>1)throw new kC("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(e){return e.shape}))));if(r.length>0&&i.length>0&&!lc.arraysEqual(r,i))throw new kC("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+i[0]+" target sample(s).")}(e=z_(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=z_(t,this.feedOutputNames,i,!1,"target")),function(e,t,n){for(var r=[VE,GE,jE],i=0;i<e.length;++i){var a=e[i],o=t[i],s=n[i];if(null!=o){if(o===jE&&1===a.shape[a.shape.length-1])throw new kC("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=a.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var h=l[c];if(null!=h&&u[c]!==h)throw new kC("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new kC("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+e[0].shape[0]+" sample(s).");return[e,t]},t.prototype.standardizeUserData=function(e,t,n,r,i,a){return void 0===i&&(i=!0),yC(this,void 0,void 0,(function(){var o,s,u,l,c,h,p,f;return bC(this,(function(d){switch(d.label){case 0:if(o=this.standardizeUserDataXY(e,t,i,a),s=o[0],u=o[1],null!=n)throw new Error("sample weight is not supported yet.");if(l=null,null==r)return[3,4];c=w_(r,this.outputNames),l=[],h=0,d.label=1;case 1:return h<c.length?(f=(p=l).push,[4,x_(u[h],null,c[h])]):[3,4];case 2:f.apply(p,[d.sent()]),d.label=3;case 3:return++h,[3,1];case 4:return[2,[s,u,l]]}}))}))},t.prototype.testLoop=function(e,t,n,r,i){var a=this;return void 0===r&&(r=0),Kh((function(){var o=a.checkNumSamples(t,n,i,"steps"),s=[];if(r>0)throw new EC("Verbose mode is not implemented yet.");if(null!=i)throw new EC("steps mode in testLoop() is not implemented yet");for(var u=R_(o,n),l=yp(bk(0,o)),c=0;c<u.length;++c){var h=u[c][0],p=u[c][1],f=Ck(l,h,p-h),d=T_(t,f),m=e(d);if(0===c)for(var v=0;v<m.length;++v)s.push(gp(0));for(v=0;v<m.length;++v)s[v]=ty(s[v],my(p-h,m[v]))}for(v=0;v<s.length;++v)s[v]=ay(s[v],o);return s}))},t.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],i=r;NC(e,r)>1&&(i+="_"+NC(e.slice(0,n),r)),t.push(i)}return t},t.prototype.makeTrainFunction=function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),a=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});var u,l=new p_(t),c=m_(e.outputs,l,{training:!0});for(s=0;s<e.lossFunctions.length;++s){var h=(0,e.lossFunctions[s])(i[s],c[s]);null!=a[s]&&(h=C_(h,a[s]));var p=Ab(h);n.push(p),u=0===s?h:ty(u,h)}for(s=0;s<e.metricsTensors.length;++s){var f=void 0;if(e.outputs.length>1&&s<e.outputs.length)f=n[s];else{var d=e.metricsTensors[s][1];f=Ab((0,e.metricsTensors[s][0])(i[d],c[d]))}Qh(f),o.push(f)}return u=Ab(u),e.calculateLosses().forEach((function(e){u=ty(u,e)})),u}),!0,s)].concat(o)}},t.prototype.makeTestFunction=function(){var e=this;this.testFunction=function(t){return Kh((function(){for(var n,r=[],i=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:i[s]});var u=new p_(o),l=m_(e.outputs,u);for(s=0;s<e.lossFunctions.length;++s){var c=Ab((0,e.lossFunctions[s])(a[s],l[s]));n=0===s?c:ty(n,c),r.push(n)}for(s=0;s<e.metricsTensors.length;++s){var h=e.metricsTensors[s][1],p=Ab((0,e.metricsTensors[s][0])(a[h],l[h]));r.push(p)}return r}))}},t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),yC(this,void 0,void 0,(function(){return bC(this,(function(r){return[2,F_(this,e,t,n)]}))}))},t.prototype.fitDataset=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){return[2,A_(this,e,t)]}))}))},t.prototype.trainOnBatch=function(e,t){return yC(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,c;return bC(this,(function(h){switch(h.label){case 0:return[4,this.standardizeUserData(e,t)];case 1:n=h.sent(),r=n[0],i=n[1],a=this.makeTrainFunction(),o=a(r.concat(i)),s=[],u=0,l=o,h.label=2;case 2:return u<l.length?[4,l[u].data()]:[3,5];case 3:c=h.sent(),s.push(c[0]),h.label=4;case 4:return u++,[3,2];case 5:return Xh(o),[2,DC(s)]}}))}))},t.prototype.getNamedWeights=function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t},Object.defineProperty(t.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=e.prototype.dispose.call(this);if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var n=qh().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-qh().numTensors}return t},t.prototype.getLossIdentifiers=function(){var e;if("string"==typeof this.loss)e=TC(this.loss);else if(Array.isArray(this.loss)){for(var t=0,n=this.loss;t<n.length;t++)if("string"!=typeof n[t])throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((function(e){return TC(e)}))}else{var r=Object.keys(this.loss);e={};for(var i=this.loss,a=0,o=r;a<o.length;a++){var s=o[a];if("string"!=typeof i[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=TC(i[s])}}return e},t.prototype.getMetricIdentifiers=function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[TC(i_(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return TC(i_(e))}));var e={};for(var t in this.metrics)e[t]=TC(i_(this.metrics[t]));return e},t.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},t.prototype.loadTrainingConfig=function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=PE(h_(e.optimizer_config));if("string"==typeof e.loss)t=RC(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return RC(e)}));else if(null!=e.loss)for(var i in t={},e.loss)t[i]=RC(e.loss[i]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return RC(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=RC(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})},t.prototype.save=function(e,t){return yC(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,c,h;return bC(this,(function(p){switch(p.label){case 0:if("string"==typeof e){if(0===(n=jx.getSaveHandlers(e)).length)throw new kC("Cannot find any save handlers for URL '"+e+"'");if(n.length>1)throw new kC("Found more than one ("+n.length+") save handlers for URL '"+e+"'");e=n[0]}if(null==e.save)throw new kC("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,jx.encodeWeights(this.getNamedWeights(t))];case 1:return r=p.sent(),i=this.toJSON(null,!1),a={modelTopology:i,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.5.1",convertedBy:null},null!=t&&t.includeOptimizer&&null!=this.optimizer?(a.trainingConfig=this.getTrainingConfig(),o="optimizer",c=(l=jx).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,c.apply(l,[p.sent(),o])];case 3:s=p.sent(),u=s.data,(h=r.specs).push.apply(h,s.specs),r.data=jx.concatenateArrayBuffers([r.data,u]),p.label=4;case 4:return null!=this.userDefinedMetadata&&(o_(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,[2,e.save(a)]}}))}))},t.prototype.setUserDefinedMetadata=function(e){o_(e,this.name),this.userDefinedMetadata=e},t.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},t.className="Model",t}(b_);function U_(e,t,n){return yC(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h;return bC(this,(function(p){switch(p.label){case 0:if(null==n&&(n={}),null==e.load)throw new kC("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,e.load()];case 1:if(r=p.sent(),null!=(i=r.modelTopology).model_config&&(i=i.model_config),a=null==n.strict||n.strict,o=null!=r.weightData&&null!=r.weightSpecs&&a,s=PE(h_(i),t,o),null!=(u=r.trainingConfig)&&s.loadTrainingConfig(u),null!=r.userDefinedMetadata&&s.setUserDefinedMetadata(r.userDefinedMetadata),null==r.weightData)return[3,4];if(null==r.weightSpecs)throw new kC("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return l=function(e,t){var n=jx.decodeWeights(e,t),r={},i=[];return t.forEach((function(e){"optimizer"===e.group?i.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs),h=l.optimizerWeights,s.loadWeights(c=l.modelWeights,a),null!=s.optimizer&&h.length>0?[4,s.optimizer.setWeights(h)]:[3,3];case 2:p.sent(),p.label=3;case 3:Xh(c),Xh(h.map((function(e){return e.tensor}))),p.label=4;case 4:return[2,s]}}))}))}Zx.registerClass(W_);var j_=function(e){function t(t){var n=e.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},n.trainable=!0,n.built=!1,n.name=null!=t.name?t.name:sE("sequential_"),null!=t.layers)for(var r=0,i=t.layers;r<i.length;r++)n.add(i[r]);return n}return mC(t,e),t.prototype.checkShape=function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new kC("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")},t.prototype.add=function(e){var n,r=e instanceof t||e instanceof W_;if(r){if(1!==(n=e).outputs.length)throw new kC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new kC("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new kC("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=AE({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new kC("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new kC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var i=n.inboundNodes[r];if(0===i.inboundLayers.length)return i.inputTensors;for(var a=[],o=0;o<i.inboundLayers.length;o++)for(var s=0,u=e(i.inputTensors[o],i.inboundLayers[o],i.nodeIndices[o]);s<u.length;s++){var l=u[s];-1===a.indexOf(l)&&a.push(l)}return a}(this.outputs[0])}this.inboundNodes=[],new CE({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:AC(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},t.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},t.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},t.prototype.build=function(e){if(hE(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new W_({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},t.prototype.countParams=function(){return this.built||this.build(),e.prototype.countParams.call(this)},t.prototype.summary=function(t,n,r){void 0===r&&(r=console.log),this.built||this.build(),e.prototype.summary.call(this,t,n,r)},t.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},t.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new CC("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},t.prototype.evaluateDataset=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){if(!this.built)throw new CC("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(e,t)]}))}))},t.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},t.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},t.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(t.prototype,"optimizer",{get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e},enumerable:!0,configurable:!0}),t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),yC(this,void 0,void 0,(function(){return bC(this,(function(r){if(!this.built)throw new CC("The model needs to be compiled before being used.");return[2,this.model.fit(e,t,n)]}))}))},t.prototype.fitDataset=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){if(!this.built)throw new CC("The model needs to be compiled before being used.");return[2,this.model.fitDataset(e,t)]}))}))},t.prototype.trainOnBatch=function(e,t){return yC(this,void 0,void 0,(function(){return bC(this,(function(n){return[2,this.model.trainOnBatch(e,t)]}))}))},t.fromConfig=function(e,n,r,i){var a;void 0===r&&(r={}),void 0===i&&(i=!1);var o={};if(n instanceof Array){if(null==n[0].className||"Merge"===n[0].className)throw new kC("Legacy serialization format not supported yet.");a=n}else lc.assert(null!=n.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),a=n.layers,delete n.layers,o=n;var s=new e(o);if(!(s instanceof t))throw new EC("Sequential.fromConfig called on non-Sequential input: "+s);for(var u=0,l=a;u<l.length;u++){var c=PE(l[u],void 0,i);i&&c.setFastWeightInitDuringBuild(!0),s.add(c)}return s},Object.defineProperty(t.prototype,"stopTraining",{get:function(){if(null==this.model)throw new kC("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new kC("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t],i={};i.className=r.getClassName(),i.config=r.getConfig(),e.push(i)}return{name:this.name,layers:e}},t.className="Sequential",t}(W_);Zx.registerClass(j_);var H_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.getConfig=function(){return{}},t}(Zx.Serializable),G_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),function(e,t){if(void 0===t&&(t=1),1!==t)throw new EC("Support for alpha values other than 1 ("+t+") is not implemented yet.");return Tb(e)}(e,t)},t.className="elu",t}(H_);Zx.registerClass(G_);var q_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return Lb(e)},t.className="selu",t}(H_);Zx.registerClass(q_);var K_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return Fb(e)},t.className="relu",t}(H_);Zx.registerClass(K_);var X_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return Kh((function(){return hy(6,Fb(e))}))},t.className="relu6",t}(H_);Zx.registerClass(X_);var Q_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}(H_);Zx.registerClass(Q_);var Z_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return kg(e)},t.className="sigmoid",t}(H_);Zx.registerClass(Z_);var $_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return function(e){return Kh((function(){var t=ty(.5,my(.2,e));return lg(t,0,1)}))}(e)},t.className="hardSigmoid",t}(H_);Zx.registerClass($_);var Y_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return Ig(e)},t.className="softplus",t}(H_);Zx.registerClass(Y_);var J_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return function(e){return Kh((function(){return ay(e,tg(e).add(1))}))}(e)},t.className="softsign",t}(H_);Zx.registerClass(J_);var eA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e){return Fg(e)},t.className="tanh",t}(H_);Zx.registerClass(eA);var tA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),Vf(e,t)},t.className="softmax",t}(H_);Zx.registerClass(tA);var nA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),Wf(e,t)},t.className="logSoftmax",t}(H_);function rA(e){return e.getClassName()}function iA(e,t){return void 0===t&&(t={}),MC(e,Zx.SerializationMap.getMap().classNameMap,t,"activation")}function aA(e){var t;return null==e?iA(t={className:"linear",config:{}}):"string"==typeof e?((t={}).className=e,t.config={},iA(t)):e instanceof H_?e:iA(e)}function oA(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}Zx.registerClass(nA);var sA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t}(Zx.Serializable),uA=function(e){function t(t){var n=e.call(this)||this;return oA(t),n.l1=null==t||null==t.l1?.01:t.l1,n.l2=null==t||null==t.l2?.01:t.l2,n.hasL1=0!==n.l1,n.hasL2=0!==n.l2,n}return mC(t,e),t.prototype.apply=function(e){var t=this;return Kh((function(){var n=Ep([1]);return t.hasL1&&(n=ty(n,Db(my(t.l1,tg(e))))),t.hasL2&&(n=ty(n,Db(my(t.l2,Tk(e))))),n.asScalar()}))},t.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},t.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},t.className="L1L2",t}(sA);Zx.registerClass(uA);var lA={l1l2:"L1L2"};function cA(e){return FC(e)}function hA(e,t){return void 0===t&&(t={}),MC(e,Zx.SerializationMap.getMap().classNameMap,t,"regularizer")}function pA(e){return null==e?null:"string"==typeof e?hA({className:e in lA?lA[e]:e,config:{}}):e instanceof sA?e:hA(e)}var fA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,null!=t&&(n.maxValue=t.maxValue),n}return mC(t,e),t.prototype.call=function(e,t){e=cE(e);var n=Fb(e);return null!=this.maxValue&&(n=lg(n,0,this.maxValue)),n},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ReLU",t}(EE);Zx.registerClass(fA);var dA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_ALPHA=.3,null==t&&(t={}),n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return mC(t,e),t.prototype.call=function(e,t){var n=cE(e);return Rb(n,this.alpha)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LeakyReLU",t}(EE);Zx.registerClass(dA);var mA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),n.supportsMasking=!0,n.alphaInitializer=rE(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=pA(t.alphaRegularizer),n.alphaConstraint=YC(t.alphaConstraint),null==t.sharedAxes)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new kC("Expected sharedAxes to be a number or an array of numbers, but got "+t.sharedAxes);n.sharedAxes=[t.sharedAxes]}return n}return mC(t,e),t.prototype.build=function(e){var t=(e=hE(e)).slice(1);if(null!=this.sharedAxes)for(var n=0,r=this.sharedAxes;n<r.length;n++)t[(a=r[n])-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var i={};if(null!=this.sharedAxes)for(var a=1;a<e.length;++a)i[a]=e[a];this.inputSpec=[new bE({ndim:e.length,axes:i})],this.built=!0},t.prototype.call=function(e,t){return e=cE(e),Ob(e,this.alpha.read())},t.prototype.getConfig=function(){var t={alphaInitializer:nE(this.alphaInitializer),alphaRegularizer:cA(this.alphaRegularizer),alphaConstraint:ZC(this.alphaConstraint),sharedAxes:this.sharedAxes},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="PReLU",t}(EE);Zx.registerClass(mA);var vA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==n.DEFAULT_ALPHA)throw new EC("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return mC(t,e),t.prototype.call=function(e,t){var n=cE(e);return Tb(n)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ELU",t}(EE);Zx.registerClass(vA);var gA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_THETA=1,null==t&&(t={}),n.theta=null==t.theta?n.DEFAULT_THETA:t.theta,n}return mC(t,e),t.prototype.call=function(e,t){var n=cE(e);return n.mul(wk(n.greater(this.theta),"float32"))},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={theta:this.theta},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ThresholdedReLU",t}(EE);Zx.registerClass(gA);var yA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_AXIS=1,null==t&&(t={}),n.softmax=(new tA).apply,n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n}return mC(t,e),t.prototype.call=function(e,t){var n=cE(e);return this.softmax(n,this.axis)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Softmax",t}(EE);function bA(e,t,n){if("number"==typeof e)return AC(e,t);if(e.length!==t)throw new kC("The "+n+" argument must be an integer or tuple of "+t+" integers. Received: "+e.length+" elements.");for(var r=0;r<t;++r){var i=e[r];if(!dk(i))throw new kC("The "+n+" argument must be an integer or tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+i)}return e}function wA(e,t,n,r,i){return void 0===i&&(i=1),null==e?e:Math.floor((("same"===n?e:e-(t+(t-1)*(i-1))+1)+r-1)/r)}function xA(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+yk([n-t,0]);else{if("same"!==r)throw new kC("Unsupport padding mode: "+r+".");e*=t}return e}function CA(e,t){return Kh((function(){return ik(t),"channelsFirst"===t?Bb(e,[0,2,3,1]):e}))}function kA(e,t){return Kh((function(){return ik(t),"channelsFirst"===t?Bb(e,[0,2,3,4,1]):e}))}function EA(e,t,n,r,i,a,o,s){return void 0===r&&(r=[1,1]),void 0===i&&(i="valid"),void 0===s&&(s=null),Kh((function(){if(null==a&&(a="channelsLast"),ik(a),3!==e.rank&&4!==e.rank)throw new kC("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+e.rank+".");if(3!==t.rank&&4!==t.rank)throw new kC("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+e.rank+".");var u=CA(e,a);if("causal"===i)throw new EC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Bw.conv2d({x:u,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===a&&(u=Bb(u,[0,3,1,2])),u}))}Zx.registerClass(yA);var _A=function(e){function t(n,r){var i=e.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(r),i.rank=n,WC(i.rank,"rank"),1!==i.rank&&2!==i.rank&&3!==i.rank)throw new EC("Convolution layer for rank other than 1, 2, or 3 ("+i.rank+") is not implemented yet.");if(i.kernelSize=bA(r.kernelSize,n,"kernelSize"),i.strides=bA(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,ak(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,ik(i.dataFormat),i.activation=aA(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=rE(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=YC(r.biasConstraint),i.biasRegularizer=pA(r.biasRegularizer),i.activityRegularizer=pA(r.activityRegularizer),i.dilationRate=bA(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new kC("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank){if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new kC("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate))}else if(3===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate,i.dilationRate];else if(3!==i.dilationRate.length)throw new kC("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(i.dilationRate));return i}return mC(t,e),t.verifyArgs=function(e){if(SC("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!VC(e.kernelSize,"number",1,3))throw new kC("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(e.kernelSize)+".")},t.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:rA(this.activation),useBias:this.useBias,biasInitializer:nE(this.biasInitializer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),biasConstraint:ZC(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(EE),AA=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.kernel=null,t.verifyArgs(r),i.filters=r.filters,WC(i.filters,"filters"),i.kernelInitializer=rE(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=YC(r.kernelConstraint),i.kernelRegularizer=pA(r.kernelRegularizer),i}return mC(t,e),t.prototype.build=function(e){var t;e=hE(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new kC("The channel dimension of the input should be defined. Found "+e[n]);var r=e[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(t={},t[n]=r,t)}],this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){var t;e=cE(e);var r=null==n.bias?null:n.bias.read(),i=UC(n.activation.getClassName());if(null!=i&&2===n.rank)t=EA(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,i);else{if(1===n.rank)t=function(e,t,n,r,i,a,o){return void 0===r&&(r=1),void 0===i&&(i="valid"),void 0===o&&(o=1),Kh((function(){if(null==a&&(a="channelsLast"),ik(a),3!==e.shape.length)throw new kC("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new kC("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new kC("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===a&&(e=Bb(e,[0,2,1])),"causal"===i)throw new EC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=Uy(e,t,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(s=Ok(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=EA(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new EC("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,r,i,a,o){return void 0===r&&(r=[1,1,1]),void 0===i&&(i="valid"),Kh((function(){if(null==a&&(a="channelsLast"),ik(a),4!==e.rank&&5!==e.rank)throw new kC("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new kC("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");var s=kA(e,a);if("causal"===i)throw new EC("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=Hy(s,t,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(s=Ok(s,n)),"channelsFirst"===a&&(s=Bb(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))},t.prototype.computeOutputShape=function(e){e=hE(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var i=wA(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(i)}var a=[e[0]];return"channelsLast"===this.dataFormat?(a=a.concat(t)).push(this.filters):(a.push(this.filters),a=a.concat(t)),a},t.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:nE(this.kernelInitializer),kernelRegularizer:cA(this.kernelRegularizer),kernelConstraint:ZC(this.kernelConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.verifyArgs=function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new kC("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))},t}(_A),SA=function(e){function t(n){var r=e.call(this,2,n)||this;return t.verifyArgs(n),r}return mC(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&!VC(e.kernelSize,"number",1,2))throw new kC("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv2D",t}(AA);Zx.registerClass(SA);var NA=function(e){function t(n){var r=e.call(this,3,n)||this;return t.verifyArgs(n),r}return mC(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new kC("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv3D",t}(AA);Zx.registerClass(NA);var DA=function(e){function t(t){var n=e.call(this,t)||this;if(n.inputSpec=[new bE({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new kC("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return mC(t,e),t.prototype.build=function(e){var t;if(4!==(e=hE(e)).length)throw new kC("Input should have rank 4; Received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new kC("The channel dimension of the inputs should be defined. Found `None`.");var r=e[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new bE({ndim:4,axes:(t={},t[n]=r,t)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){var t=cE(e);if(4!==t.shape.length)throw new kC("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);var r,i,a=t.shape;"channelsFirst"===n.dataFormat?(r=2,i=3):(r=1,i=2);var o=a[i],s=n.kernelSize[1],u=n.strides[1],l=[a[0],xA(a[r],n.strides[0],n.kernelSize[0],n.padding),xA(o,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Bb(t,[0,2,3,1]));var c=$y(t,n.kernel.read(),l,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(c=Bb(c,[0,3,1,2])),null!=n.bias&&(c=Ok(c,n.bias.read(),n.dataFormat)),null!=n.activation&&(c=n.activation.apply(c)),c}))},t.prototype.computeOutputShape=function(e){var t,n,r,i=(e=hE(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[t]=this.filters,i[n]=xA(i[n],s,a,this.padding),i[r]=xA(i[r],u,o,this.padding),i},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.dilationRate,t},t.className="Conv2DTranspose",t}(SA);Zx.registerClass(DA);var IA=function(e){function t(t){return e.call(this,2,t)||this}return mC(t,e),t.className="SeparableConv2D",t}(function(e){function t(t,n){var r=e.call(this,t,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new kC("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new kC("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new kC("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=rE(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=pA(n.depthwiseRegularizer),r.depthwiseConstraint=YC(n.depthwiseConstraint),r.pointwiseInitializer=rE(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=pA(n.pointwiseRegularizer),r.pointwiseConstraint=YC(n.pointwiseConstraint),r}return mC(t,e),t.prototype.build=function(e){var t;if((e=hE(e)).length<this.rank+2)throw new kC("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n]||e[n]<0)throw new kC("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[n]));for(var r=e[n],i=this.kernelSize.concat([r,this.depthMultiplier]),a=[],o=0;o<this.rank;++o)a.push(1);a.push(r*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new bE({ndim:this.rank+2,axes:(t={},t[n]=r,t)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){var t;if(e=cE(e),1===n.rank)throw new EC("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Bb(e,[0,2,3,1])),t=Zy(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=Ok(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Bb(t,[0,3,1,2])),t}))},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=nE(this.depthwiseInitializer),t.pointwiseInitializer=nE(this.pointwiseInitializer),t.depthwiseRegularizer=cA(this.depthwiseRegularizer),t.pointwiseRegularizer=cA(this.pointwiseRegularizer),t.depthwiseConstraint=ZC(this.depthwiseConstraint),t.pointwiseConstraint=ZC(this.pointwiseConstraint),t},t.className="SeparableConv",t}(AA));Zx.registerClass(IA);var TA=function(e){function t(n){var r=e.call(this,1,n)||this;return t.verifyArgs(n),r.inputSpec=[{ndim:3}],r}return mC(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&!VC(e.kernelSize,"number",1,1))throw new kC("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv1D",t}(AA);Zx.registerClass(TA);var RA=function(e){function t(t){var n=e.call(this,t)||this;return n.cropping="number"==typeof t.cropping?[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:t.cropping,n.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return mC(t,e),t.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){return e=cE(e),"channelsLast"===n.dataFormat?Ek(Ek(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):Ek(Ek(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))},t.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Cropping2D",t}(EE);Zx.registerClass(RA);var OA=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==t.size?n.DEFAULT_SIZE:t.size,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,n}return mC(t,e),t.prototype.computeOutputShape=function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}return[e[0],t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2],e[3]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){var t=cE(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=Bb(t,[0,2,3,1]);var i=n.size[0]*r[2],a=n.size[1]*r[3],o=t.resizeNearestNeighbor([i,a]);return Bb(o,[0,3,1,2])}return t.resizeNearestNeighbor([i=n.size[0]*r[1],a=n.size[1]*r[2]])}))},t.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="UpSampling2D",t}(EE);Zx.registerClass(OA);var FA=function(e){function t(t){var n=e.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=rE(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=YC(t.depthwiseConstraint),n.depthwiseRegularizer=pA(t.depthwiseRegularizer),n}return mC(t,e),t.prototype.build=function(e){if((e=hE(e)).length<4)throw new kC("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new kC("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){var t=function(e,t,n,r,i,a){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),Kh((function(){null==i&&(i="channelsLast"),ik(i);var a=CA(e,i);if(4!==e.rank)throw new kC("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new kC("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return a=Ky(a,t,n,"same"===r?"same":"valid","NHWC",null),"channelsFirst"===i&&(a=Bb(a,[0,3,1,2])),a}))}(e=cE(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat);return n.useBias&&(t=Ok(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))},t.prototype.computeOutputShape=function(e){e=hE(e);var t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=wA("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),i=wA(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,i]:[e[0],r,i,n]},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=nE(this.depthwiseInitializer),t.depthwiseRegularizer=cA(this.depthwiseRegularizer),t.depthwiseConstraint=ZC(this.depthwiseRegularizer),t},t.className="DepthwiseConv2D",t}(_A);Zx.registerClass(FA);var MA=function(e){function t(t){var n=e.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return mC(t,e),t.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e);if(0<n.rate&&n.rate<1){var i=null!=t.training&&t.training,a=n.getNoiseShape(r);return Mk((function(){return Fk(r,n.rate,a,n.seed)}),(function(){return r}),i)}return e}))},t.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.prototype.dispose=function(){return e.prototype.dispose.call(this)},t.className="Dropout",t}(EE);Zx.registerClass(MA);var LA=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return mC(t,e),t.prototype.getNoiseShape=function(e){var t=e.shape;return[t[0],1,t[2]]},t.className="SpatialDropout1D",t}(MA);Zx.registerClass(LA);var BA=function(e){function t(t){var n=e.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){var r=null;null!=t.batchSize&&(r=t.batchSize),n.batchInputShape=[r,t.inputDim]}return n.units=t.units,WC(n.units,"units"),n.activation=aA(t.activation),null!=t.useBias&&(n.useBias=t.useBias),n.kernelInitializer=rE(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=rE(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=YC(t.kernelConstraint),n.biasConstraint=YC(t.biasConstraint),n.kernelRegularizer=pA(t.kernelRegularizer),n.biasRegularizer=pA(t.biasRegularizer),n.activityRegularizer=pA(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return mC(t,e),t.prototype.build=function(e){var t,n=(e=hE(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(t={},t[-1]=n,t)}],this.built=!0},t.prototype.computeOutputShape=function(e){var t=(e=hE(e)).slice();return t[t.length-1]=this.units,t},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r,i=cE(e),a=UC(n.activation.getClassName());return null!=a?r=Dk(i,n.kernel.read(),a,n.bias?n.bias.read():null):(r=Dk(i,n.kernel.read()),null!=n.bias&&(r=Ok(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))},t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),biasInitializer:nE(this.biasInitializer),kernelRegularizer:cA(this.kernelRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),biasConstraint:ZC(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dense",t}(EE);Zx.registerClass(BA);var PA=function(e){function t(t){var n=this;return(n=e.call(this,t=t||{})||this).inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return mC(t,e),t.prototype.computeOutputShape=function(e){for(var t=0,n=(e=hE(e)).slice(1);t<n.length;t++)if(null==n[t])throw new kC('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],mk(e,1)]},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var i=[0],a=2;a<r.rank;++a)i.push(a);i.push(1),r=r.transpose(i)}return function(e){if(e.rank<=1)throw new kC("batchFlatten requires a minimum rank of 2. Got rank: "+e.rank+".");var t=[e.shape[0],mk(e.shape,1)];return e.reshape(t)}(r)}))},t.prototype.getConfig=function(){var t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);var n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Flatten",t}(EE);Zx.registerClass(PA);var zA=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.activation=aA(t.activation),n}return mC(t,e),t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e);return n.activation.apply(r)}))},t.prototype.getConfig=function(){var t={activation:rA(this.activation)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Activation",t}(EE);Zx.registerClass(zA);var VA=function(e){function t(t){var n=e.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return mC(t,e),t.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){return function(e,t){return Kh((function(){if(2!==e.shape.length)throw new kC("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return Sk(xk(e,1),[1,t,1])}))}(e=cE(e),n.n)}))},t.prototype.getConfig=function(){var t={n:this.n},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="RepeatVector",t}(EE);Zx.registerClass(VA);var WA=function(e){function t(t){var n=e.call(this,t)||this;n.targetShape=t.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return mC(t,e),t.prototype.isUnknown=function(e){return e<0||null==e},t.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),i=1,a=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==a)throw new kC("Can only specifiy one unknown dimension.");a=o}else i*=s}var u=mk(e);if(null!==a){if(0===i||u%i!=0)throw new kC(n);r[a]=u/i}else if(u!==i)throw new kC(n);return r},t.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e),i=r.shape,a=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return r.reshape(a)}))},t.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Reshape",t}(EE);Zx.registerClass(WA);var UA=function(e){function t(t){var n=e.call(this,t)||this;if(null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+t.dims+" instead.");var r=bk(1,t.dims.length+1);if(!lc.arraysEqual(t.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new bE({ndim:n.dims.length+1})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){var t=(e=hE(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t},t.prototype.call=function(e,t){return Bb(cE(e),this.dimsIncludingBatch)},t.prototype.getConfig=function(){var t={dims:this.dims},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Permute",t}(EE);Zx.registerClass(UA);var jA=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,n.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0,n}return mC(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},t.prototype.computeMask=function(e,t){var n=cE(e);return xb(Oy(n,this.maskValue),-1)},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e),i=xb(Oy(r,n.maskValue),-1,!0);return r.mul(i.asType(r.dtype))}))},t.className="Masking",t}(EE);Zx.registerClass(jA);var HA=function(e){function t(t){var n=e.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){var r=null;null!=t.batchSize&&(r=t.batchSize),n.batchInputShape=null==t.inputLength?[r,null]:[r].concat(IC(t.inputLength))}return n.inputDim=t.inputDim,WC(n.inputDim,"inputDim"),n.outputDim=t.outputDim,WC(n.outputDim,"outputDim"),n.embeddingsInitializer=rE(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=pA(t.embeddingsRegularizer),n.activityRegularizer=pA(t.activityRegularizer),n.embeddingsConstraint=YC(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return mC(t,e),t.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},t.prototype.warnOnIncompatibleInputShape=function(e){},t.prototype.computeMask=function(e,t){var n=this;return Kh((function(){return n.maskZero?(e=cE(e),Oy(e,Dp(e))):null}))},t.prototype.computeOutputShape=function(e){if(e=hE(e),null==this.inputLength)return e.concat([this.outputDim]);var t=IC(this.inputLength);if(t.length!==e.length-1)throw new kC('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,r=0;r<t.length;++r){var i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new kC('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==i&&(t[n]=a),n++}return[e[0]].concat(t,[this.outputDim])},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e);return"int32"!==r.dtype&&(r=wk(r,"int32")),Ik(n.embeddings.read(),r.as1D()).reshape(hE(n.computeOutputShape(r.shape)))}))},t.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:nE(this.embeddingsInitializer),embeddingsRegularizer:cA(this.embeddingsRegularizer),activityRegularizer:cA(this.activityRegularizer),embeddingsConstraint:ZC(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Embedding",t}(EE);Zx.registerClass(HA);var GA=function(e){function t(t){var n=e.call(this,t||{})||this;return n.supportsMasking=!0,n}return mC(t,e),t.prototype.mergeFunction=function(e){throw new EC},t.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new kC("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n},t.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[hE(e)]),(e=e).length<2)throw new kC("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,r=e;n<r.length;n++)null!=(o=r[n])&&null!==o[0]&&t.push(o[0]);if((t=BC(t)).length>1)throw new kC("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var i=null==e[0]?null:e[0].slice(1),a=1;a<e.length;++a){var o=null==e[a]?null:e[a].slice(1);i=this.computeElementwiseOpOutputShape(i,o)}var s=e.map((function(e){return e.length}));this.reshapeRequired=-1!==e.indexOf(null)||1!==BC(s).length},t.prototype.call=function(e,t){var n=this;return Kh((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){for(var i=yk(r),a=0,o=e;a<o.length;a++){for(var s=(p=o[a]).rank,u=0;u<i-s;++u)p=xk(p,1);t.push(p)}return n.mergeFunction(t)}for(var l=!1,c=0,h=e;c<h.length;c++){var p;if(null==(s=(p=h[c]).rank)){var f=p.shape,d=f[0],m=f.slice(1).concat([d]),v=p.reshape([d].concat(mk(f.slice(1))));v=(v=Bb(v,[1,0])).reshape(m),t.push(v),l=!0}else if(s>1){var g=bk(1,s).concat([0]);t.push(Bb(p,g)),l=!0}else t.push(p)}var y=n.mergeFunction(t),b=y.rank;if(l)if(null==b){var w=y.shape;m=[d=w[w.length-1]].concat(w.slice(0,w.length-1)),y=Bb(y.reshape([-1,d]),[1,0]).reshape(m)}else b>1&&(g=[b-1].concat(bk(0,b-1)),y=Bb(y,g));return y}return n.mergeFunction(e)}))},t.prototype.computeOutputShape=function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}for(var i=[],a=0,o=e;a<o.length;a++)null!=(r=o[a])&&null!==r[0]&&i.push(r[0]);return 1===(i=BC(i)).length?i.concat(t):[null].concat(t)},t.prototype.computeMask=function(e,t){return Kh((function(){if(null==t)return null;if(!Array.isArray(t))throw new kC("`mask` should be an Array");if(!Array.isArray(e))throw new kC("`inputs` should be an Array");if(t.length!==e.length)throw new kC("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+e.length+" vs "+t.length+")");if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:tf(e,0)})))[0],r=1;r<t.length-1;++r)n=Qg(n,t[r]);return n}))},t}(EE),qA=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.mergeFunction=function(e){return Kh((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ty(t,e[n]);return t}))},t.className="Add",t}(GA);Zx.registerClass(qA);var KA=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.mergeFunction=function(e){return Kh((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=my(t,e[n]);return t}))},t.className="Multiply",t}(GA);Zx.registerClass(KA);var XA=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.mergeFunction=function(e){return Kh((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ty(t,e[n]);return my(1/e.length,t)}))},t.className="Average",t}(GA);Zx.registerClass(XA);var QA=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.mergeFunction=function(e){return Kh((function(){for(var t=e[0],n=1;n<e.length;++n)t=ly(t,e[n]);return t}))},t.className="Maximum",t}(GA);Zx.registerClass(QA);var ZA=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.mergeFunction=function(e){return Kh((function(){for(var t=e[0],n=1;n<e.length;++n)t=hy(t,e[n]);return t}))},t.className="Minimum",t}(GA);Zx.registerClass(ZA);var $A=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_AXIS=-1,null==t&&(t={}),n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return mC(t,e),t.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new kC("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var t=!0,n=0,r=e=e;n<r.length;n++)if(null!=(c=r[n])){t=!1;break}if(!t){for(var i=[],a=0;a<e.length;++a){var o=e[a].slice();o.splice(this.axis,1);for(var s=!1,u=0,l=i;u<l.length;u++){var c=l[u];if(lc.arraysEqual(c,o)){s=!0;break}}s||i.push(o)}if(i.length>1)throw new kC("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},t.prototype.mergeFunction=function(e){var t=this;return Kh((function(){return _k(e,t.axis)}))},t.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new kC("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,a=t.slice(1);i<a.length;i++){var o=a[i];if(null==n[r]||null==o[r]){n[r]=null;break}n[r]+=o[r]}return n},t.prototype.computeMask=function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new kC("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new kC("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new kC("Mismatch in the length of mask ("+t.length+") and the legnth of inputs ("+e.length+")");return Kh((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var i=[],a=0;a<e.length;++a)i.push(null==t[a]?Np(e[a]).asType("bool"):t[a].rank<e[a].rank?tf(t[a],-1):t[a]);var o=Ip(i,n.axis);return wb(o,-1,!1)}))},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Concatenate",t}(GA);function YA(e,t){for(;e<0;)e+=t;return e}Zx.registerClass($A);var JA=function(e){function t(t){var n=e.call(this,t)||this;return n.axes=t.axes,n.normalize=null!=t.normalize&&t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return mC(t,e),t.prototype.build=function(e){lc.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new EC("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new kC("Dimension incompatibility: "+t[r[0]]+" !== "+n[r[1]])},t.prototype.mergeFunction=function(e){if(2!==e.length)throw new kC("A `Dot` layer must be called on exactly 2 inputs, but received "+e.length+" input(s).");var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return YA(t,e[n].shape.length)})):[YA(this.axes,n.shape.length),YA(this.axes,r.shape.length)],this.normalize&&(n=zE(n,t[0]),r=zE(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new EC("batchDot is not implemented for tensors of 4D or higher rank yet");if(lc.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got "+e.shape.length})),lc.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got "+t.shape.length})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new EC("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,i=t.shape.length;null==n&&(n=[r-1,i-2]);var a=n;return Kh((function(){var n,o;if(r>i){n=r-i;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(i>r){for(n=i-r,s=[],u=0;u<n;++u)s.push(1);e=e.reshape(e.shape.concat(s))}else n=0;if(o=2===e.shape.length&&2===t.shape.length?a[0]===a[1]?e.mulStrict(t).sum(a[0]):e.transpose([1,0]).mulStrict(t).sum(a[1]):e.matMul(t,a[0]!==e.shape.length-1,a[1]===t.shape.length-1),n>0){var l,c=[];for(u=l=r>i?r+i-3:r-1;u<l+n;++u)c.push(u);o=o.squeeze(c)}return 1===o.shape.length&&(o=o.expandDims(1)),o}))}(n,r,t)},t.prototype.interpretAxes=function(e,t){return Array.isArray(this.axes)?this.axes:[YA(this.axes,e.length),YA(this.axes,t.length)]},t.prototype.computeOutputShape=function(e){lc.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new EC("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var i=t.concat(n);return 1===i.length&&i.push(1),i},t.prototype.computeMask=function(e,t){return null},t.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dot",t}(GA);Zx.registerClass(JA);var eS=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return mC(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e);return Mk((function(){return Nk(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))},t.className="GaussianNoise",t}(EE);Zx.registerClass(eS);var tS=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return mC(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t);var r=cE(e);return n.rate>0&&n.rate<1?Mk((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(Nk(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))},t.className="GaussianDropout",t}(EE);Zx.registerClass(tS);var nS=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return mC(t,e),t.prototype._getNoiseShape=function(e){return this.noiseShape||cE(e).shape},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return Kh((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return Mk((function(){var t=cE(e),i=-1.7580993408473766,a=Ay(df(r),n.rate);a=wk(a,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(i,2)),-.5),s=-o*i*n.rate;return t.mul(a).add(a.add(-1).mul(i)).mul(o).add(s)}),(function(){return cE(e)}),t.training||!1)}return e}))},t.className="AlphaDropout",t}(EE);function rS(e,t,n,r,i,a){var o;if(void 0===a&&(a=.001),2===e.rank)o=qg(e,t,n,r,i,a);else if(3===e.rank)o=Kg(e,t,n,r,i,a);else{if(4!==e.rank)throw new EC("batchNormalization is not implemented for array of rank "+e.rank+" yet");o=Xg(e,t,n,r,i,a)}return o}Zx.registerClass(nS);var iS=function(e){function t(t){var n=this;return null==t&&(t={}),(n=e.call(this,t)||this).supportsMasking=!0,n.axis=null==t.axis?-1:t.axis,n.momentum=null==t.momentum?.99:t.momentum,n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=rE(t.betaInitializer||"zeros"),n.gammaInitializer=rE(t.gammaInitializer||"ones"),n.movingMeanInitializer=rE(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=rE(t.movingVarianceInitializer||"ones"),n.betaConstraint=YC(t.betaConstraint),n.gammaConstraint=YC(t.gammaConstraint),n.betaRegularizer=pA(t.betaRegularizer),n.gammaRegularizer=pA(t.gammaRegularizer),n}return mC(t,e),t.prototype.build=function(e){var t;e=hE(e);var n=this.axis>=0?this.axis:this.axis+e.length,r=e[n];if(null==r)throw new kC("Axis "+n+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new bE({ndim:e.length,axes:(t={},t[n]=r,t)})];var i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){var r=null!=t.training&&t.training,i=cE(e),a=i.shape,o=a.length,s=bk(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var l=AC(1,o);l[u]=a[u];var c=s.slice();c.sort();var h=!lc.arraysEqual(c,bk(0,o).slice(0,o-1));if(!r)return function(){if(h){var e=n.movingMean.read().reshape(l),t=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,a=n.scale?n.gamma.read().reshape(l):null;return rS(i,e,t,r,a,n.epsilon)}return rS(i,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var p=function(e,t,n,r,i){return void 0===i&&(i=.001),lc.arraysEqual(r.slice().sort(),bk(0,e.rank-1))?function(e,t,n,r,i){return void 0===i&&(i=.001),Kh((function(){var a=Nb(e,r),o=a.mean,s=a.variance;return[rS(e,o,s,n,t,i),o,s]}))}(e,t,n,r,i):function(e,t,n,r,i){return void 0===i&&(i=.001),Kh((function(){for(var a=Nb(e,r),o=a.mean,s=a.variance,u=[],l=0,c=bk(0,e.rank);l<c.length;l++){var h=c[l];-1!==r.indexOf(h)?u.push(1):u.push(e.shape[h])}var p=o.reshape(u),f=s.reshape(u),d=null==t?null:t.reshape(u),m=null==n?null:n.reshape(u);return[rS(e,p,f,m,d,i),o,s]}))}(e,t,n,r,i)}(i,n.gamma.read(),n.beta.read(),s,n.epsilon),f=p[0],d=p[2],m=function(e,t,n){Kh((function(){var r=1-n,i=e.read(),a=i.sub(t).mul(r);e.write(i.sub(a))}))};return m(n.movingMean,p[1],n.momentum),m(n.movingVariance,d,n.momentum),f}))},t.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:nE(this.betaInitializer),gammaInitializer:nE(this.gammaInitializer),movingMeanInitializer:nE(this.movingMeanInitializer),movingVarianceInitializer:nE(this.movingVarianceInitializer),betaRegularizer:cA(this.betaRegularizer),gammaRegularizer:cA(this.gammaRegularizer),betaConstraint:ZC(this.betaConstraint),gammaConstraint:ZC(this.gammaConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="BatchNormalization",t}(EE);Zx.registerClass(iS);var aS=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).axis=null==t.axis?-1:t.axis,"number"==typeof n.axis){if(!Number.isInteger(n.axis))throw new Error("Expected axis to be an integer, but received "+n.axis)}else{if(!Array.isArray(n.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(n.axis));for(var r=0,i=n.axis;r<i.length;r++)if(!Number.isInteger(i[r]))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(n.axis))}return n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=rE(t.betaInitializer||"zeros"),n.gammaInitializer=rE(t.gammaInitializer||"ones"),n.betaRegularizer=pA(t.betaRegularizer),n.gammaRegularizer=pA(t.gammaRegularizer),n.supportsMasking=!0,n}return mC(t,e),t.prototype.build=function(e){var t=(e=hE(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);for(var r=0,i=this.axis;r<i.length;r++){var a=i[r];if(a<0||a>=t)throw new Error("Invalid axis: "+a)}if(this.axis.length!==BC(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var o=this.axis.map((function(t){return e[t]}));this.gamma=this.scale?this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0},t.prototype.call=function(e,t){var n=this,r=cE(e),i=r.shape,a=i.length;return Kh((function(){for(var e=Nb(r,n.axis,!0),t=e.mean,o=e.variance,s=AC(1,a),u=0,l=n.axis;u<l.length;u++){var c=l[u];s[c]=i[c]}for(var h=function(e){return null!=e&&e.shape.length!==a&&n.axis!==[a-1]?e.reshape(s):e},p=h(n.gamma.read()),f=h(n.beta.read()),d=[],m=[],v=0;v<a;++v)-1!==n.axis.indexOf(v)?(d.push(i[v]),m.push(1)):(d.push(1),m.push(i[v]));return t=t.tile(d),o=o.tile(d),p=p.tile(m),f=f.tile(m),rS(r,t,o,f,p,n.epsilon)}))},t.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:nE(this.betaInitializer),gammaInitializer:nE(this.gammaInitializer),betaRegularizer:cA(this.betaRegularizer),gammaRegularizer:cA(this.gammaRegularizer)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LayerNormalization",t}(EE);Zx.registerClass(aS);var oS=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new kC("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+t.padding.length+" array.");var r=void 0,i=void 0;if("number"==typeof t.padding[0])r=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new kC("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+t.padding[0].length+" array.");if(r=t.padding[0],2!==t.padding[1].length)throw new kC("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+t.padding[1].length+" array.");i=t.padding[1]}n.padding=[r,i]}return n.inputSpec=[new bE({ndim:4})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){return e=hE(e),"channelsFirst"===this.dataFormat?[e[0],e[1],null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null]:[e[0],null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,e[3]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){return function(e,t,n){return Kh((function(){if(4!==e.rank)throw new kC("temporalPadding expects input tensor to be 4-D, but received a "+e.rank+"-D tensor.");if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new kC("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new kC("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");return of(e,"channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]])}))}(cE(e),n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ZeroPadding2D",t}(EE);function sS(e,t,n,r,i,a){return Kh((function(){var o;ik(i),ok(a),ak(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=CA(e,i);var s="same"===r?"same":"valid";return o="max"===a?lb(e,t,n,s):cb(e,t,n,s),"channelsFirst"===i&&(o=Bb(o,[0,3,1,2])),o}))}function uS(e,t,n,r,i,a){return Kh((function(){var o;ik(i),ok(a),ak(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=kA(e,i);var s="same"===r?"same":"valid";return o="max"===a?pb(e,t,n,s):fb(e,t,n,s),"channelsFirst"===i&&(o=Bb(o,[0,4,1,2,3])),o}))}Zx.registerClass(oS);var lS=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=2),n=e.call(this,t)||this,"number"==typeof t.poolSize)n.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new kC("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.poolSize));n.poolSize=t.poolSize}if(WC(n.poolSize,"poolSize"),null==t.strides)n.strides=n.poolSize;else if("number"==typeof t.strides)n.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new kC("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.strides));n.strides=t.strides}return WC(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,ak(n.padding),n.inputSpec=[new bE({ndim:3})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){var t=wA((e=hE(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){n.invokeCallHook(e,t),e=xk(cE(e),2);var r=n.poolingFunction(cE(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return gf(r,[2])}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(EE),cS=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return ik(i),ak(r),sS(e,t,n,r,i,"max")},t.className="MaxPooling1D",t}(lS);Zx.registerClass(cS);var hS=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return ik(i),ak(r),sS(e,t,n,r,i,"avg")},t.className="AveragePooling1D",t}(lS);Zx.registerClass(hS);var pS=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new kC("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides];return WC(n.poolSize,"poolSize"),WC(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ik(n.dataFormat),ak(n.padding),n.inputSpec=[new bE({ndim:4})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){e=hE(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=wA(t,this.poolSize[0],this.padding,this.strides[0]),n=wA(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){return n.invokeCallHook(e,t),n.poolingFunction(cE(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(EE),fS=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return ik(i),ak(r),sS(e,t,n,r,i,"max")},t.className="MaxPooling2D",t}(pS);Zx.registerClass(fS);var dS=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return ik(i),ak(r),sS(e,t,n,r,i,"avg")},t.className="AveragePooling2D",t}(pS);Zx.registerClass(dS);var mS=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new kC("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return WC(n.poolSize,"poolSize"),WC(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ik(n.dataFormat),ak(n.padding),n.inputSpec=[new bE({ndim:5})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){e=hE(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=wA(t,this.poolSize[0],this.padding,this.strides[0]),n=wA(n,this.poolSize[1],this.padding,this.strides[1]),r=wA(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]},t.prototype.call=function(e,t){var n=this;return Kh((function(){return n.invokeCallHook(e,t),n.poolingFunction(cE(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(EE),vS=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return ik(i),ak(r),uS(e,t,n,r,i,"max")},t.className="MaxPooling3D",t}(mS);Zx.registerClass(vS);var gS=function(e){function t(t){return e.call(this,t)||this}return mC(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return ik(i),ak(r),uS(e,t,n,r,i,"avg")},t.className="AveragePooling3D",t}(mS);Zx.registerClass(gS);var yS=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[new bE({ndim:3})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){return[e[0],e[2]]},t.prototype.call=function(e,t){throw new EC},t}(EE),bS=function(e){function t(t){return e.call(this,t||{})||this}return mC(t,e),t.prototype.call=function(e,t){return Kh((function(){var t=cE(e);return Ab(t,1)}))},t.className="GlobalAveragePooling1D",t}(yS);Zx.registerClass(bS);var wS=function(e){function t(t){return e.call(this,t||{})||this}return mC(t,e),t.prototype.call=function(e,t){return Kh((function(){var t=cE(e);return _b(t,1)}))},t.className="GlobalMaxPooling1D",t}(yS);Zx.registerClass(wS);var xS=function(e){function t(t){var n=e.call(this,t)||this;return n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ik(n.dataFormat),n.inputSpec=[new bE({ndim:4})],n}return mC(t,e),t.prototype.computeOutputShape=function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},t.prototype.call=function(e,t){throw new EC},t.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(EE),CS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.call=function(e,t){var n=this;return Kh((function(){var t=cE(e);return Ab(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))},t.className="GlobalAveragePooling2D",t}(xS);Zx.registerClass(CS);var kS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.call=function(e,t){var n=this;return Kh((function(){var t=cE(e);return _b(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))},t.className="GlobalMaxPooling2D",t}(xS);function ES(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new kC("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function _S(e,t,n,r,i,a,o,s){return void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),Kh((function(){var u=t.shape.length;if(u<3)throw new kC("Input should be at least 3D, but is "+u+"D.");var l=[1,0].concat(bk(2,u));if(t=Bb(t,l),null!=a)throw new EC("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=i.asType("bool").asType("float32")).rank===u-1&&(i=tf(i,-1)),i=Bb(i,l)),r&&(t=nb(t,0),null!=i&&(i=nb(i,0)));var c,h,p=[],f=n,d=t.shape[0],m=xf(t);null!=i&&(h=xf(i));for(var v,g=function(t){var n=m[t],r=Kh((function(){return e(n,f)}));if(null==i)c=r[0],f=r[1];else{var a=Kh((function(){var e=h[t],n=Np(e).sub(e);return{output:r[0].mul(e).addStrict(f[0].mul(n)),newStates:f.map((function(t,i){return r[1][i].mul(e).addStrict(t.mul(n))}))}}));c=a.output,f=a.newStates}s&&p.push(c)},y=0;y<d;++y)g(y);return s&&(v=yf(p,1)),[c,v,f]}))}Zx.registerClass(kS);var AS=function(e){function t(t){var n,r=e.call(this,t)||this;if(null==t.cell)throw new kC("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(t.cell)?new FS({cells:t.cell}):t.cell).stateSize)throw new kC("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=t.returnSequences&&t.returnSequences,r.returnState=null!=t.returnState&&t.returnState,r.goBackwards=null!=t.goBackwards&&t.goBackwards,r._stateful=null!=t.stateful&&t.stateful,r.unroll=null!=t.unroll&&t.unroll,r.supportsMasking=!0,r.inputSpec=[new bE({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return mC(t,e),t.prototype.getStates=function(){return null==this.states_?bk(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_},t.prototype.setStates=function(e){this.states_=e},t.prototype.computeOutputShape=function(e){uE(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){for(var i=[],a=0,o=t;a<o.length;a++)i.push([e[0],o[a]]);return[n].concat(i)}return n},t.prototype.computeMask=function(e,t){var n=this;return Kh((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))},Object.defineProperty(t.prototype,"states",{get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e},enumerable:!0,configurable:!0}),t.prototype.build=function(e){if(null!=this.numConstants)throw new EC("Constants support is not implemented in RNN yet.");uE(e)&&(e=e[0]),e=e,this.inputSpec[0]=new bE({shape:[this.stateful?e[0]:null,null,e[e.length-1]]});var t,n=[e[0]].concat(e.slice(2));if(this.cell.build(n),t=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!lc.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),t))throw new kC("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=t.map((function(e){return new bE({shape:[null,e]})}));this.stateful&&this.resetStates()},t.prototype.resetStates=function(e,t){var n=this;void 0===t&&(t=!1),Kh((function(){if(!n.stateful)throw new xC("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=n.inputSpec[0].shape[0];if(null==r)throw new kC("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states_)n.states_=Array.isArray(n.cell.stateSize)?n.cell.stateSize.map((function(e){return Ep([r,e])})):[Ep([r,n.cell.stateSize])];else if(null==e)Xh(n.states_),null!=n.keptStates&&(Xh(n.keptStates),n.keptStates=[]),Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map((function(e){return Ep([r,e])})):n.states_[0]=Ep([r,n.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==n.states_.length)throw new kC("Layer "+n.name+" expects "+n.states_.length+" state(s), but it received "+e.length+" state value(s). Input received: "+e);!0===t?n.keptStates.push(n.states_.slice()):Xh(n.states_);for(var i=0;i<n.states_.length;++i){var a=e[i],o=Array.isArray(n.cell.stateSize)?n.cell.stateSize[i]:n.cell.stateSize,s=[r,o];if(!lc.arraysEqual(a.shape,s))throw new kC("State "+i+" is incompatible with layer "+n.name+": expected shape="+s+", received shape="+a.shape);n.states_[i]=a}}n.states_=n.states_.map((function(e){return Qh(e.clone())}))}))},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var a=ES(t,r,i,this.numConstants);t=a.inputs,i=a.constants;var o=[],s=[];if(null!=(r=a.initialState)){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(var u=0,l=r;u<l.length;u++)this.stateSpec.push(new bE({shape:l[u].shape}));s=s.concat(this.stateSpec)}if(null!=i&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof wE){var c=[t].concat(o),h=this.inputSpec.concat(s),p=this.inputSpec;this.inputSpec=h;var f=e.prototype.apply.call(this,c,n);return this.inputSpec=p,f}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return Kh((function(){var r=null==t?null:t.mask,i=null==t?null:t.training,a=null==t?null:t.initialState;e=cE(e),null==a&&(a=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(a.length!==o)throw new kC("RNN Layer has "+o+" state(s) but was passed "+a.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:i},u=_S((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,a,n.goBackwards,r,null,n.unroll,n.returnSequences),l=u[0],c=u[1],h=u[2];n.stateful&&n.resetStates(h,i);var p=n.returnSequences?c:l;return n.returnState?[p].concat(h):p}))},t.prototype.getInitialState=function(e){var t=this;return Kh((function(){var n=Ep(e.shape);return n=xk(n=Db(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?Sk(n,[1,e]):n})):t.cell.stateSize>1?[Sk(n,[1,t.cell.stateSize])]:[n]}))},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)},t.prototype.getConfig=function(){var t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var n=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:n};var r=e.prototype.getConfig.call(this);return Object.assign(t,r),t},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=PE(t.cell,n);return new e(Object.assign(t,{cell:r}))},t.className="RNN",t}(EE);Zx.registerClass(AS);var SS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t}(EE),NS=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,WC(n.units,"units"),n.activation=aA(null==t.activation?n.DEFAULT_ACTIVATION:t.activation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=rE(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=rE(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=rE(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=pA(t.kernelRegularizer),n.recurrentRegularizer=pA(t.recurrentRegularizer),n.biasRegularizer=pA(t.biasRegularizer),n.kernelConstraint=YC(t.kernelConstraint),n.recurrentConstraint=YC(t.recurrentConstraint),n.biasConstraint=YC(t.biasConstraint),n.dropout=gk([1,yk([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=gk([1,yk([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return mC(t,e),t.prototype.build=function(e){e=hE(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){if(2!==(e=e).length)throw new kC("SimpleRNNCell expects 2 input Tensors, got "+e.length+".");var r=e[1];e=e[0];var i,a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=MS((function(){return Np(e)}),n.dropout,a)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=MS((function(){return Np(r)}),n.recurrentDropout,a));var o=n.dropoutMask,s=n.recurrentDropoutMask;i=Dk(null!=o?my(e,o):e,n.kernel.read()),null!=n.bias&&(i=Ok(i,n.bias.read())),null!=s&&(r=my(r,s));var u=ty(i,Dk(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),recurrentInitializer:nE(this.recurrentInitializer),biasInitializer:nE(this.biasInitializer),kernelRegularizer:cA(this.kernelRegularizer),recurrentRegularizer:cA(this.recurrentRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),recurrentConstraint:ZC(this.recurrentConstraint),biasConstraint:ZC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="SimpleRNNCell",t}(SS);Zx.registerClass(NS);var DS=function(e){function t(t){return t.cell=new NS(t),e.call(this,t)||this}return mC(t,e),t.prototype.call=function(t,n){var r=this;return Kh((function(){return null!=r.cell.dropoutMask&&(Xh(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Xh(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),e.prototype.call.call(r,t,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),recurrentInitializer:nE(this.recurrentInitializer),biasInitializer:nE(this.biasInitializer),kernelRegularizer:cA(this.kernelRegularizer),recurrentRegularizer:cA(this.recurrentRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),recurrentConstraint:ZC(this.recurrentConstraint),biasConstraint:ZC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return new e(t)},t.className="SimpleRNN",t}(AS);Zx.registerClass(DS);var IS=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,WC(n.units,"units"),n.activation=aA(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=aA(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=rE(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=rE(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=rE(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=pA(t.kernelRegularizer),n.recurrentRegularizer=pA(t.recurrentRegularizer),n.biasRegularizer=pA(t.biasRegularizer),n.kernelConstraint=YC(t.kernelConstraint),n.recurrentConstraint=YC(t.recurrentConstraint),n.biasConstraint=YC(t.biasConstraint),n.dropout=gk([1,yk([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=gk([1,yk([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return mC(t,e),t.prototype.build=function(e){var t=(e=hE(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){if(2!==(e=e).length)throw new kC("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var r=null!=t.training&&t.training,i=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=MS((function(){return Np(e)}),n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=MS((function(){return Np(i)}),n.recurrentDropout,r,3));var a,o,s,u=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=my(e,n.dropoutMask[0]));var l=Dk(e,n.kernel.read());n.useBias&&(l=Ok(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(i=my(i,u[0]));var c=n.recurrentKernel.read(),h=Mp(c,[2*n.units,n.units],c.rank-1),p=h[1],f=Dk(i,h[0]),d=Mp(l,3,l.rank-1),m=d[0],v=d[1],g=d[2],y=Mp(f,2,f.rank-1),b=y[1];a=n.recurrentActivation.apply(ty(m,y[0])),o=n.recurrentActivation.apply(ty(v,b));var w=Dk(my(o,i),p);s=n.activation.apply(ty(g,w));var x=ty(my(a,i),my(ty(1,bg(a)),s));return[x,x]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),recurrentActivation:rA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),recurrentInitializer:nE(this.recurrentInitializer),biasInitializer:nE(this.biasInitializer),kernelRegularizer:cA(this.kernelRegularizer),recurrentRegularizer:cA(this.recurrentRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),recurrentConstraint:ZC(this.recurrentConstraint),biasConstraint:ZC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="GRUCell",t}(SS);Zx.registerClass(IS);var TS=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new IS(t),e.call(this,t)||this}return mC(t,e),t.prototype.call=function(t,n){var r=this;return Kh((function(){return null!=r.cell.dropoutMask&&(Xh(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Xh(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),e.prototype.call.call(r,t,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),recurrentActivation:rA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),recurrentInitializer:nE(this.recurrentInitializer),biasInitializer:nE(this.biasInitializer),kernelRegularizer:cA(this.kernelRegularizer),recurrentRegularizer:cA(this.recurrentRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),recurrentConstraint:ZC(this.recurrentConstraint),biasConstraint:ZC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="GRU",t}(AS);Zx.registerClass(TS);var RS=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,WC(n.units,"units"),n.activation=aA(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=aA(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=rE(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=rE(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=rE(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=pA(t.kernelRegularizer),n.recurrentRegularizer=pA(t.recurrentRegularizer),n.biasRegularizer=pA(t.biasRegularizer),n.kernelConstraint=YC(t.kernelConstraint),n.recurrentConstraint=YC(t.recurrentConstraint),n.biasConstraint=YC(t.biasConstraint),n.dropout=gk([1,yk([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=gk([1,yk([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return mC(t,e),t.prototype.build=function(e){var t,n,r=(e=hE(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var i=this.biasInitializer,a=this.units;n=new((t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mC(t,e),t.prototype.apply=function(e,t){var n=i.apply([a]),r=(new Vk).apply([a]),o=i.apply([2*a]);return Ak(Ak(n,r),o)},t}(Pk)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},t.prototype.call=function(e,t){var n=this;return Kh((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new kC("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var i=e[1],a=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=MS((function(){return Np(e)}),n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=MS((function(){return Np(i)}),n.recurrentDropout,r,4));var o,s,u,l,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=my(e,n.dropoutMask[0]));var h=Dk(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(i=my(i,c[0])),h=ty(h,Dk(i,n.recurrentKernel.read())),n.useBias&&(h=Ok(h,n.bias.read()));var p=Mp(h,4,h.rank-1),f=p[1],d=p[2],m=p[3];o=n.recurrentActivation.apply(p[0]),s=n.recurrentActivation.apply(f),u=ty(my(s,a),my(o,n.activation.apply(d))),l=n.recurrentActivation.apply(m);var v=my(l,n.activation.apply(u));return[v,v,u]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),recurrentActivation:rA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),recurrentInitializer:nE(this.recurrentInitializer),biasInitializer:nE(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cA(this.kernelRegularizer),recurrentRegularizer:cA(this.recurrentRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),recurrentConstraint:ZC(this.recurrentConstraint),biasConstraint:ZC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LSTMCell",t}(SS);Zx.registerClass(RS);var OS=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new RS(t),e.call(this,t)||this}return mC(t,e),t.prototype.call=function(t,n){var r=this;return Kh((function(){return null!=r.cell.dropoutMask&&(Xh(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Xh(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),e.prototype.call.call(r,t,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:rA(this.activation),recurrentActivation:rA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:nE(this.kernelInitializer),recurrentInitializer:nE(this.recurrentInitializer),biasInitializer:nE(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cA(this.kernelRegularizer),recurrentRegularizer:cA(this.recurrentRegularizer),biasRegularizer:cA(this.biasRegularizer),activityRegularizer:cA(this.activityRegularizer),kernelConstraint:ZC(this.kernelConstraint),recurrentConstraint:ZC(this.recurrentConstraint),biasConstraint:ZC(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="LSTM",t}(AS);Zx.registerClass(OS);var FS=function(e){function t(t){var n=e.call(this,t)||this;return n.cells=t.cells,n}return mC(t,e),Object.defineProperty(t.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var r=n[t];Array.isArray(r.stateSize)?e.push.apply(e,r.stateSize):e.push(r.stateSize)}return e},enumerable:!0,configurable:!0}),t.prototype.call=function(e,t){var n=this;return Kh((function(){for(var r=(e=e).slice(1),i=[],a=0,o=n.cells.slice().reverse();a<o.length;a++){var s=o[a];Array.isArray(s.stateSize)?i.push(r.splice(0,s.stateSize.length)):i.push(r.splice(0,1))}i.reverse();for(var u,l=[],c=0;c<n.cells.length;++c)s=n.cells[c],r=i[c],u=0===c?[e[0]].concat(r):[u[0]].concat(r),u=s.call(u,t),l.push(u.slice(1));r=[];for(var h=0,p=l.slice().reverse();h<p.length;h++)r.push.apply(r,p[h]);return[u[0]].concat(r)}))},t.prototype.build=function(e){var t;uE(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){lk("RNNCell_"+r,(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0},t.prototype.getConfig=function(){for(var t=[],n=0,r=this.cells;n<r.length;n++){var i=r[n];t.push({className:i.getClassName(),config:i.getConfig()})}var a={cells:t},o=e.prototype.getConfig.call(this);return Object.assign(a,o),a},t.fromConfig=function(e,t,n){void 0===n&&(n={});for(var r=[],i=0,a=t.cells;i<a.length;i++)r.push(PE(a[i],n));return new e({cells:r})},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++)e.push.apply(e,n[t].trainableWeights);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],a=0,o=this.cells;a<o.length;a++)i.push.apply(i,(r=o[a]).trainableWeights);return i.concat(e)}return e},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++)e.push.apply(e,n[t].weights);return mE(e)},t.prototype.setWeights=function(e){for(var t=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],a=e.splice(i.weights.length),o=0;o<i.weights.length;++o)t.push([i.weights[o],a[o]]);vE(t)},t.className="StackedRNNCells",t}(SS);function MS(e,t,n,r){function i(){return Fk(e(),t)}if(void 0===n&&(n=null),void 0===r&&(r=1),r>1){for(var a=[],o=0;o<r;o++)a.push(Mk(i,e,n));return a.map((function(e){return Qh(e.clone())}))}return Qh(Mk(i,e,n).clone())}Zx.registerClass(FS);var LS=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=t.layer,n}return mC(t,e),t.prototype.build=function(e){this.built=!0},Object.defineProperty(t.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.layer.getWeights()},t.prototype.setWeights=function(e){this.layer.setWeights(e)},t.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=PE(t.layer,n);delete t.layer;var i={layer:r};return Object.assign(i,t),new e(i)},t}(EE),BS=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n}return mC(t,e),t.prototype.build=function(t){if((t=hE(t)).length<3)throw new kC("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),e.prototype.build.call(this,t)},t.prototype.computeOutputShape=function(e){var t=[(e=hE(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))},t.prototype.call=function(e,t){var n=this;return Kh((function(){return _S((function(e,r){return[cE(n.layer.call(e,t)),[]]}),e=cE(e),[],!1,null,null,!1,!0)[1]}))},t.className="TimeDistributed",t}(LS);Zx.registerClass(BS);var PS="concat",zS=function(e){function t(t){var n=e.call(this,t)||this,r=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=r,n.forwardLayer=PE(i),r.goBackwards=!0!==r.goBackwards;var a={};if(a.className=t.layer.getClassName(),a.config=r,n.backwardLayer=PE(a),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=void 0===t.mergeMode?PS:t.mergeMode,function(e){zC(nk,"BidirectionalMergeMode",e)}(n.mergeMode),t.weights)throw new EC("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return mC(t,e),Object.defineProperty(t.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},t.prototype.setWeights=function(e){var t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))},t.prototype.computeOutputShape=function(e){var t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),t=i[0]):t=i[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):DC(n)},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var a=ES(t,r,i,this.numConstants);if(t=a.inputs,r=a.initialState,i=a.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(null==r||0===r.length)&&null==i)return e.prototype.apply.call(this,t,n);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new kC("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push.apply(o,r);var l=r.map((function(e){return new bE({shape:e.shape})}));this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,l)}if(null!=i)throw new EC("Support for constants in Bidirectional layers is not implemented yet.");for(var c=o[0]instanceof wE,h=0,p=o;h<p.length;h++)if(p[h]instanceof wE!==c)throw new kC("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){var f=[t].concat(o),d=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=d;var v=e.prototype.apply.call(this,f,n);return this.inputSpec=m,v}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return Kh((function(){var r,i,a,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),i=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),l=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),i=n.backwardLayer.call(e,Object.assign(t,{initialState:l}))}return n.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),n.returnSequences&&(i=nb(i,1)),"concat"===n.mergeMode?o=_k([r,i]):"sum"===n.mergeMode?o=ty(r,i):"ave"===n.mergeMode?o=my(.5,ty(r,i)):"mul"===n.mergeMode?o=my(r,i):null==n.mergeMode&&(o=[r,i]),n.returnState?null==n.mergeMode?o.concat(a):[o].concat(a):o}))},t.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},t.prototype.build=function(e){var t=this;lk(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),lk(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0},t.prototype.computeMask=function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)},t.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.fromConfig=function(e,t){var n=PE(t.layer);if(delete t.layer,null!=t.numConstants)throw new EC("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)},t.className="Bidirectional",t}(LS);function VS(e){return new hS(e)}function WS(e){return new dS(e)}function US(e){return new gS(e)}function jS(e){return new wS(e)}function HS(e){return new kS(e)}function GS(e){return new cS(e)}function qS(e){return new fS(e)}function KS(e,t){return e<t}function XS(e,t){return e>t}Zx.registerClass(zS),Object.freeze({inputLayer:function(e){return new _E(e)},elu:function(e){return new vA(e)},reLU:function(e){return new fA(e)},leakyReLU:function(e){return new dA(e)},prelu:function(e){return new mA(e)},softmax:function(e){return new yA(e)},thresholdedReLU:function(e){return new gA(e)},conv1d:function(e){return new TA(e)},conv2d:function(e){return new SA(e)},conv2dTranspose:function(e){return new DA(e)},conv3d:function(e){return new NA(e)},separableConv2d:function(e){return new IA(e)},cropping2D:function(e){return new RA(e)},upSampling2d:function(e){return new OA(e)},depthwiseConv2d:function(e){return new FA(e)},activation:function(e){return new zA(e)},dense:function(e){return new BA(e)},dropout:function(e){return new MA(e)},spatialDropout1d:function(e){return new LA(e)},flatten:function(e){return new PA(e)},repeatVector:function(e){return new VA(e)},reshape:function(e){return new WA(e)},permute:function(e){return new UA(e)},embedding:function(e){return new HA(e)},add:function(e){return new qA(e)},average:function(e){return new XA(e)},concatenate:function(e){return new $A(e)},maximum:function(e){return new QA(e)},minimum:function(e){return new ZA(e)},multiply:function(e){return new KA(e)},dot:function(e){return new JA(e)},batchNormalization:function(e){return new iS(e)},layerNormalization:function(e){return new aS(e)},zeroPadding2d:function(e){return new oS(e)},averagePooling1d:VS,avgPool1d:function(e){return VS(e)},avgPooling1d:function(e){return VS(e)},averagePooling2d:WS,avgPool2d:function(e){return WS(e)},avgPooling2d:function(e){return WS(e)},averagePooling3d:US,avgPool3d:function(e){return US(e)},avgPooling3d:function(e){return US(e)},globalAveragePooling1d:function(e){return new bS(e)},globalAveragePooling2d:function(e){return new CS(e)},globalMaxPooling1d:jS,globalMaxPooling2d:HS,maxPooling1d:GS,maxPooling2d:qS,maxPooling3d:function(e){return new vS(e)},gru:function(e){return new TS(e)},gruCell:function(e){return new IS(e)},lstm:function(e){return new OS(e)},lstmCell:function(e){return new RS(e)},simpleRNN:function(e){return new DS(e)},simpleRNNCell:function(e){return new NS(e)},rnn:function(e){return new AS(e)},stackedRNNCells:function(e){return new FS(e)},bidirectional:function(e){return new zS(e)},timeDistributed:function(e){return new BS(e)},globalMaxPool1d:jS,globalMaxPool2d:HS,maxPool1d:GS,maxPool2d:qS,Layer:EE,RNN:AS,RNNCell:SS,input:function(e){return AE(e)},gaussianNoise:function(e){return new eS(e)},gaussianDropout:function(e){return new tS(e)},alphaDropout:function(e){return new nS(e)},masking:function(e){return new jA(e)}}),Object.freeze({binaryAccuracy:function(e,t){return QE(e,t)},binaryCrossentropy:function(e,t){return JE(e,t)},sparseCategoricalAccuracy:function(e,t){return e_(e,t)},categoricalAccuracy:function(e,t){return ZE(e,t)},categoricalCrossentropy:function(e,t){return t_(e,t)},precision:function(e,t){return YE(e,t)},recall:function(e,t){return function(e,t){return Kh((function(){var n=$E(e,t),r=function(e,t){return Kh((function(){return Qg(e.equal(1),t.equal(0)).sum().cast("float32")}))}(e,t),i=n.add(r);return Jg(_y(i,0),n.div(i),0).cast("float32")}))}(e,t)},cosineProximity:function(e,t){return qE(e,t)},meanAbsoluteError:function(e,t){return WE(e,t)},meanAbsolutePercentageError:function(e,t){return UE(e,t)},MAPE:function(e,t){return UE(e,t)},mape:function(e,t){return UE(e,t)},meanSquaredError:function(e,t){return VE(e,t)},MSE:function(e,t){return VE(e,t)},mse:function(e,t){return VE(e,t)}}),Object.freeze({modelFromJSON:function(e,t){return yC(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l;return bC(this,(function(c){switch(c.label){case 0:return"modelTopology"in e||(e={modelTopology:e}),null!=(n=(e=e).modelTopology).model_config&&(n=n.model_config),r=h_(n),i=PE(r,t),null==e.weightsManifest?[3,2]:[4,jx.loadWeights(e.weightsManifest,e.pathPrefix,i.weights.map((function(e){return e.originalName})))];case 1:for(a=c.sent(),o={},s=0,u=i.weights;s<u.length;s++)o[(l=u[s]).originalName]=a[l.originalName];i.loadWeights(o),Xh(a),c.label=2;case 2:return[2,i]}}))}))}}),Object.freeze({l1l2:function(e){return new uA(e)},l1:function(e){return function(e){return oA(e),new uA({l1:null!=e?e.l1:null,l2:0})}(e)},l2:function(e){return function(e){return oA(e),new uA({l2:null!=e?e.l2:null,l1:0})}(e)}}),function(e){function t(t){var n=e.call(this)||this;if(null==t&&(t={}),t.restoreBestWeights)throw new EC("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,-1===["auto","min","max"].indexOf(n.mode)&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),n.monitorFunc="min"===n.mode?KS:"max"===n.mode?XS:-1!==n.monitor.indexOf("acc")?XS:KS,n.monitorFunc===KS&&(n.minDelta*=-1),n}mC(t,e),t.prototype.onTrainBegin=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return this.wait=0,this.stoppedEpoch=0,this.best=null!=this.baseline?this.baseline:this.monitorFunc===KS?1/0:-1/0,[2]}))}))},t.prototype.onEpochEnd=function(e,t){return yC(this,void 0,void 0,(function(){var n;return bC(this,(function(r){switch(r.label){case 0:return[4,SE(t)];case 1:return r.sent(),null==(n=this.getMonitorValue(t))?[2]:(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)),[2])}}))}))},t.prototype.onTrainEnd=function(e){return yC(this,void 0,void 0,(function(){return bC(this,(function(e){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]}))}))},t.prototype.getMonitorValue=function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(e)),t}}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.model=null,t}return mC(t,e),t.prototype.setModel=function(e){if(!(e instanceof W_))throw new Error("model must be a LayersModel, not some other Container");this.model=e},t}(IE));var QS,ZS,$S=function(){return($S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function YS(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function JS(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(QS||(QS={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(ZS||(ZS={}));var eN={};function tN(e){return eN[e]}function nN(e,t,n,r){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var a=i.inputIndexStart,o=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?a+1:i.inputIndexEnd;if("tensor"===i.type)return rN(t.inputNames[i.inputIndexStart],n,r);if("tensors"===i.type)return t.inputNames.slice(a,o).map((function(e){return rN(e,n,r)}));var s=Array.prototype.slice.call(rN(t.inputNames.slice(a)[0],n,r).dataSync());return"number"===i.type?s[0]:s}var u=t.attrParams[e];return u&&u.value}function rN(e,t,n){var r=oN(e),i=r[0],a=r[1],o=n.currentContextIds.find((function(e){return!!t[aN(i,e)]}));return void 0!==o?t[aN(i,o)][a]:void 0}function iN(e,t){var n=oN(e),r=n[1];return[aN(n[0],t&&t.currentContextId),r]}function aN(e,t){return t?e+"-"+t:e}function oN(e){var t=e.lastIndexOf(":");return-1===t?[e,0]:[e.substring(0,t),Number(e.substring(t+1))]}function sN(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}var uN=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),lN=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),cN=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),hN=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),pN=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),fN=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),dN=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),mN=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),vN=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),gN=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),yN=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),bN=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),wN=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),xN=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),CN=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),kN=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),EN=function(){function e(){var e=[].concat.apply([],[uN,lN,cN,hN,pN,fN,dN,gN,vN,mN,yN,bN,wN,xN,CN,kN].map((function(e){return e.json})));this.opMappers=e.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.transformGraph=function(e,t){var n=this;void 0===t&&(t={});var r=[],i=[],a=e.node.reduce((function(e,t){return e[t.name]=n.mapNode(t),t.op.startsWith("Placeholder")&&r.push(e[t.name]),"Const"===t.op&&i.push(e[t.name]),e}),{}),o=[],s=[],u={},l={};null!=t&&(u=this.mapSignatureEntries(t.inputs),l=this.mapSignatureEntries(t.outputs));var c=Object.keys(a);return c.forEach((function(e){var t=a[e];t.inputNames.forEach((function(e){var n=iN(e)[0];t.inputs.push(a[n]),a[n].children.push(t)}))})),0===Object.keys(l).length?c.forEach((function(e){var t=a[e];0===t.children.length&&s.push(t)})):Object.keys(l).forEach((function(e){var t=iN(e)[0],n=a[t];null!=n&&(n.signatureKey=l[e],s.push(n))})),Object.keys(u).length>0?Object.keys(u).forEach((function(e){var t=iN(e)[0],n=a[t];n&&(n.signatureKey=u[e],o.push(n))})):o=r,{nodes:a,inputs:o,outputs:s,weights:i,placeholders:r,signature:t}},e.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})},e.prototype.mapNode=function(e){var t=tN(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,i=void 0;switch(n.type){case"string":void 0===(i=AN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=AN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(i=MN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=MN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(i=NN(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(i=NN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(i=FN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=FN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(i=SN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=SN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(i=BN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=BN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(i=ON(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=ON(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(i=LN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=LN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(i=IN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=IN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(i=TN(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=TN(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+n.type+" for op: "+e.op)}return t[n.name]={value:i,type:r},t}),{})),n},e}();function _N(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=dl().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function AN(e,t,n,r){void 0===r&&(r=!1);var i=e[t];return null!=i?_N(i.s,r):n}function SN(e,t,n){var r=e[t];return r?r.b:n}function NN(e,t,n){var r=e[t]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function DN(e){switch("string"==typeof e&&(e=QS[e]),e){case QS.DT_FLOAT:return"float32";case QS.DT_INT32:case QS.DT_INT64:return"int32";case QS.DT_BOOL:return"bool";case QS.DT_DOUBLE:return"float32";case QS.DT_STRING:return"string";default:return null}}function IN(e,t,n){var r=e[t];return r&&r.type?DN(r.type):n}function TN(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return DN(e)})):n}function RN(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function ON(e,t,n){var r=e[t];return r&&r.shape?RN(r.shape):n}function FN(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function MN(e,t,n,r){void 0===r&&(r=!1);var i=e[t];return i&&i.list&&i.list.s?i.list.s.map((function(e){return _N(e,r)})):n}function LN(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return RN(e)})):n}function BN(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var PN=function(){function e(e,t,n){var r=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((function(e){return r.getInput(e)})),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((function(e,t){return e[t]=r.getAttr(t),e}),{}))}return e.prototype.getInput=function(e){return rN(e,this.tensorMap,this.context)},e.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return rN(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return NN(this.node.rawAttrs,e,t);if(null!=n.s)return AN(this.node.rawAttrs,e,t);if(null!=n.b)return SN(this.node.rawAttrs,e,t);if(null!=n.shape)return ON(this.node.rawAttrs,e,t);if(null!=n.type)return IN(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return FN(this.node.rawAttrs,e,t);if(null!=n.list.s)return MN(this.node.rawAttrs,e,t);if(null!=n.list.shape)return LN(this.node.rawAttrs,e,t);if(null!=n.list.b)return BN(this.node.rawAttrs,e,t);if(null!=n.list.type)return TN(this.node.rawAttrs,e,t)}return t},e}(),zN=function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[ty(nN("a",e,t,n),nN("b",e,t,n))];case"AddN":return[ny(nN("tensors",e,t,n))];case"FloorMod":case"Mod":return[fy(nN("a",e,t,n),nN("b",e,t,n))];case"Mul":return[my(nN("a",e,t,n),nN("b",e,t,n))];case"RealDiv":case"Div":return[ay(nN("a",e,t,n),nN("b",e,t,n))];case"DivNoNan":return[oy(nN("a",e,t,n),nN("b",e,t,n))];case"FloorDiv":return[uy(nN("a",e,t,n),nN("b",e,t,n))];case"Sub":return[xy(nN("a",e,t,n),nN("b",e,t,n))];case"Minimum":return[hy(nN("a",e,t,n),nN("b",e,t,n))];case"Maximum":return[ly(nN("a",e,t,n),nN("b",e,t,n))];case"Pow":return[gy(nN("a",e,t,n),nN("b",e,t,n))];case"SquaredDifference":return[by(nN("a",e,t,n),nN("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},VN=function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[tg(nN("x",e,t,n))];case"Acos":return[ng(nN("x",e,t,n))];case"Acosh":return[rg(nN("x",e,t,n))];case"Asin":return[ig(nN("x",e,t,n))];case"Asinh":return[ag(nN("x",e,t,n))];case"Atan":return[og(nN("x",e,t,n))];case"Atan2":return[iy(nN("x",e,t,n),nN("y",e,t,n))];case"Atanh":return[sg(nN("x",e,t,n))];case"Ceil":return[ug(nN("x",e,t,n))];case"Complex":return[pp(nN("real",e,t,n),nN("imag",e,t,n))];case"Cos":return[cg(nN("x",e,t,n))];case"Cosh":return[hg(nN("x",e,t,n))];case"Elu":return[Tb(nN("x",e,t,n))];case"Erf":return[pg(nN("x",e,t,n))];case"Exp":return[fg(nN("x",e,t,n))];case"Expm1":return[dg(nN("x",e,t,n))];case"Floor":return[mg(nN("x",e,t,n))];case"Log":return[vg(nN("x",e,t,n))];case"Log1p":return[gg(nN("x",e,t,n))];case"Imag":return[dp(nN("x",e,t,n))];case"Neg":return[bg(nN("x",e,t,n))];case"Reciprocal":return[wg(nN("x",e,t,n))];case"Real":return[fp(nN("x",e,t,n))];case"Relu":return[Fb(nN("x",e,t,n))];case"Round":return[xg(nN("x",e,t,n))];case"Selu":return[Lb(nN("x",e,t,n))];case"Sigmoid":return[kg(nN("x",e,t,n))];case"Sin":return[Ng(nN("x",e,t,n))];case"Sign":return[Eg(nN("x",e,t,n))];case"Sinh":return[Dg(nN("x",e,t,n))];case"Softplus":return[Ig(nN("x",e,t,n))];case"Sqrt":return[Tg(nN("x",e,t,n))];case"Square":return[eg(nN("x",e,t,n))];case"Tanh":return[Fg(nN("x",e,t,n))];case"Tan":return[Og(nN("x",e,t,n))];case"Relu6":case"ClipByValue":return[lg(nN("x",e,t,n),nN("clipValueMin",e,t,n),nN("clipValueMax",e,t,n))];case"Rsqrt":return[Cg(rN(e.inputNames[0],t,n))];case"Prod":return[Ib(nN("x",e,t,n),nN("axes",e,t,n))];case"LeakyRelu":return[Rb(nN("x",e,t,n),nN("alpha",e,t,n))];case"Prelu":return[Ob(nN("x",e,t,n),nN("alpha",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},WN=function(){function e(t,n,r,i,a,o,s){this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=e.nextId++}return Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.clearAndClose=function(){this.tensors.forEach((function(e){return e.tensor.dispose()})),this.tensors=[],this.closed_=!0},e.prototype.size=function(){return this.tensors.length},e.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},e.prototype.readMany=function(e){var t=this;return e.map((function(e){return t.read(e)}))},e.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,n.written=!0,this.tensors[e]=n},e.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach((function(e,r){return n.write(e,t[r])}))},e.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return mp([],[0].concat(this.elementShape));var r=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),yf(r,0)},e.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return mp([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),Ip(r,0)},e.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,xf(t,0))},e.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var r=0,i=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var a=0===r?0:t.size/r,o=[];Kh((function(){t=t.reshape([1,r,a]);for(var s=0;s<e.length;++s)o[s]=db(t,[0,0===s?0:i[s-1],0],[1,e[s],a]).reshape(n.elementShape);return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)},e.prototype.assertShapesMatchAllowUndefinedSize=function(e,t,n){void 0===n&&(n=""),lc.assert(this.shapesEqualAllowUndefinedSize(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))},e.prototype.shapesEqualAllowUndefinedSize=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0},e.nextId=0,e}(),UN=function(e,t,n){switch(e.op){case"Conv1D":var r=nN("stride",e,t,n),i=nN("pad",e,t,n),a=nN("dataFormat",e,t,n).toUpperCase(),o=nN("dilation",e,t,n);return[Uy(nN("x",e,t,n),nN("filter",e,t,n),r,i,a,o)];case"Conv2D":r=nN("strides",e,t,n),i=nN("pad",e,t,n),a=nN("dataFormat",e,t,n).toUpperCase();var s=nN("dilations",e,t,n);return[jy(nN("x",e,t,n),nN("filter",e,t,n),[r[1],r[2]],i,a,[s[1],s[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var u=nN("fusedOps",e,t,n),l=u[0],c=u[1],h="biasadd"===l,p="prelu"===c,f="fusedbatchnorm"===l,d=nN("numArgs",e,t,n);if(h){if(p&&2!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!p&&1!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(f)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");r=nN("strides",e,t,n),i=nN("pad",e,t,n),a=nN("dataFormat",e,t,n).toUpperCase(),s=nN("dilations",e,t,n);var m=nN("args",e,t,n),v=m[0],g=m[1];return[("_FusedConv2D"===e.op?Bw.conv2d:Bw.depthwiseConv2d)({x:nN("x",e,t,n),filter:nN("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[s[1],s[2]],bias:v,activation:c,preluActivationWeights:g})];case"Conv2DBackpropInput":case"Conv2dTranspose":var y=nN("outputShape",e,t,n);return r=nN("strides",e,t,n),i=nN("pad",e,t,n),[$y(nN("x",e,t,n),nN("filter",e,t,n),y,[r[1],r[2]],i)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return r=nN("strides",e,t,n),i=nN("pad",e,t,n),s=nN("dilations",e,t,n),a=nN("dataFormat",e,t,n).toUpperCase(),[Ky(nN("input",e,t,n),nN("filter",e,t,n),[r[1],r[2]],i,a,[s[1],s[2]])];case"Conv3D":return r=nN("strides",e,t,n),i=nN("pad",e,t,n),a=nN("dataFormat",e,t,n).toUpperCase(),s=nN("dilations",e,t,n),[Hy(nN("x",e,t,n),nN("filter",e,t,n),[r[1],r[2],r[3]],i,a,[s[1],s[2],s[3]])];case"AvgPool":r=nN("strides",e,t,n),i=nN("pad",e,t,n);var b=nN("kernelSize",e,t,n);return[cb(nN("x",e,t,n),[b[1],b[2]],[r[1],r[2]],i)];case"MaxPool":return r=nN("strides",e,t,n),i=nN("pad",e,t,n),b=nN("kernelSize",e,t,n),[lb(nN("x",e,t,n),[b[1],b[2]],[r[1],r[2]],i)];case"AvgPool3D":return r=nN("strides",e,t,n),i=nN("pad",e,t,n),b=nN("kernelSize",e,t,n),[fb(nN("x",e,t,n),[b[1],b[2],b[3]],[r[1],r[2],r[3]],i)];case"MaxPool3D":return r=nN("strides",e,t,n),i=nN("pad",e,t,n),b=nN("kernelSize",e,t,n),[pb(nN("x",e,t,n),[b[1],b[2],b[3]],[r[1],r[2],r[3]],i)];default:throw TypeError("Node type "+e.op+" is not implemented")}},jN=function(e,t,n){switch(e.op){case"Fill":var r=nN("shape",e,t,n),i=nN("dtype",e,t,n);return[_p(r,nN("value",e,t,n),i)];case"LinSpace":var a=nN("start",e,t,n);return[Ap(a,nN("stop",e,t,n),nN("num",e,t,n))];case"Multinomial":var o=nN("logits",e,t,n),s=nN("numSamples",e,t,n),u=nN("seed",e,t,n);return[rf(o,s,u)];case"OneHot":var l=nN("indices",e,t,n),c=nN("depth",e,t,n),h=nN("onValue",e,t,n),p=nN("offValue",e,t,n);return[af(l,c,h,p)];case"Ones":return[kp(nN("shape",e,t,n),nN("dtype",e,t,n))];case"OnesLike":return[Np(nN("x",e,t,n))];case"RandomUniform":return[df(nN("shape",e,t,n),nN("minval",e,t,n),nN("maxval",e,t,n),nN("dtype",e,t,n))];case"Range":return[Sp(a=nN("start",e,t,n),nN("stop",e,t,n),nN("step",e,t,n),nN("dtype",e,t,n))];case"TruncatedNormal":r=nN("shape",e,t,n);var f=nN("mean",e,t,n),d=nN("stdDev",e,t,n);return u=nN("seed",e,t,n),[wf(r,f,d,nN("dtype",e,t,n),u)];case"Zeros":return[Ep(nN("shape",e,t,n),nN("dtype",e,t,n))];case"ZerosLike":return[Dp(nN("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},HN=function(e,t,n){switch(e.op){case"TopKV2":var r=nN("x",e,t,n),i=nN("k",e,t,n),a=nN("sorted",e,t,n),o=Hb(r,i,a);return[o.values,o.indices];default:throw TypeError("Node type "+e.op+" is not implemented")}},GN=function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=nN("default",e,t,n);return[rN(e.name,t,n)||r];case"Placeholder":return[rN(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[nN("x",e,t,n).clone()];case"IdentityN":return nN("x",e,t,n).map((function(e){return e.clone()}));case"Snapshot":return[nN("x",e,t,n).clone()];case"Shape":return[yp(nN("x",e,t,n).shape,"int32")];case"ShapeN":return nN("x",e,t,n).map((function(e){return yp(e.shape)}));case"Size":return[gp(nN("x",e,t,n).size,"int32")];case"Rank":return[gp(nN("x",e,t,n).rank,"int32")];case"NoOp":return[gp(1)];case"Print":var i=nN("x",e,t,n),a=nN("data",e,t,n),o=nN("message",e,t,n),s=nN("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<a.length;u++)console.log(Array.prototype.slice.call(a[u].dataSync()).slice(0,s));return[i];default:throw TypeError("Node type "+e.op+" is not implemented")}},qN=function(e,t,n){switch(e.op){case"ResizeBilinear":var r=nN("images",e,t,n),i=nN("size",e,t,n),a=nN("alignCorners",e,t,n);return[Dw.resizeBilinear(r,[i[0],i[1]],a)];case"ResizeNearestNeighbor":return r=nN("images",e,t,n),i=nN("size",e,t,n),a=nN("alignCorners",e,t,n),[Dw.resizeNearestNeighbor(r,[i[0],i[1]],a)];case"CropAndResize":var o=nN("image",e,t,n),s=nN("boxes",e,t,n),u=nN("boxInd",e,t,n),l=nN("cropSize",e,t,n),c=nN("method",e,t,n),h=nN("extrapolationValue",e,t,n);return[Dw.cropAndResize(o,s,u,l,c,h)];default:throw TypeError("Node type "+e.op+" is not implemented")}},KN=function(e,t,n){switch(e.op){case"Equal":return[ky(nN("a",e,t,n),nN("b",e,t,n))];case"NotEqual":return[Oy(nN("a",e,t,n),nN("b",e,t,n))];case"Greater":return[_y(nN("a",e,t,n),nN("b",e,t,n))];case"GreaterEqual":return[Ay(nN("a",e,t,n),nN("b",e,t,n))];case"Less":return[Dy(nN("a",e,t,n),nN("b",e,t,n))];case"LessEqual":return[Iy(nN("a",e,t,n),nN("b",e,t,n))];case"LogicalAnd":return[Qg(nN("a",e,t,n),nN("b",e,t,n))];case"LogicalNot":return[Zg(nN("a",e,t,n))];case"LogicalOr":return[$g(nN("a",e,t,n),nN("b",e,t,n))];case"Select":return[Jg(nN("condition",e,t,n),nN("a",e,t,n),nN("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},XN=function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Jy(nN("a",e,t,n),nN("b",e,t,n),nN("transposeA",e,t,n),nN("transposeB",e,t,n))];case"Transpose":return[Bb(nN("x",e,t,n),nN("perm",e,t,n))];case"_FusedMatMul":var r=nN("fusedOps",e,t,n),i=r[1],a="biasadd"===r[0],o="prelu"===i,s=nN("numArgs",e,t,n);if(a){if(o&&2!==s)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==s)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var u=nN("args",e,t,n),l=u[0],c=u[1];return[Bw.matMul({a:nN("a",e,t,n),b:nN("b",e,t,n),transposeA:nN("transposeA",e,t,n),transposeB:nN("transposeB",e,t,n),bias:l,activation:i,preluActivationWeights:c})];default:throw TypeError("Node type "+e.op+" is not implemented")}},QN=function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Gg(nN("x",e,t,n),nN("mean",e,t,n),nN("variance",e,t,n),nN("offset",e,t,n),nN("scale",e,t,n),nN("epsilon",e,t,n))];case"LRN":return[Pb(nN("x",e,t,n),nN("radius",e,t,n),nN("bias",e,t,n),nN("alpha",e,t,n),nN("beta",e,t,n))];case"Softmax":return[Vf(nN("x",e,t,n))];case"LogSoftmax":return[Wf(nN("x",e,t,n))];case"SparseToDense":return[$b(nN("sparseIndices",e,t,n),nN("outputShape",e,t,n),nN("sparseValues",e,t,n),nN("defaultValue",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},ZN=function(e,t,n){switch(e.op){case"Max":var r=nN("axis",e,t,n),i=nN("keepDims",e,t,n);return[_b(nN("x",e,t,n),r,i)];case"Mean":return r=nN("axis",e,t,n),i=nN("keepDims",e,t,n),[Ab(nN("x",e,t,n),r,i)];case"Min":return r=nN("axis",e,t,n),i=nN("keepDims",e,t,n),[Sb(nN("x",e,t,n),r,i)];case"Sum":return r=nN("axis",e,t,n),i=nN("keepDims",e,t,n),[Db(nN("x",e,t,n),r,i)];case"All":return r=nN("axis",e,t,n),i=nN("keepDims",e,t,n),[wb(nN("x",e,t,n),r,i)];case"Any":return r=nN("axis",e,t,n),i=nN("keepDims",e,t,n),[xb(nN("x",e,t,n),r,i)];case"ArgMax":return r=nN("axis",e,t,n),[Cb(nN("x",e,t,n),r)];case"ArgMin":return r=nN("axis",e,t,n),[kb(nN("x",e,t,n),r)];case"Prod":return r=nN("axis",e,t,n),i=nN("keepDims",e,t,n),[Ib(nN("x",e,t,n),r,i)];default:throw TypeError("Node type "+e.op+" is not implemented")}},$N=function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var r=nN("n",e,t,n),i=nN("axis",e,t,n),a=nN("tensors",e,t,n);return a=a.slice(0,r),[Ip(a,i)];case"GatherV2":case"Gather":i=nN("axis",e,t,n);var o=nN("x",e,t,n),s=nN("indices",e,t,n);return[By(o,s.asType("int32"),i)];case"ReverseV2":case"Reverse":return i=nN("axis",e,t,n),o=nN("x",e,t,n),[nb(o,i)];case"Slice":var u=nN("begin",e,t,n),l=nN("size",e,t,n);return[db(nN("x",e,t,n),u,l)];case"StridedSlice":u=nN("begin",e,t,n);var c=nN("end",e,t,n),h=nN("strides",e,t,n),p=nN("beginMask",e,t,n),f=nN("endMask",e,t,n),d=nN("ellipsisMask",e,t,n),m=nN("newAxisMask",e,t,n),v=nN("shrinkAxisMask",e,t,n),g=nN("x",e,t,n);if(1===u.length&&g.shape.length>1)for(var y=1;y<g.shape.length;y++)u.push(0),c.push(g.shape[y]),h.push(h[0]);return[jb(g,u,c,h,p,f,d,m,v)];case"Pack":return Kh((function(){var r=nN("axis",e,t,n),i=nN("tensors",e,t,n),a=i[0].shape,o=i[0].squeeze().shape,s=i.map((function(e){var t=lc.arraysEqual(e.shape,a);if(!t&&!lc.arraysEqual(e.squeeze().shape,o))throw new Error("the input tensors shape does not match");return t?e:e.reshape(a)}));return[yf(s,r)]}));case"Unpack":return Kh((function(){var r=nN("axis",e,t,n),i=nN("tensor",e,t,n);return xf(i,r)}));case"Tile":var b=nN("reps",e,t,n);return[bf(nN("x",e,t,n),b)];case"Split":case"SplitV":i=nN("axis",e,t,n);var w=nN("numOrSizeSplits",e,t,n);return Mp(nN("x",e,t,n),w,i);case"ScatterNd":s=nN("indices",e,t,n);var x=nN("values",e,t,n),C=nN("shape",e,t,n);return[Gb(s,x,C)];case"GatherNd":var k=nN("x",e,t,n);return s=nN("indices",e,t,n),[Yb(k,s)];case"SparseToDense":s=nN("sparseIndices",e,t,n),C=nN("outputShape",e,t,n);var E=nN("sparseValues",e,t,n),_=nN("defaultValue",e,t,n);return[$b(s,E,C,E.dtype===_.dtype?_:_.asType(E.dtype))];default:throw TypeError("Node type "+e.op+" is not implemented")}},YN=function(e,t,n){switch(e.op){case"FFT":return[qb(nN("x",e,t,n))];case"IFFT":return[Kb(nN("x",e,t,n))];case"RFFT":return[Xb(nN("x",e,t,n))];case"IRFFT":return[Qb(nN("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},JN=function(e,t,n){switch(e.op){case"Cast":return[$p(nN("x",e,t,n),nN("dtype",e,t,n))];case"ExpandDims":var r=nN("axis",e,t,n);return[tf(nN("x",e,t,n),r)];case"Squeeze":return r=nN("axis",e,t,n),[gf(nN("x",e,t,n),r)];case"Reshape":return[mf(nN("x",e,t,n),nN("shape",e,t,n))];case"PadV2":case"Pad":return[of(nN("x",e,t,n),sN(nN("padding",e,t,n),2),nN("constantValue",e,t,n))];case"SpaceToBatchND":var i=nN("blockShape",e,t,n),a=sN(nN("paddings",e,t,n),2);return[vf(nN("x",e,t,n),i,a)];case"BatchToSpaceND":i=nN("blockShape",e,t,n);var o=sN(nN("crops",e,t,n),2);return[Qp(nN("x",e,t,n),i,o)];case"DepthToSpace":var s=nN("blockSize",e,t,n),u=nN("dataFormat",e,t,n).toUpperCase();return[ef(nN("x",e,t,n),s,u)];default:throw TypeError("Node type "+e.op+" is not implemented")}};function eD(e,t,n){var r=function(e,t,n){switch(e.category){case"arithmetic":return zN(e,t,n);case"basic_math":return VN(e,t,n);case"control":return function(e,t,n){return YS(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h,p,f,d,m,v,g,y,b,w,x,C,k,E,_,A,S,N,D,I,T,R,O,F,M,L;return JS(this,(function(B){switch(B.label){case 0:switch(e.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[nN("pred",e,t,n).clone()]];case 2:return r=nN("pred",e,t,n),i=nN("data",e,t,n),[4,r.data()];case 3:return[2,B.sent()[0]?[void 0,i.clone()]:[i.clone(),void 0]];case 4:return[2,(a=e.inputNames.find((function(e){return void 0!==rN(e,t,n)})))?[rN(a,t,n).clone()]:void 0];case 5:return o=nN("frameName",e,t,n),s=nN("tensor",e,t,n),n.enterFrame(o),[2,[s.clone()]];case 6:return u=nN("tensor",e,t,n),n.exitFrame(),[2,[u.clone()]];case 7:return l=nN("tensor",e,t,n),n.nextIteration(),[2,[l.clone()]];case 8:return c=nN("size",e,t,n),h=nN("dtype",e,t,n),p=nN("elementShape",e,t,n),f=nN("dynamicSize",e,t,n),d=nN("clearAfterRead",e,t,n),m=nN("identicalElementShapes",e,t,n),v=nN("name",e,t,n),g=new WN(v,h,c,p,m,f,d),n.addTensorArray(g),[2,[gp(g.id),gp(1)]];case 9:return y=nN("tensorArrayId",e,t,n),b=nN("index",e,t,n),w=nN("tensor",e,t,n),n.getTensorArray(y).write(b,w),[2,[gp(1)]];case 10:return x=nN("tensorArrayId",e,t,n),C=nN("index",e,t,n),[2,[n.getTensorArray(x).read(C)]];case 11:return k=nN("tensorArrayId",e,t,n),E=nN("indices",e,t,n),_=nN("dtype",e,t,n),[2,[n.getTensorArray(k).gather(E,_)]];case 12:return A=nN("tensorArrayId",e,t,n),S=nN("indices",e,t,n),N=nN("tensor",e,t,n),n.getTensorArray(A).scatter(S,N),[2,[gp(1)]];case 13:return D=nN("tensorArrayId",e,t,n),I=n.getTensorArray(D),T=nN("dtype",e,t,n),[2,[I.concat(T)]];case 14:return R=nN("tensorArrayId",e,t,n),O=nN("tensor",e,t,n),F=nN("lengths",e,t,n),n.getTensorArray(R).split(F,O),[2,[gp(1)]];case 15:return M=nN("tensorArrayId",e,t,n),[2,[gp(n.getTensorArray(M).size(),"int32")]];case 16:return L=nN("tensorArrayId",e,t,n),n.getTensorArray(L).clearAndClose(),[2,[gp(0)]];case 17:throw TypeError("Node type "+e.op+" is not implemented")}}))}))}(e,t,n);case"convolution":return UN(e,t,n);case"creation":return jN(e,t,n);case"dynamic":return function(e,t,n){return YS(this,void 0,void 0,(function(){var r,i,a,o,s;return JS(this,(function(u){switch(u.label){case 0:switch(e.op){case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,3];case"ListDiff":return[3,5]}return[3,6];case 1:return r=nN("boxes",e,t,n),i=nN("scores",e,t,n),a=nN("maxOutputSize",e,t,n),o=nN("iouThreshold",e,t,n),s=nN("scoreThreshold",e,t,n),[4,Dw.nonMaxSuppressionAsync(r,i,a,o,s)];case 2:return[2,[u.sent()]];case 3:return[4,ey(nN("condition",e,t,n).asType("bool"))];case 4:return[2,[u.sent()]];case 5:return[2,Cf(nN("x",e,t,n),nN("y",e,t,n))];case 6:throw TypeError("Node type "+e.op+" is not implemented")}}))}))}(e,t,n);case"evaluation":return HN(e,t,n);case"image":return qN(e,t,n);case"graph":return GN(e,t,n);case"logical":return KN(e,t,n);case"matrices":return XN(e,t,n);case"normalization":return QN(e,t,n);case"reduction":return ZN(e,t,n);case"slice_join":return $N(e,t,n);case"spectral":return YN(e,t,n);case"transformation":return JN(e,t,n);case"custom":var r=tN(e.op);if(r&&r.customExecutor)return r.customExecutor(new PN(e,t,n));throw TypeError("Custom op "+e.op+" is not registered.");default:throw TypeError("Unknown op '"+e.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return r instanceof Promise?r.then((function(e){return[].concat(e)})):[].concat(r)}var tD=function(){function e(e,t){this.weightMap=e,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return e.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(e.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),e.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},e.prototype.contextIdforContexts=function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":e.frameName+"-"+e.iterationId})).join("/"):""},e.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},e.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},e.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},e.prototype.getWeight=function(e){return this.weightMap[e]},e.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},e.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},e}();function nD(e,t,n){for(var r=new Set,i=[],a=null,o=null,s=new Set,u=Object.keys(e).map((function(e){return oN(e)[0]})),l=t.slice();l.length>0;){var c=l.pop();(aD(c)||oD(c))&&null==a&&(o=(a=c).children.map((function(e){return e.name})).filter((function(e){return r.has(e)}))),r.add(c.name),null==n[c.name]&&-1===u.indexOf(c.name)&&(0!==c.inputs.length?c.inputs.forEach((function(e){s.has(e.name)||(s.add(e.name),l.push(e))})):i.push(c.name))}return{inputs:e,outputs:t,usedNodes:r,missingInputs:i,dynamicNode:a,syncInputs:o}}var rD=["Switch","Merge","Enter","Exit","NextIteration"],iD=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"];function aD(e){return rD.indexOf(e.op)>=0}function oD(e){return iD.indexOf(e.op)>=0}var sD=function(){function e(e){this.graph=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=e.outputs,this._inputs=e.inputs,this._signature=e.signature}return Object.defineProperty(e.prototype,"weightMap",{get:function(){return this._weightMap},set:function(e){var t=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this.weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this._outputs.map((function(e){return e.signatureKey||e.name}))},enumerable:!0,configurable:!0}),e.prototype.getCompilationKey=function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)},e.prototype.compile=function(e,t){var n=nD(e,t,this.weightMap),r=n.missingInputs,i=n.dynamicNode;if(null!=i)throw new Error("This execution contains the node '"+i.name+"', which has the dynamic op '"+i.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+n.syncInputs+"]");if(r.length>0){var a=t.map((function(e){return e.name})),o=Object.keys(e);throw new Error("Cannot compute the outputs ["+a+"] from the provided inputs ["+o+"]. Missing the following inputs: ["+r+"]")}return function(e,t,n){var r=n.usedNodes,i=[];Object.keys(n.inputs).map((function(e){return oN(e)[0]})).map((function(t){return e.nodes[t]})).forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var a=new Set,o=[];i.length>0;){var s=i.pop();a.add(s.name),t[s.name]||o.push(s),s.children.forEach((function(e){!a.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return a.has(e.name)}))&&i.push(e)}))}return o}(this.graph,this.weightMap,n)},e.prototype.execute=function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=r.map((function(e){return n.graph.nodes[oN(e)[0]]})),a=t.map((function(e){return n.graph.nodes[oN(e)[0]]})),o=this.getCompilationKey(i,a),s=this.compiledMap.get(o);null==s&&(s=this.compile(e,a),this.compiledMap.set(o,s));var u={};return Kh((function(){var r=new tD(n._weightMap,u),i=$S({},n.weightMap);Object.keys(e).forEach((function(t){var n=oN(t),r=n[0],a=[];a[n[1]]=e[t],i[r]=a}));for(var a=n.getFrozenTensorIds(i),o={},l=0;l<s.length;l++){var c=s[l];if(!i[c.name]){var h=eD(c,i,r);if(h instanceof Promise)throw new Error("The execution of the op '"+c.op+"' returned a promise. Please use model.executeAsync() instead.");i[c.name]=h,n.checkTensorForDisposal(c.name,c,i,r,a,t,o)}}return t.map((function(e){return rN(e,i,r)}))}))},e.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)},e.prototype.checkTensorForDisposal=function(e,t,n,r,i,a,o){"control"!==t.category&&-1===a.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[aN(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!i.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))},e.prototype.executeAsync=function(e,t){return YS(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return JS(this,(function(u){switch(u.label){case 0:return e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t),n=new tD(this._weightMap,{}),[4,this.executeWithControlFlow(e,n,t)];case 1:return r=u.sent(),i=t.map((function(e){return rN(e,r,n)})),a=new Set(i.map((function(e){return e.id}))),o=new Set(Object.keys(e).map((function(t){return e[t].id}))),Object.keys(r).forEach((function(e){r[e].forEach((function(e){!e||e.isDisposed||a.has(e.id)||o.has(e.id)||-1!==s.weightIds.indexOf(e.id)||e.dispose()}))})),[2,i]}}))}))},e.prototype.executeWithControlFlow=function(e,t,n){return YS(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,c,h,p,f,d,m,v,g,y,b=this;return JS(this,(function(w){switch(w.label){case 0:r=Object.keys(e),i=r.map((function(e){return b.graph.nodes[oN(e)[0]]})),a=n.map((function(e){return b.graph.nodes[oN(e)[0]]})),o=nD(e,a,this.weightMap),s=o.usedNodes,u=o.missingInputs,l=o.dynamicNode,c=o.syncInputs,h=i.concat(this.graph.weights).map((function(e){return{node:e,contexts:t.currentContext}})),p=$S({},this.weightMap),Object.keys(e).forEach((function(t){var n=oN(t),r=n[0],i=[];i[n[1]]=e[t],p[r]=i})),f={},d=this.getFrozenTensorIds(p),m={},w.label=1;case 1:return h.length>0?(v=this.processStack(i,h,t,p,m,d,n,f,s),[4,Promise.all(v)]):[3,3];case 2:return w.sent(),[3,1];case 3:if(null==l&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(g=a.filter((function(e){return!aD(e)&&!rN(e.name,p,t)})).map((function(e){return e.name}))).length>0)throw y="",null!=l&&(y="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+c+"]"),new Error("Cannot compute the outputs ["+g+"] from the provided inputs ["+r+"]. Consider providing the following inputs: ["+u+"]. "+y);return[2,p]}}))}))},e.prototype.processStack=function(e,t,n,r,i,a,o,s,u){for(var l=this,c=[],h=function(){var h=t.pop();n.currentContext=h.contexts;var f="";if("Enter"===h.node.op&&nN("isConstant",h.node,r,n)&&(f=iN(h.node.name,n)[0]),-1===e.indexOf(h.node)){var d=eD(h.node,r,n);f||(f=iN(h.node.name,n)[0]);var m=n.currentContext;d instanceof Promise?c.push(d.then((function(e){return r[f]=e,n.currentContext=m,l.checkTensorForDisposal(f,h.node,r,n,a,o,s),l.processChildNodes(h.node,t,n,r,i,u),e}))):(r[f]=d,p.checkTensorForDisposal(f,h.node,r,n,a,o,s),p.processChildNodes(h.node,t,n,r,i,u))}else p.processChildNodes(h.node,t,n,r,i,u)},p=this;t.length>0;)h();return c},e.prototype.processChildNodes=function(e,t,n,r,i,a){e.children.forEach((function(e){var o=iN(e.name,n)[0];!i[o]&&a.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!rN(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!rN(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})))}))},e.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))},e.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],i=oN(n)[0],a=t.graph.nodes[i];if(a.attrParams.shape&&a.attrParams.shape.value){var o=a.attrParams.shape.value,s=o.length===r.shape.length&&r.shape.every((function(e,t){return-1===o[t]||o[t]===e}));lc.assert(s,(function(){return"The shape of dict['"+a.name+"'] provided in model.execute(dict) must be ["+o+"], but was ["+r.shape+"]"}))}a.attrParams.dtype&&a.attrParams.dtype.value&&lc.assert(r.dtype===a.attrParams.dtype.value,(function(){return"The dtype of dict['"+a.name+"'] provided in model.execute(dict) must be "+a.attrParams.dtype.value+", but was "+r.dtype}))}))},e.prototype.mapInputs=function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t},e.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter((function(e){var n=oN(e)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},e.prototype.mapOutputs=function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})},e.prototype.checkOutputs=function(e){var t=this;e.forEach((function(e){var n=oN(e)[0];if(!t.graph.nodes[n])throw new Error("The output '"+e+"' is not found in the graph")}))},e}();!function(){function e(e,t){void 0===t&&(t={}),this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={})}Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=jx.browserHTTPRequest(e,this.loadOptions);else{var t=jx.getLoadHandlers(e,this.loadOptions.onProgress);if(0===t.length)t.push(jx.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return YS(this,void 0,void 0,(function(){var e,t,n,r;return JS(this,(function(i){switch(i.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return e=i.sent(),n={},null!=e.userDefinedMetadata&&(n=e.userDefinedMetadata.signature),this.version=(t=e.modelTopology).versions.producer+"."+t.versions.minConsumer,r=jx.decodeWeights(e.weightData,e.weightSpecs),this.executor=new sD(EN.Instance.transformGraph(t,n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),[2,!0]}}))}))},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.normalizeInputs=function(e){if(!(e instanceof wc||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})},e.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},e.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},e.prototype.executeAsync=function(e,t){return YS(this,void 0,void 0,(function(){var n;return JS(this,(function(r){switch(r.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return[2,(n=r.sent()).length>1?n:n[0]]}}))}))},e.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})},e.prototype.dispose=function(){this.executor.dispose()}}();var uD=function(e,t){return(uD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function lD(e,t){function n(){this.constructor=e}uD(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function cD(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function hD(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function pD(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var fD=pD((function(e){!function(e,t,n){function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),i=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),dD=pD((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),mD=pD((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),vD=pD((function(e){!function(e,t,n){function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.x&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),gD=pD((function(e){!function(e,t,n){function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n=i[a]=(n^=n>>>15)^(e^=e>>>12),t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=0==(n=s[127&a]^=r+(o=o+1640531527|0))?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,s[i]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=i}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.X&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),yD=pD((function(e){!function(e,t,n){function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),bD=pD((function(e){!function(t,r){var i,a=this,o=256,s=6,u="random",l=r.pow(o,s),c=r.pow(2,52),h=2*c,p=o-1;function f(e,n,f){var g=[],y=m(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,v(t)]}}():e,3),g),b=new function(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=p&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=p&i+1],n=n*o+s[p&(s[i]=s[a=p&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}(g),w=function(){for(var e=b.g(s),t=l,n=0;e<c;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,m(v(b.S),t),(n.pass||f||function(e,t,n,i){return i&&(i.S&&d(i,b),e.state=function(){return d(b,{})}),n?(r[u]=e,t):e})(w,y,"global"in n?n.global:this==r,n.state)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[p&i]=p&(n^=19*t[p&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+u]=f,m(r.random(),t),e.exports){e.exports=f;try{i=n(4)}catch(e){}}}([],Math)}));bD.alea=fD,bD.xor128=dD,bD.xorwow=mD,bD.xorshift7=vD,bD.xor4096=gD,bD.tychei=yD;var wD=bD.alea;function xD(e,t,n,r){if(void 0===n&&(n=new Map),void 0===r&&(r=new Set),null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(ED(e)){var a=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=xD(e[o],t,n,r);a[o]=s}return r.delete(e),a}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,i.value),i.value}function CD(e){return null===e?null:ED(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function kD(e,t){return cD(this,void 0,void 0,(function(){var n,r,i,a,o,s;return hD(this,(function(u){switch(u.label){case 0:n=new Map,xD(e,t,n),r=0,i=Array.from(n.keys()),u.label=1;case 1:return r<i.length?(o=n.get(a=i[r]))instanceof Promise?[4,o]:[3,3]:[3,4];case 2:s=u.sent(),n.set(a,s),u.label=3;case 3:return r++,[3,1];case 4:return[2,xD(e,t,n)]}}))}))}function ED(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof wc))}function _D(e){return function(e,t){return xD(e,t)}(e,AD)}function AD(e){return e instanceof wc?{value:e.clone(),recurse:!1}:ED(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var SD=function(){function e(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return e.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},e.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},e.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},e.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},e.prototype.isFull=function(){return this.length()===this.capacity},e.prototype.isEmpty=function(){return 0===this.length()},e.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},e.prototype.pushAll=function(e){for(var t=0,n=e;t<n.length;t++)this.push(n[t])},e.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},e.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},e.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},e.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},e}(),ND=function(e){function t(){return e.call(this,t.INITIAL_CAPACITY)||this}return lD(t,e),t.prototype.isFull=function(){return!1},t.prototype.push=function(t){e.prototype.isFull.call(this)&&this.expand(),e.prototype.push.call(this,t)},t.prototype.unshift=function(t){e.prototype.isFull.call(this)&&this.expand(),e.prototype.unshift.call(this,t)},t.prototype.expand=function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n},t.INITIAL_CAPACITY=32,t}(SD);function DD(e){return new FD(e)}function ID(e,t){return new GD(e,t)}var TD,RD=function(){function e(){}return e.prototype.toArray=function(){return cD(this,void 0,void 0,(function(){var e,t;return hD(this,(function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}}))}))},e.prototype.toArrayForTest=function(){return cD(this,void 0,void 0,(function(){var e,t,n;return hD(this,(function(r){switch(r.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=r.sent(),r.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=r.sent(),[3,2];case 4:return[2,t]}}))}))},e.prototype.resolveFully=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}}))}))},e.prototype.resolveWhile=function(e){return cD(this,void 0,void 0,(function(){var t,n;return hD(this,(function(r){switch(r.label){case 0:return[4,this.next()];case 1:t=r.sent(),n=e(t.value),r.label=2;case 2:return t.done||!n?[3,4]:[4,this.next()];case 3:return t=r.sent(),n=e(t.value),[3,2];case 4:return[2]}}))}))},e.prototype.handleErrors=function(e){return new WD(this,e)},e.prototype.filter=function(e){return new zD(this,e)},e.prototype.map=function(e){return new VD(this,e)},e.prototype.mapAsync=function(e){return new UD(this,e)},e.prototype.serialMapAsync=function(e){return new UD(this,e).serial()},e.prototype.flatmap=function(e){return new HD(this,e)},e.prototype.forEachAsync=function(e){return cD(this,void 0,void 0,(function(){return hD(this,(function(t){return[2,this.map(e).resolveFully()]}))}))},e.prototype.serialForEach=function(e){return cD(this,void 0,void 0,(function(){return hD(this,(function(t){return[2,this.serialMapAsync(e).resolveWhile((function(e){return!0===e}))]}))}))},e.prototype.rowMajorBatch=function(e,t){return void 0===t&&(t=!0),new PD(this,e,t)},e.prototype.columnMajorBatch=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=CD),this.rowMajorBatch(e,t).map((function(e){return function(e,t){return void 0===t&&(t=CD),function e(t,n,r){void 0===r&&(r=new Set);var i=t[0];if(r.has(i))throw new Error("Circular references are not supported.");var a=n(t);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(ED(i)){var o=Array.isArray(i)?[]:{};r.add(i);var s=function(i){var a=e(t.map((function(e){return e[i]})),n,r);o[i]=a};for(var u in i)s(u);return r.delete(i),o}throw new Error("Can't recurse into non-iterable type: "+i)}return a.value}(e,t)}(e,n)}))},e.prototype.concatenate=function(e,t){return new GD(function(e){return new OD(e)}([this,e]),t)},e.prototype.take=function(e){return e<0||null==e?this:new BD(this,e)},e.prototype.skip=function(e){return e<0||null==e?this:new LD(this,e)},e.prototype.prefetch=function(e){return new qD(this,e)},e.prototype.shuffle=function(e,t){return new KD(this,e,t)},e.prototype.serial=function(){return new MD(this)},e}(),OD=function(e){function t(t){var n=e.call(this)||this;return n.items=t,n.trav=0,n}return lD(t,e),t.prototype.summary=function(){return"Array of "+this.items.length+" items"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(e=this.items[this.trav],this.trav++,[2,{value:_D(e),done:!1}])}))}))},t}(RD),FD=function(e){function t(t){var n=e.call(this)||this;return n.nextFn=t,n}return lD(t,e),t.prototype.summary=function(){return"Function call"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){try{return[2,this.nextFn()]}catch(e){throw e.message="Error thrown while iterating through a dataset: "+e.message,e}return[2]}))}))},t}(RD),MD=function(e){function t(t){var n=e.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return[2,this.upstream.next()]}))}))},t}(RD),LD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.maxCount=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){switch(t.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(e=t.sent()).done?[2,e]:(Xh(e.value),[3,0]);case 2:return[2,this.upstream.next()]}}))}))},t}(RD),BD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.maxCount=n,r.count=0,r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Take"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]}))}))},t}(RD),PD=function(e){function t(t,n,r){void 0===r&&(r=!0);var i=e.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=r,i.lastRead=Promise.resolve({value:null,done:!1}),i}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){var e,t;return hD(this,(function(n){switch(n.label){case 0:e=[],n.label=1;case 1:return e.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(t=n.sent()).done?this.enableSmallLastBatch&&e.length>0?[2,{value:e,done:!1}]:[2,{value:null,done:!0}]:(e.push(t.value),[3,1]);case 3:return[2,{value:e,done:!1}]}}))}))},t}(RD),zD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.predicate=n,r.lastRead=Promise.resolve({value:null,done:!1}),r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){switch(t.label){case 0:return[4,this.upstream.next()];case 1:return(e=t.sent()).done||this.predicate(e.value)?[2,e]:(Xh(e.value),[3,0]);case 2:return[2]}}))}))},t}(RD),VD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Map"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return hD(this,(function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((e=s.sent()).done)return[2,{value:null,done:!0}];for(t=Mc.getTensorsInContainer(e.value),n=this.transform(e.value),r=Mc.getTensorsInContainer(n),i=0,a=t;i<a.length;i++)Mc.isTensorInList(o=a[i],r)||o.dispose();return[2,{value:n,done:!1}]}}))}))},t}(RD),WD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.handler=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){switch(t.label){case 0:t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,t.sent()];case 3:return e=t.sent(),this.handler(e)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}}))}))},t}(RD),UD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return hD(this,(function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:return(e=s.sent()).done?[2,{value:null,done:!0}]:(t=Mc.getTensorsInContainer(e.value),[4,this.transform(e.value)]);case 2:for(n=s.sent(),r=Mc.getTensorsInContainer(n),i=0,a=t;i<a.length;i++)Mc.isTensorInList(o=a[i],r)||o.dispose();return[2,{value:n,done:!1}]}}))}))},t}(RD),jD=function(e){function t(){var t=e.call(this)||this;return t.outputQueue=new ND,t.lastRead=Promise.resolve({value:null,done:!1}),t}return lD(t,e),t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return e.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}}))}))},t}(RD),HD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},t.prototype.pump=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return hD(this,(function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((e=s.sent()).done)return[2,!1];for(t=Mc.getTensorsInContainer(e.value),n=this.transform(e.value),r=Mc.getTensorsInContainer(n),this.outputQueue.pushAll(n),i=0,a=t;i<a.length;i++)Mc.isTensorInList(o=a[i],r)||o.dispose();return[2,!0]}}))}))},t}(jD),GD=function(e){function t(t,n){var r=e.call(this)||this;return r.baseErrorHandler=n,r.lastRead=null,r.iterator=null,r.moreIterators=t,r}return lD(t,e),t.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]}))}))},t.prototype.readFromChain=function(e){return cD(this,void 0,void 0,(function(){var t,n;return hD(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return r.sent(),null!=this.iterator?[3,3]:[4,this.moreIterators.next()];case 2:if((t=r.sent()).done)return[2,{value:null,done:!0}];this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),r.label=3;case 3:return[4,this.iterator.next()];case 4:return(n=r.sent()).done?(this.iterator=null,[2,this.readFromChain(e)]):[2,n]}}))}))},t}(RD);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(TD||(TD={})),function(e){function t(t,n){void 0===n&&(n=TD.FAIL);var r=e.call(this)||this;return r.iterators=t,r.mismatchMode=n,r.count=0,r.currentPromise=null,r}lD(t,e),t.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},t.prototype.nextState=function(e){return cD(this,void 0,void 0,(function(){function t(e){return e instanceof RD?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}}var n,r,i;return hD(this,(function(a){switch(a.label){case 0:return[4,e];case 1:return a.sent(),n=0,r=0,[4,kD(this.iterators,t)];case 2:if(i=a.sent(),n===r)return[2,{value:null,done:!0}];if(r>0)switch(this.mismatchMode){case TD.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case TD.SHORTEST:return[2,{value:null,done:!0}]}return this.count++,[2,{value:i,done:!1}]}}))}))},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]}))}))}}(RD);var qD=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.bufferSize=n,r.buffer=new SD(n),r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},t.prototype.refill=function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}},t.prototype.next=function(){return this.refill(),this.buffer.shift()},t}(RD),KD=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=wD(r||lc.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return lD(t,e),t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e=this;return hD(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.randomInt=function(e){return Math.floor(this.random()*e)},t.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},t.prototype.serialNext=function(){return cD(this,void 0,void 0,(function(){var e,t;return hD(this,(function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(e=this.chooseIndex(),[4,this.buffer.shuffleExcise(e)]);case 2:return(t=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,t]);case 3:return[2,{value:null,done:!0}]}}))}))},t}(qD),XD=function(){function e(){this.size=null}return e.prototype.batch=function(e,t){var n=this;void 0===t&&(t=!0);var r=this;return lc.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      "+e})),QD((function(){return cD(n,void 0,void 0,(function(){return hD(this,(function(n){switch(n.label){case 0:return[4,r.iterator()];case 1:return[2,n.sent().columnMajorBatch(e,t,ZD)]}}))}))}),this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e))},e.prototype.concatenate=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){var t,r;return hD(this,(function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return r=(t=i.sent()).concatenate,[4,e.iterator()];case 2:return[2,r.apply(t,[i.sent()])]}}))}))}),this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null)},e.prototype.filter=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().filter((function(t){return Kh((function(){return e(t)}))}))]}}))}))}),this.size===1/0?1/0:null)},e.prototype.forEachAsync=function(e){return cD(this,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}}))}))},e.prototype.forEach=function(e){return cD(this,void 0,void 0,(function(){return hD(this,(function(t){return Gh("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(e)]}))}))},e.prototype.map=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().map((function(t){return Kh((function(){return e(t)}))}))]}}))}))}),this.size)},e.prototype.mapAsync=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().mapAsync(e)]}}))}))}),this.size)},e.prototype.prefetch=function(e){var t=this;if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return QD((function(){return cD(t,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().prefetch(e)]}}))}))}),this.size)},e.prototype.repeat=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){var t=this;return hD(this,(function(r){return[2,ID(DD((function(){return cD(t,void 0,void 0,(function(){var e;return hD(this,(function(t){switch(t.label){case 0:return e={},[4,n.iterator()];case 1:return[2,(e.value=t.sent(),e.done=!1,e)]}}))}))})).take(e))]}))}))}),null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null)},e.prototype.skip=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().skip(e)]}}))}))}),null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null)},e.prototype.shuffle=function(e,t,n){var r=this;if(void 0===n&&(n=!0),null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var i=this,a=wD(t||lc.now().toString());return QD((function(){return cD(r,void 0,void 0,(function(){var t;return hD(this,(function(r){switch(r.label){case 0:return t=a.int32(),n&&(t+=a.int32()),[4,i.iterator()];case 1:return[2,r.sent().shuffle(e,t.toString())]}}))}))}),this.size)},e.prototype.take=function(e){var t=this,n=this;return QD((function(){return cD(t,void 0,void 0,(function(){return hD(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().take(e)]}}))}))}),null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null)},e.prototype.toArray=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}}))}))},e.prototype.toArrayForTest=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}}))}))},e.MAX_BUFFER_SIZE=1e4,e}();function QD(e,t){return void 0===t&&(t=null),new(function(n){function r(){var e=null!==n&&n.apply(this,arguments)||this;return e.size=t,e}return lD(r,n),r.prototype.iterator=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(t){return[2,e()]}))}))},r}(XD))}function ZD(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof wc||lc.isTypedArray(e)}(e[0])?{value:$D(e),recurse:!1}:{value:null,recurse:!0}}function $D(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof wc?yf(e):mp(e)}var YD=function(e){function t(t){var n=e.call(this)||this;return n.input=t,n}return lD(t,e),t.prototype.iterator=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:return[4,this.input.iterator()];case 1:return[2,e.sent().decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e}))]}}))}))},t}(XD),JD=Symbol("out"),eI=Symbol("field"),tI=Symbol("quote"),nI=Symbol("quoteafterquote"),rI=Symbol("quoteinquote"),iI=(function(e){function t(t,n){var r=e.call(this)||this;return r.input=t,r.hasHeader=!0,r.fullColumnNames=null,r.columnNamesValidated=!1,r.columnConfigs=null,r.configuredColumnsOnly=!1,r.delimiter=",",r.delimWhitespace=!1,r.base=new YD(t),n||(n={}),r.hasHeader=!1!==n.hasHeader,r.fullColumnNames=n.columnNames,r.columnConfigs=n.columnConfigs,r.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(lc.assert(null==n.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),r.delimWhitespace=!0,r.delimiter=" "):r.delimiter=n.delimiter?n.delimiter:",",r}lD(t,e),t.prototype.columnNames=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:e.sent(),e.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}}))}))},t.prototype.setColumnNames=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r,i,a,o=this;return hD(this,(function(s){switch(s.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(e=s.sent(),!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&e&&lc.assert(e.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+o.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=e),t=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),n=Object.keys(t).filter((function(e){return t[e]>1})),lc.assert(0===n.length,(function(){return"Duplicate column names found: "+n.toString()})),this.columnConfigs)for(r=0,i=Object.keys(this.columnConfigs);r<i.length;r++)if(-1===this.fullColumnNames.indexOf(a=i[r]))throw new Error('The key "'+a+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");return this.columnNamesValidated=!0,[2]}}))}))},t.prototype.maybeReadHeaderLine=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){switch(t.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,t.sent().next()];case 2:if((e=t.sent()).done)throw new Error("No data was found for CSV parsing.");return[2,this.parseRow(e.value,!1)];case 3:return[2,null]}}))}))},t.prototype.iterator=function(){return cD(this,void 0,void 0,(function(){var e,t=this;return hD(this,(function(n){switch(n.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:n.sent(),n.label=2;case 2:return[4,this.base.iterator()];case 3:return e=n.sent(),this.hasHeader&&(e=e.skip(1)),[2,e.map((function(e){return t.makeDataElement(e)}))]}}))}))},t.prototype.makeDataElement=function(e){for(var t=this.parseRow(e),n={},r={},i=0;i<this.fullColumnNames.length;i++){var a=this.fullColumnNames[i],o=this.columnConfigs?this.columnConfigs[a]:null;if(!this.configuredColumnsOnly||o){var s=t[i],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column "+a+" is empty in this line: "+e);u=void 0}else{var l=Number(s);if(isNaN(l))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":u=l;break;case"int32":u=Math.floor(l);break;case"bool":u=this.getBoolean(s);break;default:u=l}else u=l}o&&o.isLabel?r[a]=u:n[a]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}},t.prototype.getBoolean=function(e){return"1"===e||"true"===e.toLowerCase()?1:0},t.prototype.parseRow=function(e,t){void 0===t&&(t=!0);for(var n=[],r=0,i=e.length,a=JD,o=0;o<i;o++)switch(a){case JD:switch(e.charAt(o)){case'"':r=o+1,a=tI;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),a=JD;break;default:a=eI,r=o}break;case eI:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),a=JD,r=o+1}break;case tI:switch(e.charAt(o)){case'"':a=nI}break;case nI:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),a=JD,r=o+1;break;case'"':a=tI;break;default:a=rI}break;case rI:switch(e.charAt(o)){case'"':a=tI}}if(n.push(a===nI?e.substring(r,i-1):e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+n);return n}}(XD),function(e){function t(t){var n=e.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var r=Math.log2(n.fftSize);if(n.fftSize<0||r<4||r>14||!Number.isInteger(r))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+n.fftSize);if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=!1!==t.includeSpectrogram,n.includeWaveform=!0===t.includeWaveform,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}lD(t,e),t.prototype.summary=function(){return"microphone"},t.create=function(e){return void 0===e&&(e={}),cD(this,void 0,void 0,(function(){var n;return hD(this,(function(r){switch(r.label){case 0:if(dl().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(n=new t(e)).start()];case 1:return r.sent(),[2,n]}}))}))},t.prototype.start=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r;return hD(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=this,[4,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})];case 1:return e.stream=i.sent(),[3,3];case 2:throw t=i.sent(),new Error("Error thrown while initializing video stream: "+t.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(n=window.AudioContext||window.webkitAudioContext,this.audioContext=new n,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return r=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,r.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}}))}))},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r,i;return hD(this,(function(a){switch(a.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return n=a.sent(),this.includeSpectrogram&&(r=this.flattenQueue(n.freqDataQueue),e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(n.timeDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:e,waveform:t},done:!1}]}}))}))},t.prototype.capture=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}}))}))},t.prototype.getAudioData=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r=this;return hD(this,(function(i){return e=[],t=[],n=0,[2,new Promise((function(i){var a=setInterval((function(){r.includeSpectrogram&&(r.analyser.getFloatFrequencyData(r.freqData),r.freqData[0]===-1/0&&i({freqDataQueue:e,timeDataQueue:t}),e.push(r.freqData.slice(0,r.columnTruncateLength))),r.includeWaveform&&(r.analyser.getFloatTimeDomainData(r.timeData),t.push(r.timeData.slice())),++n===r.numFrames&&(clearInterval(a),i({freqDataQueue:e,timeDataQueue:t}))}),r.fftSize/r.sampleRateHz*1e3)}))]}))}))},t.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},t.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},t.prototype.getSampleRate=function(){return this.sampleRateHz},t.prototype.flattenQueue=function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n},t.prototype.getTensorFromAudioDataArray=function(e,t){var n=new Float32Array(lc.sizeFromShape(t));return n.set(e,n.length-e.length),mp(n,t)}}(RD),function(e){function t(t,n){var r=e.call(this)||this;if(r.webcamVideoElement=t,r.webcamConfig=n,r.isClosed=!0,r.resize=!1,r.needToResize())if(r.resize=!0,r.cropSize=[r.webcamConfig.resizeHeight,r.webcamConfig.resizeWidth],r.cropBoxInd=yp([0],"int32"),r.webcamConfig.centerCrop){var i=1*r.webcamConfig.resizeWidth/r.webcamVideoElement.width,a=1*r.webcamConfig.resizeHeight/r.webcamVideoElement.height,o=(1-i)/2,s=(1-a)/2;r.cropBox=bp([s,o,a+s,o+i],[1,4])}else r.cropBox=bp([0,0,1,1],[1,4]);return r}lD(t,e),t.prototype.summary=function(){return"webcam"},t.create=function(e,n){return void 0===n&&(n={}),cD(this,void 0,void 0,(function(){var r;return hD(this,(function(i){switch(i.label){case 0:if(dl().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}return[4,(r=new t(e,n)).start()];case 1:return i.sent(),[2,r]}}))}))},t.prototype.start=function(){return cD(this,void 0,void 0,(function(){var e,t,n=this;return hD(this,(function(r){switch(r.label){case 0:this.webcamConfig.facingMode&&lc.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: "+n.webcamConfig.facingMode+". Please provide 'user' or 'environment'"})),r.label=1;case 1:return r.trys.push([1,3,,4]),e=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return e.stream=r.sent(),[3,4];case 3:throw(t=r.sent()).message="Error thrown while initializing video stream: "+t.message,t;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise((function(e){n.webcamVideoElement.onloadedmetadata=function(){e()}}))]}}))}))},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){if(this.isClosed)return[2,{value:null,done:!0}];try{e=qx.fromPixels(this.webcamVideoElement)}catch(e){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(e))}if(!this.resize)return[2,{value:e,done:!1}];try{return[2,{value:this.cropAndResizeFrame(e),done:!1}]}catch(e){throw new Error("Error thrown cropping the video: "+e.message)}finally{e.dispose()}return[2]}))}))},t.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},t.prototype.cropAndResizeFrame=function(e){var t=this;return Kh((function(){var n,r=e.toFloat().expandDims(0),i=(n=Dw.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return n.reshape(i.slice(1))}))},t.prototype.capture=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}}))}))},t.prototype.stop=function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0},t.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")}}(RD),function(){}),aI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lD(t,e),t.prototype.split=function(e){return new oI(this,e)},t}(RD),oI=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.impl=new sI(t,n),r}return lD(t,e),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return[2,this.impl.next()]}))}))},t}(aI),sI=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.separator=n,r.carryover="",r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},t.prototype.pump=function(){return cD(this,void 0,void 0,(function(){var e,t,n,r;return hD(this,(function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:if((e=i.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((t=e.value.split(this.separator))[0]=this.carryover+t[0],n=0,r=t.slice(0,-1);n<r.length;n++)this.outputQueue.push(r[n]);return this.carryover=t[t.length-1],[2,!0]}}))}))},t}(jD),uI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lD(t,e),t.prototype.decodeUTF8=function(){return new lI(this)},t}(RD),lI=function(e){function t(t){var n=e.call(this)||this;return n.upstream=t,n.impl=new cI(t),n}return lD(t,e),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return[2,this.impl.next()]}))}))},t}(aI),cI=function(e){function t(t){var r=e.call(this)||this;if(r.upstream=t,dl().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var i=n(5).StringDecoder;r.decoder=new i("utf8")}return r}return lD(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},t.prototype.pump=function(){return cD(this,void 0,void 0,(function(){var e,t,n;return hD(this,(function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return(e=r.sent()).done?[2,!1]:(t=e.value,n=dl().get("IS_BROWSER")?this.decoder.decode(t,{stream:!0}):this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),[2,!0])}}))}))},t}(jD),hI=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.file=t,r.options=n,lc.assert(t instanceof Uint8Array||!!dl().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=n.offset||0,r.chunkSize=n.chunkSize||1048576,r}return lD(t,e),t.prototype.summary=function(){return"FileChunks "+this.file},t.prototype.next=function(){return cD(this,void 0,void 0,(function(){var e,t,n=this;return hD(this,(function(r){switch(r.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(e=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var i=new FileReader;i.onload=function(n){var r=i.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},i.onabort=function(e){return t(new Error("Aborted"))},i.onerror=function(e){return t(new Error(e.type))};var a=n.file.slice(n.offset,r);i.readAsArrayBuffer(a)}n.offset=r})),t={},[4,e]);case 1:return[2,(t.value=r.sent(),t.done=!1,t)]}}))}))},t}(uI);function pI(e,t){return void 0===t&&(t={}),cD(this,void 0,void 0,(function(){var n,r,i,a,o;return hD(this,(function(s){switch(s.label){case 0:return"string"==typeof e?n=e:(n=e.url,r=fI(e)),[4,lc.fetch(n,r)];case 1:return(i=s.sent()).ok?(o=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return a=new(o.apply(Uint8Array,[void 0,s.sent()])),[2,new hI(a,t)];case 3:throw new Error(i.statusText)}}))}))}var fI=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function dI(e){return"string"==typeof e&&"file://"===e.substr(0,7)}var mI=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.input=t,r.options=n,r}return lD(t,e),t.prototype.iterator=function(){return cD(this,void 0,void 0,(function(){var e;return hD(this,(function(t){return dI(this.input)&&dl().get("IS_NODE")&&(e=n(6),this.input=e.readFileSync(this.input.substr(7))),[2,new hI(this.input,this.options)]}))}))},t}(iI);!function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.url=t,r.fileOptions=n,r}lD(t,e),t.prototype.iterator=function(){return cD(this,void 0,void 0,(function(){return hD(this,(function(e){return dI(this.url)?[2,new mI(this.url,this.fileOptions).iterator()]:[2,pI(this.url,this.fileOptions)]}))}))}}(iI);var vI,gI={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},yI=((vI=function(){function e(){_classCallCheck(this,e),this.MODEL_URL="assets/tfjs-resnet-model/model.json",this.modelClasses=gI}return _createClass(e,[{key:"loadModel",value:function(){return e=this,n=regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Fetching model..."),t=(new Date).getTime(),e.next=4,function(e,t){return null==t&&(t={}),function(e,t){return yC(this,void 0,void 0,(function(){var n;return bC(this,(function(r){if(null==t&&(t={}),"string"==typeof e){if(0===(n=jx.getLoadHandlers(e,t.onProgress)).length)n.push(jx.browserHTTPRequest(e,t));else if(n.length>1)throw new kC("Found more than one ("+n.length+") load handlers for URL '"+e+"'");e=n[0]}return[2,U_(e,void 0,t)]}))}))}(e,t)}(this.MODEL_URL);case 4:return this.model=e.sent,n=Math.round(((new Date).getTime()-t)/1e3),e.abrupt("return",(console.log("Model loaded. Time taken: ",n,"sec."),!0));case 7:case"end":return e.stop()}}),e,this)})),new((t=void 0)||(t=Promise))((function(r,i){function a(e){try{s(n.next(e))}catch(yE){i(yE)}}function o(e){try{s(n.throw(e))}catch(yE){i(yE)}}function s(e){e.done?r(e.value):new t((function(t){t(e.value)})).then(a,o)}s((n=n.apply(e,[])).next())}));var e,t,n}},{key:"predict",value:function(e){var t=qx.fromPixels(e).toFloat(),n=Dw.resizeBilinear(t,[224,224]),r=ab(n,2),i=_p([224,224,1],103.939),a=_p([224,224,1],116.779),o=_p([224,224,1],123.68),s=Ip([i,a,o],2),u=xy(r,s),l=tf(u),c=this.model.predict(l).dataSync();return this.decodeOutput(c)}},{key:"decodeOutput",value:function(e){var t=this,n=[];return e.forEach((function(e,r){n.push({class:t.modelClasses[r],prob:e})})),n.sort((function(e,t){return t.prob-e.prob})),n.slice(0,3)}}]),e}()).ngInjectableDef=re({factory:function(){return new vI},token:vI,providedIn:"root"}),vI),bI=zn({encapsulation:0,styles:[[".cell[_ngcontent-%COMP%]{position:relative;height:150px;margin:10px;background:#fff;cursor:pointer;box-shadow:4px 4px 6px 2px rgba(0,0,0,.7)}.cell[_ngcontent-%COMP%]:hover{box-shadow:2px 2px 3px rgba(0,0,0,.6)}.cell[_ngcontent-%COMP%]:active{box-shadow:none}.image-container[_ngcontent-%COMP%]{position:relative;height:100%}.image[_ngcontent-%COMP%]{height:100%;-o-object-fit:contain;object-fit:contain}.predictions-holder[_ngcontent-%COMP%]{max-width:150px;height:100%;padding:5px;overflow:scroll}.prediction[_ngcontent-%COMP%]{margin:15px 0}.prediction-prob[_ngcontent-%COMP%]{text-align:end;font-weight:700;font-size:10px}.prediction-class[_ngcontent-%COMP%]{white-space:nowrap;margin-left:5px;font-size:14px;overflow:scroll}"]],data:{}});function wI(e){return Va(0,[(e()(),_a(0,0,null,null,9,"li",[["class","prediction"],["fxLayout","row"],["fxLayoutAlign","start center"]],null,null,null,null,null)),qr(1,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(2,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),_a(3,0,null,null,3,"p",[["class","prediction-prob"],["fxFlex","0 0 30px"]],null,null,null,null,null)),qr(4,671744,null,0,Hu,[Qt,hu,Ms,Uu,vu],{fxFlex:[0,"fxFlex"]},null),(e()(),Ba(5,null,[" ","% "])),La(6,2),(e()(),_a(7,0,null,null,2,"p",[["class","prediction-class"]],null,null,null,null,null)),(e()(),Ba(8,null,[" "," "])),La(9,1)],(function(e,t){e(t,1,0,"row"),e(t,2,0,"start center"),e(t,4,0,"0 0 30px")}),(function(e,t){var n=Ln(t,5,0,e(t,6,0,Or(t.parent.parent,0),100*t.context.$implicit.prob,"1.1-1"));e(t,5,0,n);var r=Ln(t,8,0,e(t,9,0,Or(t.parent.parent,1),t.context.$implicit.class));e(t,8,0,r)}))}function xI(e){return Va(0,[(e()(),_a(0,0,null,null,5,"div",[["class","predictions-holder"],["fxLayout","column"],["fxLayoutAlign","center"]],null,null,null,null,null)),qr(1,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(2,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),_a(3,0,null,null,2,"ul",[],null,null,null,null,null)),(e()(),Ea(16777216,null,null,1,null,wI)),qr(5,278528,null,0,os,[wn,yn,fn],{ngForOf:[0,"ngForOf"]},null)],(function(e,t){var n=t.component;e(t,1,0,"column"),e(t,2,0,"center"),e(t,5,0,n.predictions)}),null)}function CI(e){return Va(0,[Kr(0,ds,[Si]),Kr(0,fs,[]),Ia(671088640,1,{imageEl:0}),(e()(),_a(3,0,null,null,6,"div",[["class","cell"],["fxLayout","row"],["fxLayoutAlign","start start"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.predict()&&r),r}),null,null)),qr(4,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(5,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),_a(6,0,null,null,1,"div",[["class","image-container"]],null,null,null,null,null)),(e()(),_a(7,0,[[1,0],["imageSelector",1]],null,0,"img",[["alt","sample image"],["class","image"]],[[8,"src",4]],null,null,null,null)),(e()(),Ea(16777216,null,null,1,null,xI)),qr(9,16384,null,0,us,[wn,yn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,4,0,"row"),e(t,5,0,"start start"),e(t,9,0,n.predictions.length>0)}),(function(e,t){e(t,7,0,t.component.getImagePath())}))}var kI,EI=new ve("cdk-dir-doc",{providedIn:"root",factory:function(){return Se(vs)}}),_I=((kI=function(){function e(t){if(_classCallCheck(this,e),this.value="ltr",this.change=new mi,t){var n=t.documentElement?t.documentElement.dir:null,r=(t.body?t.body.dir:null)||n;this.value="ltr"===r||"rtl"===r?r:"ltr"}}return _createClass(e,[{key:"ngOnDestroy",value:function(){this.change.complete()}}]),e}()).ngInjectableDef=re({factory:function(){return new kI(Ae(EI,8))},token:kI,providedIn:"root"}),kI),AI=function e(){_classCallCheck(this,e)},SI=zn({encapsulation:0,styles:[[".heading-row[_ngcontent-%COMP%]{position:relative;width:100%;min-height:100px}.title[_ngcontent-%COMP%]{padding:15px 5px 0;font-size:48px;text-align:center;color:#000}.subtitle[_ngcontent-%COMP%]{padding:5px;font-size:20px;text-align:center;color:#777}.content[_ngcontent-%COMP%]{padding:5px}"]],data:{}});function NI(e){return Va(0,[(e()(),_a(0,0,null,null,1,"app-cell",[],null,null,null,CI,bI)),qr(1,114688,null,0,sl,[yI],{image:[0,"image"]},null)],(function(e,t){e(t,1,0,t.context.$implicit)}),null)}function DI(e){return Va(0,[(e()(),_a(0,0,null,null,21,"div",[["class","temp"]],null,null,null,null,null)),(e()(),_a(1,0,null,null,20,"div",[["class","g-page"]],null,null,null,null,null)),(e()(),_a(2,0,null,null,11,"div",[["class","heading-row"],["fxLayout","column"],["fxLayoutAlign","center"],["fxLayoutGap","gappx"]],null,null,null,null,null)),qr(3,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(4,1720320,null,0,Ru,[Qt,Gi,_I,hu,[2,Iu],vu],{fxLayoutGap:[0,"fxLayoutGap"]},null),qr(5,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),_a(6,0,null,null,3,"p",[["class","title"],["fxLayout","row"],["fxLayoutAlign","center"]],null,null,null,null,null)),qr(7,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(8,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),Ba(-1,null,[" Image Classification "])),(e()(),_a(10,0,null,null,3,"p",[["class","subtitle"],["fxLayout","row"],["fxLayoutAlign","center"]],null,null,null,null,null)),qr(11,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(12,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),Ba(-1,null,[" Using A Pretrained ResNet Model From Keras And Converted To TensorflowJs "])),(e()(),_a(14,0,null,null,7,"div",[["class","content"],["fxLayout","row"],["fxLayoutAlign","center start"]],null,null,null,null,null)),qr(15,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(16,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),_a(17,0,null,null,4,"div",[["fxLayout","row wrap"],["fxLayoutAlign","center center"]],null,null,null,null,null)),qr(18,671744,null,0,Su,[Qt,hu,[2,_u],vu],{fxLayout:[0,"fxLayout"]},null),qr(19,671744,null,0,$u,[Qt,hu,[2,Qu],vu],{fxLayoutAlign:[0,"fxLayoutAlign"]},null),(e()(),Ea(16777216,null,null,1,null,NI)),qr(21,278528,null,0,os,[wn,yn,fn],{ngForOf:[0,"ngForOf"]},null)],(function(e,t){var n=t.component;e(t,3,0,"column"),e(t,4,0,"gappx"),e(t,5,0,"center"),e(t,7,0,"row"),e(t,8,0,"center"),e(t,11,0,"row"),e(t,12,0,"center"),e(t,15,0,"row"),e(t,16,0,"center start"),e(t,18,0,"row wrap"),e(t,19,0,"center center"),e(t,21,0,n.images)}),null)}var II=function(e,t,n,r,i,a){return new kr(e,t,n,r,i,a)}("app-root",Xo,(function(e){return Va(0,[(e()(),_a(0,0,null,null,1,"app-root",[],null,null,null,DI,SI)),qr(1,114688,null,0,Xo,[yI],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),TI=null;function RI(){return TI}var OI,FI=function(e){function t(){var e;_classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._animationPrefix=null,e._transitionEnd=null;try{var n=e.createElement("div",document);if(null!=e.getStyle(n,"animationName"))e._animationPrefix="";else for(var r=["Webkit","Moz","O","ms"],i=0;i<r.length;i++)if(null!=e.getStyle(n,r[i]+"AnimationName")){e._animationPrefix="-"+r[i].toLowerCase()+"-";break}var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(a).forEach((function(t){null!=e.getStyle(n,t)&&(e._transitionEnd=a[t])}))}catch($d){e._animationPrefix=null,e._transitionEnd=null}return e}return _inherits(t,e),_createClass(t,[{key:"getDistributedNodes",value:function(e){return e.getDistributedNodes()}},{key:"resolveAndSetHref",value:function(e,t,n){e.href=null==n?t:t+"/../"+n}},{key:"supportsDOMEvents",value:function(){return!0}},{key:"supportsNativeShadowDOM",value:function(){return"function"==typeof document.body.createShadowRoot}},{key:"getAnimationPrefix",value:function(){return this._animationPrefix?this._animationPrefix:""}},{key:"getTransitionEnd",value:function(){return this._transitionEnd?this._transitionEnd:""}},{key:"supportsAnimation",value:function(){return null!=this._animationPrefix&&null!=this._transitionEnd}}]),t}(function(){function e(){_classCallCheck(this,e),this.resourceLoaderType=null}return _createClass(e,[{key:"attrToPropMap",get:function(){return this._attrToPropMap},set:function(e){this._attrToPropMap=e}}]),e}()),MI={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},LI={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},BI={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},PI=function(){if(me.Node)return me.Node.prototype.contains||function(e){return!!(16&this.compareDocumentPosition(e))}}(),zI=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e){throw new Error("parse not implemented")}},{key:"hasProperty",value:function(e,t){return t in e}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"getProperty",value:function(e,t){return e[t]}},{key:"invoke",value:function(e,t,n){e[t].apply(e,_toConsumableArray(n))}},{key:"logError",value:function(e){window.console&&(console.error?console.error(e):console.log(e))}},{key:"log",value:function(e){window.console&&window.console.log&&window.console.log(e)}},{key:"logGroup",value:function(e){window.console&&window.console.group&&window.console.group(e)}},{key:"logGroupEnd",value:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()}},{key:"contains",value:function(e,t){return PI.call(e,t)}},{key:"querySelector",value:function(e,t){return e.querySelector(t)}},{key:"querySelectorAll",value:function(e,t){return e.querySelectorAll(t)}},{key:"on",value:function(e,t,n){e.addEventListener(t,n,!1)}},{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"createMouseEvent",value:function(e){var t=this.getDefaultDocument().createEvent("MouseEvent");return t.initEvent(e,!0,!0),t}},{key:"createEvent",value:function(e){var t=this.getDefaultDocument().createEvent("Event");return t.initEvent(e,!0,!0),t}},{key:"preventDefault",value:function(e){e.preventDefault(),e.returnValue=!1}},{key:"isPrevented",value:function(e){return e.defaultPrevented||null!=e.returnValue&&!e.returnValue}},{key:"getInnerHTML",value:function(e){return e.innerHTML}},{key:"getTemplateContent",value:function(e){return"content"in e&&this.isTemplateElement(e)?e.content:null}},{key:"getOuterHTML",value:function(e){return e.outerHTML}},{key:"nodeName",value:function(e){return e.nodeName}},{key:"nodeValue",value:function(e){return e.nodeValue}},{key:"type",value:function(e){return e.type}},{key:"content",value:function(e){return this.hasProperty(e,"content")?e.content:e}},{key:"firstChild",value:function(e){return e.firstChild}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"parentElement",value:function(e){return e.parentNode}},{key:"childNodes",value:function(e){return e.childNodes}},{key:"childNodesAsList",value:function(e){for(var t=e.childNodes,n=new Array(t.length),r=0;r<t.length;r++)n[r]=t[r];return n}},{key:"clearNodes",value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"removeChild",value:function(e,t){e.removeChild(t)}},{key:"replaceChild",value:function(e,t,n){e.replaceChild(t,n)}},{key:"remove",value:function(e){return e.parentNode&&e.parentNode.removeChild(e),e}},{key:"insertBefore",value:function(e,t,n){e.insertBefore(n,t)}},{key:"insertAllBefore",value:function(e,t,n){n.forEach((function(n){return e.insertBefore(n,t)}))}},{key:"insertAfter",value:function(e,t,n){e.insertBefore(n,t.nextSibling)}},{key:"setInnerHTML",value:function(e,t){e.innerHTML=t}},{key:"getText",value:function(e){return e.textContent}},{key:"setText",value:function(e,t){e.textContent=t}},{key:"getValue",value:function(e){return e.value}},{key:"setValue",value:function(e,t){e.value=t}},{key:"getChecked",value:function(e){return e.checked}},{key:"setChecked",value:function(e,t){e.checked=t}},{key:"createComment",value:function(e){return this.getDefaultDocument().createComment(e)}},{key:"createTemplate",value:function(e){var t=this.getDefaultDocument().createElement("template");return t.innerHTML=e,t}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createElementNS",value:function(e,t,n){return(n=n||this.getDefaultDocument()).createElementNS(e,t)}},{key:"createTextNode",value:function(e,t){return(t=t||this.getDefaultDocument()).createTextNode(e)}},{key:"createScriptTag",value:function(e,t,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(e,t),r}},{key:"createStyleElement",value:function(e,t){var n=(t=t||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(e,t)),n}},{key:"createShadowRoot",value:function(e){return e.createShadowRoot()}},{key:"getShadowRoot",value:function(e){return e.shadowRoot}},{key:"getHost",value:function(e){return e.host}},{key:"clone",value:function(e){return e.cloneNode(!0)}},{key:"getElementsByClassName",value:function(e,t){return e.getElementsByClassName(t)}},{key:"getElementsByTagName",value:function(e,t){return e.getElementsByTagName(t)}},{key:"classList",value:function(e){return Array.prototype.slice.call(e.classList,0)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"setStyle",value:function(e,t,n){e.style[t]=n}},{key:"removeStyle",value:function(e,t){e.style[t]=""}},{key:"getStyle",value:function(e,t){return e.style[t]}},{key:"hasStyle",value:function(e,t,n){var r=this.getStyle(e,t)||"";return n?r==n:r.length>0}},{key:"tagName",value:function(e){return e.tagName}},{key:"attributeMap",value:function(e){for(var t=new Map,n=e.attributes,r=0;r<n.length;r++){var i=n.item(r);t.set(i.name,i.value)}return t}},{key:"hasAttribute",value:function(e,t){return e.hasAttribute(t)}},{key:"hasAttributeNS",value:function(e,t,n){return e.hasAttributeNS(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"getAttributeNS",value:function(e,t,n){return e.getAttributeNS(t,n)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"setAttributeNS",value:function(e,t,n,r){e.setAttributeNS(t,n,r)}},{key:"removeAttribute",value:function(e,t){e.removeAttribute(t)}},{key:"removeAttributeNS",value:function(e,t,n){e.removeAttributeNS(t,n)}},{key:"templateAwareRoot",value:function(e){return this.isTemplateElement(e)?this.content(e):e}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"getBoundingClientRect",value:function(e){try{return e.getBoundingClientRect()}catch($d){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}},{key:"getTitle",value:function(e){return e.title}},{key:"setTitle",value:function(e,t){e.title=t||""}},{key:"elementMatches",value:function(e,t){return!!this.isElementNode(e)&&(e.matches&&e.matches(t)||e.msMatchesSelector&&e.msMatchesSelector(t)||e.webkitMatchesSelector&&e.webkitMatchesSelector(t))}},{key:"isTemplateElement",value:function(e){return this.isElementNode(e)&&"TEMPLATE"===e.nodeName}},{key:"isTextNode",value:function(e){return e.nodeType===Node.TEXT_NODE}},{key:"isCommentNode",value:function(e){return e.nodeType===Node.COMMENT_NODE}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"hasShadowRoot",value:function(e){return null!=e.shadowRoot&&e instanceof HTMLElement}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"importIntoDoc",value:function(e){return document.importNode(this.templateAwareRoot(e),!0)}},{key:"adoptNode",value:function(e){return document.adoptNode(e)}},{key:"getHref",value:function(e){return e.getAttribute("href")}},{key:"getEventKey",value:function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&BI.hasOwnProperty(t)&&(t=BI[t]))}return LI[t]||t}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getHistory",value:function(){return window.history}},{key:"getLocation",value:function(){return window.location}},{key:"getBaseHref",value:function(e){var t,n=VI||(VI=document.querySelector("base"))?VI.getAttribute("href"):null;return null==n?null:(t=n,OI||(OI=document.createElement("a")),OI.setAttribute("href",t),"/"===OI.pathname.charAt(0)?OI.pathname:"/"+OI.pathname)}},{key:"resetBaseElement",value:function(){VI=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"setData",value:function(e,t,n){this.setAttribute(e,"data-"+t,n)}},{key:"getData",value:function(e,t){return this.getAttribute(e,"data-"+t)}},{key:"getComputedStyle",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return getComputedStyle(e)}))},{key:"supportsWebAnimation",value:function(){return"function"==typeof Element.prototype.animate}},{key:"performanceNow",value:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}},{key:"supportsCookies",value:function(){return!0}},{key:"getCookie",value:function(e){return function(e,t){t=encodeURIComponent(t);var n=!0,r=!1,i=void 0;try{for(var a,o=e.split(";")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=s.indexOf("="),l=_slicedToArray(-1==u?[s,""]:[s.slice(0,u),s.slice(u+1)],2),c=l[0],h=l[1];if(c.trim()===t)return decodeURIComponent(h)}}catch(p){r=!0,i=p}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return null}(document.cookie,e)}},{key:"setCookie",value:function(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)}},{key:"attrToPropMap",get:function(){return MI}}],[{key:"makeCurrent",value:function(){var e;e=new t,TI||(TI=e)}}]),t}(FI),VI=null;function WI(){return!!window.history.pushState}var UI=new ve("TRANSITION_ID"),jI=[{provide:yi,useFactory:function(e,t,n){return function(){n.get(bi).donePromise.then((function(){var n=RI();Array.prototype.slice.apply(n.querySelectorAll(t,"style[ng-transition]")).filter((function(t){return n.getAttribute(t,"ng-transition")===e})).forEach((function(e){return n.remove(e)}))}))}},deps:[UI,vs,kt],multi:!0}],HI=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){me.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},me.getAllAngularTestabilities=function(){return e.getAllTestabilities()},me.getAllAngularRootElements=function(){return e.getAllRootElements()},me.frameworkStabilizers||(me.frameworkStabilizers=[]),me.frameworkStabilizers.push((function(e){var t=me.getAllAngularTestabilities(),n=t.length,r=!1,i=function(t){r=r||t,0==--n&&e(r)};t.forEach((function(e){e.whenStable(i)}))}))}},{key:"findTestabilityInTree",value:function(e,t,n){if(null==t)return null;var r=e.getTestability(t);return null!=r?r:n?RI().isShadowRoot(t)?this.findTestabilityInTree(e,RI().getHost(t),!0):this.findTestabilityInTree(e,RI().parentElement(t),!0):null}}],[{key:"init",value:function(){var t;t=new e,ta=t}}]),e}();function GI(e,t){"undefined"!=typeof COMPILED&&COMPILED||((me.ng=me.ng||{})[e]=t)}var qI={ApplicationRef:ca,NgZone:Gi};function KI(e){return va(e)}var XI=new ve("EventManagerPlugins"),QI=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach((function(e){return e.manager=r})),this._plugins=t.slice().reverse()}return _createClass(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var i=n[r];if(i.supports(e))return this._eventNameToPlugin.set(e,i),i}throw new Error("No event manager plugin found for event ".concat(e))}}]),e}(),ZI=function(){function e(t){_classCallCheck(this,e),this._doc=t}return _createClass(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=RI().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),$I=function(){function e(){_classCallCheck(this,e),this._stylesSet=new Set}return _createClass(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach((function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))})),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}(),YI=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._doc=e,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(e.head),n}return _inherits(t,e),_createClass(t,[{key:"_addStylesToHost",value:function(e,t){var n=this;e.forEach((function(e){var r=n._doc.createElement("style");r.textContent=e,n._styleNodes.add(t.appendChild(r))}))}},{key:"addHost",value:function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}},{key:"removeHost",value:function(e){this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach((function(n){return t._addStylesToHost(e,n)}))}},{key:"ngOnDestroy",value:function(){this._styleNodes.forEach((function(e){return RI().remove(e)}))}}]),t}($I),JI={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},eT=/%COMP%/g,tT="_nghost-%COMP%",nT="_ngcontent-%COMP%";function rT(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?rT(e,i,n):(i=i.replace(eT,e),n.push(i))}return n}function iT(e){return function(t){!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var aT=function(){function e(t,n,r){_classCallCheck(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new oT(t)}return _createClass(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Fe.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new lT(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case Fe.Native:case Fe.ShadowDom:return new cT(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=rT(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}(),oT=function(){function e(t){_classCallCheck(this,e),this.eventManager=t,this.data=Object.create(null)}return _createClass(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(JI[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var i=JI[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=JI[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&Yt.DashCase?e.style.setProperty(t,n,r&Yt.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&Yt.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){uT(t,"property"),e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return uT(t,"listener"),"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,iT(n)):this.eventManager.addEventListener(e,t,iT(n))}}]),e}(),sT="@".charCodeAt(0);function uT(e,t){if(e.charCodeAt(0)===sT)throw new Error("Found the synthetic ".concat(t," ").concat(e,'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.'))}var lT=function(e){function t(e,n,r,i){var a;_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).component=r;var o=rT(i+"-"+r.id,r.styles,[]);return n.addStyles(o),a.contentAttr=nT.replace(eT,i+"-"+r.id),a.hostAttr=tT.replace(eT,i+"-"+r.id),a}return _inherits(t,e),_createClass(t,[{key:"applyToHost",value:function(e){_get(_getPrototypeOf(t.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,n){var r=_get(_getPrototypeOf(t.prototype),"createElement",this).call(this,e,n);return _get(_getPrototypeOf(t.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),t}(oT),cT=function(e){function t(e,n,r,i){var a;_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).sharedStylesHost=n,a.hostEl=r,a.component=i,a.shadowRoot=i.encapsulation===Fe.ShadowDom?r.attachShadow({mode:"open"}):r.createShadowRoot(),a.sharedStylesHost.addHost(a.shadowRoot);for(var o=rT(i.id,i.styles,[]),s=0;s<o.length;s++){var u=document.createElement("style");u.textContent=o[s],a.shadowRoot.appendChild(u)}return a}return _inherits(t,e),_createClass(t,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,n){return _get(_getPrototypeOf(t.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),n)}},{key:"insertBefore",value:function(e,n,r){return _get(_getPrototypeOf(t.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),n,r)}},{key:"removeChild",value:function(e,n){return _get(_getPrototypeOf(t.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),n)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(_get(_getPrototypeOf(t.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),t}(oT),hT="undefined"!=typeof Zone&&Zone.__symbol__||function(e){return"__zone_symbol__"+e},pT=hT("addEventListener"),fT=hT("removeEventListener"),dT={},mT="__zone_symbol__propagationStopped",vT=function(){var e="undefined"!=typeof Zone&&Zone[hT("BLACK_LISTED_EVENTS")];if(e){var t={};return e.forEach((function(e){t[e]=e})),t}}(),gT=function(e){return!!vT&&vT.hasOwnProperty(e)},yT=function(e){var t=dT[e.type];if(t){var n=this[t];if(n){var r=[e];if(1===n.length){var i=n[0];return i.zone!==Zone.current?i.zone.run(i.handler,this,r):i.handler.apply(this,r)}for(var a=n.slice(),o=0;o<a.length&&!0!==e[mT];o++){var s=a[o];s.zone!==Zone.current?s.zone.run(s.handler,this,r):s.handler.apply(this,r)}}}},bT=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).ngZone=n,r&&ws(r)||i.patchEvent(),i}return _inherits(t,e),_createClass(t,[{key:"patchEvent",value:function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var e=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[mT]=!0),e&&e.apply(this,arguments)}}}},{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this,i=n;if(!e[pT]||Gi.isInAngularZone()&&!gT(t))e.addEventListener(t,i,!1);else{var a=dT[t];a||(a=dT[t]=hT("ANGULAR"+t+"FALSE"));var o=e[a],s=o&&o.length>0;o||(o=e[a]=[]);var u=gT(t)?Zone.root:Zone.current;if(0===o.length)o.push({zone:u,handler:i});else{for(var l=!1,c=0;c<o.length;c++)if(o[c].handler===i){l=!0;break}l||o.push({zone:u,handler:i})}s||e[pT](t,yT,!1)}return function(){return r.removeEventListener(e,t,i)}}},{key:"removeEventListener",value:function(e,t,n){var r=e[fT];if(!r)return e.removeEventListener.apply(e,[t,n,!1]);var i=dT[t],a=i&&e[i];if(!a)return e.removeEventListener.apply(e,[t,n,!1]);for(var o=!1,s=0;s<a.length;s++)if(a[s].handler===n){o=!0,a.splice(s,1);break}o?0===a.length&&r.apply(e,[t,yT,!1]):e.removeEventListener.apply(e,[t,n,!1])}}]),t}(ZI),wT={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},xT=new ve("HammerGestureConfig"),CT=new ve("HammerLoader"),kT=function(){function e(){_classCallCheck(this,e),this.events=[],this.overrides={}}return _createClass(e,[{key:"buildHammer",value:function(e){var t=new Hammer(e,this.options);for(var n in t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),this.overrides)t.get(n).set(this.overrides[n]);return t}}]),e}(),ET=function(e){function t(e,n,r,i){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)))._config=n,a.console=r,a.loader=i,a}return _inherits(t,e),_createClass(t,[{key:"supports",value:function(e){return!(!wT.hasOwnProperty(e.toLowerCase())&&!this.isCustomEvent(e)||!window.Hammer&&!this.loader&&(this.console.warn('The "'.concat(e,'" event cannot be bound because Hammer.JS is not ')+"loaded and no custom loader has been specified."),1))}},{key:"addEventListener",value:function(e,t,n){var r=this,i=this.manager.getZone();if(t=t.toLowerCase(),!window.Hammer&&this.loader){var a=!1,o=function(){a=!0};return this.loader().then((function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(o=function(){});a||(o=r.addEventListener(e,t,n))})).catch((function(){r.console.warn('The "'.concat(t,'" event cannot be bound because the custom ')+"Hammer.JS loader failed."),o=function(){}})),function(){o()}}return i.runOutsideAngular((function(){var a=r._config.buildHammer(e),o=function(e){i.runGuarded((function(){n(e)}))};return a.on(t,o),function(){a.off(t,o),"function"==typeof a.destroy&&a.destroy()}}))}},{key:"isCustomEvent",value:function(e){return this._config.events.indexOf(e)>-1}}]),t}(ZI),_T=["alt","control","meta","shift"],AT={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},ST=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"supports",value:function(e){return null!=t.parseEventName(e)}},{key:"addEventListener",value:function(e,n,r){var i=t.parseEventName(n),a=t.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular((function(){return RI().onAndCancel(e,i.domEventName,a)}))}}],[{key:"parseEventName",value:function(e){var n=e.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;var i=t._normalizeKey(n.pop()),a="";if(_T.forEach((function(e){var t=n.indexOf(e);t>-1&&(n.splice(t,1),a+=e+".")})),a+=i,0!=n.length||0===i.length)return null;var o={};return o.domEventName=r,o.fullKey=a,o}},{key:"getEventFullKey",value:function(e){var t="",n=RI().getEventKey(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),_T.forEach((function(r){r!=n&&(0,AT[r])(e)&&(t+=r+".")})),t+=n}},{key:"eventCallback",value:function(e,n,r){return function(i){t.getEventFullKey(i)===e&&r.runGuarded((function(){return n(i)}))}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),t}(ZI),NT=function e(){_classCallCheck(this,e)},DT=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._doc=e,n}return _inherits(t,e),_createClass(t,[{key:"sanitize",value:function(e,t){if(null==t)return null;switch(e){case ft.NONE:return t;case ft.HTML:return t instanceof TT?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"HTML"),function(e,t){var n=null;try{Ye=Ye||new qe(e);var r=t?String(t):"";n=Ye.getInertBodyElement(r);var i=5,a=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=a,a=n.innerHTML,n=Ye.getInertBodyElement(r)}while(r!==a);var o=new ut,s=o.sanitizeChildren(pt(n)||n);return Ge()&&o.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=pt(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(t)));case ft.STYLE:return t instanceof RT?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"Style"),function(e){if(!(e=String(e).trim()))return"";var t=e.match(vt);return t&&Qe(t[1])===t[1]||e.match(mt)&&function(e){for(var t=!0,n=!0,r=0;r<e.length;r++){var i=e.charAt(r);"'"===i&&n?t=!t:'"'===i&&t&&(n=!n)}return t&&n}(e)?e:(Ge()&&console.warn("WARNING: sanitizing unsafe style value ".concat(e," (see http://g.co/ng/security#xss).")),"unsafe")}(t));case ft.SCRIPT:if(t instanceof OT)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"Script"),new Error("unsafe value used in a script context");case ft.URL:return t instanceof MT||t instanceof FT?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"URL"),Qe(String(t)));case ft.RESOURCE_URL:if(t instanceof MT)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext ".concat(e," (see http://g.co/ng/security#xss)"))}}},{key:"checkNotSafeValue",value:function(e,t){if(e instanceof IT)throw new Error("Required a safe ".concat(t,", got a ").concat(e.getTypeName()," ")+"(see http://g.co/ng/security#xss)")}},{key:"bypassSecurityTrustHtml",value:function(e){return new TT(e)}},{key:"bypassSecurityTrustStyle",value:function(e){return new RT(e)}},{key:"bypassSecurityTrustScript",value:function(e){return new OT(e)}},{key:"bypassSecurityTrustUrl",value:function(e){return new FT(e)}},{key:"bypassSecurityTrustResourceUrl",value:function(e){return new MT(e)}}]),t}(NT),IT=function(){function e(t){_classCallCheck(this,e),this.changingThisBreaksApplicationSecurity=t}return _createClass(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: ".concat(this.changingThisBreaksApplicationSecurity)+" (see http://g.co/ng/security#xss)"}}]),e}(),TT=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getTypeName",value:function(){return"HTML"}}]),t}(IT),RT=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getTypeName",value:function(){return"Style"}}]),t}(IT),OT=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getTypeName",value:function(){return"Script"}}]),t}(IT),FT=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getTypeName",value:function(){return"URL"}}]),t}(IT),MT=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getTypeName",value:function(){return"ResourceURL"}}]),t}(IT),LT=aa(ya,"browser",[{provide:Ei,useValue:gs},{provide:ki,useValue:function(){zI.makeCurrent(),HI.init()},multi:!0},{provide:Qo,useClass:function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._doc=e,n._init(),n}return _inherits(t,e),_createClass(t,[{key:"_init",value:function(){this.location=RI().getLocation(),this._history=RI().getHistory()}},{key:"getBaseHrefFromDOM",value:function(){return RI().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){RI().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}},{key:"onHashChange",value:function(e){RI().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}},{key:"pushState",value:function(e,t,n){WI()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){WI()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"getState",value:function(){return this._history.state}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}}]),t}(Qo),deps:[vs]},{provide:vs,useFactory:function(){return document},deps:[]}]);function BT(){return new Ue}var PT=function(){function e(t){if(_classCallCheck(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:wi,useValue:t.appId},{provide:UI,useExisting:wi},jI]}}}]),e}();"undefined"!=typeof window&&window;var zT=function e(){_classCallCheck(this,e)},VT=function e(){_classCallCheck(this,e)},WT=function(){function e(t,n){_classCallCheck(this,e),ws(n)&&!t&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}return _createClass(e,null,[{key:"withConfig",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{ngModule:e,providers:t.serverLoaded?[{provide:Ms,useValue:Object.assign({},Fs,t)},{provide:Bs,useValue:n,multi:!0},{provide:Ls,useValue:!0}]:[{provide:Ms,useValue:Object.assign({},Fs,t)},{provide:Bs,useValue:n,multi:!0}]}}}]),e}(),UT=new qo(Ko,[Xo],(function(e){return function(e){for(var t={},n=[],r=!1,i=0;i<e.length;i++){var a=e[i];a.token===xt&&!0===a.value&&(r=!0),1073741824&a.flags&&n.push(a.token),a.index=i,t[Mn(a.token)]=a}return{factory:null,providersByKey:t,providers:e,modules:n,isRoot:r}}([vr(512,Gt,qt,[[8,[II]],[3,Gt],Ie]),vr(5120,Si,xa,[[3,Si]]),vr(4608,rs,is,[Si,[2,ns]]),vr(5120,ui,Ca,[Gi]),vr(4608,Li,Li,[]),vr(5120,wi,xi,[]),vr(5120,fn,ba,[]),vr(5120,dn,wa,[]),vr(4608,NT,DT,[vs]),vr(6144,dt,null,[NT]),vr(4608,xT,kT,[]),vr(5120,XI,(function(e,t,n,r,i,a,o,s){return[new bT(e,t,n),new ST(r),new ET(i,a,o,s)]}),[vs,Gi,Ei,vs,vs,xT,Ai,[2,CT]]),vr(4608,QI,QI,[XI,Gi]),vr(135680,YI,YI,[vs]),vr(4608,aT,aT,[QI,YI,wi]),vr(6144,$t,null,[aT]),vr(6144,$I,null,[YI]),vr(4608,Ji,Ji,[Gi]),vr(5120,_i,(function(e,t){return[(n=e,r=t,function(){if(bs(r)){var e=Array.from(n.querySelectorAll("[class*=flex-layout-]")),t=/\bflex-layout-.+?\b/g;e.forEach((function(e){e.classList.contains("flex-layout-ssr")&&e.parentNode?e.parentNode.removeChild(e):e.className.replace(t,"")}))}})];var n,r}),[vs,Ei]),vr(1073742336,ms,ms,[]),vr(1024,Ue,BT,[]),vr(1024,yi,(function(e){return[(t=e,GI("probe",KI),GI("coreTokens",Object.assign({},qI,(t||[]).reduce((function(e,t){return e[t.name]=t.token,e}),{}))),function(){return KI})];var t}),[[2,ia]]),vr(512,bi,bi,[[2,yi]]),vr(131584,ca,ca,[Gi,Ai,kt,Ue,Gt,bi]),vr(1073742336,ka,ka,[ca]),vr(1073742336,PT,PT,[[3,PT]]),vr(1073742336,Ts,Ts,[]),vr(1073742336,AI,AI,[]),vr(1073742336,ol,ol,[]),vr(1073742336,zT,zT,[]),vr(1073742336,VT,VT,[]),vr(1073742336,WT,WT,[[2,Ls],Ei]),vr(1073742336,Ko,Ko,[]),vr(256,xt,!0,[])])}));(function(){if(He)throw new Error("Cannot enable prod mode after platform setup.");je=!1})(),LT().bootstrapModuleFactory(UT).catch((function(e){return console.error(e)}))},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);